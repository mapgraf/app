/* [create-plugin] version: 5.3.2 */
define(["@emotion/css","@grafana/data","@grafana/runtime","@grafana/ui","react","rxjs"],((e,t,n,r,o,i)=>(()=>{"use strict";var a={6089:t=>{t.exports=e},7781:e=>{e.exports=t},8531:e=>{e.exports=n},2007:e=>{e.exports=r},5959:e=>{e.exports=o},1269:e=>{e.exports=i}},c={};function s(e){var t=c[e];if(void 0!==t)return t.exports;var n=c[e]={exports:{}};return a[e](n,n.exports,s),n.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};s.r(l),s.d(l,{plugin:()=>w});var u=s(7781),p=s(5959),d=s.n(p);var f=s(1269),m=s(6089),g=s(8531),b=s(2007);const y={container:"data-testid ac-container",apiToken:"data-testid ac-api-key",apiPort:"data-testid ac-api-port",submit:"data-testid ac-submit-form"};function v(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){v(i,r,o,a,c,"next",e)}function c(e){v(i,r,o,a,c,"throw",e)}a(void 0)}))}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){O(e,t,n[t])}))}return e}function S(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const j=e=>({colorWeak:m.css`
    color: ${e.colors.text.secondary};
  `,marginTop:m.css`
    margin-top: ${e.spacing(3)};
  `}),h=(x=P((function*(e,t){try{yield T(e,t),window.location.reload()}catch(e){console.error("Error while updating the plugin",e)}})),function(e,t){return x.apply(this,arguments)});var x;const T=function(){var e=P((function*(e,t){const n=yield(0,g.getBackendSrv)().fetch({url:`/api/plugins/${e}/settings`,method:"POST",data:t});return(0,f.lastValueFrom)(n)}));return function(t,n){return e.apply(this,arguments)}}(),w=(new u.AppPlugin).setRootPage((function(e){return d().createElement(d().Fragment,null)})).addConfigPage({title:"Configuration",icon:"cog",body:({plugin:e})=>{const t=(0,b.useStyles2)(j),{enabled:n,pinned:r,jsonData:o,secureJsonFields:i}=e.meta,[a,c]=(0,p.useState)({apiPort:(null==o?void 0:o.apiPort)||"8089",apiToken:"",isApiTokenSet:Boolean(null==i?void 0:i.apiToken)}),[s,l]=(0,p.useState)();(0,p.useEffect)((()=>{var e;(e=P((function*(){const e=(0,g.getBackendSrv)().fetch({url:"/api/plugins/vaduga-mapgl-app/resources/ping"}),t=(yield(0,f.lastValueFrom)(e)).data;if(t){const{orgName:e,expiresAtFmt:n,expiresAt:r,domain:o,featLimit:i}=t;l({orgName:e,expiresAtFmt:n,expiresAt:r,domain:o,featLimit:i})}})),function(){return e.apply(this,arguments)})()}),[]);const u=Date.now().toString(),m=Number(u.slice(0,10))>(null==s?void 0:s.expiresAt);return d().createElement("div",{"data-testid":y.container},d().createElement(b.FieldSet,{label:"API Settings"},d().createElement(b.Field,{label:"API token",description:"A license API token"},d().createElement(b.SecretInput,{width:60,"data-testid":y.apiToken,name:"apiToken",value:a.apiToken,isConfigured:a.isApiTokenSet,placeholder:"Your secret API token",onChange:e=>{c(S(k({},a),{[e.target.name]:e.target.value.trim()}))},onReset:()=>c(S(k({},a),{apiToken:"",isApiTokenSet:!1}))})),s&&d().createElement("div",null,"licensed for: ",(null==s?void 0:s.orgName)+" , ","domain: ",null==s?void 0:s.domain,d().createElement("p",{style:m?{color:"#d10a85"}:{}},"token expir",m?"ed":"es",": ",null==s?void 0:s.expiresAtFmt)),d().createElement("div",{className:t.marginTop},d().createElement(b.Button,{type:"submit","data-testid":y.submit,onClick:()=>h(e.meta.id,{enabled:n,pinned:r,jsonData:{apiPort:a.apiPort},secureJsonData:a.isApiTokenSet?void 0:{apiToken:a.apiToken}}),disabled:Boolean(!a.apiPort||!a.isApiTokenSet&&!a.apiToken)},"Save API settings"))))},id:"configuration"});return l})()));
//# sourceMappingURL=module.js.map