/* [create-plugin] version: 5.22.1 */
define(["@grafana/ui","@emotion/css","rxjs","@grafana/runtime","@grafana/data","react"],((e,t,n,r,o,i)=>(()=>{"use strict";var a={7:t=>{t.exports=e},89:e=>{e.exports=t},269:e=>{e.exports=n},531:e=>{e.exports=r},781:e=>{e.exports=o},959:e=>{e.exports=i}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return a[e](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};c.r(l),c.d(l,{plugin:()=>j});var u=c(781),p=c(959),d=c.n(p);var g=c(269),f=c(89),m=c(531),b=c(7);const y={container:"data-testid ac-container",apiToken:"data-testid ac-api-key",apiPort:"data-testid ac-api-port",submit:"data-testid ac-submit-form"};function v(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){v(i,r,o,a,s,"next",e)}function s(e){v(i,r,o,a,s,"throw",e)}a(void 0)}))}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}function h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const w=e=>({colorWeak:f.css`
    color: ${e.colors.text.secondary};
  `,marginTop:f.css`
    margin-top: ${e.spacing(3)};
  `}),k=(e,t)=>S((function*(){try{yield T(e,t),window.location.reload()}catch(e){console.error("Error while updating the plugin",e)}}))(),T=(e,t)=>S((function*(){const n=yield(0,m.getBackendSrv)().fetch({url:`/api/plugins/${e}/settings`,method:"POST",data:t});return(0,g.lastValueFrom)(n)}))(),j=(new u.AppPlugin).setRootPage((function(e){return d().createElement(d().Fragment,null)})).addConfigPage({title:"Configuration",icon:"cog",body:({plugin:e})=>{const t=(0,b.useStyles2)(w),{enabled:n,pinned:r,jsonData:o,secureJsonFields:i}=e.meta,[a,s]=(0,p.useState)({apiPort:(null==o?void 0:o.apiPort)||"8089",apiToken:"",isApiTokenSet:Boolean(null==i?void 0:i.apiToken)}),[c,l]=(0,p.useState)();(0,p.useEffect)((()=>{S((function*(){const e=window.location.host,t=(0,m.getBackendSrv)().fetch({method:"POST",url:"/api/plugins/vaduga-mapgl-app/resources/ping",data:JSON.stringify({host:e}),showErrorAlert:!1}),n=(yield(0,g.lastValueFrom)(t)).data;if(n){const{org:e,host:t,isPower:r,expiresAt:o}=n;console.log("ping",n);const i=function(e){const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}(1*o);l({org:e,expiresAt:o,expiresFmt:i,host:t,isPower:r})}}))()}),[]);const u=Date.now()/1e3>(null==c?void 0:c.expiresAt);return d().createElement("div",{"data-testid":y.container},d().createElement(b.FieldSet,{label:"License Settings"},d().createElement(b.Field,{label:"JWT token"},d().createElement(b.SecretInput,{width:60,"data-testid":y.apiToken,name:"apiToken",value:a.apiToken,isConfigured:a.isApiTokenSet,placeholder:"Your JWT token",onChange:e=>{s(h(O({},a),{[e.target.name]:e.target.value.trim()}))},onReset:()=>s(h(O({},a),{apiToken:"",isApiTokenSet:!1}))})),c&&d().createElement("div",null,"licensed for: ",(null==c?void 0:c.org)+" , ","host: ",null==c?void 0:c.host,d().createElement("p",{style:u?{color:"#d10a85"}:{}},"token expir",u?"ed":"es",": ",null==c?void 0:c.expiresFmt),"tier: ",(null==c?void 0:c.isPower)?"Power":"Lite"),d().createElement("div",{className:t.marginTop},d().createElement(b.Button,{type:"submit","data-testid":y.submit,onClick:()=>k(e.meta.id,{enabled:n,pinned:r,jsonData:{apiPort:a.apiPort},secureJsonData:a.isApiTokenSet?void 0:{apiToken:a.apiToken}}),disabled:Boolean(!a.apiPort||!a.isApiTokenSet&&!a.apiToken)},"Save API settings"))))},id:"configuration"});return l})()));