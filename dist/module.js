/* [create-plugin] version: 5.22.1 */
define(["@grafana/ui","@emotion/css","rxjs","@grafana/runtime","@grafana/data","react"],((e,t,n,r,o,a)=>(()=>{"use strict";var i={7:t=>{t.exports=e},89:e=>{e.exports=t},269:e=>{e.exports=n},531:e=>{e.exports=r},781:e=>{e.exports=o},959:e=>{e.exports=a}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return i[e](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};l.r(c),l.d(c,{plugin:()=>T});var p=l(781),u=l(959),d=l.n(u);var g=l(269),f=l(89),m=l(531),b=l(7);const y={container:"data-testid ac-container",apiToken:"data-testid ac-api-key",apiPort:"data-testid ac-api-port",submit:"data-testid ac-submit-form"};function v(e,t,n,r,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){v(a,r,o,i,s,"next",e)}function s(e){v(a,r,o,i,s,"throw",e)}i(void 0)}))}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}function k(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const w=e=>({colorWeak:f.css`
    color: ${e.colors.text.secondary};
  `,marginTop:f.css`
    margin-top: ${e.spacing(3)};
  `}),h=(e,t)=>S((function*(){try{yield j(e,t),window.location.reload()}catch(e){console.error("Error while updating the plugin",e)}}))(),j=(e,t)=>S((function*(){const n=yield(0,m.getBackendSrv)().fetch({url:`/api/plugins/${e}/settings`,method:"POST",data:t});return(0,g.lastValueFrom)(n)}))(),T=(new p.AppPlugin).setRootPage((function(e){return d().createElement(d().Fragment,null)})).addConfigPage({title:"Configuration",icon:"cog",body:({plugin:e})=>{const t=(0,b.useStyles2)(w),{enabled:n,pinned:r,jsonData:o,secureJsonFields:a}=e.meta,[i,s]=(0,u.useState)({apiPort:(null==o?void 0:o.apiPort)||"8089",apiToken:"",isApiTokenSet:Boolean(null==a?void 0:a.apiToken)}),[l,c]=(0,u.useState)();(0,u.useEffect)((()=>{S((function*(){const e=(0,m.getBackendSrv)().fetch({url:"/api/plugins/vaduga-mapgl-app/resources/ping"}),t=(yield(0,g.lastValueFrom)(e)).data;if(t){const{org_name:e,expires:n,allowed_hosts:r}=t;console.log("ping",t);const o=function(e){const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}(1*n);c({org_name:e,expires:n,expiresFmt:o,allowed_hosts:r})}}))()}),[]);const p=Date.now()>(null==l?void 0:l.expires);return d().createElement("div",{"data-testid":y.container},d().createElement(b.FieldSet,{label:"API Settings"},d().createElement(b.Field,{label:"API token",description:"A license API token"},d().createElement(b.SecretInput,{width:60,"data-testid":y.apiToken,name:"apiToken",value:i.apiToken,isConfigured:i.isApiTokenSet,placeholder:"Your secret API token",onChange:e=>{s(k(O({},i),{[e.target.name]:e.target.value.trim()}))},onReset:()=>s(k(O({},i),{apiToken:"",isApiTokenSet:!1}))})),l&&d().createElement("div",null,"licensed for: ",(null==l?void 0:l.org_name)+" , ","allowed_hosts: ",null==l?void 0:l.allowed_hosts,d().createElement("p",{style:p?{color:"#d10a85"}:{}},"token expir",p?"ed":"es",": ",null==l?void 0:l.expiresFmt)),d().createElement("div",{className:t.marginTop},d().createElement(b.Button,{type:"submit","data-testid":y.submit,onClick:()=>h(e.meta.id,{enabled:n,pinned:r,jsonData:{apiPort:i.apiPort},secureJsonData:i.isApiTokenSet?void 0:{apiToken:i.apiToken}}),disabled:Boolean(!i.apiPort||!i.isApiTokenSet&&!i.apiToken)},"Save API settings"))))},id:"configuration"});return c})()));