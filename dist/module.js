/* [create-plugin] version: 5.26.4 */
/* [create-plugin] plugin: vaduga-mapgl-app@1.0.0 */
define(["@grafana/ui","@emotion/css","rxjs","module","@grafana/runtime","@grafana/data","react"],(e,t,r,n,o,a,i)=>(()=>{"use strict";var s={7:t=>{t.exports=e},89:e=>{e.exports=t},269:e=>{e.exports=r},308:e=>{e.exports=n},531:e=>{e.exports=o},781:e=>{e.exports=a},959:e=>{e.exports=i}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return s[e](r,r.exports,c),r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="public/plugins/vaduga-mapgl-app/";var p={};c.r(p),c.d(p,{plugin:()=>A});var u=c(308),d=c.n(u);c.p=d()&&d().uri?d().uri.slice(0,d().uri.lastIndexOf("/")+1):"public/plugins/vaduga-mapgl-app/";var g=c(781),f=c(959),m=c.n(f);var b=c(269),v=c(89),y=c(531),S=c(7);const P={container:"data-testid ac-container",apiToken:"data-testid ac-api-key",apiPort:"data-testid ac-api-port",submit:"data-testid ac-submit-form"};function O(e,t,r,n,o,a,i){try{var s=e[a](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function h(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){O(a,n,o,i,s,"next",e)}function s(e){O(a,n,o,i,s,"throw",e)}i(void 0)})}}function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){w(e,t,r[t])})}return e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}const j=e=>({colorWeak:v.css`
    color: ${e.colors.text.secondary};
  `,marginTop:v.css`
    margin-top: ${e.spacing(3)};
  `}),x=(e,t)=>h(function*(){try{yield E(e,t),window.location.reload()}catch(e){console.error("Error while updating the plugin",e)}})(),E=(e,t)=>h(function*(){const r=yield(0,y.getBackendSrv)().fetch({url:`/api/plugins/${e}/settings`,method:"POST",data:t});return(0,b.lastValueFrom)(r)})(),A=(new g.AppPlugin).setRootPage(function(e){return m().createElement(m().Fragment,null,m().createElement("div",null,"TEST"))}).addConfigPage({title:"Configuration",icon:"cog",body:({plugin:e})=>{const t=(0,S.useStyles2)(j),{enabled:r,pinned:n,jsonData:o,secureJsonFields:a}=e.meta,[i,s]=(0,f.useState)({apiPort:(null==o?void 0:o.apiPort)||"8089",apiToken:"",isApiTokenSet:Boolean(null==a?void 0:a.apiToken)}),[l,c]=(0,f.useState)();(0,f.useEffect)(()=>{h(function*(){const e=window.location.host,t=(0,y.getBackendSrv)().fetch({method:"POST",url:"/api/plugins/vaduga-mapgl-app/resources/ping",data:JSON.stringify({host:e}),showErrorAlert:!1}),r=(yield(0,b.lastValueFrom)(t)).data;if(r){const{org:e,host:t,isPower:n,expiresAt:o}=r,a=function(e){const t=new Date(1e3*e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`}(1*o);c({org:e,expiresAt:o,expiresFmt:a,host:t,isPower:n})}})()},[]);const p=Date.now()/1e3>(null==l?void 0:l.expiresAt);return m().createElement("div",{"data-testid":P.container},m().createElement(S.FieldSet,{label:"License Settings"},m().createElement(S.Field,{label:"JWT token"},m().createElement(S.SecretInput,{width:60,"data-testid":P.apiToken,name:"apiToken",value:i.apiToken,isConfigured:i.isApiTokenSet,placeholder:"Your JWT token",onChange:e=>{s(T(k({},i),{[e.target.name]:e.target.value.trim()}))},onReset:()=>s(T(k({},i),{apiToken:"",isApiTokenSet:!1}))})),l&&m().createElement("div",null,"licensed for: ",(null==l?void 0:l.org)+" , ","host: ",null==l?void 0:l.host,m().createElement("p",{style:p?{color:"#d10a85"}:{}},"token expir",p?"ed":"es",": ",null==l?void 0:l.expiresFmt),"tier: ",(null==l?void 0:l.isPower)?"Power":"Lite"),m().createElement("div",{className:t.marginTop},m().createElement(S.Button,{type:"submit","data-testid":P.submit,onClick:()=>x(e.meta.id,{enabled:r,pinned:n,jsonData:{apiPort:i.apiPort},secureJsonData:i.isApiTokenSet?void 0:{apiToken:i.apiToken}}),disabled:Boolean(!i.apiPort||!i.isApiTokenSet&&!i.apiToken)},"Save API settings"))))},id:"configuration"});return p})());