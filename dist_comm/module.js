/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","react","@grafana/ui","react-dom","@emotion/css","@grafana/runtime","lodash","@emotion/react"],((e,t,n,i,r,o,s,a)=>(()=>{var l,c,u={62:e=>{e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],i=0;i<e.rangeCount;i++)n.push(e.getRangeAt(i));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}}},278:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&s[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},410:e=>{"use strict";const t=/^[0-9]+$/,n=(e,n)=>{const i=t.test(e),r=t.test(n);return i&&r&&(e=+e,n=+n),e===n?0:i&&!r?-1:r&&!i?1:e<n?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});class i{constructor(e=[],t=r){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),o=t[i];const s=i+1;if(s<this.length&&n(t[s],o)<0&&(i=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=i}t[e]=r}}function r(e,t){return e<t?-1:e>t?1:0}},959:(e,t,n)=>{"use strict";const i=n(6879);e.exports=(e,t)=>e.sort(((e,n)=>i(n,e,t)))},1106:(e,t,n)=>{"use strict";const i=Symbol("SemVer ANY");class r{static get ANY(){return i}constructor(e,t){if(t=o(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),c("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,c("comp",this)}parse(e){const t=this.options.loose?s[a.COMPARATORLOOSE]:s[a.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new u(n[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(c("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new h(e.value,t).test(this.value):""===e.operator?""===e.value||new h(this.value,t).test(e.semver):!((t=o(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))||(!this.operator.startsWith(">")||!e.operator.startsWith(">"))&&(!this.operator.startsWith("<")||!e.operator.startsWith("<"))&&(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))&&!(l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))&&!(l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}}e.exports=r;const o=n(8029),{safeRe:s,t:a}=n(2728),l=n(7685),c=n(5906),u=n(9534),h=n(6293)},1173:(e,t,n)=>{"use strict";const i=n(6293);e.exports=(e,t)=>new i(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")))},1178:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>i(e,t,n)<=0},1180:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t)=>new i(e,t).minor},1247:function(e,t){!function(e){"use strict";const t=134217729;function n(e,t,n,i,r){let o,s,a,l,c=t[0],u=i[0],h=0,d=0;u>c==u>-c?(o=c,c=t[++h]):(o=u,u=i[++d]);let p=0;if(h<e&&d<n)for(u>c==u>-c?(a=o-((s=c+o)-c),c=t[++h]):(a=o-((s=u+o)-u),u=i[++d]),o=s,0!==a&&(r[p++]=a);h<e&&d<n;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=i[++d]),o=s,0!==a&&(r[p++]=a);for(;h<e;)a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h],o=s,0!==a&&(r[p++]=a);for(;d<n;)a=o-((s=o+u)-(l=s-o))+(u-l),u=i[++d],o=s,0!==a&&(r[p++]=a);return 0===o&&0!==p||(r[p++]=o),p}function i(e){return new Float64Array(e)}const r=i(4),o=i(8),s=i(12),a=i(16),l=i(4);e.orient2d=function(e,i,c,u,h,d){const p=(i-d)*(c-h),f=(e-h)*(u-d),g=p-f;if(0===p||0===f||p>0!=f>0)return g;const m=Math.abs(p+f);return Math.abs(g)>=33306690738754716e-32*m?g:-function(e,i,c,u,h,d,p){let f,g,m,_,y,v,b,x,w,E,S,T,C,A,P,I,M,R;const k=e-h,O=c-h,L=i-d,D=u-d;y=(P=(x=k-(b=(v=t*k)-(v-k)))*(E=D-(w=(v=t*D)-(v-D)))-((A=k*D)-b*w-x*w-b*E))-(S=P-(M=(x=L-(b=(v=t*L)-(v-L)))*(E=O-(w=(v=t*O)-(v-O)))-((I=L*O)-b*w-x*w-b*E))),r[0]=P-(S+y)+(y-M),y=(C=A-((T=A+S)-(y=T-A))+(S-y))-(S=C-I),r[1]=C-(S+y)+(y-I),y=(R=T+S)-T,r[2]=T-(R-y)+(S-y),r[3]=R;let F=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,r),N=22204460492503146e-32*p;if(F>=N||-F>=N)return F;if(f=e-(k+(y=e-k))+(y-h),m=c-(O+(y=c-O))+(y-h),g=i-(L+(y=i-L))+(y-d),_=u-(D+(y=u-D))+(y-d),0===f&&0===g&&0===m&&0===_)return F;if(N=11093356479670487e-47*p+33306690738754706e-32*Math.abs(F),(F+=k*_+D*f-(L*m+O*g))>=N||-F>=N)return F;y=(P=(x=f-(b=(v=t*f)-(v-f)))*(E=D-(w=(v=t*D)-(v-D)))-((A=f*D)-b*w-x*w-b*E))-(S=P-(M=(x=g-(b=(v=t*g)-(v-g)))*(E=O-(w=(v=t*O)-(v-O)))-((I=g*O)-b*w-x*w-b*E))),l[0]=P-(S+y)+(y-M),y=(C=A-((T=A+S)-(y=T-A))+(S-y))-(S=C-I),l[1]=C-(S+y)+(y-I),y=(R=T+S)-T,l[2]=T-(R-y)+(S-y),l[3]=R;const B=n(4,r,4,l,o);y=(P=(x=k-(b=(v=t*k)-(v-k)))*(E=_-(w=(v=t*_)-(v-_)))-((A=k*_)-b*w-x*w-b*E))-(S=P-(M=(x=L-(b=(v=t*L)-(v-L)))*(E=m-(w=(v=t*m)-(v-m)))-((I=L*m)-b*w-x*w-b*E))),l[0]=P-(S+y)+(y-M),y=(C=A-((T=A+S)-(y=T-A))+(S-y))-(S=C-I),l[1]=C-(S+y)+(y-I),y=(R=T+S)-T,l[2]=T-(R-y)+(S-y),l[3]=R;const z=n(B,o,4,l,s);y=(P=(x=f-(b=(v=t*f)-(v-f)))*(E=_-(w=(v=t*_)-(v-_)))-((A=f*_)-b*w-x*w-b*E))-(S=P-(M=(x=g-(b=(v=t*g)-(v-g)))*(E=m-(w=(v=t*m)-(v-m)))-((I=g*m)-b*w-x*w-b*E))),l[0]=P-(S+y)+(y-M),y=(C=A-((T=A+S)-(y=T-A))+(S-y))-(S=C-I),l[1]=C-(S+y)+(y-I),y=(R=T+S)-T,l[2]=T-(R-y)+(S-y),l[3]=R;const j=n(z,s,4,l,a);return a[j-1]}(e,i,c,u,h,d,m)},e.orient2dfast=function(e,t,n,i,r,o){return(t-o)*(n-r)-(e-r)*(i-o)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},1559:(e,t,n)=>{"use strict";const i=n(2728),r=n(6484),o=n(9534),s=n(410),a=n(9618),l=n(5991),c=n(8968),u=n(2969),h=n(7278),d=n(8992),p=n(1180),f=n(6339),g=n(3731),m=n(5566),_=n(6264),y=n(4693),v=n(6879),b=n(6657),x=n(959),w=n(7574),E=n(5161),S=n(6175),T=n(6877),C=n(3039),A=n(1178),P=n(7685),I=n(7192),M=n(1106),R=n(6293),k=n(4120),O=n(1173),L=n(4922),D=n(8752),F=n(3931),N=n(1772),B=n(4473),z=n(4129),j=n(6184),U=n(5362),V=n(7287),$=n(3910);e.exports={parse:a,valid:l,clean:c,inc:u,diff:h,major:d,minor:p,patch:f,prerelease:g,compare:m,rcompare:_,compareLoose:y,compareBuild:v,sort:b,rsort:x,gt:w,lt:E,eq:S,neq:T,gte:C,lte:A,cmp:P,coerce:I,Comparator:M,Range:R,satisfies:k,toComparators:O,maxSatisfying:L,minSatisfying:D,minVersion:F,validRange:N,outside:B,gtr:z,ltr:j,intersects:U,simplifyRange:V,subset:$,SemVer:o,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:r.SEMVER_SPEC_VERSION,RELEASE_TYPES:r.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},1772:(e,t,n)=>{"use strict";const i=n(6293);e.exports=(e,t)=>{try{return new i(e,t).range||"*"}catch(e){return null}}},2007:e=>{"use strict";e.exports=n},2190:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(4942),r=n.n(i),o=n(278),s=n.n(o)()(r());s.push([e.id,'.deck-widget {\n  margin: var(--widget-margin, 12px);\n}\n\n/* Common button container styles */\n.deck-widget-button,\n.deck-widget-button-group {\n  background: var(--button-stroke, rgba(255, 255, 255, 0.3));\n  border-radius: var(--button-corner-radius, 8px);\n  box-shadow: var(--button-shadow, 0px 0px 8px 0px rgba(0, 0, 0, 0.25));\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Single button */\n.deck-widget-button {\n  width: var(--button-size, 28px);\n  height: var(--button-size, 28px);\n}\n\n/* Button group */\n.deck-widget-button-group {\n  width: calc(var(--button-size, 28px) - 2);\n  height: calc((var(--button-size, 28px) * 2) - 1);\n\n  flex-direction: row;\n  padding: 1px;\n  gap: 1px;\n}\n\n.deck-widget-button-group.vertical {\n  display: inline-flex;\n  flex-direction: column;\n}\n\n/* Common button styles */\n.deck-widget-button-group button,\n.deck-widget-button button {\n  width: calc(var(--button-size, 28px) - 2px);\n  height: calc(var(--button-size, 28px) - 2px);\n\n  box-sizing: border-box;\n  background: var(--button-background, #fff);\n  backdrop-filter: var(--button-backdrop-filter, unset);\n  border: var(--button-inner-stroke, unset);\n  border-radius: calc(var(--button-corner-radius, 8px) - 1px);\n\n  pointer-events: auto;\n  cursor: pointer;\n  outline: none;\n  padding: 0;\n}\n\n/* Border radius adjustments for grouped buttons */\n.deck-widget-button-group.vertical > *:not(:last-child),\n.deck-widget-button-group.vertical > *:not(:last-child) > button {\n  border-bottom-left-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.vertical > *:not(:first-child),\n.deck-widget-button-group.vertical > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-top-right-radius: 0;\n}\n\n\n.deck-widget-button-group.horizontal > *:not(:last-child),\n.deck-widget-button-group.horizontal > *:not(:last-child) > button {\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.horizontal > *:not(:first-child),\n.deck-widget-button-group.horizontal > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n/* Icon button styles */\n.deck-widget button .deck-widget-icon {\n  background-color: var(--button-icon-idle, #616166);\n  background-position: 50%;\n  background-repeat: no-repeat;\n  display: block;\n  height: 100%;\n  width: 100%;\n}\n\n.deck-widget button .deck-widget-icon:hover {\n  background-color: var(--button-icon-hover, rgb(24, 24, 26));\n}\n\n/* Fullscreen styles */\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-enter .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-exit .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n}\n\n.deck-pseudo-fullscreen {\n  height: 50% !important;\n  left: 0 !important;\n  position: fixed !important;\n  top: 0 !important;\n  width: 100% !important;\n  z-index: -1;\n}\n\n/* Zoom styles */\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-in .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-out .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n}\n',"",{version:3,sources:["webpack://./img/stylesheet.css"],names:[],mappings:"AAAA;EACE,kCAAkC;AACpC;;AAEA,mCAAmC;AACnC;;EAEE,0DAA0D;EAC1D,+CAA+C;EAC/C,qEAAqE;;EAErE,aAAa;EACb,mBAAmB;EACnB,uBAAuB;AACzB;;AAEA,kBAAkB;AAClB;EACE,+BAA+B;EAC/B,gCAAgC;AAClC;;AAEA,iBAAiB;AACjB;EACE,yCAAyC;EACzC,gDAAgD;;EAEhD,mBAAmB;EACnB,YAAY;EACZ,QAAQ;AACV;;AAEA;EACE,oBAAoB;EACpB,sBAAsB;AACxB;;AAEA,yBAAyB;AACzB;;EAEE,2CAA2C;EAC3C,4CAA4C;;EAE5C,sBAAsB;EACtB,0CAA0C;EAC1C,qDAAqD;EACrD,yCAAyC;EACzC,2DAA2D;;EAE3D,oBAAoB;EACpB,eAAe;EACf,aAAa;EACb,UAAU;AACZ;;AAEA,kDAAkD;AAClD;;EAEE,4BAA4B;EAC5B,6BAA6B;AAC/B;;AAEA;;EAEE,yBAAyB;EACzB,0BAA0B;AAC5B;;;AAGA;;EAEE,0BAA0B;EAC1B,6BAA6B;AAC/B;;AAEA;;EAEE,yBAAyB;EACzB,4BAA4B;AAC9B;;AAEA,uBAAuB;AACvB;EACE,kDAAkD;EAClD,wBAAwB;EACxB,4BAA4B;EAC5B,cAAc;EACd,YAAY;EACZ,WAAW;AACb;;AAEA;EACE,2DAA2D;AAC7D;;AAEA,sBAAsB;AACtB;EACE;;;GAGC;EACD;;;GAGC;AACH;;AAEA;EACE;;;GAGC;EACD;;;GAGC;AACH;;AAEA;EACE,sBAAsB;EACtB,kBAAkB;EAClB,0BAA0B;EAC1B,iBAAiB;EACjB,sBAAsB;EACtB,WAAW;AACb;;AAEA,gBAAgB;AAChB;EACE;;;GAGC;EACD;;;GAGC;AACH;;AAEA;EACE;;;GAGC;EACD;;;GAGC;AACH",sourcesContent:['.deck-widget {\n  margin: var(--widget-margin, 12px);\n}\n\n/* Common button container styles */\n.deck-widget-button,\n.deck-widget-button-group {\n  background: var(--button-stroke, rgba(255, 255, 255, 0.3));\n  border-radius: var(--button-corner-radius, 8px);\n  box-shadow: var(--button-shadow, 0px 0px 8px 0px rgba(0, 0, 0, 0.25));\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Single button */\n.deck-widget-button {\n  width: var(--button-size, 28px);\n  height: var(--button-size, 28px);\n}\n\n/* Button group */\n.deck-widget-button-group {\n  width: calc(var(--button-size, 28px) - 2);\n  height: calc((var(--button-size, 28px) * 2) - 1);\n\n  flex-direction: row;\n  padding: 1px;\n  gap: 1px;\n}\n\n.deck-widget-button-group.vertical {\n  display: inline-flex;\n  flex-direction: column;\n}\n\n/* Common button styles */\n.deck-widget-button-group button,\n.deck-widget-button button {\n  width: calc(var(--button-size, 28px) - 2px);\n  height: calc(var(--button-size, 28px) - 2px);\n\n  box-sizing: border-box;\n  background: var(--button-background, #fff);\n  backdrop-filter: var(--button-backdrop-filter, unset);\n  border: var(--button-inner-stroke, unset);\n  border-radius: calc(var(--button-corner-radius, 8px) - 1px);\n\n  pointer-events: auto;\n  cursor: pointer;\n  outline: none;\n  padding: 0;\n}\n\n/* Border radius adjustments for grouped buttons */\n.deck-widget-button-group.vertical > *:not(:last-child),\n.deck-widget-button-group.vertical > *:not(:last-child) > button {\n  border-bottom-left-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.vertical > *:not(:first-child),\n.deck-widget-button-group.vertical > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-top-right-radius: 0;\n}\n\n\n.deck-widget-button-group.horizontal > *:not(:last-child),\n.deck-widget-button-group.horizontal > *:not(:last-child) > button {\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.horizontal > *:not(:first-child),\n.deck-widget-button-group.horizontal > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n/* Icon button styles */\n.deck-widget button .deck-widget-icon {\n  background-color: var(--button-icon-idle, #616166);\n  background-position: 50%;\n  background-repeat: no-repeat;\n  display: block;\n  height: 100%;\n  width: 100%;\n}\n\n.deck-widget button .deck-widget-icon:hover {\n  background-color: var(--button-icon-hover, rgb(24, 24, 26));\n}\n\n/* Fullscreen styles */\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-enter .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-exit .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n}\n\n.deck-pseudo-fullscreen {\n  height: 50% !important;\n  left: 0 !important;\n  position: fixed !important;\n  top: 0 !important;\n  width: 100% !important;\n  z-index: -1;\n}\n\n/* Zoom styles */\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-in .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-out .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n}\n'],sourceRoot:""}]);const a=s},2341:(e,t,n)=>{e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=(i=n(2))&&i.__esModule?i:{default:i};t.default=r.default,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.default=function(e){var t=e.activeClassName,n=void 0===t?"":t,r=e.activeIndex,l=void 0===r?-1:r,c=e.activeStyle,u=e.autoEscape,h=e.caseSensitive,d=void 0!==h&&h,p=e.className,f=e.findChunks,g=e.highlightClassName,m=void 0===g?"":g,_=e.highlightStyle,y=void 0===_?{}:_,v=e.highlightTag,b=void 0===v?"mark":v,x=e.sanitize,w=e.searchWords,E=e.textToHighlight,S=e.unhighlightTag,T=void 0===S?"span":S,C=e.unhighlightClassName,A=void 0===C?"":C,P=e.unhighlightStyle,I=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["activeClassName","activeIndex","activeStyle","autoEscape","caseSensitive","className","findChunks","highlightClassName","highlightStyle","highlightTag","sanitize","searchWords","textToHighlight","unhighlightTag","unhighlightClassName","unhighlightStyle"]),M=(0,o.findAll)({autoEscape:u,caseSensitive:d,findChunks:f,sanitize:x,searchWords:w,textToHighlight:E}),R=b,k=-1,O="",L=void 0,D=(0,a.default)((function(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n];return t}));return(0,s.createElement)("span",i({className:p},I,{children:M.map((function(e,t){var i=E.substr(e.start,e.end-e.start);if(e.highlight){k++;var r;r="object"==typeof m?d?m[i]:(m=D(m))[i.toLowerCase()]:m;var o=k===+l;O=r+" "+(o?n:""),L=!0===o&&null!=c?Object.assign({},y,c):y;var a={children:i,className:O,key:t,style:L};return"string"!=typeof R&&(a.highlightIndex=k),(0,s.createElement)(R,a)}return(0,s.createElement)(T,{children:i,className:A,key:t,style:P})}))}))};var r,o=n(3),s=n(4),a=(r=n(5))&&r.__esModule?r:{default:r};e.exports=t.default},function(e,t){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);Object.defineProperty(t,"combineChunks",{enumerable:!0,get:function(){return i.combineChunks}}),Object.defineProperty(t,"fillInChunks",{enumerable:!0,get:function(){return i.fillInChunks}}),Object.defineProperty(t,"findAll",{enumerable:!0,get:function(){return i.findAll}}),Object.defineProperty(t,"findChunks",{enumerable:!0,get:function(){return i.findChunks}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=function(e){var t=e.autoEscape,o=e.caseSensitive,s=void 0!==o&&o,a=e.findChunks,l=void 0===a?i:a,c=e.sanitize,u=e.searchWords,h=e.textToHighlight;return r({chunksToHighlight:n({chunks:l({autoEscape:t,caseSensitive:s,sanitize:c,searchWords:u,textToHighlight:h})}),totalLength:h?h.length:0})};var n=t.combineChunks=function(e){var t=e.chunks;return t.sort((function(e,t){return e.start-t.start})).reduce((function(e,t){if(0===e.length)return[t];var n=e.pop();if(t.start<=n.end){var i=Math.max(n.end,t.end);e.push({start:n.start,end:i})}else e.push(n,t);return e}),[])},i=function(e){var t=e.autoEscape,n=e.caseSensitive,i=e.sanitize,r=void 0===i?o:i,s=e.searchWords,a=e.textToHighlight;return a=r(a),s.filter((function(e){return e})).reduce((function(e,i){i=r(i),t&&(i=i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));for(var o=new RegExp(i,n?"g":"gi"),s=void 0;s=o.exec(a);){var l=s.index,c=o.lastIndex;c>l&&e.push({start:l,end:c}),s.index==o.lastIndex&&o.lastIndex++}return e}),[])};t.findChunks=i;var r=t.fillInChunks=function(e){var t=e.chunksToHighlight,n=e.totalLength,i=[],r=function(e,t,n){t-e>0&&i.push({start:e,end:t,highlight:n})};if(0===t.length)r(0,n,!1);else{var o=0;t.forEach((function(e){r(o,e.start,!1),r(e.start,e.end,!0),o=e.end})),r(o,n,!1)}return i};function o(e){return e}}])},function(e,t){e.exports=n(5959)},function(e,t){"use strict";var n=function(e,t){return e===t};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,i=void 0,r=[],o=void 0,s=!1,a=function(e,n){return t(e,r[n])};return function(){for(var t=arguments.length,n=Array(t),l=0;l<t;l++)n[l]=arguments[l];return s&&i===this&&n.length===r.length&&n.every(a)?o:(s=!0,i=this,r=n,o=e.apply(this,n))}}}])},2473:(e,t,n)=>{"use strict";var i=n(5959),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=i.useState,s=i.useEffect,a=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=o({inst:{value:n,getSnapshot:t}}),r=i[0].inst,u=i[1];return a((function(){r.value=n,r.getSnapshot=t,c(r)&&u({inst:r})}),[e,n,t]),s((function(){return c(r)&&u({inst:r}),e((function(){c(r)&&u({inst:r})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},2728:(e,t,n)=>{"use strict";const{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:o}=n(6484),s=n(5906),a=(t=e.exports={}).re=[],l=t.safeRe=[],c=t.src=[],u=t.safeSrc=[],h=t.t={};let d=0;const p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",o],[p,r]],g=(e,t,n)=>{const i=(e=>{for(const[t,n]of f)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),r=d++;s(e,r,t),h[e]=r,c[r]=t,u[r]=i,a[r]=new RegExp(t,n?"g":void 0),l[r]=new RegExp(i,n?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${c[h.NUMERICIDENTIFIER]})\\.(${c[h.NUMERICIDENTIFIER]})\\.(${c[h.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${c[h.NUMERICIDENTIFIERLOOSE]})\\.(${c[h.NUMERICIDENTIFIERLOOSE]})\\.(${c[h.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${c[h.NONNUMERICIDENTIFIER]}|${c[h.NUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${c[h.NONNUMERICIDENTIFIER]}|${c[h.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASE",`(?:-(${c[h.PRERELEASEIDENTIFIER]}(?:\\.${c[h.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${c[h.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[h.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${c[h.BUILDIDENTIFIER]}(?:\\.${c[h.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${c[h.MAINVERSION]}${c[h.PRERELEASE]}?${c[h.BUILD]}?`),g("FULL",`^${c[h.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${c[h.MAINVERSIONLOOSE]}${c[h.PRERELEASELOOSE]}?${c[h.BUILD]}?`),g("LOOSE",`^${c[h.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${c[h.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${c[h.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${c[h.XRANGEIDENTIFIER]})(?:\\.(${c[h.XRANGEIDENTIFIER]})(?:\\.(${c[h.XRANGEIDENTIFIER]})(?:${c[h.PRERELEASE]})?${c[h.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${c[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[h.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[h.XRANGEIDENTIFIERLOOSE]})(?:${c[h.PRERELEASELOOSE]})?${c[h.BUILD]}?)?)?`),g("XRANGE",`^${c[h.GTLT]}\\s*${c[h.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${c[h.GTLT]}\\s*${c[h.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),g("COERCE",`${c[h.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",c[h.COERCEPLAIN]+`(?:${c[h.PRERELEASE]})?`+`(?:${c[h.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",c[h.COERCE],!0),g("COERCERTLFULL",c[h.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${c[h.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${c[h.LONETILDE]}${c[h.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${c[h.LONETILDE]}${c[h.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${c[h.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${c[h.LONECARET]}${c[h.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${c[h.LONECARET]}${c[h.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${c[h.GTLT]}\\s*(${c[h.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${c[h.GTLT]}\\s*(${c[h.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${c[h.GTLT]}\\s*(${c[h.LOOSEPLAIN]}|${c[h.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${c[h.XRANGEPLAIN]})\\s+-\\s+(${c[h.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${c[h.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[h.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},2794:e=>{e.exports=function(e,t){if(!e)throw new Error("No coordinates passed");return{type:"Feature",geometry:{type:"LineString",coordinates:e},properties:t||{}}}},2969:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t,n,r,o)=>{"string"==typeof n&&(o=r,r=n,n=void 0);try{return new i(e instanceof i?e.version:e,n).inc(t,r,o).version}catch(e){return null}}},3039:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>i(e,t,n)>=0},3241:e=>{"use strict";e.exports=s},3516:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyToClipboard=void 0;var r=a(n(5959)),o=a(n(5489)),s=["text","onCopy","options","children"];function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(m,e);var t,n,a,l,g=(a=m,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(a);if(l){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,e)});function m(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,m);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return f(d(e=g.call.apply(g,[this].concat(n))),"onClick",(function(t){var n=e.props,i=n.text,s=n.onCopy,a=n.children,l=n.options,c=r.default.Children.only(a),u=(0,o.default)(i,l);s&&s(i,u),c&&c.props&&"function"==typeof c.props.onClick&&c.props.onClick(t)})),e}return t=m,(n=[{key:"render",value:function(){var e=this.props,t=(e.text,e.onCopy,e.options,e.children),n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,s),i=r.default.Children.only(t);return r.default.cloneElement(i,c(c({},n),{},{onClick:this.onClick}))}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),m}(r.default.PureComponent);t.CopyToClipboard=g,f(g,"defaultProps",{onCopy:void 0,options:void 0})},3676:(e,t,n)=>{"use strict";e.exports=n(2473)},3731:(e,t,n)=>{"use strict";const i=n(9618);e.exports=(e,t)=>{const n=i(e,t);return n&&n.prerelease.length?n.prerelease:null}},3910:(e,t,n)=>{"use strict";const i=n(6293),r=n(1106),{ANY:o}=r,s=n(4120),a=n(5566),l=[new r(">=0.0.0-0")],c=[new r(">=0.0.0")],u=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===o){if(1===t.length&&t[0].semver===o)return!0;e=n.includePrerelease?l:c}if(1===t.length&&t[0].semver===o){if(n.includePrerelease)return!0;t=c}const i=new Set;let r,u,p,f,g,m,_;for(const t of e)">"===t.operator||">="===t.operator?r=h(r,t,n):"<"===t.operator||"<="===t.operator?u=d(u,t,n):i.add(t.semver);if(i.size>1)return null;if(r&&u){if(p=a(r.semver,u.semver,n),p>0)return null;if(0===p&&(">="!==r.operator||"<="!==u.operator))return null}for(const e of i){if(r&&!s(e,String(r),n))return null;if(u&&!s(e,String(u),n))return null;for(const i of t)if(!s(e,String(i),n))return!1;return!0}let y=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver,v=!(!r||n.includePrerelease||!r.semver.prerelease.length)&&r.semver;y&&1===y.prerelease.length&&"<"===u.operator&&0===y.prerelease[0]&&(y=!1);for(const e of t){if(_=_||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,r)if(v&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===v.major&&e.semver.minor===v.minor&&e.semver.patch===v.patch&&(v=!1),">"===e.operator||">="===e.operator){if(f=h(r,e,n),f===e&&f!==r)return!1}else if(">="===r.operator&&!s(r.semver,String(e),n))return!1;if(u)if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if(g=d(u,e,n),g===e&&g!==u)return!1}else if("<="===u.operator&&!s(u.semver,String(e),n))return!1;if(!e.operator&&(u||r)&&0!==p)return!1}return!(r&&m&&!u&&0!==p||u&&_&&!r&&0!==p||v||y)},h=(e,t,n)=>{if(!e)return t;const i=a(e.semver,t.semver,n);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},d=(e,t,n)=>{if(!e)return t;const i=a(e.semver,t.semver,n);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,n={})=>{if(e===t)return!0;e=new i(e,n),t=new i(t,n);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=u(i,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0}},3931:(e,t,n)=>{"use strict";const i=n(9534),r=n(6293),o=n(7574);e.exports=(e,t)=>{e=new r(e,t);let n=new i("0.0.0");if(e.test(n))return n;if(n=new i("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let s=null;r.forEach((e=>{const t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":s&&!o(t,s)||(s=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!s||n&&!o(n,s)||(n=s)}return n&&e.test(n)?n:null}},4120:(e,t,n)=>{"use strict";const i=n(6293);e.exports=(e,t,n)=>{try{t=new i(t,n)}catch(e){return!1}return t.test(e)}},4129:(e,t,n)=>{"use strict";const i=n(4473);e.exports=(e,t,n)=>i(e,t,">",n)},4141:e=>{e.exports=function(e,t,n,i){var r=e[0],o=e[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=t.length);for(var a=i-n,l=0,c=a-1;l<a;c=l++){var u=t[l+n][0],h=t[l+n][1],d=t[c+n][0],p=t[c+n][1];h>o!=p>o&&r<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},4440:(e,t,n)=>{var i=n(5021),r=n(4141);e.exports=function(e,t,n,o){return t.length>0&&Array.isArray(t[0])?r(e,t,n,o):i(e,t,n,o)},e.exports.nested=r,e.exports.flat=i},4452:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=s(e,o(n)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)i.call(e,n)&&e[n]&&(t=s(t,n));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},4473:(e,t,n)=>{"use strict";const i=n(9534),r=n(1106),{ANY:o}=r,s=n(6293),a=n(4120),l=n(7574),c=n(5161),u=n(1178),h=n(3039);e.exports=(e,t,n,d)=>{let p,f,g,m,_;switch(e=new i(e,d),t=new s(t,d),n){case">":p=l,f=u,g=c,m=">",_=">=";break;case"<":p=c,f=h,g=l,m="<",_="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(e,t,d))return!1;for(let n=0;n<t.set.length;++n){const i=t.set[n];let s=null,a=null;if(i.forEach((e=>{e.semver===o&&(e=new r(">=0.0.0")),s=s||e,a=a||e,p(e.semver,s.semver,d)?s=e:g(e.semver,a.semver,d)&&(a=e)})),s.operator===m||s.operator===_)return!1;if((!a.operator||a.operator===m)&&f(e,a.semver))return!1;if(a.operator===_&&g(e,a.semver))return!1}return!0}},4693:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t)=>i(e,t,!0)},4922:(e,t,n)=>{"use strict";const i=n(9534),r=n(6293);e.exports=(e,t,n)=>{let o=null,s=null,a=null;try{a=new r(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(o&&-1!==s.compare(e)||(o=e,s=new i(o,n)))})),o}},4940:e=>{"use strict";e.exports=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}},4942:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},5021:e=>{e.exports=function(e,t,n,i){var r=e[0],o=e[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=t.length);for(var a=(i-n)/2,l=0,c=a-1;l<a;c=l++){var u=t[n+2*l+0],h=t[n+2*l+1],d=t[n+2*c+0],p=t[n+2*c+1];h>o!=p>o&&r<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},5114:(e,t,n)=>{"use strict";var i=n(6481),r=n(922),o=n(4440),s=n(1247).orient2d;function a(e,t,n){t=Math.max(0,void 0===t?2:t),n=n||0;var r=function(e){for(var t=e[0],n=e[0],i=e[0],r=e[0],s=0;s<e.length;s++){var a=e[s];a[0]<t[0]&&(t=a),a[0]>i[0]&&(i=a),a[1]<n[1]&&(n=a),a[1]>r[1]&&(r=a)}var l=[t,n,i,r],c=l.slice();for(s=0;s<e.length;s++)o(e[s],l)||c.push(e[s]);return function(e){e.sort(v);for(var t=[],n=0;n<e.length;n++){for(;t.length>=2&&p(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}for(var i=[],r=e.length-1;r>=0;r--){for(;i.length>=2&&p(i[i.length-2],i[i.length-1],e[r])<=0;)i.pop();i.push(e[r])}return i.pop(),t.pop(),t.concat(i)}(c)}(e),s=new i(16);s.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},s.compareMinX=function(e,t){return e[0]-t[0]},s.compareMinY=function(e,t){return e[1]-t[1]},s.load(e);for(var a,c=[],u=0;u<r.length;u++){var h=r[u];s.remove(h),a=g(h,a),c.push(a)}var d=new i(16);for(u=0;u<c.length;u++)d.insert(f(c[u]));for(var _=t*t,y=n*n;c.length;){var b=c.shift(),x=b.p,w=b.next.p,E=m(x,w);if(!(E<y)){var S=E/_;(h=l(s,b.prev.p,x,w,b.next.next.p,S,d))&&Math.min(m(h,x),m(h,w))<=S&&(c.push(b),c.push(g(h,b)),s.remove(h),d.remove(b),d.insert(f(b)),d.insert(f(b.next)))}}b=a;var T=[];do{T.push(b.p),b=b.next}while(b!==a);return T.push(b.p),T}function l(e,t,n,i,o,s,a){for(var l=new r([],c),h=e.data;h;){for(var p=0;p<h.children.length;p++){var f=h.children[p],g=h.leaf?_(f,n,i):u(n,i,f);g>s||l.push({node:f,dist:g})}for(;l.length&&!l.peek().node.children;){var m=l.pop(),y=m.node,v=_(y,t,n),b=_(y,i,o);if(m.dist<v&&m.dist<b&&d(n,y,a)&&d(i,y,a))return y}(h=l.pop())&&(h=h.node)}return null}function c(e,t){return e.dist-t.dist}function u(e,t,n){if(h(e,n)||h(t,n))return 0;var i=y(e[0],e[1],t[0],t[1],n.minX,n.minY,n.maxX,n.minY);if(0===i)return 0;var r=y(e[0],e[1],t[0],t[1],n.minX,n.minY,n.minX,n.maxY);if(0===r)return 0;var o=y(e[0],e[1],t[0],t[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=y(e[0],e[1],t[0],t[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(i,r,o,s)}function h(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function d(e,t,n){for(var i,r,o,s,a=Math.min(e[0],t[0]),l=Math.min(e[1],t[1]),c=Math.max(e[0],t[0]),u=Math.max(e[1],t[1]),h=n.search({minX:a,minY:l,maxX:c,maxY:u}),d=0;d<h.length;d++)if(i=h[d].p,r=h[d].next.p,o=e,i!==(s=t)&&r!==o&&p(i,r,o)>0!=p(i,r,s)>0&&p(o,s,i)>0!=p(o,s,r)>0)return!1;return!0}function p(e,t,n){return s(e[0],e[1],t[0],t[1],n[0],n[1])}function f(e){var t=e.p,n=e.next.p;return e.minX=Math.min(t[0],n[0]),e.minY=Math.min(t[1],n[1]),e.maxX=Math.max(t[0],n[0]),e.maxY=Math.max(t[1],n[1]),e}function g(e,t){var n={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(n.next=t.next,n.prev=t,t.next.prev=n,t.next=n):(n.prev=n,n.next=n),n}function m(e,t){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function _(e,t,n){var i=t[0],r=t[1],o=n[0]-i,s=n[1]-r;if(0!==o||0!==s){var a=((e[0]-i)*o+(e[1]-r)*s)/(o*o+s*s);a>1?(i=n[0],r=n[1]):a>0&&(i+=o*a,r+=s*a)}return(o=e[0]-i)*o+(s=e[1]-r)*s}function y(e,t,n,i,r,o,s,a){var l,c,u,h,d=n-e,p=i-t,f=s-r,g=a-o,m=e-r,_=t-o,y=d*d+p*p,v=d*f+p*g,b=f*f+g*g,x=d*m+p*_,w=f*m+g*_,E=y*b-v*v,S=E,T=E;0===E?(c=0,S=1,h=w,T=b):(h=y*w-v*x,(c=v*w-b*x)<0?(c=0,h=w,T=b):c>S&&(c=S,h=w+v,T=b)),h<0?(h=0,-x<0?c=0:-x>y?c=S:(c=-x,S=y)):h>T&&(h=T,-x+v<0?c=0:-x+v>y?c=S:(c=-x+v,S=y));var C=(1-(u=0===h?0:h/T))*r+u*s-((1-(l=0===c?0:c/S))*e+l*n),A=(1-u)*o+u*a-((1-l)*t+l*i);return C*C+A*A}function v(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}r.default&&(r=r.default),e.exports=a,e.exports.default=a},5161:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>i(e,t,n)<0},5230:e=>{"use strict";function t(e,t,i){i=i||2;var o,s,a,l,h,d,f,g=t&&t.length,m=g?t[0]*i:e.length,_=n(e,0,m,i,!0),y=[];if(!_||_.next===_.prev)return y;if(g&&(_=function(e,t,i,r){var o,s,a,l=[];for(o=0,s=t.length;o<s;o++)(a=n(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),l.push(p(a));for(l.sort(c),o=0;o<l.length;o++)i=u(l[o],i);return i}(e,t,_,i)),e.length>80*i){o=a=e[0],s=l=e[1];for(var v=i;v<m;v+=i)(h=e[v])<o&&(o=h),(d=e[v+1])<s&&(s=d),h>a&&(a=h),d>l&&(l=d);f=0!==(f=Math.max(a-o,l-s))?32767/f:0}return r(_,y,i,o,s,f,0),y}function n(e,t,n,i,r){var o,s;if(r===C(e,t,n,i)>0)for(o=t;o<n;o+=i)s=E(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=E(o,e[o],e[o+1],s);return s&&_(s,s.next)&&(S(s),s=s.next),s}function i(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!_(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{if(S(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function r(e,t,n,c,u,h,p){if(e){!p&&h&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=d(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,c,u,h);for(var f,g,m=e;e.prev!==e.next;)if(f=e.prev,g=e.next,h?s(e,c,u,h):o(e))t.push(f.i/n|0),t.push(e.i/n|0),t.push(g.i/n|0),S(e),e=g.next,m=g.next;else if((e=g)===m){p?1===p?r(e=a(i(e),t,n),t,n,c,u,h,2):2===p&&l(e,t,n,c,u,h):r(i(e),t,n,c,u,h,1);break}}}function o(e){var t=e.prev,n=e,i=e.next;if(m(t,n,i)>=0)return!1;for(var r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,g=i.next;g!==t;){if(g.x>=u&&g.x<=d&&g.y>=h&&g.y<=p&&f(r,a,o,l,s,c,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function s(e,t,n,i){var r=e.prev,o=e,s=e.next;if(m(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,p=s.y,g=a<l?a<c?a:c:l<c?l:c,_=u<h?u<p?u:p:h<p?h:p,y=a>l?a>c?a:c:l>c?l:c,v=u>h?u>p?u:p:h>p?h:p,b=d(g,_,t,n,i),x=d(y,v,t,n,i),w=e.prevZ,E=e.nextZ;w&&w.z>=b&&E&&E.z<=x;){if(w.x>=g&&w.x<=y&&w.y>=_&&w.y<=v&&w!==r&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=g&&E.x<=y&&E.y>=_&&E.y<=v&&E!==r&&E!==s&&f(a,u,l,h,c,p,E.x,E.y)&&m(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=b;){if(w.x>=g&&w.x<=y&&w.y>=_&&w.y<=v&&w!==r&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&m(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=x;){if(E.x>=g&&E.x<=y&&E.y>=_&&E.y<=v&&E!==r&&E!==s&&f(a,u,l,h,c,p,E.x,E.y)&&m(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function a(e,t,n){var r=e;do{var o=r.prev,s=r.next.next;!_(o,s)&&y(o,r,r.next,s)&&x(o,s)&&x(s,o)&&(t.push(o.i/n|0),t.push(r.i/n|0),t.push(s.i/n|0),S(r),S(r.next),r=e=s),r=r.next}while(r!==e);return i(r)}function l(e,t,n,o,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var u=w(l,c);return l=i(l,l.next),u=i(u,u.next),r(l,t,n,o,s,a,0),void r(u,t,n,o,s,a,0)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,u=n.x,d=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&f(o<d?r:s,o,u,d,o<d?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),x(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&h(n,i)))&&(n=i,p=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var r=w(n,e);return i(r,r.next),i(n,n.next)}function h(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function d(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||_(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,i){var r=b(m(e,t,n)),o=b(m(e,t,i)),s=b(m(n,i,e)),a=b(m(n,i,t));return r!==o&&s!==a||!(0!==r||!v(e,n,t))||!(0!==o||!v(e,i,t))||!(0!==s||!v(n,e,i))||!(0!==a||!v(n,t,i))}function v(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function b(e){return e>0?1:e<0?-1:0}function x(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function w(e,t){var n=new T(e.i,e.x,e.y),i=new T(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function E(e,t,n,i){var r=new T(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,s=Math.abs(C(e,0,o,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(C(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},5292:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},s=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=o[c]||0,h="".concat(c," ").concat(u);o[c]=u+1;var d=n(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}s.push(h)}return s}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=n(o[s]);t[a].references--}for(var l=i(e,r),c=0;c<o.length;c++){var u=n(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=l}}},5362:(e,t,n)=>{"use strict";const i=n(6293);e.exports=(e,t,n)=>(e=new i(e,n),t=new i(t,n),e.intersects(t,n))},5489:(e,t,n)=>{"use strict";var i=n(62),r={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var n,o,s,a,l,c,u=!1;t||(t={}),n=t.debug||!1;try{if(s=i(),a=document.createRange(),l=document.getSelection(),(c=document.createElement("span")).textContent=e,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",(function(i){if(i.stopPropagation(),t.format)if(i.preventDefault(),void 0===i.clipboardData){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var o=r[t.format]||r.default;window.clipboardData.setData(o,e)}else i.clipboardData.clearData(),i.clipboardData.setData(t.format,e);t.onCopy&&(i.preventDefault(),t.onCopy(i.clipboardData))})),document.body.appendChild(c),a.selectNodeContents(c),l.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(i){n&&console.error("unable to copy using execCommand: ",i),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),u=!0}catch(i){n&&console.error("unable to copy using clipboardData: ",i),n&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,e)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(a):l.removeAllRanges()),c&&document.body.removeChild(c),s()}return u}},5566:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t,n)=>new i(e,n).compare(new i(t,n))},5731:(e,t,n)=>{"use strict";var i=n(3516).CopyToClipboard;i.CopyToClipboard=i,e.exports=i},5906:e=>{"use strict";const t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},5959:e=>{"use strict";e.exports=t},5991:(e,t,n)=>{"use strict";const i=n(9618);e.exports=(e,t)=>{const n=i(e,t);return n?n.version:null}},6089:e=>{"use strict";e.exports=r},6175:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>0===i(e,t,n)},6184:(e,t,n)=>{"use strict";const i=n(4473);e.exports=(e,t,n)=>i(e,t,"<",n)},6264:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>i(t,e,n)},6293:(e,t,n)=>{"use strict";const i=/\s+/g;class r{constructor(e,t){if(t=s(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof a)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(i," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!_(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&g)|(this.options.loose&&m))+":"+e,n=o.get(t);if(n)return n;const i=this.options.loose,r=i?u[h.HYPHENRANGELOOSE]:u[h.HYPHENRANGE];e=e.replace(r,M(this.options.includePrerelease)),l("hyphen replace",e),e=e.replace(u[h.COMPARATORTRIM],d),l("comparator trim",e),e=e.replace(u[h.TILDETRIM],p),l("tilde trim",e),e=e.replace(u[h.CARETTRIM],f),l("caret trim",e);let s=e.split(" ").map((e=>b(e,this.options))).join(" ").split(/\s+/).map((e=>I(e,this.options)));i&&(s=s.filter((e=>(l("loose invalid filter",e,this.options),!!e.match(u[h.COMPARATORLOOSE]))))),l("range list",s);const c=new Map,y=s.map((e=>new a(e,this.options)));for(const e of y){if(_(e))return[e];c.set(e.value,e)}c.size>1&&c.has("")&&c.delete("");const v=[...c.values()];return o.set(t,v),v}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>v(n,t)&&e.set.some((e=>v(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(R(this.set[t],e,this.options))return!0;return!1}}e.exports=r;const o=new(n(4940)),s=n(8029),a=n(1106),l=n(5906),c=n(9534),{safeRe:u,t:h,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:f}=n(2728),{FLAG_INCLUDE_PRERELEASE:g,FLAG_LOOSE:m}=n(6484),_=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,v=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every((e=>r.intersects(e,t))),r=i.pop();return n},b=(e,t)=>(l("comp",e,t),e=S(e,t),l("caret",e),e=w(e,t),l("tildes",e),e=C(e,t),l("xrange",e),e=P(e,t),l("stars",e),e),x=e=>!e||"x"===e.toLowerCase()||"*"===e,w=(e,t)=>e.trim().split(/\s+/).map((e=>E(e,t))).join(" "),E=(e,t)=>{const n=t.loose?u[h.TILDELOOSE]:u[h.TILDE];return e.replace(n,((t,n,i,r,o)=>{let s;return l("tilde",e,t,n,i,r,o),x(n)?s="":x(i)?s=`>=${n}.0.0 <${+n+1}.0.0-0`:x(r)?s=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:o?(l("replaceTilde pr",o),s=`>=${n}.${i}.${r}-${o} <${n}.${+i+1}.0-0`):s=`>=${n}.${i}.${r} <${n}.${+i+1}.0-0`,l("tilde return",s),s}))},S=(e,t)=>e.trim().split(/\s+/).map((e=>T(e,t))).join(" "),T=(e,t)=>{l("caret",e,t);const n=t.loose?u[h.CARETLOOSE]:u[h.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,((t,n,r,o,s)=>{let a;return l("caret",e,t,n,r,o,s),x(n)?a="":x(r)?a=`>=${n}.0.0${i} <${+n+1}.0.0-0`:x(o)?a="0"===n?`>=${n}.${r}.0${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.0${i} <${+n+1}.0.0-0`:s?(l("replaceCaret pr",s),a="0"===n?"0"===r?`>=${n}.${r}.${o}-${s} <${n}.${r}.${+o+1}-0`:`>=${n}.${r}.${o}-${s} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${o}-${s} <${+n+1}.0.0-0`):(l("no pr"),a="0"===n?"0"===r?`>=${n}.${r}.${o}${i} <${n}.${r}.${+o+1}-0`:`>=${n}.${r}.${o}${i} <${n}.${+r+1}.0-0`:`>=${n}.${r}.${o} <${+n+1}.0.0-0`),l("caret return",a),a}))},C=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map((e=>A(e,t))).join(" ")),A=(e,t)=>{e=e.trim();const n=t.loose?u[h.XRANGELOOSE]:u[h.XRANGE];return e.replace(n,((n,i,r,o,s,a)=>{l("xRange",e,n,i,r,o,s,a);const c=x(r),u=c||x(o),h=u||x(s),d=h;return"="===i&&d&&(i=""),a=t.includePrerelease?"-0":"",c?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(u&&(o=0),s=0,">"===i?(i=">=",u?(r=+r+1,o=0,s=0):(o=+o+1,s=0)):"<="===i&&(i="<",u?r=+r+1:o=+o+1),"<"===i&&(a="-0"),n=`${i+r}.${o}.${s}${a}`):u?n=`>=${r}.0.0${a} <${+r+1}.0.0-0`:h&&(n=`>=${r}.${o}.0${a} <${r}.${+o+1}.0-0`),l("xRange return",n),n}))},P=(e,t)=>(l("replaceStars",e,t),e.trim().replace(u[h.STAR],"")),I=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(u[t.includePrerelease?h.GTE0PRE:h.GTE0],"")),M=e=>(t,n,i,r,o,s,a,l,c,u,h,d)=>`${n=x(i)?"":x(r)?`>=${i}.0.0${e?"-0":""}`:x(o)?`>=${i}.${r}.0${e?"-0":""}`:s?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=x(c)?"":x(u)?`<${+c+1}.0.0-0`:x(h)?`<${c}.${+u+1}.0-0`:d?`<=${c}.${u}.${h}-${d}`:e?`<${c}.${u}.${+h+1}-0`:`<=${l}`}`.trim(),R=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(l(e[n].semver),e[n].semver!==a.ANY&&e[n].semver.prerelease.length>0){const i=e[n].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},6339:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t)=>new i(e,t).patch},6481:function(e){e.exports=function(){"use strict";function e(e,i,r,o,s){!function e(n,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=i-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,i,Math.max(r,Math.floor(i-l*u/a+h)),Math.min(o,Math.floor(i+(a-l)*u/a+h)),s)}var d=n[i],p=r,f=o;for(t(n,r,i),s(n[o],d)>0&&t(n,r,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[r],d)?t(n,r,f):t(n,++f,o),f<=i&&(r=f+1),i<=f&&(o=f-1)}}(e,i,r||0,o||e.length-1,s||n)}function t(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function n(e,t){return e<t?-1:e>t?1:0}var i=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(e,t,n){if(!n)return t.indexOf(e);for(var i=0;i<t.length;i++)if(n(e,t[i]))return i;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,i,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=t;o<n;o++){var s=e.children[o];a(r,e.leaf?i(s):s)}return r}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,n,i,r,o){for(var s=[n,i];s.length;)if(!((i=s.pop())-(n=s.pop())<=r)){var a=n+Math.ceil((i-n)/r/2)*r;e(t,a,n,i,o),s.push(n,a,a,i)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var i=this.toBBox,r=[];t;){for(var o=0;o<t.children.length;o++){var s=t.children[o],a=t.leaf?i(s):s;p(e,a)&&(t.leaf?n.push(s):d(e,a)?this._all(s,n):r.push(s))}t=r.pop()}return n},i.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var i=0;i<t.children.length;i++){var r=t.children[i],o=t.leaf?this.toBBox(r):r;if(p(e,o)){if(t.leaf||d(e,o))return!0;n.push(r)}}t=n.pop()}return!1},i.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},i.prototype.clear=function(){return this.data=f([]),this},i.prototype.remove=function(e,t){if(!e)return this;for(var n,i,o,s=this.data,a=this.toBBox(e),l=[],c=[];s||l.length;){if(s||(s=l.pop(),i=l[l.length-1],n=c.pop(),o=!0),s.leaf){var u=r(e,s.children,t);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?i?(n++,s=i.children[n],o=!1):s=null:(l.push(s),c.push(n),n=0,i=s,s=s.children[0])}return this},i.prototype.toBBox=function(e){return e},i.prototype.compareMinX=function(e,t){return e.minX-t.minX},i.prototype.compareMinY=function(e,t){return e.minY-t.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(e){return this.data=e,this},i.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},i.prototype._build=function(e,t,n,i){var r,s=n-t+1,a=this._maxEntries;if(s<=a)return o(r=f(e.slice(t,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1))),(r=f([])).leaf=!1,r.height=i;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));g(e,t,n,c,this.compareMinX);for(var u=t;u<=n;u+=c){var h=Math.min(u+c-1,n);g(e,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);r.children.push(this._build(e,d,p,i-1))}}return o(r,this.toBBox),r},i.prototype._chooseSubtree=function(e,t,n,i){for(;i.push(t),!t.leaf&&i.length-1!==n;){for(var r=1/0,o=1/0,s=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=u(l),h=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,r=c<r?c:r,s=l):h===o&&c<r&&(r=c,s=l)}t=s||t.children[0]}var d,p;return t},i.prototype._insert=function(e,t,n){var i=n?e:this.toBBox(e),r=[],o=this._chooseSubtree(i,this.data,t,r);for(o.children.push(e),a(o,i);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(i,r,t)},i.prototype._split=function(e,t){var n=e[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var s=this._chooseSplitIndex(n,r,i),a=f(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,o(n,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},i.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(e,t,n){for(var i,r,o,a,l,c,h,d=1/0,p=1/0,f=t;f<=n-t;f++){var g=s(e,0,f,this.toBBox),m=s(e,f,n,this.toBBox),_=(r=g,o=m,void 0,void 0,void 0,void 0,a=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),c=Math.min(r.maxX,o.maxX),h=Math.min(r.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),y=u(g)+u(m);_<d?(d=_,i=f,p=y<p?y:p):_===d&&y<p&&(p=y,i=f)}return i||n-t},i.prototype._chooseSplitAxis=function(e,t,n){var i=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)},i.prototype._allDistMargin=function(e,t,n,i){e.children.sort(i);for(var r=this.toBBox,o=s(e,0,t,r),l=s(e,n-t,n,r),c=h(o)+h(l),u=t;u<n-t;u++){var d=e.children[u];a(o,e.leaf?r(d):d),c+=h(o)}for(var p=n-t-1;p>=t;p--){var f=e.children[p];a(l,e.leaf?r(f):f),c+=h(l)}return c},i.prototype._adjustParentBBoxes=function(e,t,n){for(var i=n;i>=0;i--)a(t[i],e)},i.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},i}()},6484:e=>{"use strict";const t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},6505:function(e){e.exports=function(){"use strict";var e={},t={};function n(n,i,r){if(t[n]=r,"index"===n){var o="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",s={};return t.shared(s),t.index(e,s),"undefined"!=typeof window&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),e}}return n("shared",0,(function(e){function t(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))}function n(e,t){this.x=e,this.y=t}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r,o;"function"==typeof SuppressedError&&SuppressedError,n.prototype={clone(){return new n(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround(e,t){const n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:n},n.convert=function(e){if(e instanceof n)return e;if(Array.isArray(e))return new n(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new n(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};var s=function(){if(o)return r;function e(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return o=1,r=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},r}(),a=i(s);let l,c;function u(){return null==l&&(l="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),l}function h(){if(null==c&&(c=!1,u())){const e=5,t=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(t){for(let n=0;n<e*e;n++){const i=4*n;t.fillStyle=`rgb(${i},${i+1},${i+2})`,t.fillRect(n%e,Math.floor(n/e),1,1)}const n=t.getImageData(0,0,e,e).data;for(let t=0;t<e*e*4;t++)if(t%4!=3&&n[t]!==t){c=!0;break}}}return c||!1}var d=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array;function f(){var e=new p(9);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function g(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function m(){var e=new p(3);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function _(e){return Math.hypot(e[0],e[1],e[2])}function y(e,t,n){var i=new p(3);return i[0]=e,i[1]=t,i[2]=n,i}function v(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function b(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function x(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var w,E=_;function S(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}function T(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function C(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e}function A(){var e=new p(2);return p!=Float32Array&&(e[0]=0,e[1]=0),e}function P(e,t){var n=new p(2);return n[0]=e,n[1]=t,n}m(),w=new p(4),p!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0),m(),y(1,0,0),y(0,1,0),T(),T(),f(),A();const I=8192;function M(e,t,n){return t*(I/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}function R(e,t){return(e%t+t)%t}function k(e,t,n){return e*(1-n)+t*n}function O(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function L(e,t,n,i){const r=new a(e,t,n,i);return e=>r.solve(e)}const D=L(.25,.1,.25,1);function F(e,t,n){return Math.min(n,Math.max(t,e))}function N(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function B(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}let z=1;function j(e,t,n){const i={};for(const n in e)i[n]=t.call(this,e[n],n,e);return i}function U(e,t,n){const i={};for(const n in e)t.call(this,e[n],n,e)&&(i[n]=e[n]);return i}function V(e){return Array.isArray(e)?e.map(V):"object"==typeof e&&e?j(e,V):e}const $={};function G(e){$[e]||("undefined"!=typeof console&&console.warn(e),$[e]=!0)}function W(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function H(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let Z=null;function q(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Y(e,n,i,r,o){return t(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const t=new VideoFrame(e,{timestamp:0});try{const s=null==t?void 0:t.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(r*o*4);if(yield t.copyTo(l,function(e,t,n,i,r){const o=4*Math.max(-t,0),s=(Math.max(0,n)-n)*i*4+o,a=4*i,l=Math.max(0,t),c=Math.max(0,n);return{rect:{x:l,y:c,width:Math.min(e.width,t+i)-l,height:Math.min(e.height,n+r)-c},layout:[{offset:s,stride:a}]}}(e,n,i,r,o)),a)for(let e=0;e<l.length;e+=4){const t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{t.close()}}))}let K,J;function Q(e,t,n,i){return e.addEventListener(t,n,i),{unsubscribe:()=>{e.removeEventListener(t,n,i)}}}function ee(e){return e*Math.PI/180}function te(e){return e/Math.PI*180}const ne={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ie={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},re="AbortError";function oe(){return new Error(re)}const se={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ae(e){return se.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const le="global-dispatcher";class ce extends Error{constructor(e,t,n,i){super(`AJAXError: ${t} (${e}): ${n}`),this.status=e,this.statusText=t,this.url=n,this.body=i}}const ue=()=>H(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,he=function(e,n){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const t=ae(e.url);if(t)return t(e,n);if(H(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:le},n)}if(!(/^file:/.test(i=e.url)||/^file:/.test(ue())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(e,n){return t(this,void 0,void 0,(function*(){const t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:ue(),signal:n.signal});let i,r;"json"!==e.type||t.headers.has("Accept")||t.headers.set("Accept","application/json");try{i=yield fetch(t)}catch(t){throw new ce(0,t.message,e.url,new Blob)}if(!i.ok){const t=yield i.blob();throw new ce(i.status,i.statusText,e.url,t)}r="arrayBuffer"===e.type||"image"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text();const o=yield r;if(n.signal.aborted)throw oe();return{data:o,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires")}}))}(e,n);if(H(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:le},n)}var i;return function(e,t){return new Promise(((n,i)=>{var r;const o=new XMLHttpRequest;o.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(o.responseType="arraybuffer");for(const t in e.headers)o.setRequestHeader(t,e.headers[t]);"json"===e.type&&(o.responseType="text",(null===(r=e.headers)||void 0===r?void 0:r.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===e.credentials,o.onerror=()=>{i(new Error(o.statusText))},o.onload=()=>{if(!t.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let t=o.response;if("json"===e.type)try{t=JSON.parse(o.response)}catch(e){return void i(e)}n({data:t,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const t=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});i(new ce(o.status,o.statusText,e.url,t))}},t.signal.addEventListener("abort",(()=>{o.abort(),i(oe())})),o.send(e.body)}))}(e,n)};function de(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const t=new URL(e),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function pe(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function fe(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class ge{constructor(e,t={}){B(this,t),this.type=e}}class me extends ge{constructor(e,t={}){super("error",B({error:e},t))}}class _e{on(e,t){return this._listeners=this._listeners||{},pe(e,t,this._listeners),{unsubscribe:()=>{this.off(e,t)}}}off(e,t){return fe(e,t,this._listeners),fe(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},pe(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new ge(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const t of i)fe(n,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(B(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof me&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ve=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function be(e,t){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return ve.forEach((e=>{e in t&&(n[e]=t[e])})),n}function xe(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!xe(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!xe(e[n],t[n]))return!1;return!0}return e===t}function we(e,t){e.push(t)}function Ee(e,t,n){we(n,{command:"addSource",args:[e,t[e]]})}function Se(e,t,n){we(t,{command:"removeSource",args:[e]}),n[e]=!0}function Te(e,t,n,i){Se(e,n,i),Ee(e,t,n)}function Ce(e,t,n){let i;for(i in e[n])if(Object.prototype.hasOwnProperty.call(e[n],i)&&"data"!==i&&!xe(e[n][i],t[n][i]))return!1;for(i in t[n])if(Object.prototype.hasOwnProperty.call(t[n],i)&&"data"!==i&&!xe(e[n][i],t[n][i]))return!1;return!0}function Ae(e,t,n,i,r,o){e=e||{},t=t||{};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(xe(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}));for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(xe(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}))}function Pe(e){return e.id}function Ie(e,t){return e[t.id]=t,e}class Me{constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function Re(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}class ke extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Oe{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,n]of t)this.bindings[e]=n}concat(e){return new Oe(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Le={kind:"null"},De={kind:"number"},Fe={kind:"string"},Ne={kind:"boolean"},Be={kind:"color"},ze={kind:"projectionDefinition"},je={kind:"object"},Ue={kind:"value"},Ve={kind:"collator"},$e={kind:"formatted"},Ge={kind:"padding"},We={kind:"colorArray"},He={kind:"numberArray"},Ze={kind:"resolvedImage"},qe={kind:"variableAnchorOffsetCollection"};function Xe(e,t){return{kind:"array",itemType:e,N:t}}function Ye(e){if("array"===e.kind){const t=Ye(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ke=[Le,De,Fe,Ne,Be,ze,$e,je,Xe(Ue),Ge,He,We,Ze,qe];function Je(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Je(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ke)if(!Je(e,t))return null}return`Expected ${Ye(e)} but found ${Ye(t)} instead.`}function Qe(e,t){return t.some((t=>t.kind===e.kind))}function et(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function tt(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const nt=.96422,it=.82521,rt=4/29,ot=6/29,st=3*ot*ot,at=ot*ot*ot,lt=Math.PI/180,ct=180/Math.PI;function ut(e){return(e%=360)<0&&(e+=360),e}function ht([e,t,n,i]){let r,o;const s=pt((.2225045*(e=dt(e))+.7168786*(t=dt(t))+.0606169*(n=dt(n)))/1);e===t&&t===n?r=o=s:(r=pt((.4360747*e+.3850649*t+.1430804*n)/nt),o=pt((.0139322*e+.0971045*t+.7141733*n)/it));const a=116*s-16;return[a<0?0:a,500*(r-s),200*(s-o),i]}function dt(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function pt(e){return e>at?Math.pow(e,1/3):e/st+rt}function ft([e,t,n,i]){let r=(e+16)/116,o=isNaN(t)?r:r+t/500,s=isNaN(n)?r:r-n/200;return r=1*mt(r),o=nt*mt(o),s=it*mt(s),[gt(3.1338561*o-1.6168667*r-.4906146*s),gt(-.9787684*o+1.9161415*r+.033454*s),gt(.0719453*o-.2289914*r+1.4052427*s),i]}function gt(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function mt(e){return e>ot?e*e*e:st*(e-rt)}const _t=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function yt(e,t){return _t(e,t)?e[t]:void 0}function vt(e){return parseInt(e.padEnd(2,e),16)/255}function bt(e,t){return xt(t?e/100:e,0,1)}function xt(e,t,n){return Math.min(Math.max(t,e),n)}function wt(e){return!e.some(Number.isNaN)}const Et={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function St(e,t,n){return e+n*(t-e)}function Tt(e,t,n){return e.map(((e,i)=>St(e,t[i],n)))}class Ct{constructor(e,t,n,i=1,r=!0){this.r=e,this.g=t,this.b=n,this.a=i,r||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,n,i]))}static parse(e){if(e instanceof Ct)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=yt(Et,e);if(t){const[e,n,i]=t;return[e/255,n/255,i/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let n=1;return[vt(e.slice(n,n+=t)),vt(e.slice(n,n+=t)),vt(e.slice(n,n+=t)),vt(e.slice(n,n+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,n,i,r,o,s,a,l,c,u,h,d]=t,p=[r||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[i,s,c].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[xt(+n/t,0,1),xt(+o/t,0,1),xt(+l/t,0,1),h?bt(+h,d):1];if(wt(e))return e}}return}}const n=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[e,t,i,r,o,s,a,l,c]=n,u=[i||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,xt(+r,0,100),xt(+s,0,100),l?bt(+l,c):1];if(wt(e))return function([e,t,n,i]){function r(i){const r=(i+e/30)%12,o=t*Math.min(n,1-n);return n-o*Math.max(-1,Math.min(r-3,9-r,1))}return e=ut(e),t/=100,n/=100,[r(0),r(8),r(4),i]}(e)}}}(e);return t?new Ct(...t,!1):void 0}get rgb(){const{r:e,g:t,b:n,a:i}=this,r=i||1/0;return this.overwriteGetter("rgb",[e/r,t/r,n/r,i])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,n,i,r]=ht(e),o=Math.sqrt(n*n+i*i);return[Math.round(1e4*o)?ut(Math.atan2(i,n)*ct):NaN,o,t,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ht(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,i]=this.rgb;return`rgba(${[e,t,n].map((e=>Math.round(255*e))).join(",")},${i})`}static interpolate(e,t,n,i="rgb"){switch(i){case"rgb":{const[i,r,o,s]=Tt(e.rgb,t.rgb,n);return new Ct(i,r,o,s,!1)}case"hcl":{const[i,r,o,s]=e.hcl,[a,l,c,u]=t.hcl;let h,d;if(isNaN(i)||isNaN(a))isNaN(i)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=i,1!==c&&0!==c||(d=r));else{let e=a-i;a>i&&e>180?e-=360:a<i&&i-a>180&&(e+=360),h=i+n*e}const[p,f,g,m]=function([e,t,n,i]){return e=isNaN(e)?0:e*lt,ft([n,Math.cos(e)*t,Math.sin(e)*t,i])}([h,null!=d?d:St(r,l,n),St(o,c,n),St(s,u,n)]);return new Ct(p,f,g,m,!1)}case"lab":{const[i,r,o,s]=ft(Tt(e.lab,t.lab,n));return new Ct(i,r,o,s,!1)}}}}Ct.black=new Ct(0,0,0,1),Ct.white=new Ct(1,1,1,1),Ct.transparent=new Ct(0,0,0,0),Ct.red=new Ct(1,0,0,1);class At{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Pt=["bottom","center","top"];class It{constructor(e,t,n,i,r,o){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r,this.verticalAlign=o}}class Mt{constructor(e){this.sections=e}static fromString(e){return new Mt([new It(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Mt?e:Mt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class Rt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Rt)return e;if("number"==typeof e)return new Rt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Rt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new Rt(Tt(e.values,t.values,n))}}class kt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof kt)return e;if("number"==typeof e)return new kt([e]);if(Array.isArray(e)){for(const t of e)if("number"!=typeof t)return;return new kt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){return new kt(Tt(e.values,t.values,n))}}class Ot{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ot)return e;if("string"==typeof e){const t=Ct.parse(e);if(!t)return;return new Ot([t])}if(!Array.isArray(e))return;const t=[];for(const n of e){if("string"!=typeof n)return;const e=Ct.parse(n);if(!e)return;t.push(e)}return new Ot(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n,i="rgb"){const r=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)r.push(Ct.interpolate(e.values[o],t.values[o],n,i));return new Ot(r)}}class Lt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Dt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ft{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ft)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];if("string"!=typeof n||!Dt.has(n))return;if(!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new Ft(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,n){const i=e.values,r=t.values;if(i.length!==r.length)throw new Lt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let e=0;e<i.length;e+=2){if(i[e]!==r[e])throw new Lt(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${i[e]}, to[${e}]: ${r[e]}`);o.push(i[e]);const[t,s]=i[e+1],[a,l]=r[e+1];o.push([St(t,a,n),St(s,l,n)])}return new Ft(o)}}class Nt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Nt({name:e,available:!1}):null}}class Bt{constructor(e,t,n){this.from=e,this.to=t,this.transition=n}static interpolate(e,t,n){return new Bt(e,t,n)}static parse(e){return e instanceof Bt?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new Bt(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new Bt(e.from,e.to,e.transition):"string"==typeof e?new Bt(e,e,1):void 0}}function zt(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jt(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Bt||e instanceof Ct||e instanceof At||e instanceof Mt||e instanceof Rt||e instanceof kt||e instanceof Ot||e instanceof Ft||e instanceof Nt)return!0;if(Array.isArray(e)){for(const t of e)if(!jt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!jt(e[t]))return!1;return!0}return!1}function Ut(e){if(null===e)return Le;if("string"==typeof e)return Fe;if("boolean"==typeof e)return Ne;if("number"==typeof e)return De;if(e instanceof Ct)return Be;if(e instanceof Bt)return ze;if(e instanceof At)return Ve;if(e instanceof Mt)return $e;if(e instanceof Rt)return Ge;if(e instanceof kt)return He;if(e instanceof Ot)return We;if(e instanceof Ft)return qe;if(e instanceof Nt)return Ze;if(Array.isArray(e)){const t=e.length;let n;for(const t of e){const e=Ut(t);if(n){if(n===e)continue;n=Ue;break}n=e}return Xe(n||Ue,t)}return je}function Vt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ct||e instanceof Bt||e instanceof Mt||e instanceof Rt||e instanceof kt||e instanceof Ot||e instanceof Ft||e instanceof Nt?e.toString():JSON.stringify(e)}class $t{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!jt(e[1]))return t.error("invalid value");const n=e[1];let i=Ut(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new $t(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Gt={string:Fe,number:De,boolean:Ne,object:je};class Wt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Gt)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=Gt[n],i++}else r=Ue;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=Xe(r,o)}else{if(!Gt[r])throw new Error(`Types doesn't contain name = ${r}`);n=Gt[r]}const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,Ue);if(!n)return null;o.push(n)}return new Wt(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!Je(this.type,Ut(n)))return n;if(t===this.args.length-1)throw new Lt(`Expected value to be of type ${Ye(this.type)}, but found ${Ye(Ut(n))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Ht={"to-boolean":Ne,"to-color":Be,"to-number":De,"to-string":Fe};class Zt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!Ht[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const i=Ht[n],r=[];for(let n=1;n<e.length;n++){const i=t.parse(e[n],n,Ue);if(!i)return null;r.push(i)}return new Zt(i,r)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof Ct)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:zt(t[0],t[1],t[2],t[3]),!n))return new Ct(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Lt(n||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const i=Rt.parse(t);if(i)return i}throw new Lt(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=kt.parse(t);if(i)return i}throw new Lt(`Could not parse numberArray from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const n of this.args){t=n.evaluate(e);const i=Ot.parse(t);if(i)return i}throw new Lt(`Could not parse colorArray from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const i=Ft.parse(t);if(i)return i}throw new Lt(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Lt(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Mt.fromString(Vt(this.args[0].evaluate(e)));case"resolvedImage":return Nt.fromString(Vt(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Vt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const qt=["Unknown","Point","LineString","Polygon"];class Xt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?qt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Ct.parse(e),this._parseColorCache.set(e,t)),t}}class Yt{constructor(e,t,n=[],i,r=new Oe,o=[]){this.registry=e,this.path=n,this.key=n.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,n,i,r={}){return t?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new Wt(t,[e]):"coerce"===n?new Zt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind){if("projectionDefinition"===e.kind&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(e.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(e.kind)&&["value","number","array"].includes(r.kind)||"colorArray"===e.kind&&["value","string","array"].includes(r.kind)||"variableAnchorOffsetCollection"===e.kind&&["value","array"].includes(r.kind))i=n(i,e,t.typeAnnotation||"coerce");else if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof $t)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){const t=new Xt;try{i=new $t(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new Yt(this.registry,this._isConstant,i,t||null,r,this.errors)}error(e,...t){const n=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ke(n,e))}checkSubtype(e,t){const n=Je(e,t);return n&&this.error(n),n}}class Kt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let i=1;i<e.length-1;i+=2){const r=e[i];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;n.push([r,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Kt(n,i):null}outputDefined(){return this.result.outputDefined()}}class Jt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Jt(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Qt{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,De),i=t.parse(e[2],2,Xe(t.expectedType||Ue));return n&&i?new Qt(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Lt(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Lt(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Lt(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class en{constructor(e,t){this.type=Ne,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ue),i=t.parse(e[2],2,Ue);return n&&i?Qe(n.type,[Ne,Fe,De,Le,Ue])?new en(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ye(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!et(t,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${Ye(Ut(t))} instead.`);if(!et(n,["string","array"]))throw new Lt(`Expected second argument to be of type array or string, but found ${Ye(Ut(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class tn{constructor(e,t,n){this.type=De,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ue),i=t.parse(e[2],2,Ue);if(!n||!i)return null;if(!Qe(n.type,[Ne,Fe,De,Le,Ue]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ye(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,De);return r?new tn(n,i,r):null}return new tn(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!et(t,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${Ye(Ut(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),et(n,["string"])){const e=n.indexOf(t,i);return-1===e?-1:[...n.slice(0,e)].length}if(et(n,["array"]))return n.indexOf(t,i);throw new Lt(`Expected second argument to be of type array or string, but found ${Ye(Ut(n))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class nn{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,Ut(e)))return null}else n=Ut(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,s,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,Ue);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new nn(n,i,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Ut(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class rn{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,Ne);if(!o)return null;const s=t.parse(e[r+1],r+1,n);if(!s)return null;i.push([o,s]),n=n||s.type}const r=t.parse(e[e.length-1],e.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new rn(n,i,r)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class on{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ue),i=t.parse(e[2],2,De);if(!n||!i)return null;if(!Qe(n.type,[Xe(Ue),Fe,Ue]))return t.error(`Expected first argument to be of type array or string, but found ${Ye(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,De);return r?new on(n.type,n,i,r):null}return new on(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),et(t,["string"]))return[...t].slice(n,i).join("");if(et(t,["array"]))return t.slice(n,i);throw new Lt(`Expected first argument to be of type array or string, but found ${Ye(Ut(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function sn(e,t){const n=e.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],r=e[a+1],i<=t){if(a===n||t<r)return a;o=a+1}else{if(!(i>t))throw new Lt("Input is not a number.");s=a-1}return 0}class an{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,De);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let n=1;n<e.length;n+=2){const o=1===n?-1/0:e[n],s=e[n+1],a=n,l=n+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([o,c])}return new an(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[sn(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}var ln,cn,un=function(){if(cn)return ln;function e(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}return cn=1,ln=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ln}(),hn=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(un);class dn{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=pn(t,e.base,n,i);else if("linear"===e.name)r=pn(t,1,n,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new hn(o[0],o[1],o[2],o[3]).solve(pn(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,De),!r)return null;const s=[];let a=null;"interpolate-hcl"!==n&&"interpolate-lab"!==n||t.expectedType==We?t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType):a=Be;for(let e=0;e<o.length;e+=2){const n=o[e],i=o[e+1],r=e+3,l=e+4;if("number"!=typeof n)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=n)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(i,l,a);if(!c)return null;a=a||c.type,s.push([n,c])}return tt(a,De)||tt(a,ze)||tt(a,Be)||tt(a,Ge)||tt(a,He)||tt(a,We)||tt(a,qe)||tt(a,Xe(De))?new dn(a,n,i,r,s):t.error(`Type ${Ye(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=sn(t,i),s=dn.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return St(a,l,s);case"color":return Ct.interpolate(a,l,s);case"padding":return Rt.interpolate(a,l,s);case"colorArray":return Ot.interpolate(a,l,s);case"numberArray":return kt.interpolate(a,l,s);case"variableAnchorOffsetCollection":return Ft.interpolate(a,l,s);case"array":return Tt(a,l,s);case"projectionDefinition":return Bt.interpolate(a,l,s)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ct.interpolate(a,l,s,"hcl");case"colorArray":return Ot.interpolate(a,l,s,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ct.interpolate(a,l,s,"lab");case"colorArray":return Ot.interpolate(a,l,s,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function pn(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}const fn={color:Ct.interpolate,number:St,padding:Rt.interpolate,numberArray:kt.interpolate,colorArray:Ot.interpolate,variableAnchorOffsetCollection:Ft.interpolate,array:Tt};class gn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const i of e.slice(1)){const e=t.parse(i,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}if(!n)throw new Error("No output type");const o=i&&r.some((e=>Je(i,e.type)));return new gn(o?Ue:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(e),n&&n instanceof Nt&&!n.available&&(t||(t=n.name),n=null,i===this.args.length&&(n=t)),null!==n)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function mn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function _n(e,t,n,i){return 0===i.compare(t,n)}function yn(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=Ne,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,Ue);if(!o)return null;if(!mn(n,o.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${Ye(o.type)}'.`);let s=t.parse(e[2],2,Ue);if(!s)return null;if(!mn(n,s.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${Ye(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Ye(o.type)}' and '${Ye(s.type)}'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Wt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Wt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Ve),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=Ut(o),n=Ut(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new Lt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const e=Ut(o),n=Ut(s);if("string"!==e.kind||"string"!==n.kind)return t(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const vn=yn("==",(function(e,t,n){return t===n}),_n),bn=yn("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!_n(0,t,n,i)})),xn=yn("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),wn=yn(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),En=yn("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),Sn=yn(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0}));class Tn{constructor(e,t,n){this.type=Ve,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Ne);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Ne);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,Fe),!o)?null:new Tn(i,r,o)}evaluate(e){return new At(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Cn{constructor(e,t,n,i,r){this.type=Fe,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,De);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,Fe),!r))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,Fe),!o))return null;let s=null;if(i["min-fraction-digits"]&&(s=t.parse(i["min-fraction-digits"],1,De),!s))return null;let a=null;return i["max-fraction-digits"]&&(a=t.parse(i["max-fraction-digits"],1,De),!a)?null:new Cn(n,r,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class An{constructor(e){this.type=$e,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let n=1;n<=e.length-1;++n){const o=e[n];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,De),!e))return null;let n=null;if(o["text-font"]&&(n=t.parse(o["text-font"],1,Xe(Fe)),!n))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,Be),!s))return null;let a=null;if(o["vertical-align"]){if("string"==typeof o["vertical-align"]&&!Pt.includes(o["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${o["vertical-align"]}' instead.`);if(a=t.parse(o["vertical-align"],1,Fe),!a)return null}const l=i[i.length-1];l.scale=e,l.font=n,l.textColor=s,l.verticalAlign=a}else{const o=t.parse(e[n],1,Ue);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:o,scale:null,font:null,textColor:null,verticalAlign:null})}}return new An(i)}evaluate(e){return new Mt(this.sections.map((t=>{const n=t.content.evaluate(e);return Ut(n)===Ze?new It("",n,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new It(Vt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class Pn{constructor(e){this.type=Ze,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Fe);return n?new Pn(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Nt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class In{constructor(e){this.type=De,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${Ye(n.type)} instead.`):new In(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Lt(`Expected value to be of type string or array, but found ${Ye(Ut(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Mn=8192;function Rn(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*Mn),Math.round(i*r*Mn)]}function kn(e,t){const n=Math.pow(2,t.z);return[(r=(e[0]/Mn+t.x)/n,360*r-180),(i=(e[1]/Mn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function On(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ln(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Dn(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function Fn(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*o[0]&&!(!Vn(e,t,n,i)||!Vn(n,i,e,t));var r,o}function Nn(e,t,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(Fn(e,t,i[n],i[n+1]))return!0;return!1}function Bn(e,t,n=!1){let i=!1;for(const a of t)for(let t=0;t<a.length-1;t++){if(Dn(e,a[t],a[t+1]))return n;(o=a[t])[1]>(r=e)[1]!=(s=a[t+1])[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(i=!i)}var r,o,s;return i}function zn(e,t){for(const n of t)if(Bn(e,n))return!0;return!1}function jn(e,t){for(const n of e)if(!Bn(n,t))return!1;for(let n=0;n<e.length-1;++n)if(Nn(e[n],e[n+1],t))return!1;return!0}function Un(e,t){for(const n of t)if(jn(e,n))return!0;return!1}function Vn(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(e[0]-n[0])*o-r*(e[1]-n[1]),a=(t[0]-n[0])*o-r*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function $n(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const s=Rn(e[r][i],n);On(t,s),o.push(s)}i.push(o)}return i}function Gn(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=$n(e[r],t,n);i.push(o)}return i}function Wn(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}On(t,e)}function Hn(e,t,n,i){const r=Math.pow(2,i.z)*Mn,o=[i.x*Mn,i.y*Mn],s=[];for(const i of e)for(const e of i){const i=[e.x+o[0],e.y+o[1]];Wn(i,t,n,r),s.push(i)}return s}function Zn(e,t,n,i){const r=Math.pow(2,i.z)*Mn,o=[i.x*Mn,i.y*Mn],s=[];for(const n of e){const e=[];for(const i of n){const n=[i.x+o[0],i.y+o[1]];On(t,n),e.push(n)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)Wn(i,t,n,r)}var a;return s}class qn{constructor(e,t){this.type=Ne,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jt(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const n of t.features){const{type:t,coordinates:i}=n.geometry;"Polygon"===t&&e.push(i),"MultiPolygon"===t&&e.push(...i)}if(e.length)return new qn(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new qn(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new qn(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=$n(t.coordinates,i,r),s=Hn(e.geometry(),n,i,r);if(!Ln(n,i))return!1;for(const e of s)if(!Bn(e,o))return!1}if("MultiPolygon"===t.type){const o=Gn(t.coordinates,i,r),s=Hn(e.geometry(),n,i,r);if(!Ln(n,i))return!1;for(const e of s)if(!zn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=$n(t.coordinates,i,r),s=Zn(e.geometry(),n,i,r);if(!Ln(n,i))return!1;for(const e of s)if(!jn(e,o))return!1}if("MultiPolygon"===t.type){const o=Gn(t.coordinates,i,r),s=Zn(e.geometry(),n,i,r);if(!Ln(n,i))return!1;for(const e of s)if(!Un(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Xn=class{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1);const o=i+1;if(o<this.length&&n(t[o],t[i])<0&&(i=o),n(t[i],r)>=0)break;t[e]=t[i],e=i}t[e]=r}};function Yn(e,t,n=0,i=e.length-1,r=Jn){for(;i>n;){if(i-n>600){const o=i-n+1,s=t-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Yn(e,t,Math.max(n,Math.floor(t-s*l/o+c)),Math.min(i,Math.floor(t+(o-s)*l/o+c)),r)}const o=e[t];let s=n,a=i;for(Kn(e,n,t),r(e[i],o)>0&&Kn(e,n,i);s<a;){for(Kn(e,s,a),s++,a--;r(e[s],o)<0;)s++;for(;r(e[a],o)>0;)a--}0===r(e[n],o)?Kn(e,n,a):(a++,Kn(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}}function Kn(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Jn(e,t){return e<t?-1:e>t?1:0}function Qn(e,t){if(e.length<=1)return[e];const n=[];let i,r;for(const t of e){const e=ti(t);0!==e&&(t.area=Math.abs(e),void 0===r&&(r=e<0),r===e<0?(i&&n.push(i),i=[t]):i.push(t))}if(i&&n.push(i),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(Yn(n[e],t,1,n[e].length-1,ei),n[e]=n[e].slice(0,t));return n}function ei(e,t){return t.area-e.area}function ti(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}const ni=1/298.257223563,ii=ni*(2-ni),ri=Math.PI/180;class oi{constructor(e){const t=6378.137*ri*1e3,n=Math.cos(e*ri),i=1/(1-ii*(1-n*n)),r=Math.sqrt(i);this.kx=t*r*n,this.ky=t*r*i*(1-ii)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(e,t){let n,i,r,o,s=1/0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=this.wrap(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,n=l,i=c,r=a,o=d)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function si(e,t){return t[0]-e[0]}function ai(e){return e[1]-e[0]+1}function li(e,t){return e[1]>=e[0]&&e[1]<t}function ci(e,t){if(e[0]>e[1])return[null,null];const n=ai(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===n)return[e,null];const i=Math.floor(n/2)-1;return[[e[0],e[0]+i],[e[0]+i+1,e[1]]]}function ui(e,t){if(!li(t,e.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let i=t[0];i<=t[1];++i)On(n,e[i]);return n}function hi(e){const t=[1/0,1/0,-1/0,-1/0];for(const n of e)for(const e of n)On(t,e);return t}function di(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function pi(e,t,n){if(!di(e)||!di(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function fi(e,t,n){const i=n.pointOnLine(t,e);return n.distance(e,i.point)}function gi(e,t,n,i,r){const o=Math.min(fi(e,[n,i],r),fi(t,[n,i],r)),s=Math.min(fi(n,[e,t],r),fi(i,[e,t],r));return Math.min(o,s)}function mi(e,t,n,i,r){if(!li(t,e.length)||!li(i,n.length))return 1/0;let o=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],a=e[s+1];for(let e=i[0];e<i[1];++e){const i=n[e],s=n[e+1];if(Fn(t,a,i,s))return 0;o=Math.min(o,gi(t,a,i,s,r))}}return o}function _i(e,t,n,i,r){if(!li(t,e.length)||!li(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=i[0];t<=i[1];++t)if(o=Math.min(o,r.distance(e[s],n[t])),0===o)return o;return o}function yi(e,t,n){if(Bn(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r[0],o=r[r.length-1];if(t!==o&&(i=Math.min(i,fi(e,[o,t],n)),0===i))return i;const s=n.pointOnLine(r,e);if(i=Math.min(i,n.distance(e,s.point)),0===i)return i}return i}function vi(e,t,n,i){if(!li(t,e.length))return NaN;for(let i=t[0];i<=t[1];++i)if(Bn(e[i],n,!0))return 0;let r=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],s=e[o+1];for(const e of n)for(let n=0,o=e.length,a=o-1;n<o;a=n++){const o=e[a],l=e[n];if(Fn(t,s,o,l))return 0;r=Math.min(r,gi(t,s,o,l,i))}}return r}function bi(e,t){for(const n of e)for(const e of n)if(Bn(e,t,!0))return!0;return!1}function xi(e,t,n,i=1/0){const r=hi(e),o=hi(t);if(i!==1/0&&pi(r,o,n)>=i)return i;if(Ln(r,o)){if(bi(e,t))return 0}else if(bi(t,e))return 0;let s=1/0;for(const i of e)for(let e=0,r=i.length,o=r-1;e<r;o=e++){const r=i[o],a=i[e];for(const e of t)for(let t=0,i=e.length,o=i-1;t<i;o=t++){const i=e[o],l=e[t];if(Fn(r,a,i,l))return 0;s=Math.min(s,gi(r,a,i,l,n))}}return s}function wi(e,t,n,i,r,o){if(!o)return;const s=pi(ui(i,o),r,n);s<t&&e.push([s,o,[0,0]])}function Ei(e,t,n,i,r,o,s){if(!o||!s)return;const a=pi(ui(i,o),ui(r,s),n);a<t&&e.push([a,o,s])}function Si(e,t,n,i,r=1/0){let o=Math.min(i.distance(e[0],n[0][0]),r);if(0===o)return o;const s=new Xn([[0,[0,e.length-1],[0,0]]],si),a=hi(n);for(;s.length>0;){const r=s.pop();if(r[0]>=o)continue;const l=r[1],c=t?50:100;if(ai(l)<=c){if(!li(l,e.length))return NaN;if(t){const t=vi(e,l,n,i);if(isNaN(t)||0===t)return t;o=Math.min(o,t)}else for(let t=l[0];t<=l[1];++t){const r=yi(e[t],n,i);if(o=Math.min(o,r),0===o)return 0}}else{const n=ci(l,t);wi(s,o,i,e,a,n[0]),wi(s,o,i,e,a,n[1])}}return o}function Ti(e,t,n,i,r,o=1/0){let s=Math.min(o,r.distance(e[0],n[0]));if(0===s)return s;const a=new Xn([[0,[0,e.length-1],[0,n.length-1]]],si);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=t?50:100,h=i?50:100;if(ai(l)<=u&&ai(c)<=h){if(!li(l,e.length)&&li(c,n.length))return NaN;let o;if(t&&i)o=mi(e,l,n,c,r),s=Math.min(s,o);else if(t&&!i){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(o=fi(n[e],t,r),s=Math.min(s,o),0===s)return s}else if(!t&&i){const t=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(o=fi(e[n],t,r),s=Math.min(s,o),0===s)return s}else o=_i(e,l,n,c,r),s=Math.min(s,o)}else{const o=ci(l,t),u=ci(c,i);Ei(a,s,r,e,n,o[0],u[0]),Ei(a,s,r,e,n,o[0],u[1]),Ei(a,s,r,e,n,o[1],u[0]),Ei(a,s,r,e,n,o[1],u[1])}}return s}function Ci(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class Ai{constructor(e,t){this.type=De,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jt(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new Ai(t,t.features.map((e=>Ci(e.geometry))).flat());if("Feature"===t.type)return new Ai(t,Ci(t.geometry));if("type"in t&&"coordinates"in t)return new Ai(t,Ci(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=e.geometry(),i=n.flat().map((t=>kn([t.x,t.y],e.canonical)));if(0===n.length)return NaN;const r=new oi(i[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Ti(i,!1,[e.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Ti(i,!1,e.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,Si(i,!1,e.coordinates,r,o))}if(0===o)return o}return o}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=e.geometry(),i=n.flat().map((t=>kn([t.x,t.y],e.canonical)));if(0===n.length)return NaN;const r=new oi(i[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Ti(i,!0,[e.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Ti(i,!0,e.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,Si(i,!0,e.coordinates,r,o))}if(0===o)return o}return o}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const n=e.geometry();if(0===n.length||0===n[0].length)return NaN;const i=Qn(n,0).map((t=>t.map((t=>t.map((t=>kn([t.x,t.y],e.canonical))))))),r=new oi(i[0][0][0][1]);let o=1/0;for(const e of t)for(const t of i){switch(e.type){case"Point":o=Math.min(o,Si([e.coordinates],!1,t,r,o));break;case"LineString":o=Math.min(o,Si(e.coordinates,!0,t,r,o));break;case"Polygon":o=Math.min(o,xi(t,e.coordinates,r,o))}if(0===o)return o}return o}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Pi{constructor(e){this.type=Ue,this.key=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=e[1];return null==n?t.error("Global state property must be defined."):"string"!=typeof n?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Pi(n)}evaluate(e){var t;const n=null===(t=e.globals)||void 0===t?void 0:t.globalState;return n&&0!==Object.keys(n).length?yt(n,this.key):null}eachChild(){}outputDefined(){return!1}}const Ii={"==":vn,"!=":bn,">":wn,"<":xn,">=":Sn,"<=":En,array:Wt,at:Qt,boolean:Wt,case:rn,coalesce:gn,collator:Tn,format:An,image:Pn,in:en,"index-of":tn,interpolate:dn,"interpolate-hcl":dn,"interpolate-lab":dn,length:In,let:Kt,literal:$t,match:nn,number:Wt,"number-format":Cn,object:Wt,slice:on,step:an,string:Wt,"to-boolean":Zt,"to-color":Zt,"to-number":Zt,"to-string":Zt,var:Jt,within:qn,distance:Ai,"global-state":Pi};class Mi{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],i=Mi.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[i,o]of s){a=new Yt(t.registry,Di,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(i)?i[t-1]:i.type,o=a.parse(n,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(i)&&i.length!==s.length)a.error(`Expected ${i.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(i)?i[e]:i.type,n=s[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Mi(n,r,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ye).join(", ")})`:`(${Ye(t.type)}...)`;var t})).join(" | "),i=[];for(let n=1;n<e.length;n++){const r=t.parse(e[n],1+i.length);if(!r)return null;i.push(Ye(r.type))}t.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(e,t){Mi.definitions=t;for(const n in t)e[n]=Mi}}function Ri(e,[t,n,i,r]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const o=r?r.evaluate(e):1,s=zt(t,n,i,o);if(s)throw new Lt(s);return new Ct(t/255,n/255,i/255,o,!1)}function ki(e,t){return e in t}function Oi(e,t){const n=t[e];return void 0===n?null:n}function Li(e){return{type:e}}function Di(e){if(e instanceof Jt)return Di(e.boundExpression);if(e instanceof Mi&&"error"===e.name)return!1;if(e instanceof Tn)return!1;if(e instanceof qn)return!1;if(e instanceof Ai)return!1;if(e instanceof Pi)return!1;const t=e instanceof Zt||e instanceof Wt;let n=!0;return e.eachChild((e=>{n=t?n&&Di(e):n&&e instanceof $t})),!!n&&Fi(e)&&Bi(e,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Fi(e){if(e instanceof Mi){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof qn)return!1;if(e instanceof Ai)return!1;let t=!0;return e.eachChild((e=>{t&&!Fi(e)&&(t=!1)})),t}function Ni(e){if(e instanceof Mi&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Ni(e)&&(t=!1)})),t}function Bi(e,t){if(e instanceof Mi&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!Bi(e,t)&&(n=!1)})),n}function zi(e){return{result:"success",value:e}}function ji(e){return{result:"error",value:e}}function Ui(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Vi(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function $i(e){return!!e.expression&&e.expression.interpolated}function Gi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Wi(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&Ut(e)===je}function Hi(e){return e}function Zi(e,t){const n=e.stops&&"object"==typeof e.stops[0][0],i=n||!(n||void 0!==e.property),r=e.type||($i(t)?"exponential":"interval"),o=function(e){switch(e.type){case"color":return Ct.parse;case"padding":return Rt.parse;case"numberArray":return kt.parse;case"colorArray":return Ot.parse;default:return null}}(t);if(o&&((e=Re({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],o(e[1])]))),e.default=o(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==(s=e.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${e.colorSpace}"`);var s;const a=function(e){switch(e){case"exponential":return Ki;case"interval":return Yi;case"categorical":return Xi;case"identity":return Ji;default:throw new Error(`Unknown function type "${e}"`)}}(r);let l,c;if("categorical"===r){l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}if(n){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,Zi(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:dn.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:({zoom:n},i)=>Ki({stops:r,base:e.base},t,n).evaluate(n,i)}}if(i){const n="exponential"===r?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:dn.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:n})=>a(e,t,n,l,c)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?qi(e.default,t.default):a(e,t,r,l,c)}}}function qi(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function Xi(e,t,n,i,r){return qi(typeof n===r?i[n]:void 0,e.default,t.default)}function Yi(e,t,n){if("number"!==Gi(n))return qi(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=sn(e.stops.map((e=>e[0])),n);return e.stops[r][1]}function Ki(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Gi(n))return qi(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=sn(e.stops.map((e=>e[0])),n),s=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1],c=fn[t.type]||Hi;return"function"==typeof a.evaluate?{evaluate(...t){const n=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return c(n,i,s,e.colorSpace)}}:c(a,l,s,e.colorSpace)}function Ji(e,t,n){switch(t.type){case"color":n=Ct.parse(n);break;case"formatted":n=Mt.fromString(n.toString());break;case"resolvedImage":n=Nt.fromString(n.toString());break;case"padding":n=Rt.parse(n);break;case"colorArray":n=Ot.parse(n);break;case"numberArray":n=kt.parse(n);break;default:Gi(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0)}return qi(n,e.default,t.default)}Mi.register(Ii,{error:[{kind:"error"},[Fe],(e,[t])=>{throw new Lt(t.evaluate(e))}],typeof:[Fe,[Ue],(e,[t])=>Ye(Ut(t.evaluate(e)))],"to-rgba":[Xe(De,4),[Be],(e,[t])=>{const[n,i,r,o]=t.evaluate(e).rgb;return[255*n,255*i,255*r,o]}],rgb:[Be,[De,De,De],Ri],rgba:[Be,[De,De,De,De],Ri],has:{type:Ne,overloads:[[[Fe],(e,[t])=>ki(t.evaluate(e),e.properties())],[[Fe,je],(e,[t,n])=>ki(t.evaluate(e),n.evaluate(e))]]},get:{type:Ue,overloads:[[[Fe],(e,[t])=>Oi(t.evaluate(e),e.properties())],[[Fe,je],(e,[t,n])=>Oi(t.evaluate(e),n.evaluate(e))]]},"feature-state":[Ue,[Fe],(e,[t])=>Oi(t.evaluate(e),e.featureState||{})],properties:[je,[],e=>e.properties()],"geometry-type":[Fe,[],e=>e.geometryType()],id:[Ue,[],e=>e.id()],zoom:[De,[],e=>e.globals.zoom],"heatmap-density":[De,[],e=>e.globals.heatmapDensity||0],elevation:[De,[],e=>e.globals.elevation||0],"line-progress":[De,[],e=>e.globals.lineProgress||0],accumulated:[Ue,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[De,Li(De),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[De,Li(De),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:De,overloads:[[[De,De],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[De],(e,[t])=>-t.evaluate(e)]]},"/":[De,[De,De],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[De,[De,De],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[De,[De],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[De,[De],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[De,[De],(e,[t])=>Math.log(t.evaluate(e))],log2:[De,[De],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[De,[De],(e,[t])=>Math.sin(t.evaluate(e))],cos:[De,[De],(e,[t])=>Math.cos(t.evaluate(e))],tan:[De,[De],(e,[t])=>Math.tan(t.evaluate(e))],asin:[De,[De],(e,[t])=>Math.asin(t.evaluate(e))],acos:[De,[De],(e,[t])=>Math.acos(t.evaluate(e))],atan:[De,[De],(e,[t])=>Math.atan(t.evaluate(e))],min:[De,Li(De),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[De,Li(De),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[De,[De],(e,[t])=>Math.abs(t.evaluate(e))],round:[De,[De],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[De,[De],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[De,[De],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ne,[Fe,Ue],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Ne,[Ue],(e,[t])=>e.id()===t.value],"filter-type-==":[Ne,[Fe],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ne,[Fe,Ue],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[Ne,[Ue],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<i}],"filter->":[Ne,[Fe,Ue],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[Ne,[Ue],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>i}],"filter-<=":[Ne,[Fe,Ue],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[Ne,[Ue],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<=i}],"filter->=":[Ne,[Fe,Ue],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[Ne,[Ue],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>=i}],"filter-has":[Ne,[Ue],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ne,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Ne,[Xe(Fe)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ne,[Xe(Ue)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ne,[Fe,Xe(Ue)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ne,[Fe,Xe(Ue)],(e,[t,n])=>function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ne,overloads:[[[Ne,Ne],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Li(Ne),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Ne,overloads:[[[Ne,Ne],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Li(Ne),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Ne,[Ne],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ne,[Fe],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[Fe,[Fe],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Fe,[Fe],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Fe,Li(Ue),(e,t)=>t.map((t=>Vt(t.evaluate(e)))).join("")],"resolved-locale":[Fe,[Ve],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Qi{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Xt,this._defaultValue=t?function(e){if("color"===e.type&&Wi(e.default))return new Ct(0,0,0,0);switch(e.type){case"color":return Ct.parse(e.default)||null;case"padding":return Rt.parse(e.default)||null;case"numberArray":return kt.parse(e.default)||null;case"colorArray":return Ot.parse(e.default)||null;case"variableAnchorOffsetCollection":return Ft.parse(e.default)||null;case"projectionDefinition":return Bt.parse(e.default)||null;default:return void 0===e.default?null:e.default}}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Lt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function er(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Ii}function tr(e,t){const n=new Yt(Ii,Di,[],t?function(e){const t={color:Be,string:Fe,number:De,enum:Fe,boolean:Ne,formatted:$e,padding:Ge,numberArray:He,colorArray:We,projectionDefinition:ze,resolvedImage:Ze,variableAnchorOffsetCollection:qe};return"array"===e.type?Xe(t[e.value]||Ue,e.length):t[e.type]}(t):void 0),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?zi(new Qi(i,t)):ji(n.errors)}class nr{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Ni(t.expression),this.globalStateRefs=ar(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class ir{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ni(t.expression),this.globalStateRefs=ar(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?dn.interpolationFactor(this.interpolationType,e,t,n):0}}function rr(e,t){const n=tr(e,t);if("error"===n.result)return n;const i=n.value.expression,r=Fi(i);if(!r&&!Ui(t))return ji([new ke("","data expressions not supported")]);const o=Bi(i,["zoom"]);if(!o&&!Vi(t))return ji([new ke("","zoom expressions not supported")]);const s=sr(i);return s||o?s instanceof ke?ji([s]):s instanceof dn&&!$i(t)?ji([new ke("",'"interpolate" expressions cannot be used with this property')]):zi(s?new ir(r?"camera":"composite",n.value,s.labels,s instanceof dn?s.interpolation:void 0):new nr(r?"constant":"source",n.value)):ji([new ke("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class or{constructor(e,t){this._parameters=e,this._specification=t,Re(this,Zi(this._parameters,this._specification))}static deserialize(e){return new or(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function sr(e){let t=null;if(e instanceof Kt)t=sr(e.result);else if(e instanceof gn){for(const n of e.args)if(t=sr(n),t)break}else(e instanceof an||e instanceof dn)&&e.input instanceof Mi&&"zoom"===e.input.name&&(t=e);return t instanceof ke||e.eachChild((e=>{const n=sr(e);n instanceof ke?t=n:!t&&n?t=new ke("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new ke("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function ar(e,t=new Set){return e instanceof Pi&&t.add(e.key),e.eachChild((e=>{ar(e,t)})),t}function lr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!lr(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const cr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ur(e){if(null==e)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};lr(e)||(e=pr(e));const t=tr(e,cr);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,n,i)=>t.value.evaluate(e,n,{},i),needGeometry:dr(e),getGlobalStateRefs:()=>ar(t.value.expression)}}function hr(e,t){return e<t?-1:e>t?1:0}function dr(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(dr(e[t]))return!0;return!1}function pr(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?fr(e[1],e[2],"=="):"!="===t?_r(fr(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?fr(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(pr))):"all"===t?["all"].concat(e.slice(1).map(pr)):"none"===t?["all"].concat(e.slice(1).map(pr).map(_r)):"in"===t?gr(e[1],e.slice(2)):"!in"===t?_r(gr(e[1],e.slice(2))):"has"===t?mr(e[1]):"!has"!==t||_r(mr(e[1]));var n}function fr(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function gr(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(hr)]]:["filter-in-small",e,["literal",t]]}}function mr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function _r(e){return["!",e]}function yr(e){const t=typeof e;if("number"===t||"boolean"===t||"string"===t||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+=`${yr(n)},`;return`${t}]`}const n=Object.keys(e).sort();let i="{";for(let t=0;t<n.length;t++)i+=`${JSON.stringify(n[t])}:${yr(e[n[t]])},`;return`${i}}`}function vr(e){let t="";for(const n of ve)t+=`/${yr(e[n])}`;return t}function br(e){const t=e.value;return t?[new Me(e.key,t,"constants have been deprecated as of v8")]:[]}function xr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function wr(e){if(Array.isArray(e))return e.map(wr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=wr(e[n]);return t}return xr(e)}function Er(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec,a=e.validateSpec;let l=[];const c=Gi(n);if("object"!==c)return[new Me(t,n,`object expected, ${c} found`)];for(const e in n){const c=e.split(".")[0],u=yt(i,c)||i["*"];let h;if(yt(r,c))h=r[c];else if(yt(i,c))h=a;else if(r["*"])h=r["*"];else{if(!i["*"]){l.push(new Me(t,n[e],`unknown property "${e}"`));continue}h=a}l=l.concat(h({key:(t?`${t}.`:t)+e,value:n[e],valueSpec:u,style:o,styleSpec:s,object:n,objectKey:e,validateSpec:a},n))}for(const e in i)r[e]||i[e].required&&void 0===i[e].default&&void 0===n[e]&&l.push(new Me(t,n,`missing required property "${e}"`));return l}function Sr(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||e.validateSpec;if("array"!==Gi(t))return[new Me(o,t,`array expected, ${Gi(t)} found`)];if(n.length&&t.length!==n.length)return[new Me(o,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Me(o,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let a={type:n.value,values:n.values};r.$version<7&&(a.function=n.function),"object"===Gi(n.value)&&(a=n.value);let l=[];for(let n=0;n<t.length;n++)l=l.concat(s({array:t,arrayIndex:n,value:t[n],valueSpec:a,validateSpec:e.validateSpec,style:i,styleSpec:r,key:`${o}[${n}]`}));return l}function Tr(e){const t=e.key,n=e.value,i=e.valueSpec;let r=Gi(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new Me(t,n,`number expected, ${r} found`)]:"minimum"in i&&n<i.minimum?[new Me(t,n,`${n} is less than the minimum value ${i.minimum}`)]:"maximum"in i&&n>i.maximum?[new Me(t,n,`${n} is greater than the maximum value ${i.maximum}`)]:[]}function Cr(e){const t=e.valueSpec,n=xr(e.value.type);let i,r,o,s={};const a="categorical"!==n&&void 0===e.value.property,l=!a,c="array"===Gi(e.value.stops)&&"array"===Gi(e.value.stops[0])&&"object"===Gi(e.value.stops[0][0]),u=Er({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new Me(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(Sr({key:e.key,value:i,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Gi(i)&&0===i.length&&t.push(new Me(e.key,i,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&a&&u.push(new Me(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new Me(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!$i(e.valueSpec)&&u.push(new Me(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Ui(e.valueSpec)?u.push(new Me(e.key,e.value,"property functions not supported")):a&&!Vi(e.valueSpec)&&u.push(new Me(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new Me(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,a=e.key;if("array"!==Gi(i))return[new Me(a,i,`array expected, ${Gi(i)} found`)];if(2!==i.length)return[new Me(a,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==Gi(i[0]))return[new Me(a,i,`object expected, ${Gi(i[0])} found`)];if(void 0===i[0].zoom)return[new Me(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Me(a,i,"object stop key must have value")];if(o&&o>xr(i[0].zoom))return[new Me(a,i[0].zoom,"stop zoom values must appear in ascending order")];xr(i[0].zoom)!==o&&(o=xr(i[0].zoom),r=void 0,s={}),n=n.concat(Er({key:`${a}[0]`,value:i[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Tr,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:i[0],validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},i));return er(wr(i[1]))?n.concat([new Me(`${a}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat(e.validateSpec({key:`${a}[1]`,value:i[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Gi(e.value),l=xr(e.value),c=null!==e.value?e.value:o;if(i){if(a!==i)return[new Me(e.key,c,`${a} stop domain type must match previous stop domain type ${i}`)]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Me(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i=`number expected, ${a} found`;return Ui(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(e.key,c,i)]}return"categorical"!==n||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&void 0!==r&&l<r?[new Me(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in s?[new Me(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Me(e.key,c,`integer expected, found ${l}`)]}}function Ar(e){const t=("property"===e.expressionContext?rr:tr)(wr(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Me(`${e.key}${t.key}`,e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Me(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ni(n))return[new Me(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Ni(n))return[new Me(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Bi(n,["zoom","feature-state"]))return[new Me(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Fi(n))return[new Me(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pr(e){const t=e.key,n=e.value,i=Gi(n);return"string"!==i?[new Me(t,n,`color expected, ${i} found`)]:Ct.parse(String(n))?[]:[new Me(t,n,`color expected, "${n}" found`)]}function Ir(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(xr(n))&&r.push(new Me(t,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(xr(n))&&r.push(new Me(t,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function Mr(e){return lr(wr(e.value))?Ar(Re({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rr(e)}function Rr(e){const t=e.value,n=e.key;if("array"!==Gi(t))return[new Me(n,t,`array expected, ${Gi(t)} found`)];const i=e.styleSpec;let r,o=[];if(t.length<1)return[new Me(n,t,"filter array must have at least 1 element")];switch(o=o.concat(Ir({key:`${n}[0]`,value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),xr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===xr(t[1])&&o.push(new Me(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Me(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Gi(t[1]),"string"!==r&&o.push(new Me(`${n}[1]`,t[1],`string expected, ${r} found`)));for(let s=2;s<t.length;s++)r=Gi(t[s]),"$type"===xr(t[1])?o=o.concat(Ir({key:`${n}[${s}]`,value:t[s],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Me(`${n}[${s}]`,t[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)o=o.concat(Rr({key:`${n}[${i}]`,value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Gi(t[1]),2!==t.length?o.push(new Me(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Me(`${n}[1]`,t[1],`string expected, ${r} found`))}return o}function kr(e,t){const n=e.key,i=e.validateSpec,r=e.style,o=e.styleSpec,s=e.value,a=e.objectKey,l=o[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return i({key:n,value:s,valueSpec:o.transition,style:r,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Me(n,s,`unknown property "${a}"`)];let h;if("string"===Gi(s)&&Ui(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new Me(n,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&("text-field"===a&&r&&!r.glyphs&&d.push(new Me(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Wi(wr(s))&&"identity"===xr(s.type)&&d.push(new Me(n,s,'"text-font" does not support identity functions'))),d.concat(i({key:e.key,value:s,valueSpec:u,style:r,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function Or(e){return kr(e,"paint")}function Lr(e){return kr(e,"layout")}function Dr(e){let t=[];const n=e.value,i=e.key,r=e.style,o=e.styleSpec;if("object"!==Gi(n))return[new Me(i,n,`object expected, ${Gi(n)} found`)];n.type||n.ref||t.push(new Me(i,n,'either "type" or "ref" is required'));let s=xr(n.type);const a=xr(n.ref);if(n.id){const o=xr(n.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];xr(e.id)===o&&t.push(new Me(i,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new Me(i,n[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{xr(t.id)===a&&(e=t)})),e?e.ref?t.push(new Me(i,n.ref,"ref cannot reference another ref layer")):s=xr(e.type):t.push(new Me(i,n.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&xr(e.type);e?"vector"===o&&"raster"===s?t.push(new Me(i,n.source,`layer "${n.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s||"raster-dem"!==o&&"color-relief"===s?t.push(new Me(i,n.source,`layer "${n.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?t.push(new Me(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s&&"color-relief"!==s?t.push(new Me(i,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Me(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Me(i,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Me(i,n.source,`source "${n.source}" not found`))}else t.push(new Me(i,n,'missing required property "source"'));return t=t.concat(Er({key:i,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${i}.type`,value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:n,objectKey:"type"}),filter:Mr,layout:e=>Er({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Lr(Re({layerType:s},e))}}),paint:e=>Er({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Or(Re({layerType:s},e))}})}})),t}function Fr(e){const t=e.value,n=e.key,i=Gi(t);return"string"!==i?[new Me(n,t,`string expected, ${i} found`)]:[]}const Nr={promoteId:function({key:e,value:t}){if("string"===Gi(t))return Fr({key:e,value:t});{const n=[];for(const i in t)n.push(...Fr({key:`${e}.${i}`,value:t[i]}));return n}}};function Br(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style,o=e.validateSpec;if(!t.type)return[new Me(n,t,'"type" is required')];const s=xr(t.type);let a;switch(s){case"vector":case"raster":return a=Er({key:n,value:t,valueSpec:i[`source_${s.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:Nr,validateSpec:o}),a;case"raster-dem":return a=function(e){var t;const n=null!==(t=e.sourceName)&&void 0!==t?t:"",i=e.value,r=e.styleSpec,o=r.source_raster_dem,s=e.style;let a=[];const l=Gi(i);if(void 0===i)return a;if("object"!==l)return a.push(new Me("source_raster_dem",i,`object expected, ${l} found`)),a;const c="custom"===xr(i.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const t in i)!c&&u.includes(t)?a.push(new Me(t,i[t],`In "${n}": "${t}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[t]?a=a.concat(e.validateSpec({key:t,value:i[t],valueSpec:o[t],validateSpec:e.validateSpec,style:s,styleSpec:r})):a.push(new Me(t,i[t],`unknown property "${t}"`));return a}({sourceName:n,value:t,style:e.style,styleSpec:i,validateSpec:o}),a;case"geojson":if(a=Er({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,validateSpec:o,objectElementValidators:Nr}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],o="string"==typeof i?[i,["accumulated"],["get",e]]:i;a.push(...Ar({key:`${n}.${e}.map`,value:r,expressionContext:"cluster-map"})),a.push(...Ar({key:`${n}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Er({key:n,value:t,valueSpec:i.source_video,style:r,validateSpec:o,styleSpec:i});case"image":return Er({key:n,value:t,valueSpec:i.source_image,style:r,validateSpec:o,styleSpec:i});case"canvas":return[new Me(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ir({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function zr(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let o=[];const s=Gi(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Me("light",t,`object expected, ${s} found`)]),o;for(const s in t){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&i[a[1]]&&i[a[1]].transition?e.validateSpec({key:s,value:t[s],valueSpec:n.transition,validateSpec:e.validateSpec,style:r,styleSpec:n}):i[s]?e.validateSpec({key:s,value:t[s],valueSpec:i[s],validateSpec:e.validateSpec,style:r,styleSpec:n}):[new Me(s,t[s],`unknown property "${s}"`)])}return o}function jr(e){const t=e.value,n=e.styleSpec,i=n.sky,r=e.style,o=Gi(t);if(void 0===t)return[];if("object"!==o)return[new Me("sky",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(i[o]?e.validateSpec({key:o,value:t[o],valueSpec:i[o],style:r,styleSpec:n}):[new Me(o,t[o],`unknown property "${o}"`)]);return s}function Ur(e){const t=e.value,n=e.styleSpec,i=n.terrain,r=e.style;let o=[];const s=Gi(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Me("terrain",t,`object expected, ${s} found`)]),o;for(const s in t)o=o.concat(i[s]?e.validateSpec({key:s,value:t[s],valueSpec:i[s],validateSpec:e.validateSpec,style:r,styleSpec:n}):[new Me(s,t[s],`unknown property "${s}"`)]);return o}function Vr(e){let t=[];const n=e.value,i=e.key;if(Array.isArray(n)){const r=[],o=[];for(const s in n)n[s].id&&r.includes(n[s].id)&&t.push(new Me(i,n,`all the sprites' ids must be unique, but ${n[s].id} is duplicated`)),r.push(n[s].id),n[s].url&&o.includes(n[s].url)&&t.push(new Me(i,n,`all the sprites' URLs must be unique, but ${n[s].url} is duplicated`)),o.push(n[s].url),t=t.concat(Er({key:`${i}[${s}]`,value:n[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return Fr({key:i,value:n})}function $r(e){return t=e.value,Boolean(t)&&t.constructor===Object?[]:[new Me(e.key,e.value,`object expected, ${Gi(e.value)} found`)];var t}const Gr={"*":()=>[],array:Sr,boolean:function(e){const t=e.value,n=e.key,i=Gi(t);return"boolean"!==i?[new Me(n,t,`boolean expected, ${i} found`)]:[]},number:Tr,color:Pr,constants:br,enum:Ir,filter:Mr,function:Cr,layer:Dr,object:Er,source:Br,light:zr,sky:jr,terrain:Ur,projection:function(e){const t=e.value,n=e.styleSpec,i=n.projection,r=e.style,o=Gi(t);if(void 0===t)return[];if("object"!==o)return[new Me("projection",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(i[o]?e.validateSpec({key:o,value:t[o],valueSpec:i[o],style:r,styleSpec:n}):[new Me(o,t[o],`unknown property "${o}"`)]);return s},projectionDefinition:function(e){const t=e.key;let n=e.value;n=n instanceof String?n.valueOf():n;const i=Gi(n);return"array"!==i||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(n)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(n)?["array","string"].includes(i)?[]:[new Me(t,n,`projection expected, invalid type "${i}" found`)]:[new Me(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Fr,formatted:function(e){return 0===Fr(e).length?[]:Ar(e)},resolvedImage:function(e){return 0===Fr(e).length?[]:Ar(e)},padding:function(e){const t=e.key,n=e.value;if("array"===Gi(n)){if(n.length<1||n.length>4)return[new Me(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const i={type:"number"};let r=[];for(let o=0;o<n.length;o++)r=r.concat(e.validateSpec({key:`${t}[${o}]`,value:n[o],validateSpec:e.validateSpec,valueSpec:i}));return r}return Tr({key:t,value:n,valueSpec:{}})},numberArray:function(e){const t=e.key,n=e.value;if("array"===Gi(n)){const i={type:"number"};if(n.length<1)return[new Me(t,n,"array length at least 1 expected, length 0 found")];let r=[];for(let o=0;o<n.length;o++)r=r.concat(e.validateSpec({key:`${t}[${o}]`,value:n[o],validateSpec:e.validateSpec,valueSpec:i}));return r}return Tr({key:t,value:n,valueSpec:{}})},colorArray:function(e){const t=e.key,n=e.value;if("array"===Gi(n)){if(n.length<1)return[new Me(t,n,"array length at least 1 expected, length 0 found")];let e=[];for(let i=0;i<n.length;i++)e=e.concat(Pr({key:`${t}[${i}]`,value:n[i]}));return e}return Pr({key:t,value:n})},variableAnchorOffsetCollection:function(e){const t=e.key,n=e.value,i=Gi(n),r=e.styleSpec;if("array"!==i||n.length<1||n.length%2!=0)return[new Me(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let i=0;i<n.length;i+=2)o=o.concat(Ir({key:`${t}[${i}]`,value:n[i],valueSpec:r.layout_symbol["text-anchor"]})),o=o.concat(Sr({key:`${t}[${i+1}]`,value:n[i+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:r}));return o},sprite:Vr,state:$r};function Wr(e){const t=e.value,n=e.valueSpec,i=e.styleSpec;return e.validateSpec=Wr,n.expression&&Wi(xr(t))?Cr(e):n.expression&&er(wr(t))?Ar(e):n.type&&Gr[n.type]?Gr[n.type](e):Er(Re({},e,{valueSpec:n.type?i[n.type]:n}))}function Hr(e){const t=e.value,n=e.key,i=Fr(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new Me(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new Me(n,t,'"glyphs" url must include a "{range}" token'))),i}function Zr(e,t=ye){let n=[];return n=n.concat(Wr({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Wr,objectElementValidators:{glyphs:Hr,"*":()=>[]}})),e.constants&&(n=n.concat(br({key:"constants",value:e.constants}))),Xr(n)}function qr(e){return function(t){return e({...t,validateSpec:Wr})}}function Xr(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Yr(e){return function(...t){return Xr(e.apply(this,t))}}Zr.source=Yr(qr(Br)),Zr.sprite=Yr(qr(Vr)),Zr.glyphs=Yr(qr(Hr)),Zr.light=Yr(qr(zr)),Zr.sky=Yr(qr(jr)),Zr.terrain=Yr(qr(Ur)),Zr.state=Yr(qr($r)),Zr.layer=Yr(qr(Dr)),Zr.filter=Yr(qr(Mr)),Zr.paintProperty=Yr(qr(Or)),Zr.layoutProperty=Yr(qr(Lr));const Kr=Zr,Jr=Kr.light,Qr=Kr.sky,eo=Kr.paintProperty,to=Kr.layoutProperty;function no(e,t){let n=!1;if(t&&t.length)for(const i of t)e.fire(new me(new Error(i.message))),n=!0;return n}class io{constructor(e,t,n){const i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(let e=0;e<this.d*this.d;e++){const t=r[3+e],n=r[3+e+1];i.push(t===n?null:r.subarray(t,n))}const o=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],o),this.bboxes=r.subarray(o),this.insert=this._insertReadonly}else{this.d=t+2*n;for(let e=0;e<this.d*this.d;e++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;const r=n/t*e;this.min=-r,this.max=e+r}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,n,i,r,o){this.cells[r].push(o)}query(e,t,n,i,r){const o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(e,t,n,i,this._queryCell,o,{},r),o}}_queryCell(e,t,n,i,r,o,s,a){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):e<=c[l+2]&&t<=c[l+3]&&n>=c[l+0]&&i>=c[l+1])?(s[h]=!0,o.push(r[h])):s[h]=!1}}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,e,t,n,i,c,o,s,a))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let n=0;for(let e=0;e<this.cells.length;e++)n+=this.cells[e].length;const i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let r=t;for(let t=0;t<e.length;t++){const n=e[t];i[3+t]=r,i.set(n,r),r+=n.length}return i[3+e.length]=r,i.set(this.keys,r),r+=this.keys.length,i[3+e.length+1]=r,i.set(this.bboxes,r),r+=this.bboxes.length,i.buffer}static serialize(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}}static deserialize(e){return new io(e.buffer)}}const ro={};function oo(e,t,n={}){if(ro[e])throw new Error(`${e} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ro[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}oo("Object",Object),oo("Set",Set),oo("TransferableGridIndex",io),oo("Color",Ct),oo("Error",Error),oo("AJAXError",ce),oo("ResolvedImage",Nt),oo("StylePropertyFunction",or),oo("StyleExpression",Qi,{omit:["_evaluator"]}),oo("ZoomDependentExpression",ir),oo("ZoomConstantExpression",nr),oo("CompoundExpression",Mi,{omit:["_evaluate"]});for(const e in Ii)Ii[e]._classRegistryKey||oo(`Expression_${e}`,Ii[e]);function so(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ao(e){return e.$name||e.constructor._classRegistryKey}function lo(e){return!function(e){if(null===e||"object"!=typeof e)return!1;const t=ao(e);return!(!t||"Object"===t)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||so(e)||q(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function co(e,t){if(lo(e))return(so(e)||q(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(co(i,t));return n}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const n=ao(e);if(!n)throw new Error(`can't serialize object of unregistered class ${e.constructor.name}`);if(!ro[n])throw new Error(`${n} is not registered.`);const{klass:i}=ro[n],r=i.serialize?i.serialize(e,t):{};if(i.serialize){if(t&&r===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const i in e){if(!e.hasOwnProperty(i))continue;if(ro[n].omit.indexOf(i)>=0)continue;const o=e[i];r[i]=ro[n].shallow.indexOf(i)>=0?o:co(o,t)}e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}function uo(e){if(lo(e))return e;if(Array.isArray(e))return e.map(uo);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);const t=ao(e)||"Object";if(!ro[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=ro[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const n of Object.keys(e)){if("$name"===n)continue;const r=e[n];i[n]=ro[t].shallow.indexOf(n)>=0?r:uo(r)}return i}class ho{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const po={"Latin-1 Supplement":e=>e>=128&&e<=255,"Hangul Jamo":e=>e>=4352&&e<=4607,Khmer:e=>e>=6016&&e<=6143,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Kanbun:e=>e>=12688&&e<=12703,"CJK Strokes":e=>e>=12736&&e<=12783,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Hangul Syllables":e=>e>=44032&&e<=55215,"Private Use Area":e=>e>=57344&&e<=63743,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function fo(e){for(const t of e)if(bo(t.charCodeAt(0)))return!0;return!1}function go(e){for(const t of e)if(!yo(t.charCodeAt(0)))return!1;return!0}function mo(e){const t=e.map((e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(e){return null}})).filter((e=>e));return new RegExp(t.join("|"),"u")}const _o=mo(["Arab","Dupl","Mong","Ougr","Syrc"]);function yo(e){return!_o.test(String.fromCodePoint(e))}const vo=mo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function bo(e){return!(746!==e&&747!==e&&(e<4352||!(po["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||po["CJK Compatibility"](e)||po["CJK Strokes"](e)||!(!po["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||po["Enclosed CJK Letters and Months"](e)||po["Ideographic Description Characters"](e)||po.Kanbun(e)||po.Katakana(e)&&12540!==e||!(!po["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!po["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||po["Vertical Forms"](e)||po["Yijing Hexagram Symbols"](e)||/\p{sc=Cans}/u.test(String.fromCodePoint(e))||/\p{sc=Hang}/u.test(String.fromCodePoint(e))||vo.test(String.fromCodePoint(e)))))}function xo(e){return!(bo(e)||function(e){return!!(po["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||po["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||po["Letterlike Symbols"](e)||po["Number Forms"](e)||po["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||po["Control Pictures"](e)&&9251!==e||po["Optical Character Recognition"](e)||po["Enclosed Alphanumerics"](e)||po["Geometric Shapes"](e)||po["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||po["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||po["CJK Symbols and Punctuation"](e)||po.Katakana(e)||po["Private Use Area"](e)||po["CJK Compatibility Forms"](e)||po["Small Form Variants"](e)||po["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}const wo=mo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Eo(e){return wo.test(String.fromCodePoint(e))}function So(e,t){return!(!t&&Eo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||po.Khmer(e))}function To(e){for(const t of e)if(Eo(t.charCodeAt(0)))return!0;return!1}const Co=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){if(Co.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(e,n){return t(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if("loading"!==e.pluginStatus)return this.setState(e),e;const t=e.pluginURL,i=new Promise((e=>{this.loadScriptResolve=e}));n(t);const r=new Promise((e=>setTimeout((()=>e()),this.TIMEOUT)));if(yield Promise.race([i,r]),this.isParsed()){const e={pluginStatus:"loaded",pluginURL:t};return this.setState(e),e}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${t}`)}))}};class Ao{constructor(e,t){this.zoom=e,t?(this.now=t.now||0,this.fadeDuration=t.fadeDuration||0,this.zoomHistory=t.zoomHistory||new ho,this.transition=t.transition||{},this.globalState=t.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ho,this.transition={},this.globalState={})}isSupportedScript(e){return function(e,t){for(const n of e)if(!So(n.charCodeAt(0),t))return!1;return!0}(e,"loaded"===Co.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class Po{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Wi(e))return new or(e,t);if(er(e)){const n=rr(e,t);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let n=e;return"color"===t.type&&"string"==typeof e?n=Ct.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"numberArray"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"colorArray"!==t.type||"string"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)?n=Ft.parse(e):"projectionDefinition"===t.type&&"string"==typeof e&&(n=Bt.parse(e)):n=Ot.parse(e):n=kt.parse(e):n=Rt.parse(e),{globalStateRefs:new Set,kind:"constant",evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Io{constructor(e){this.property=e,this.value=new Po(e,void 0)}transitioned(e,t){return new Ro(this.property,this.value,t,B({},e.transition,this.transition),e.now)}untransitioned(){return new Ro(this.property,this.value,null,{},0)}}class Mo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return V(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Io(this._values[e].property)),this._values[e].value=new Po(this._values[e].property,null===t?void 0:V(t))}getTransition(e){return V(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Io(this._values[e].property)),this._values[e].transition=V(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new ko(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new ko(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Ro{constructor(e,t,n,i,r){this.property=e,this.value=t,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,O(s))}}return r}}class ko{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Do(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Oo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return V(this._values[e].value)}setValue(e,t){this._values[e]=new Po(this._values[e].property,null===t?void 0:V(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Do(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class Lo{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Do{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Fo{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,n){const i=fn[this.specification.type];return i?i(e,t,n):e}}class No{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new Lo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Lo(this,{kind:"constant",value:void 0},e.parameters);const i=fn[this.specification.type];if(i){const r=i(e.value.value,t.value.value,n);return new Lo(this,{kind:"constant",value:r},e.parameters)}return e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class Bo extends No{possiblyEvaluate(e,t,n,i){if(void 0===e.value)return new Lo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i),o="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,t);return new Lo(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Lo(this,{kind:"constant",value:n},t)}return new Lo(this,e.expression,t)}evaluate(e,t,n,i,r,o){if("source"===e.kind){const s=e.evaluate(t,n,i,r,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,i),e.evaluate({zoom:Math.floor(t.zoom)},n,i),e.evaluate({zoom:Math.floor(t.zoom)+1},n,i),t):e.value}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class zo{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new Ao(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Ao(Math.floor(t.zoom),t)),e.expression.evaluate(new Ao(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class jo{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class Uo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const i=this.defaultPropertyValues[t]=new Po(n,void 0),r=this.defaultTransitionablePropertyValues[t]=new Io(n);this.defaultTransitioningPropertyValues[t]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=i.possiblyEvaluate({})}}}oo("DataDrivenProperty",No),oo("DataConstantProperty",Fo),oo("CrossFadedDataDrivenProperty",Bo),oo("CrossFadedProperty",zo),oo("ColorRampProperty",jo);const Vo="-transition";class $o extends _e{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=ur(e.filter)),t.layout&&(this._unevaluatedLayout=new Oo(t.layout)),t.paint)){this._transitionablePaint=new Mo(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(t.paint)}}setFilter(e){this.filter=e,this._featureFilter=ur(e)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const t in this._unevaluatedLayout._values){const n=this._unevaluatedLayout._values[t];for(const t of n.getGlobalStateRefs())e.add(t)}for(const t of this._featureFilter.getGlobalStateRefs())e.add(t);return e}setLayoutProperty(e,t,n={}){null!=t&&this._validate(to,`layers.${this.id}.layout.${e}`,e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(Vo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(eo,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(e.endsWith(Vo))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const n=this._transitionablePaint._values[e],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),U(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,i,r={}){return(!r||!1!==r.validate)&&no(this,e.call(Kr,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Lo&&Ui(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const Go={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ho{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zo(e,t=1){let n=0,i=0;return{members:e.map((e=>{const r=Go[e.type].BYTES_PER_ELEMENT,o=n=qo(n,Math.max(t,r)),s=e.components||1;return i=Math.max(i,r),n+=r*s,{name:e.name,type:e.type,components:s,offset:o}})),size:qo(n,Math.max(i,t)),alignment:t}}function qo(e,t){return Math.ceil(e/t)*t}class Xo extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}Xo.prototype.bytesPerElement=4,oo("StructArrayLayout2i4",Xo);class Yo extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}Yo.prototype.bytesPerElement=6,oo("StructArrayLayout3i6",Yo);class Ko extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}Ko.prototype.bytesPerElement=8,oo("StructArrayLayout4i8",Ko);class Jo extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}Jo.prototype.bytesPerElement=12,oo("StructArrayLayout2i4i12",Jo);class Qo extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=4*e,l=8*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.uint8[l+4]=i,this.uint8[l+5]=r,this.uint8[l+6]=o,this.uint8[l+7]=s,e}}Qo.prototype.bytesPerElement=8,oo("StructArrayLayout2i4ub8",Qo);class es extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}es.prototype.bytesPerElement=8,oo("StructArrayLayout2f8",es);class ts extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,i,r,o,s,a,l,c)}emplace(e,t,n,i,r,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}ts.prototype.bytesPerElement=20,oo("StructArrayLayout10ui20",ts);class ns extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,o,s,a,l,c,u,h)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ns.prototype.bytesPerElement=24,oo("StructArrayLayout4i4ui4i24",ns);class is extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}is.prototype.bytesPerElement=12,oo("StructArrayLayout3f12",is);class rs extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}rs.prototype.bytesPerElement=4,oo("StructArrayLayout1ul4",rs);class os extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,i,r,o,s,a,l)}emplace(e,t,n,i,r,o,s,a,l,c){const u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+3]=r,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,e}}os.prototype.bytesPerElement=20,oo("StructArrayLayout6i1ul2ui20",os);class ss extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}ss.prototype.bytesPerElement=12,oo("StructArrayLayout2i2i2i12",ss);class as extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,e}}as.prototype.bytesPerElement=16,oo("StructArrayLayout2f1f2i16",as);class ls extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=16*e,l=4*e,c=8*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.int16[c+6]=o,this.int16[c+7]=s,e}}ls.prototype.bytesPerElement=16,oo("StructArrayLayout2ub2f2i16",ls);class cs extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}cs.prototype.bytesPerElement=6,oo("StructArrayLayout3ui6",cs);class us extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_){const y=24*e,v=12*e,b=48*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.uint16[y+2]=i,this.uint16[y+3]=r,this.uint32[v+2]=o,this.uint32[v+3]=s,this.uint32[v+4]=a,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[b+36]=p,this.uint8[b+37]=f,this.uint8[b+38]=g,this.uint32[v+10]=m,this.int16[y+22]=_,e}}us.prototype.bytesPerElement=48,oo("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",us);class hs extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v,b,x,w,E,S,T,C,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v,b,x,w,E,S,T,C,A)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v,b,x,w,E,S,T,C,A,P){const I=32*e,M=16*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=i,this.int16[I+3]=r,this.int16[I+4]=o,this.int16[I+5]=s,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=g,this.uint16[I+15]=m,this.uint16[I+16]=_,this.uint16[I+17]=y,this.uint16[I+18]=v,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=w,this.uint16[I+22]=E,this.uint32[M+12]=S,this.float32[M+13]=T,this.float32[M+14]=C,this.uint16[I+30]=A,this.uint16[I+31]=P,e}}hs.prototype.bytesPerElement=64,oo("StructArrayLayout8i15ui1ul2f2ui64",hs);class ds extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ds.prototype.bytesPerElement=4,oo("StructArrayLayout1f4",ds);class ps extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[6*e+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}ps.prototype.bytesPerElement=12,oo("StructArrayLayout1ui2f12",ps);class fs extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=4*e;return this.uint32[2*e+0]=t,this.uint16[r+2]=n,this.uint16[r+3]=i,e}}fs.prototype.bytesPerElement=8,oo("StructArrayLayout1ul2ui8",fs);class gs extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}gs.prototype.bytesPerElement=4,oo("StructArrayLayout2ui4",gs);class ms extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ms.prototype.bytesPerElement=2,oo("StructArrayLayout1ui2",ms);class _s extends Ho{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}_s.prototype.bytesPerElement=16,oo("StructArrayLayout4f16",_s);class ys extends Wo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new n(this.anchorPointX,this.anchorPointY)}}ys.prototype.size=20;class vs extends os{get(e){return new ys(this,e)}}oo("CollisionBoxArray",vs);class bs extends Wo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}bs.prototype.size=48;class xs extends us{get(e){return new bs(this,e)}}oo("PlacedSymbolArray",xs);class ws extends Wo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ws.prototype.size=64;class Es extends hs{get(e){return new ws(this,e)}}oo("SymbolInstanceArray",Es);class Ss extends ds{getoffsetX(e){return this.float32[1*e+0]}}oo("GlyphOffsetArray",Ss);class Ts extends Yo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}oo("SymbolLineVertexArray",Ts);class Cs extends Wo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Cs.prototype.size=12;class As extends ps{get(e){return new Cs(this,e)}}oo("TextAnchorOffsetArray",As);class Ps extends Wo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ps.prototype.size=8;class Is extends fs{get(e){return new Ps(this,e)}}oo("FeatureIndexArray",Is);class Ms extends Xo{}class Rs extends Xo{}class ks extends Xo{}class Os extends Jo{}class Ls extends Qo{}class Ds extends es{}class Fs extends ts{}class Ns extends ns{}class Bs extends is{}class zs extends rs{}class js extends ss{}class Us extends ls{}class Vs extends cs{}class $s extends gs{}const Gs=Zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ws}=Gs;class Hs{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,t,n,i){const r=this.segments[this.segments.length-1];return e>Hs.MAX_VERTEX_ARRAY_LENGTH&&G(`Max vertices per segment is ${Hs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Hs.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!r||r.vertexLength+e>Hs.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i?this.createNewSegment(t,n,i):r}createNewSegment(e,t,n){const i={vertexOffset:e.length,primitiveOffset:t.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==n&&(i.sortKey=n),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(i),i}getOrCreateLatestSegment(e,t,n){return this.prepareSegment(0,e,t,n)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new Hs([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function Zs(e,t){return 256*(e=F(Math.floor(e),0,255))+F(Math.floor(t),0,255)}Hs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,oo("SegmentVector",Hs);const qs=Zo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xs,Ys,Ks,Js={exports:{}},Qs={exports:{}},ea={exports:{}},ta=function(){if(Ks)return Js.exports;Ks=1;var e=(Xs||(Xs=1,Qs.exports=function(e,t){var n,i,r,o,s,a,l,c;for(i=e.length-(n=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}),Qs.exports),t=(Ys||(Ys=1,ea.exports=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}),ea.exports);return Js.exports=e,Js.exports.murmur3=e,Js.exports.murmur2=t,Js.exports}(),na=i(ta);class ia{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(ra(e)),this.positions.push(t,n,i)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=ra(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=t?i=e:n=e+1}const r=[];for(;this.ids[n]===t;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return oa(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new ia;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function ra(e){const t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:na(String(e))}function oa(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;sa(e,o,s),sa(t,3*o,3*s),sa(t,3*o+1,3*s+1),sa(t,3*o+2,3*s+2)}s-n<i-s?(oa(e,t,n,s),n=s+1):(oa(e,t,s+1,i),i=s)}}function sa(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}oo("FeaturePositionMap",ia);class aa{constructor(e,t){this.gl=e.gl,this.location=t}}class la extends aa{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ca extends aa{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ua extends aa{constructor(e,t){super(e,t),this.current=Ct.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ha=new Float32Array(16);function da(e){return[Zs(255*e.r,255*e.g),Zs(255*e.b,255*e.a)]}class pa{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return"color"===this.type?new ua(e,t):new la(e,t)}}class fa{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,n,i){const r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&e.set(r)}getBinding(e,t,n){return"u_pattern"===n.substr(0,9)?new ca(e,t):new la(e,t)}}class ga{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r){const o=this.paintVertexArray.length,s=this.expression.evaluate(new Ao(0),t,{},i,[],r);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(e,t,r)}_setPaintValue(e,t,n){if("color"===this.type){const i=da(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ma{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r){const o=this.expression.evaluate(new Ao(this.zoom),t,{},i,[],r),s=this.expression.evaluate(new Ao(this.zoom+1),t,{},i,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,o,s)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),o=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(e,t,r,o)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=da(n),o=da(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,i=F(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(i)}getBinding(e,t,n){return new la(e,t)}}class _a{constructor(e,t,n,i,r,o){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=i,this.layerId=o,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(e,t,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(e,t,n,i){if(!i||!n)return;const{min:r,mid:o,max:s}=n,a=i[r],l=i[o],c=i[s];if(a&&l&&c)for(let n=e;n<t;n++)this.zoomInPaintVertexArray.emplace(n,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(n,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,qs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,qs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ya{constructor(e,t,n){this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){if(!n(r))continue;const o=e.paint.get(r);if(!(o instanceof Lo&&Ui(o.property.specification)))continue;const s=ba(r,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[r]=h?new fa(a.value,s):new pa(a.value,s,l),i.push(`/u_${r}`);else if("source"===a.kind||h){const n=xa(r,l,"source");this.binders[r]=h?new _a(a,l,c,t,n,e.id):new ga(a,s,l,n),i.push(`/a_${r}`)}else{const e=xa(r,l,"composite");this.binders[r]=new ma(a,s,l,c,t,e),i.push(`/z_${r}`)}}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof ga||t instanceof ma?t.maxValue:0}populatePaintArrays(e,t,n,i,r){for(const o in this.binders){const s=this.binders[o];(s instanceof ga||s instanceof ma||s instanceof _a)&&s.populatePaintArray(e,t,n,i,r)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof fa&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,i,r){let o=!1;for(const s in e){const a=t.getPositions(s);for(const t of a){const a=n.feature(t.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof ga||l instanceof ma||l instanceof _a)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(t.start,t.end,a,e[s],r),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof pa||n instanceof fa)&&e.push(...n.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof ga||n instanceof ma)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);else if(n instanceof _a)for(let t=0;t<qs.members.length;t++)e.push(qs.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof pa||n instanceof fa||n instanceof ma)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof pa||r instanceof fa||r instanceof ma)for(const o of r.uniformNames)if(t[o]){const s=r.getBinding(e,t[o],o);n.push({name:o,property:i,binding:s})}}return n}setUniforms(e,t,n,i){for(const{name:e,property:r,binding:o}of t)this.binders[r].setUniform(o,i,n.get(r),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof _a){const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(n instanceof ga||n instanceof ma)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof ga||n instanceof ma||n instanceof _a)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof ga||t instanceof ma||t instanceof _a)&&t.destroy()}}}class va{constructor(e,t,n=()=>!0){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new ya(i,t,n);this.needsUpload=!1,this._featureMap=new ia,this._bufferOffset=0}populatePaintArrays(e,t,n,i,r,o){for(const n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(e,t,i,r,o);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(e,this._featureMap,t,r,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ba(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function xa(e,t,n){const i={color:{source:es,composite:_s},number:{source:ds,composite:es}},r=function(e){return{"line-pattern":{source:Fs,composite:Fs},"fill-pattern":{source:Fs,composite:Fs},"fill-extrusion-pattern":{source:Fs,composite:Fs}}[e]}(e);return r&&r[n]||i[t][n]}oo("ConstantBinder",pa),oo("CrossFadedConstantBinder",fa),oo("SourceExpressionBinder",ga),oo("CrossFadedCompositeBinder",_a),oo("CompositeExpressionBinder",ma),oo("ProgramConfiguration",ya,{omit:["_buffers"]}),oo("ProgramConfigurationSet",va);const wa=Math.pow(2,14)-1,Ea=-wa-1;function Sa(e){const t=I/e.extent,n=e.loadGeometry();for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<i.length;e++){const n=i[e],r=Math.round(n.x*t),o=Math.round(n.y*t);n.x=F(r,Ea,wa),n.y=F(o,Ea,wa),(r<n.x||r>n.x+1||o<n.y||o>n.y+1)&&G("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ta(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Sa(e):[]}}const Ca=-32768;function Aa(e,t,n,i,r){e.emplaceBack(Ca+8*t+i,Ca+8*n+r)}class Pa{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Rs,this.indexArray=new Vs,this.segments=new Hs,this.programConfigurations=new va(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){const i=this.layers[0],r=[];let o=null,s=!1,a="heatmap"===i.type;if("circle"===i.type){const e=i;o=e.layout.get("circle-sort-key"),s=!o.isConstant(),a=a||"map"===e.paint.get("circle-pitch-alignment")}const l=a?t.subdivisionGranularity.circle:1;for(const{feature:t,id:i,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ta(t,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom,{globalState:this.globalState}),c,n))continue;const u=s?o.evaluate(c,{},n):void 0,h={id:i,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Sa(t),patterns:{},sortKey:u};r.push(h)}s&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of r){const{geometry:r,index:o,sourceLayerIndex:s}=i,a=e[o].feature;this.addFeature(i,r,o,n,l),t.featureIndex.insert(a,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ws),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r=1){let o;switch(r){case 1:o=[0,7];break;case 3:o=[0,2,5,7];break;case 5:o=[0,1,3,4,6,7];break;case 7:o=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${r}; valid values are 1, 3, 5, 7.`)}const s=o.length;for(const n of t)for(const t of n){const n=t.x,i=t.y;if(n<0||n>=I||i<0||i>=I)continue;const r=this.segments.prepareSegment(s*s,this.layoutVertexArray,this.indexArray,e.sortKey),a=r.vertexLength;for(let e=0;e<s;e++)for(let t=0;t<s;t++)Aa(this.layoutVertexArray,n,i,o[t],o[e]);for(let e=0;e<s-1;e++)for(let t=0;t<s-1;t++){const n=a+e*s+t,i=a+(e+1)*s+t;this.indexArray.emplaceBack(n,i+1,n+1),this.indexArray.emplaceBack(n,i,i+1)}r.vertexLength+=s*s,r.primitiveLength+=(s-1)*(s-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i)}}function Ia(e,t){for(let n=0;n<e.length;n++)if(Ba(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Ba(e,t[n]))return!0;return!!Oa(e,t)}function Ma(e,t,n){return!!Ba(e,t)||!!Da(t,e,n)}function Ra(e,t){if(1===e.length)return Na(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(Ba(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(Na(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Oa(e,t[n]))return!0;return!1}function ka(e,t,n){if(e.length>1){if(Oa(e,t))return!0;for(let i=0;i<t.length;i++)if(Da(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(Da(e[i],t,n))return!0;return!1}function Oa(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(La(i,r,t[e],t[e+1]))return!0}return!1}function La(e,t,n,i){return W(e,n,i)!==W(t,n,i)&&W(e,t,n)!==W(e,t,i)}function Da(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let n=1;n<t.length;n++)if(Fa(e,t[n-1],t[n])<i)return!0;return!1}function Fa(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function Na(e,t){let n,i,r,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)i=n[e],r=n[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function Ba(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function za(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=W(e,t,n[0]);return o!==W(e,t,n[1])||o!==W(e,t,n[2])||o!==W(e,t,n[3])}function ja(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Ua(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Va(e,t,i,r,o){if(!t[0]&&!t[1])return e;const s=n.convert(t)._mult(o);"viewport"===i&&s._rotate(-r);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(s));return a}let $a,Ga;oo("CircleBucket",Pa,{omit:["layers"]});var Wa={get paint(){return Ga=Ga||new Uo({"circle-radius":new No(ye.paint_circle["circle-radius"]),"circle-color":new No(ye.paint_circle["circle-color"]),"circle-blur":new No(ye.paint_circle["circle-blur"]),"circle-opacity":new No(ye.paint_circle["circle-opacity"]),"circle-translate":new Fo(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Fo(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fo(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fo(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new No(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new No(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new No(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return $a=$a||new Uo({"circle-sort-key":new No(ye.layout_circle["circle-sort-key"])})}};class Ha extends $o{constructor(e){super(e,Wa)}createBucket(e){return new Pa(e)}queryRadius(e){const t=e;return ja("circle-radius",this,t)+ja("circle-stroke-width",this,t)+Ua(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:n,geometry:i,transform:r,pixelsToTileUnits:o,unwrappedTileID:s,getElevation:a}){const l=Va(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-r.bearingInRadians,o),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(e,t,n,i){return e.map((e=>Za(e,t,n,i)))}(l,r,s,a),d=u?c*o:c;for(const e of i)for(const t of e){const e=u?t:Za(t,r,s,a);let n=d;const i=r.projectTileCoordinates(t.x,t.y,s,a).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?n*=i/r.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(n*=r.cameraToCenterDistance/i),Ma(h,e,n))return!0}return!1}}function Za(e,t,i,r){const o=t.projectTileCoordinates(e.x,e.y,i,r).point;return new n((.5*o.x+.5)*t.width,(.5*-o.y+.5)*t.height)}class qa extends Pa{}let Xa;oo("HeatmapBucket",qa,{omit:["layers"]});var Ya={get paint(){return Xa=Xa||new Uo({"heatmap-radius":new No(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new No(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fo(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jo(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fo(ye.paint_heatmap["heatmap-opacity"])})}};function Ka(e,{width:t,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*n*i)throw new RangeError(`mismatched image size. expected: ${r.length} but got: ${t*n*i}`)}else r=new Uint8Array(t*n*i);return e.width=t,e.height=n,e.data=r,e}function Ja(e,{width:t,height:n},i){if(t===e.width&&n===e.height)return;const r=Ka({},{width:t,height:n},i);Qa(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},i),e.width=t,e.height=n,e.data=r.data}function Qa(e,t,n,i,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<r.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((i.y+l)*t.width+i.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}class el{constructor(e,t){Ka(this,e,1,t)}resize(e){Ja(this,e,1)}clone(){return new el({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Qa(e,t,n,i,r,1)}}class tl{constructor(e,t){Ka(this,e,4,t)}resize(e){Ja(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Qa(e,t,n,i,r,4)}setPixel(e,t,n){const i=4*(e*this.width+t);this.data[i+0]=Math.round(255*n.r/n.a),this.data[i+1]=Math.round(255*n.g/n.a),this.data[i+2]=Math.round(255*n.b/n.a),this.data[i+3]=Math.round(255*n.a)}}function nl(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new tl({width:n,height:i});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const o=(i,o,s)=>{t[e.evaluationKey]=s;const a=e.expression.evaluate(t);r.setPixel(i/4/n,o/4,a)};if(e.clips)for(let t=0,r=0;t<i;++t,r+=4*n)for(let i=0,s=0;i<n;i++,s+=4){const a=i/(n-1),{start:l,end:c}=e.clips[t];o(r,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<n;e++,t+=4)o(0,t,e/(n-1));return r}oo("AlphaImage",el),oo("RGBAImage",tl);const il="big-fb";class rl extends $o{createBucket(e){return new qa(e)}constructor(e){super(e,Ya),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=nl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(il)&&this.heatmapFbos.delete(il)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let ol;var sl={get paint(){return ol=ol||new Uo({"hillshade-illumination-direction":new Fo(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Fo(ye.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Fo(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fo(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fo(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fo(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fo(ye.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Fo(ye.paint_hillshade["hillshade-method"])})}};class al extends $o{constructor(e){super(e,sl),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,t=this.paint.get("hillshade-illumination-altitude").values,n=this.paint.get("hillshade-highlight-color").values,i=this.paint.get("hillshade-shadow-color").values;const r=Math.max(e.length,t.length,n.length,i.length);e=e.concat(Array(r-e.length).fill(e.at(-1))),t=t.concat(Array(r-t.length).fill(t.at(-1))),n=n.concat(Array(r-n.length).fill(n.at(-1))),i=i.concat(Array(r-i.length).fill(i.at(-1)));const o=t.map(ee);return{directionRadians:e.map(ee),altitudeRadians:o,shadowColor:i,highlightColor:n}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let ll;var cl={get paint(){return ll=ll||new Uo({"color-relief-opacity":new Fo(ye["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new jo(ye["paint_color-relief"]["color-relief-color"])})}};class ul{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,n){const{width:i,height:r}=e,o=!(this.size&&this.size[0]===i&&this.size[1]===r||n),{context:s}=this,{gl:a}=s;if(this.useMipmap=Boolean(t&&t.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!t||!1!==t.premultiply)),o)this.size=[i,r],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||q(e)?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,i,r,0,this.format,a.UNSIGNED_BYTE,e.data);else{const{x:t,y:o}=n||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||q(e)?a.texSubImage2D(a.TEXTURE_2D,0,t,o,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,t,o,i,r,a.RGBA,a.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D),s.pixelStoreUnpackFlipY.setDefault(),s.pixelStoreUnpack.setDefault(),s.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,t,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class hl{constructor(e,t,n,i=1,r=1,o=1,s=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void G(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;const a=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=r,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let e=0;e<a;e++)for(let t=0;t<a;t++){const n=this.get(e,t);n>this.max&&(this.max=n),n<this.min&&(this.min=n)}}get(e,t){const n=new Uint8Array(this.data.buffer),i=4*this._idx(e,t);return this.unpack(n[i],n[i+1],n[i+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,n){return e*this.redFactor+t*this.greenFactor+n*this.blueFactor-this.baseShift}pack(e){return dl(e,this.getUnpackVector())}getPixels(){return new tl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let t=o;t<s;t++)for(let n=i;n<r;n++)this.data[this._idx(n,t)]=e.data[this._idx(n+a,t+l)]}}function dl(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=Math.min(n,i,r),a=Math.round((e+o)/s);return{r:Math.floor(a*s/n)%256,g:Math.floor(a*s/i)%256,b:Math.floor(a*s/r)%256}}oo("DEMData",hl);class pl extends $o{constructor(e){super(e,cl)}_createColorRamp(e){const t={elevationStops:[],colorStops:[]},n=this._transitionablePaint._values["color-relief-color"].value.expression;if(n instanceof nr&&n._styleExpression.expression instanceof dn){this.colorRampExpression=n;const e=n._styleExpression.expression;t.elevationStops=e.labels,t.colorStops=[];for(const n of t.elevationStops)t.colorStops.push(e.evaluate({globals:{elevation:n}}))}if(t.elevationStops.length<1&&(t.elevationStops=[0],t.colorStops=[Ct.transparent]),t.elevationStops.length<2&&(t.elevationStops.push(t.elevationStops[0]+1),t.colorStops.push(t.colorStops[0])),t.elevationStops.length<=e)return t;const i={elevationStops:[],colorStops:[]},r=(t.elevationStops.length-1)/(e-1);for(let e=0;e<t.elevationStops.length-.5;e+=r)i.elevationStops.push(t.elevationStops[Math.round(e)]),i.colorStops.push(t.colorStops[Math.round(e)]);return G(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),i}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,t,n){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const i=this._createColorRamp(t),r=new tl({width:i.colorStops.length,height:1}),o=new tl({width:i.colorStops.length,height:1});for(let e=0;e<i.elevationStops.length;e++){const t=dl(i.elevationStops[e],n);o.setPixel(0,e,new Ct(t.r/255,t.g/255,t.b/255,1)),r.setPixel(0,e,i.colorStops[e])}return this.colorRampTextures={elevationTexture:new ul(e,o,e.gl.RGBA),colorTexture:new ul(e,r,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}}const fl=Zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:gl}=fl;function ml(e,t,n){const i=n.patternDependencies;let r=!1;for(const n of t){const t=n.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const o=t.constantOr(null);o&&(r=!0,i[o.to]=!0,i[o.from]=!0)}return r}function _l(e,t,n,i,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i-1},n,{},r.availableImages),a=t.evaluate({zoom:i},n,{},r.availableImages),l=t.evaluate({zoom:i+1},n,{},r.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,n.patterns[s.id]={min:e,mid:a,max:l}}}return n}function yl(e,t,n,i,r){let o;if(r===function(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}(e,t,n,i)>0)for(let r=t;r<n;r+=i)o=jl(r/i|0,e[r],e[r+1],o);else for(let r=n-i;r>=t;r-=i)o=jl(r/i|0,e[r],e[r+1],o);return o&&Ll(o,o.next)&&(Ul(o),o=o.next),o}function vl(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Ll(i,i.next)&&0!==Ol(i.prev,i,i.next))i=i.next;else{if(Ul(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function bl(e,t,n,i,r,o,s){if(!e)return;!s&&o&&function(e,t,n,i){let r=e;do{0===r.z&&(r.z=Pl(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n=1;do{let i,r=e;e=null;let o=null;for(t=0;r;){t++;let s=r,a=0;for(let e=0;e<n&&(a++,s=s.nextZ,s);e++);let l=n;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||r.z<=s.z)?(i=r,r=r.nextZ,a--):(i=s,s=s.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=s}o.nextZ=null,n*=2}while(t>1)}(r)}(e,i,r,o);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?wl(e,i,r,o):xl(e))t.push(l.i,e.i,c.i),Ul(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?bl(e=El(vl(e),t),t,n,i,r,o,2):2===s&&Sl(e,t,n,i,r,o):bl(vl(e),t,n,i,r,o,1);break}}}function xl(e){const t=e.prev,n=e,i=e.next;if(Ol(t,n,i)>=0)return!1;const r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=Math.min(r,o,s),h=Math.min(a,l,c),d=Math.max(r,o,s),p=Math.max(a,l,c);let f=i.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Rl(r,a,o,l,s,c,f.x,f.y)&&Ol(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function wl(e,t,n,i){const r=e.prev,o=e,s=e.next;if(Ol(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=Math.min(a,l,c),f=Math.min(u,h,d),g=Math.max(a,l,c),m=Math.max(u,h,d),_=Pl(p,f,t,n,i),y=Pl(g,m,t,n,i);let v=e.prevZ,b=e.nextZ;for(;v&&v.z>=_&&b&&b.z<=y;){if(v.x>=p&&v.x<=g&&v.y>=f&&v.y<=m&&v!==r&&v!==s&&Rl(a,u,l,h,c,d,v.x,v.y)&&Ol(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==r&&b!==s&&Rl(a,u,l,h,c,d,b.x,b.y)&&Ol(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=g&&v.y>=f&&v.y<=m&&v!==r&&v!==s&&Rl(a,u,l,h,c,d,v.x,v.y)&&Ol(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==r&&b!==s&&Rl(a,u,l,h,c,d,b.x,b.y)&&Ol(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function El(e,t){let n=e;do{const i=n.prev,r=n.next.next;!Ll(i,r)&&Dl(i,n,n.next,r)&&Bl(i,r)&&Bl(r,i)&&(t.push(i.i,n.i,r.i),Ul(n),Ul(n.next),n=e=r),n=n.next}while(n!==e);return vl(n)}function Sl(e,t,n,i,r,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&kl(s,e)){let a=zl(s,e);return s=vl(s,s.next),a=vl(a,a.next),bl(s,t,n,i,r,o,0),void bl(a,t,n,i,r,o,0)}e=e.next}s=s.next}while(s!==e)}function Tl(e,t){let n=e.x-t.x;return 0===n&&(n=e.y-t.y,0===n)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Cl(e,t){const n=function(e,t){let n=t;const i=e.x,r=e.y;let o,s=-1/0;if(Ll(e,n))return n;do{if(Ll(e,n.next))return n.next;if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>s&&(s=e,o=n.x<n.next.x?n:n.next,e===i))return o}n=n.next}while(n!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;n=o;do{if(i>=n.x&&n.x>=l&&i!==n.x&&Ml(r<c?i:s,r,l,c,r<c?s:i,r,n.x,n.y)){const t=Math.abs(r-n.y)/(i-n.x);Bl(n,e)&&(t<u||t===u&&(n.x>o.x||n.x===o.x&&Al(o,n)))&&(o=n,u=t)}n=n.next}while(n!==a);return o}(e,t);if(!n)return t;const i=zl(n,e);return vl(i,i.next),vl(n,n.next)}function Al(e,t){return Ol(e.prev,e,t.prev)<0&&Ol(t.next,e,e.next)<0}function Pl(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Il(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ml(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Rl(e,t,n,i,r,o,s,a){return!(e===s&&t===a)&&Ml(e,t,n,i,r,o,s,a)}function kl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Dl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Bl(e,t)&&Bl(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Ol(e.prev,e,t.prev)||Ol(e,t.prev,t))||Ll(e,t)&&Ol(e.prev,e,e.next)>0&&Ol(t.prev,t,t.next)>0)}function Ol(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Ll(e,t){return e.x===t.x&&e.y===t.y}function Dl(e,t,n,i){const r=Nl(Ol(e,t,n)),o=Nl(Ol(e,t,i)),s=Nl(Ol(n,i,e)),a=Nl(Ol(n,i,t));return r!==o&&s!==a||!(0!==r||!Fl(e,n,t))||!(0!==o||!Fl(e,i,t))||!(0!==s||!Fl(n,e,i))||!(0!==a||!Fl(n,t,i))}function Fl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Nl(e){return e>0?1:e<0?-1:0}function Bl(e,t){return Ol(e.prev,e,e.next)<0?Ol(e,t,e.next)>=0&&Ol(e,e.prev,t)>=0:Ol(e,t,e.prev)<0||Ol(e,e.next,t)<0}function zl(e,t){const n=Vl(e.i,e.x,e.y),i=Vl(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function jl(e,t,n,i){const r=Vl(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ul(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Vl(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class $l{constructor(e,t){if(t>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=t}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Gl{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Gl.noSubdivision=new Gl({fill:new $l(0,0),line:new $l(0,0),tile:new $l(0,0),stencil:new $l(0,0),circle:1}),oo("SubdivisionGranularityExpression",$l),oo("SubdivisionGranularitySetting",Gl);const Wl=-32768,Hl=32767;class Zl{constructor(e,t){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=I/e,this._canonical=t}_getKey(e,t){return(e+=32768)<<16|t+32768}_vertexToIndex(e,t){if(e<-32768||t<-32768||e>32767||t>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const n=0|Math.round(e),i=0|Math.round(t),r=this._getKey(n,i);if(this._vertexDictionary.has(r))return this._vertexDictionary.get(r);const o=this._vertexBuffer.length/2;return this._vertexDictionary.set(r,o),this._vertexBuffer.push(n,i),o}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(e,t){const n=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=t[i+1],s=t[i+2],a=e[2*r],l=e[2*r+1];(e[2*o]-a)*(e[2*s+1]-l)-(e[2*o+1]-l)*(e[2*s]-a)>0?(n.push(r),n.push(s),n.push(o)):(n.push(r),n.push(o),n.push(s))}return n}(this._vertexBuffer,e);const t=[],n=e.length;for(let i=0;i<n;i+=3){const n=[e[i+0],e[i+1],e[i+2]],r=[this._vertexBuffer[2*e[i+0]+0],this._vertexBuffer[2*e[i+0]+1],this._vertexBuffer[2*e[i+1]+0],this._vertexBuffer[2*e[i+1]+1],this._vertexBuffer[2*e[i+2]+0],this._vertexBuffer[2*e[i+2]+1]];let o=1/0,s=1/0,a=-1/0,l=-1/0;for(let e=0;e<3;e++){const t=r[2*e],n=r[2*e+1];o=Math.min(o,t),a=Math.max(a,t),s=Math.min(s,n),l=Math.max(l,n)}if(o===a||s===l)continue;const c=Math.floor(o/this._granularityCellSize),u=Math.ceil(a/this._granularityCellSize),h=Math.floor(s/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let e=h;e<d;e++){const i=this._scanlineGenerateVertexRingForCellRow(e,r,n);Yl(this._vertexBuffer,i,t)}else t.push(...n)}return t}_scanlineGenerateVertexRingForCellRow(e,t,n){const i=e*this._granularityCellSize,r=i+this._granularityCellSize,o=[];for(let e=0;e<3;e++){const s=t[2*e],a=t[2*e+1],l=t[2*(e+1)%6],c=t[(2*(e+1)+1)%6],u=t[2*(e+2)%6],h=t[(2*(e+2)+1)%6],d=l-s,p=c-a,f=0===d,g=0===p,m=(i-a)/p,_=(r-a)/p,y=Math.min(m,_),v=Math.max(m,_);if(!g&&(y>=1||v<=0)||g&&(a<i||a>r)){c>=i&&c<=r&&o.push(n[(e+1)%3]);continue}!g&&y>0&&o.push(this._vertexToIndex(s+d*y,a+p*y));const b=s+d*Math.max(y,0),x=s+d*Math.min(v,1);f||this._generateIntraEdgeVertices(o,s,a,l,c,b,x),!g&&v<1&&o.push(this._vertexToIndex(s+d*v,a+p*v)),(g||c>=i&&c<=r)&&o.push(n[(e+1)%3]),!g&&(c<=i||c>=r)&&this._generateInterEdgeVertices(o,s,a,l,c,u,h,x,i,r)}return o}_generateIntraEdgeVertices(e,t,n,i,r,o,s){const a=i-t,l=r-n,c=0===l,u=c?Math.min(t,i):Math.min(o,s),h=c?Math.max(t,i):Math.max(o,s),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?t<i:o<s)for(let i=d;i<=p;i++){const r=i*this._granularityCellSize;e.push(this._vertexToIndex(r,n+l*(r-t)/a))}else for(let i=p;i>=d;i--){const r=i*this._granularityCellSize;e.push(this._vertexToIndex(r,n+l*(r-t)/a))}}_generateInterEdgeVertices(e,t,n,i,r,o,s,a,l,c){const u=r-n,h=o-i,d=s-r,p=(l-r)/d,f=(c-r)/d,g=Math.min(p,f),m=Math.max(p,f),_=i+h*g;let y=Math.floor(Math.min(_,a)/this._granularityCellSize)+1,v=Math.ceil(Math.max(_,a)/this._granularityCellSize)-1,b=a<_;const x=0===d;if(x&&(s===l||s===c))return;if(x||g>=1||m<=0){const e=n-s,i=o+(t-o)*Math.min((l-s)/e,(c-s)/e);y=Math.floor(Math.min(i,a)/this._granularityCellSize)+1,v=Math.ceil(Math.max(i,a)/this._granularityCellSize)-1,b=a<i}const w=u>0?c:l;if(b)for(let t=y;t<=v;t++)e.push(this._vertexToIndex(t*this._granularityCellSize,w));else for(let t=v;t>=y;t--)e.push(this._vertexToIndex(t*this._granularityCellSize,w))}_generateOutline(e){const t=[];for(const n of e){const e=Xl(n,this._granularity,!0),i=this._pointArrayToIndices(e),r=[];for(let e=1;e<i.length;e++)r.push(i[e-1]),r.push(i[e]);t.push(r)}return t}_handlePoles(e){let t=!1,n=!1;this._canonical&&(0===this._canonical.y&&(t=!0),this._canonical.y===(1<<this._canonical.z)-1&&(n=!0)),(t||n)&&this._fillPoles(e,t,n)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let t=0;t<e.length;t+=2){const n=e[t+1];n===Wl&&(e[t+1]=-32767),n===Hl&&(e[t+1]=32766)}}_generatePoleQuad(e,t,n,i,r,o){i>r!=(o===Wl)?(e.push(t),e.push(n),e.push(this._vertexToIndex(i,o)),e.push(n),e.push(this._vertexToIndex(r,o)),e.push(this._vertexToIndex(i,o))):(e.push(n),e.push(t),e.push(this._vertexToIndex(i,o)),e.push(this._vertexToIndex(r,o)),e.push(n),e.push(this._vertexToIndex(i,o)))}_fillPoles(e,t,n){const i=this._vertexBuffer,r=I,o=e.length;for(let s=2;s<o;s+=3){const o=e[s-2],a=e[s-1],l=e[s],c=i[2*o],u=i[2*o+1],h=i[2*a],d=i[2*a+1],p=i[2*l],f=i[2*l+1];t&&(0===u&&0===d&&this._generatePoleQuad(e,o,a,c,h,Wl),0===d&&0===f&&this._generatePoleQuad(e,a,l,h,p,Wl),0===f&&0===u&&this._generatePoleQuad(e,l,o,p,c,Wl)),n&&(u===r&&d===r&&this._generatePoleQuad(e,o,a,c,h,Hl),d===r&&f===r&&this._generatePoleQuad(e,a,l,h,p,Hl),f===r&&u===r&&this._generatePoleQuad(e,l,o,p,c,Hl))}}_initializeVertices(e){for(let t=0;t<e.length;t+=2)this._vertexToIndex(e[t],e[t+1])}subdividePolygonInternal(e,t){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:n,holeIndices:i}=function(e){const t=[],n=[];for(const i of e)if(0!==i.length){i!==e[0]&&t.push(n.length/2);for(let e=0;e<i.length;e++)n.push(i[e].x),n.push(i[e].y)}return{flattened:n,holeIndices:t}}(e);let r;this._initializeVertices(n);try{const e=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let o=yl(e,0,r,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(i&&(o=function(e,t,n,i){const r=[];for(let n=0,o=t.length;n<o;n++){const s=yl(e,t[n]*i,n<o-1?t[n+1]*i:e.length,i,!1);s===s.next&&(s.steiner=!0),r.push(Il(s))}r.sort(Tl);for(let e=0;e<r.length;e++)n=Cl(r[e],n);return n}(e,t,o,n)),e.length>80*n){a=e[0],l=e[1];let t=a,i=l;for(let o=n;o<r;o+=n){const n=e[o],r=e[o+1];n<a&&(a=n),r<l&&(l=r),n>t&&(t=n),r>i&&(i=r)}c=Math.max(t-a,i-l),c=0!==c?32767/c:0}return bl(o,s,n,a,l,c,0),s}(n,i),t=this._convertIndices(n,e);r=this._subdivideTrianglesScanline(t)}catch(e){console.error(e)}let o=[];return t&&(o=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(r),{verticesFlattened:this._vertexBuffer,indicesTriangles:r,indicesLineList:o}}_convertIndices(e,t){const n=[];for(let i=0;i<t.length;i++)n.push(this._vertexToIndex(e[2*t[i]],e[2*t[i]+1]));return n}_pointArrayToIndices(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(this._vertexToIndex(i.x,i.y))}return t}}function ql(e,t,n,i=!0){return new Zl(n,t).subdividePolygonInternal(e,i)}function Xl(e,t,i=!1){if(!e||e.length<1)return[];if(e.length<2)return[];const r=e[0],o=e[e.length-1],s=i&&(r.x!==o.x||r.y!==o.y);if(t<2)return s?[...e,e[0]]:[...e];const a=Math.floor(I/t),l=[];l.push(new n(e[0].x,e[0].y));const c=e.length,u=s?c:c-1;for(let t=0;t<u;t++){const i=e[t],r=t<c-1?e[t+1]:e[0],o=i.x,s=i.y,u=r.x,h=r.y,d=o!==u,p=s!==h;if(!d&&!p)continue;const f=u-o,g=h-s,m=Math.abs(f),_=Math.abs(g);let y=o,v=s;for(;;){const e=f>0?(Math.floor(y/a)+1)*a:(Math.ceil(y/a)-1)*a,t=g>0?(Math.floor(v/a)+1)*a:(Math.ceil(v/a)-1)*a,i=Math.abs(y-e),r=Math.abs(v-t),o=Math.abs(y-u),s=Math.abs(v-h),c=d?i/m:Number.POSITIVE_INFINITY,b=p?r/_:Number.POSITIVE_INFINITY;if((o<=i||!d)&&(s<=r||!p))break;if(c<b&&d||!p){y=e,v+=g*c;const t=new n(y,Math.round(v));l[l.length-1].x===t.x&&l[l.length-1].y===t.y||l.push(t)}else{y+=f*b,v=t;const e=new n(Math.round(y),v);l[l.length-1].x===e.x&&l[l.length-1].y===e.y||l.push(e)}}const b=new n(u,h);l[l.length-1].x===b.x&&l[l.length-1].y===b.y||l.push(b)}return l}function Yl(e,t,n){if(0===t.length)throw new Error("Subdivision vertex ring is empty.");let i=0,r=e[2*t[0]];for(let n=1;n<t.length;n++){const o=e[2*t[n]];o<r&&(r=o,i=n)}const o=t.length;let s=i,a=(s+1)%o;for(;;){const i=s-1>=0?s-1:o-1,r=(a+1)%o,l=e[2*t[i]],c=e[2*t[r]],u=e[2*t[s]],h=e[2*t[s]+1],d=e[2*t[a]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const n=d-h,o=-(e[2*t[a]]-u),s=h<d?1:-1;((l-u)*n+(e[2*t[i]+1]-h)*o)*s>((c-u)*n+(e[2*t[r]+1]-h)*o)*s&&(p=!0)}if(p){const e=t[i],r=t[s],l=t[a];e!==r&&e!==l&&r!==l&&n.push(l,r,e),s--,s<0&&(s=o-1)}else{const e=t[r],i=t[s],l=t[a];e!==i&&e!==l&&i!==l&&n.push(l,i,e),a++,a>=o&&(a=0)}if(i===r)break}}function Kl(e,t,n,i,r,o,s,a,l){const c=r.length/2,u=s&&a&&l;if(c<Hs.MAX_VERTEX_ARRAY_LENGTH){const h=t.prepareSegment(c,n,i),d=h.vertexLength;for(let e=0;e<o.length;e+=3)i.emplaceBack(d+o[e],d+o[e+1],d+o[e+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=o.length/3,u&&(f=s.prepareSegment(c,n,a),p=f.vertexLength,f.vertexLength+=c);for(let t=0;t<r.length;t+=2)e(r[t],r[t+1]);if(u)for(let e=0;e<l.length;e++){const t=l[e];for(let e=1;e<t.length;e+=2)a.emplaceBack(p+t[e-1],p+t[e]);f.primitiveLength+=t.length/2}}else!function(e,t,n,i,r,o){const s=[];for(let e=0;e<i.length/2;e++)s.push(-1);const a={count:0};let l=0,c=e.getOrCreateLatestSegment(t,n),u=c.vertexLength;for(let h=2;h<r.length;h+=3){const d=r[h-2],p=r[h-1],f=r[h];let g=s[d]<l,m=s[p]<l,_=s[f]<l;c.vertexLength+((g?1:0)+(m?1:0)+(_?1:0))>Hs.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,n),l=a.count,g=!0,m=!0,_=!0,u=0);const y=Jl(s,i,o,a,d,g,c),v=Jl(s,i,o,a,p,m,c),b=Jl(s,i,o,a,f,_,c);n.emplaceBack(u+y-l,u+v-l,u+b-l),c.primitiveLength++}}(t,n,i,r,o,e),u&&function(e,t,n,i,r,o){const s=[];for(let e=0;e<i.length/2;e++)s.push(-1);const a={count:0};let l=0,c=e.getOrCreateLatestSegment(t,n),u=c.vertexLength;for(let h=0;h<r.length;h++){const d=r[h];for(let p=1;p<r[h].length;p+=2){const r=d[p-1],h=d[p];let f=s[r]<l,g=s[h]<l;c.vertexLength+((f?1:0)+(g?1:0))>Hs.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,n),l=a.count,f=!0,g=!0,u=0);const m=Jl(s,i,o,a,r,f,c),_=Jl(s,i,o,a,h,g,c);n.emplaceBack(u+m-l,u+_-l),c.primitiveLength++}}}(s,n,a,r,l,e),t.forceNewSegmentOnNextPrepare(),null==s||s.forceNewSegmentOnNextPrepare()}function Jl(e,t,n,i,r,o,s){if(o){const o=i.count;return n(t[2*r],t[2*r+1]),e[r]=i.count,i.count++,s.vertexLength++,o}return e[r]}class Ql{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ks,this.indexArray=new Vs,this.indexArray2=new $s,this.programConfigurations=new va(e.layers,e.zoom),this.segments=new Hs,this.segments2=new Hs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=ml("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Ta(s,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom,{globalState:this.globalState}),u,n))continue;const h=r?i.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Sa(s),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of o){const{geometry:r,index:o,sourceLayerIndex:s}=i;if(this.hasPattern){const e=_l("fill",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,r,o,n,{},t.subdivisionGranularity);t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r,o){for(const e of Qn(t,500)){const t=ql(e,i,o.fill.getGranularityForZoomLevel(i.z)),n=this.layoutVertexArray;Kl(((e,t)=>{n.emplaceBack(e,t)}),this.segments,this.layoutVertexArray,this.indexArray,t.verticesFlattened,t.indicesTriangles,this.segments2,this.indexArray2,t.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}}let ec,tc;oo("FillBucket",Ql,{omit:["layers","patternFeatures"]});var nc={get paint(){return tc=tc||new Uo({"fill-antialias":new Fo(ye.paint_fill["fill-antialias"]),"fill-opacity":new No(ye.paint_fill["fill-opacity"]),"fill-color":new No(ye.paint_fill["fill-color"]),"fill-outline-color":new No(ye.paint_fill["fill-outline-color"]),"fill-translate":new Fo(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Fo(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bo(ye.paint_fill["fill-pattern"])})},get layout(){return ec=ec||new Uo({"fill-sort-key":new No(ye.layout_fill["fill-sort-key"])})}};class ic extends $o{constructor(e){super(e,nc)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ql(e)}queryRadius(){return Ua(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:t,transform:n,pixelsToTileUnits:i}){return Ra(Va(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-n.bearingInRadians,i),t)}isTileClipped(){return!0}}const rc=Zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),oc=Zo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:sc}=rc;class ac{constructor(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(lc,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,i=[];let r,o=1,s=0,a=0,l=0;for(;e.pos<t;){if(s<=0){const t=e.readVarint();o=7&t,s=t>>3}if(s--,1===o||2===o)a+=e.readSVarint(),l+=e.readSVarint(),1===o&&(r&&i.push(r),r=[]),r&&r.push(new n(a,l));else{if(7!==o)throw new Error(`unknown command ${o}`);r&&r.push(r[0].clone())}}return r&&i.push(r),i}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(i<=0){const t=e.readVarint();n=7&t,i=t>>3}if(i--,1===n||2===n)r+=e.readSVarint(),o+=e.readSVarint(),r<s&&(s=r),r>a&&(a=r),o<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error(`unknown command ${n}`)}return[s,l,a,c]}toGeoJSON(e,t,n){const i=this.extent*Math.pow(2,n),r=this.extent*e,o=this.extent*t,s=this.loadGeometry();function a(e){return[360*(e.x+r)/i-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/i)*Math.PI))-90]}function l(e){return e.map(a)}let c;if(1===this.type){const e=[];for(const t of s)e.push(t[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=s.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const n=[];let i,r;for(let o=0;o<t;o++){const t=cc(e[o]);0!==t&&(void 0===r&&(r=t<0),r===t<0?(i&&n.push(i),i=[e[o]]):i&&i.push(e[o]))}return i&&n.push(i),n}(s),t=[];for(const n of e)t.push(n.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function lc(e,t,n){1===e?t.id=n.readVarint():2===e?function(e,t){const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(n,t):3===e?t.type=n.readVarint():4===e&&(t._geometry=n.pos)}function cc(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}ac.types=["Unknown","Point","LineString","Polygon"];class uc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(hc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new ac(this._pbf,t,this.extent,this._keys,this._values)}}function hc(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){let t=null;const n=e.readVarint()+e.pos;for(;e.pos<n;){const n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(n))}class dc{constructor(e,t){this.layers=e.readFields(pc,{},t)}}function pc(e,t,n){if(3===e){const e=new uc(n,n.readVarint()+n.pos);e.length&&(t[e.name]=e)}}const fc=Math.pow(2,13);function gc(e,t,n,i,r,o,s,a){e.emplaceBack(t,n,2*Math.floor(i*fc)+s,r*fc*2,o*fc*2,Math.round(a))}class mc{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Os,this.centroidVertexArray=new Ms,this.indexArray=new Vs,this.programConfigurations=new va(e.layers,e.zoom),this.segments=new Hs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.features=[],this.hasPattern=ml("fill-extrusion",this.layers,t);for(const{feature:i,id:r,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,a=Ta(i,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom,{globalState:this.globalState}),a,n))continue;const l={id:r,sourceLayerIndex:s,index:o,geometry:e?a.geometry:Sa(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(_l("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,o,n,{},t.subdivisionGranularity),t.featureIndex.insert(i,l.geometry,o,s,this.index,!0)}}addFeatures(e,t,n){for(const i of this.features){const{geometry:r}=i;this.addFeature(i,r,i.index,t,n,e.subdivisionGranularity)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sc),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,oc.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,n,i,r,o){for(const n of Qn(t,500)){const t={x:0,y:0,sampleCount:0},r=this.layoutVertexArray.length;this.processPolygon(t,i,e,n,o);const s=this.layoutVertexArray.length-r,a=Math.floor(t.x/t.sampleCount),l=Math.floor(t.y/t.sampleCount);for(let e=0;e<s;e++)this.centroidVertexArray.emplaceBack(a,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}processPolygon(e,t,n,i,r){if(i.length<1)return;if(vc(i[0]))return;for(const t of i)0!==t.length&&_c(e,t);const o={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},s=r.fill.getGranularityForZoomLevel(t.z),a="Polygon"===ac.types[n.type];for(const e of i){if(0===e.length)continue;if(vc(e))continue;const t=Xl(e,s,a);this._generateSideFaces(t,o)}if(!a)return;const l=ql(i,t,s,!1),c=this.layoutVertexArray;Kl(((e,t)=>{gc(c,e,t,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(e,t){let n=0;for(let i=1;i<e.length;i++){const r=e[i],o=e[i-1];if(yc(r,o))continue;t.segment.vertexLength+4>Hs.MAX_VERTEX_ARRAY_LENGTH&&(t.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const s=r.sub(o)._perp()._unit(),a=o.dist(r);n+a>32768&&(n=0),gc(this.layoutVertexArray,r.x,r.y,s.x,s.y,0,0,n),gc(this.layoutVertexArray,r.x,r.y,s.x,s.y,0,1,n),n+=a,gc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,0,n),gc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,1,n);const l=t.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),t.segment.vertexLength+=4,t.segment.primitiveLength+=2}}}function _c(e,t){for(let n=0;n<t.length;n++){const i=t[n];n===t.length-1&&t[0].x===i.x&&t[0].y===i.y||(e.x+=i.x,e.y+=i.y,e.sampleCount++)}}function yc(e,t){return e.x===t.x&&(e.x<0||e.x>I)||e.y===t.y&&(e.y<0||e.y>I)}function vc(e){return e.every((e=>e.x<0))||e.every((e=>e.x>I))||e.every((e=>e.y<0))||e.every((e=>e.y>I))}let bc;oo("FillExtrusionBucket",mc,{omit:["layers","features"]});var xc={get paint(){return bc=bc||new Uo({"fill-extrusion-opacity":new Fo(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new No(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fo(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fo(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bo(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new No(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new No(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fo(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class wc extends $o{constructor(e){super(e,xc)}createBucket(e){return new mc(e)}queryRadius(){return Ua(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:o,pixelsToTileUnits:s,pixelPosMatrix:a}){const l=Va(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-o.bearingInRadians,s),c=this.paint.get("fill-extrusion-height").evaluate(t,i),u=this.paint.get("fill-extrusion-base").evaluate(t,i),h=function(e,t){const i=[];for(const r of e){const e=[r.x,r.y,0,1];S(e,e,t),i.push(new n(e[0]/e[3],e[1]/e[3]))}return i}(l,a),d=function(e,t,i,r){const o=[],s=[],a=r[8]*t,l=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const t of e){const e=[],i=[];for(const o of t){const t=o.x,s=o.y,g=r[0]*t+r[4]*s+r[12],m=r[1]*t+r[5]*s+r[13],_=r[2]*t+r[6]*s+r[14],y=r[3]*t+r[7]*s+r[15],v=_+c,b=y+u,x=g+h,w=m+d,E=_+p,S=y+f,T=new n((g+a)/b,(m+l)/b);T.z=v/b,e.push(T);const C=new n(x/S,w/S);C.z=E/S,i.push(C)}o.push(e),s.push(i)}return[o,s]}(r,u,c,a);return function(e,t,n){let i=1/0;Ra(n,t)&&(i=Sc(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];Ia(n,r)&&(i=Math.min(i,Sc(n,r)))}}return i!==1/0&&i}(d[0],d[1],h)}}function Ec(e,t){return e.x*t.x+e.y*t.y}function Sc(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=Ec(a,a),h=Ec(a,l),d=Ec(l,l),p=Ec(c,a),f=Ec(c,l),g=u*d-h*h,m=(d*p-h*f)/g,_=(u*f-h*p)/g,y=i.z*(1-m-_)+r.z*m+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}const Tc=Zo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cc}=Tc,Ac=Zo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Pc}=Ac,Ic=Math.cos(Math.PI/180*37.5),Mc=Math.pow(2,14)/.5;class Rc{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Ls,this.layoutVertexArray2=new Ds,this.indexArray=new Vs,this.programConfigurations=new va(e.layers,e.zoom),this.segments=new Hs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=ml("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ta(t,e);if(!this.layers[0]._featureFilter.filter(new Ao(this.zoom,{globalState:this.globalState}),c,n))continue;const u=r?i.evaluate(c,{},n):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Sa(t),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of o){const{geometry:r,index:o,sourceLayerIndex:s}=i;if(this.hasPattern){const e=_l("line",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,r,o,n,{},t.subdivisionGranularity);t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Pc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),l=s.get("line-cap"),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const n of t)this.addLine(n,e,a,l,c,u,i,o);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}addLine(e,t,n,i,r,o,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Xl(e,s?a.line.getGranularityForZoomLevel(s.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===ac.types[t.type];let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let u=0;for(;u<c-1&&e[u].equals(e[u+1]);)u++;if(c<(l?3:2))return;"bevel"===n&&(r=1.05);const h=this.overscaling<=16?122880/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,g,m,_;this.e1=this.e2=-1,l&&(p=e[c-2],_=e[u].sub(p)._unit()._perp());for(let t=u;t<c;t++){if(g=t===c-1?l?e[u+1]:void 0:e[t+1],g&&e[t].equals(g))continue;_&&(m=_),p&&(f=p),p=e[t],_=g?g.sub(p)._unit()._perp():m,m=m||_;let s=m.add(_);0===s.x&&0===s.y||s._unit();const a=m.x*_.x+m.y*_.y,y=s.x*_.x+s.y*_.y,v=0!==y?1/y:1/0,b=2*Math.sqrt(2-2*y),x=y<Ic&&f&&g,w=m.x*_.y-m.y*_.x>0;if(x&&t>u){const e=p.dist(f);if(e>2*h){const t=p.sub(p.sub(f)._mult(h/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,m,0,0,d),f=t}}const E=f&&g;let S=E?n:l?"butt":i;if(E&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>r&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<r&&(S="miter")),f&&this.updateDistance(f,p),"miter"===S)s._mult(v),this.addCurrentVertex(p,s,0,0,d);else if("flipbevel"===S){if(v>100)s=_.mult(-1);else{const e=v*m.add(_).mag()/m.sub(_).mag();s._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(p,s,0,0,d),this.addCurrentVertex(p,s.mult(-1),0,0,d)}else if("bevel"===S||"fakeround"===S){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(f&&this.addCurrentVertex(p,m,t,n,d),"fakeround"===S){const e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const i=_.sub(m)._mult(n)._add(m)._unit()._mult(w?-1:1);this.addHalfVertex(p,i.x,i.y,!1,w,0,d)}}g&&this.addCurrentVertex(p,_,-t,-n,d)}else if("butt"===S)this.addCurrentVertex(p,s,0,0,d);else if("square"===S){const e=f?1:-1;this.addCurrentVertex(p,s,e,e,d)}else"round"===S&&(f&&(this.addCurrentVertex(p,m,0,0,d),this.addCurrentVertex(p,m,1,1,d,!0)),g&&(this.addCurrentVertex(p,_,-1,-1,d,!0),this.addCurrentVertex(p,_,0,0,d)));if(x&&t<c-1){const e=p.dist(g);if(e>2*h){const t=p.add(g.sub(p)._mult(h/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,_,0,0,d),p=t}}}}addCurrentVertex(e,t,n,i,r,o=!1){const s=t.y*i-t.x,a=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,r),this.addHalfVertex(e,s,a,o,!0,-i,r),this.distance>Mc/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,n,i,r,o))}addHalfVertex({x:e,y:t},n,i,r,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(Mc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,c,this.e2),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let kc,Oc;oo("LineBucket",Rc,{omit:["layers","patternFeatures"]});var Lc={get paint(){return Oc=Oc||new Uo({"line-opacity":new No(ye.paint_line["line-opacity"]),"line-color":new No(ye.paint_line["line-color"]),"line-translate":new Fo(ye.paint_line["line-translate"]),"line-translate-anchor":new Fo(ye.paint_line["line-translate-anchor"]),"line-width":new No(ye.paint_line["line-width"]),"line-gap-width":new No(ye.paint_line["line-gap-width"]),"line-offset":new No(ye.paint_line["line-offset"]),"line-blur":new No(ye.paint_line["line-blur"]),"line-dasharray":new zo(ye.paint_line["line-dasharray"]),"line-pattern":new Bo(ye.paint_line["line-pattern"]),"line-gradient":new jo(ye.paint_line["line-gradient"])})},get layout(){return kc=kc||new Uo({"line-cap":new Fo(ye.layout_line["line-cap"]),"line-join":new No(ye.layout_line["line-join"]),"line-miter-limit":new Fo(ye.layout_line["line-miter-limit"]),"line-round-limit":new Fo(ye.layout_line["line-round-limit"]),"line-sort-key":new No(ye.layout_line["line-sort-key"])})}};class Dc extends No{possiblyEvaluate(e,t){return t=new Ao(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=B({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}let Fc;class Nc extends $o{constructor(e){super(e,Lc),this.gradientVersion=0,Fc||(Fc=new Dc(Lc.paint.properties["line-width"].specification),Fc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!!function(e){return void 0!==e._styleExpression}(e)&&e._styleExpression.expression instanceof an,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Fc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Rc(e)}queryRadius(e){const t=e,n=Bc(ja("line-width",this,t),ja("line-gap-width",this,t)),i=ja("line-offset",this,t);return n/2+Math.abs(i)+Ua(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:o,pixelsToTileUnits:s}){const a=Va(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-o.bearingInRadians,s),l=s/2*Bc(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),c=this.paint.get("line-offset").evaluate(t,i);return c&&(r=function(e,t){const i=[];for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const i=o[e-1],r=o[e],a=o[e+1],l=0===e?new n(0,0):r.sub(i)._unit()._perp(),c=e===o.length-1?new n(0,0):a.sub(r)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(t)._add(r))}i.push(s)}return i}(r,c*s)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(Ba(e,r[t]))return!0;if(ka(e,r,n))return!0}return!1}(a,r,l)}isTileClipped(){return!0}}function Bc(e,t){return t>0?t+2*e:e}const zc=Zo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jc=Zo([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Uc=Zo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Zo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vc=Zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$c=Zo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gc(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),Co.applyArabicShaping&&(e=Co.applyArabicShaping(e)),e}(e.text,t,n)})),e}Zo([{name:"triangle",components:3,type:"Uint16"}]),Zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Zo([{type:"Float32",name:"offsetX"}]),Zo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Zo([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Wc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Hc=24;const Zc=4294967296,qc=1/Zc,Xc="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class Yc{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,n=this.length){for(;this.pos<n;){const n=this.readVarint(),i=n>>3,r=this.pos;this.type=7&n,e(i,t,this),this.pos===r&&this.skip(n)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Zc;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Zc;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let n,i;return i=t[this.pos++],n=127&i,i<128?n:(i=t[this.pos++],n|=(127&i)<<7,i<128?n:(i=t[this.pos++],n|=(127&i)<<14,i<128?n:(i=t[this.pos++],n|=(127&i)<<21,i<128?n:(i=t[this.pos],n|=(15&i)<<28,function(e,t,n){const i=n.buf;let r,o;if(o=i[n.pos++],r=(112&o)>>4,o<128)return Kc(e,r,t);if(o=i[n.pos++],r|=(127&o)<<3,o<128)return Kc(e,r,t);if(o=i[n.pos++],r|=(127&o)<<10,o<128)return Kc(e,r,t);if(o=i[n.pos++],r|=(127&o)<<17,o<128)return Kc(e,r,t);if(o=i[n.pos++],r|=(127&o)<<24,o<128)return Kc(e,r,t);if(o=i[n.pos++],r|=(1&o)<<31,o<128)return Kc(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(n,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Xc?Xc.decode(this.buf.subarray(t,e)):function(e,t,n){let i="",r=t;for(;r<n;){const t=e[r];let o,s,a,l=null,c=t>239?4:t>223?3:t>191?2:1;if(r+c>n)break;1===c?t<128&&(l=t):2===c?(o=e[r+1],128==(192&o)&&(l=(31&t)<<6|63&o,l<=127&&(l=null))):3===c?(o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&(l=(15&t)<<12|(63&o)<<6|63&s,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&t)<<18|(63&o)<<12|(63&s)<<6|63&a,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),r+=c}return i}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*qc),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*qc),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(n=~(-e%4294967296),i=~(-e/4294967296),4294967295^n?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){const n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,n){for(let i,r,o=0;o<t.length;o++){if(i=t.charCodeAt(o),i>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);const n=this.pos-t;n>=128&&Jc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let n=0;n<t;n++)this.buf[this.pos++]=e[n]}writeRawMessage(e,t){this.pos++;const n=this.pos;e(t,this);const i=this.pos-n;i>=128&&Jc(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i}writeMessage(e,t,n){this.writeTag(e,2),this.writeRawMessage(t,n)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Qc,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,eu,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,iu,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,tu,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,nu,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,ru,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,ou,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,su,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,au,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}}function Kc(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Jc(e,t,n){const i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(let t=n.pos-1;t>=e;t--)n.buf[t+i]=n.buf[t]}function Qc(e,t){for(let n=0;n<e.length;n++)t.writeVarint(e[n])}function eu(e,t){for(let n=0;n<e.length;n++)t.writeSVarint(e[n])}function tu(e,t){for(let n=0;n<e.length;n++)t.writeFloat(e[n])}function nu(e,t){for(let n=0;n<e.length;n++)t.writeDouble(e[n])}function iu(e,t){for(let n=0;n<e.length;n++)t.writeBoolean(e[n])}function ru(e,t){for(let n=0;n<e.length;n++)t.writeFixed32(e[n])}function ou(e,t){for(let n=0;n<e.length;n++)t.writeSFixed32(e[n])}function su(e,t){for(let n=0;n<e.length;n++)t.writeFixed64(e[n])}function au(e,t){for(let n=0;n<e.length;n++)t.writeSFixed64(e[n])}function lu(e,t,n){1===e&&n.readMessage(cu,t)}function cu(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(uu,{});t.push({id:e,bitmap:new el({width:r+6,height:o+6},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}}function uu(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function hu(e){let t=0,n=0;for(const i of e)t+=i.w*i.h,n=Math.max(n,i.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const t of e)for(let e=i.length-1;e>=0;e--){const n=i[e];if(!(t.w>n.w||t.h>n.h)){if(t.x=n.x,t.y=n.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===n.w&&t.h===n.h){const t=i.pop();t&&e<i.length&&(i[e]=t)}else t.h===n.h?(n.x+=t.w,n.w-=t.w):t.w===n.w?(n.y+=t.h,n.h-=t.h):(i.push({x:n.x+t.w,y:n.y,w:n.w-t.w,h:t.h}),n.y+=t.h,n.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}class du{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:r,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=r,this.content=o,this.version=n,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class pu{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:o,h:s}=hu(r),a=new tl({width:o||1,height:s||1});for(const t in e){const i=e[t],r=n[t].paddedRect;tl.copy(i.data,a,{x:0,y:0},{x:r.x+1,y:r.y+1},i.data)}for(const e in t){const n=t[e],r=i[e].paddedRect,o=r.x+1,s=r.y+1,l=n.data.width,c=n.data.height;tl.copy(n.data,a,{x:0,y:0},{x:o,y:s},n.data),tl.copy(n.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),tl.copy(n.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),tl.copy(n.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),tl.copy(n.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),t[i]=new du(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl;n.update(t.data,void 0,{x:i,y:r})}}var fu;oo("ImagePosition",du),oo("ImageAtlas",pu),e.ao=void 0,(fu=e.ao||(e.ao={}))[fu.none=0]="none",fu[fu.horizontal=1]="horizontal",fu[fu.vertical=2]="vertical",fu[fu.horizontalOnly=3]="horizontalOnly";class gu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,t,n){const i=new gu;return i.scale=e||1,i.fontStack=t,i.verticalAlign=n||"bottom",i}static forImage(e,t){const n=new gu;return n.imageName=e,n.verticalAlign=t||"bottom",n}}class mu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new mu;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,r=e.charCodeAt(n-1)||null;t+=i&&xo(i)&&!Wc[e[n+1]]||r&&xo(r)&&!Wc[e[n-1]]||!Wc[e[n]]?e[n]:Wc[e[n]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&yu[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&yu[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new mu;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}getMaxImageSize(e){let t=0,n=0;for(let i=0;i<this.length();i++){const r=this.getSection(i);if(r.imageName){const i=e[r.imageName];if(!i)continue;const o=i.displaySize;t=Math.max(t,o[0]),n=Math.max(n,o[1])}}return{maxImageWidth:t,maxImageHeight:n}}addTextSection(e,t){this.text+=e.text,this.sections.push(gu.forText(e.scale,e.fontStack||t,e.verticalAlign));const n=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void G("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(gu.forImage(t,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):G("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _u(t,n,i,r,o,s,a,l,c,u,h,d,p,f,g){const m=mu.fromFeature(t,o);let _;d===e.ao.vertical&&m.verticalizePunctuation();const{processBidirectionalText:y,processStyledBidirectionalText:v}=Co;if(y&&1===m.sections.length){_=[];const e=y(m.toString(),Cu(m,u,s,n,r,f));for(const t of e){const e=new mu;e.text=t,e.sections=m.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);_.push(e)}}else if(v){_=[];const e=v(m.text,m.sectionIndex,Cu(m,u,s,n,r,f));for(const t of e){const e=new mu;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,_.push(e)}}else _=function(e,t){const n=[],i=e.text;let r=0;for(const i of t)n.push(e.substring(r,i)),r=i;return r<i.length&&n.push(e.substring(r,i.length)),n}(m,Cu(m,u,s,n,r,f));const b=[],x={positionedLines:b,text:m.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,t,n,i,r,o,s,a,l,c,u,h){let d=0,p=0,f=0,g=0;const m="right"===a?1:"left"===a?0:.5,_=Hc/h;let y=0;for(const s of r){s.trim();const r=s.getMaxScale(),a={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=a;const h=a.positionedGlyphs;let v=0;if(!s.length()){p+=o,++y;continue}const b=Pu(i,s,_);for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),g=s.getCharCode(o),m=Mu(l,u,g);let y;if(a.imageName){if(e.iconsInText=!0,a.scale=a.scale*_,y=ku(a,m,r,b,i),!y)continue;v=Math.max(v,y.imageOffset)}else if(y=Ru(a,g,m,b,t,n),!y)continue;const{rect:x,metrics:w,baselineOffset:E}=y;h.push({glyph:g,imageName:a.imageName,x:d,y:p+E+-17,vertical:m,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:w,rect:x}),m?(e.verticalizable=!0,d+=(a.imageName?w.advance:Hc)*a.scale+c):d+=w.advance*a.scale+c}0!==h.length&&(f=Math.max(d-c,f),Ou(h,0,h.length-1,m)),d=0,a.lineOffset=Math.max(v,(r-1)*Hc);const x=o*r+v;p+=x,g=Math.max(x,g),++y}const{horizontalAlign:v,verticalAlign:b}=Au(s);(function(e,t,n,i,r,o,s,a,l){const c=(t-n)*r;let u=0;u=o!==s?-a*i- -17:-i*l*s+.5*s;for(const t of e)for(const e of t.positionedGlyphs)e.x+=c,e.y+=u})(e.positionedLines,m,v,b,f,g,o,p,r.length),e.top+=-b*p,e.bottom=e.top+p,e.left+=-v*f,e.right=e.left+f}(x,n,i,r,_,a,l,c,d,u,p,g),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b)&&x}const yu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},bu={40:!0};function xu(e,t,n,i,r,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*Hc/o+r:0}{const i=n[t.fontStack],o=i&&i[e];return o?o.metrics.advance*t.scale+r:0}}function wu(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function Eu(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Su(e,t,n,i,r,o){let s=null,a=wu(t,n,r,o);for(const e of i){const i=wu(t-e.x,n,r,o)+e.badness;i<=a&&(s=e,a=i)}return{index:e,x:t,priorBreak:s,badness:a}}function Tu(e){return e?Tu(e.priorBreak).concat(e.index):[]}function Cu(e,t,n,i,r,o){if(!e)return[];const s=[],a=function(e,t,n,i,r,o){let s=0;for(let n=0;n<e.length();n++){const a=e.getSection(n);s+=xu(e.getCharCode(n),a,i,r,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,i,r,o),l=e.text.indexOf("")>=0;let c=0;for(let n=0;n<e.length();n++){const h=e.getSection(n),d=e.getCharCode(n);if(yu[d]||(c+=xu(d,h,i,r,t,o)),n<e.length()-1){const t=!((u=d)<11904)&&(!!po["CJK Compatibility Forms"](u)||!!po["CJK Compatibility"](u)||!!po["CJK Strokes"](u)||!!po["CJK Symbols and Punctuation"](u)||!!po["Enclosed CJK Letters and Months"](u)||!!po["Halfwidth and Fullwidth Forms"](u)||!!po["Ideographic Description Characters"](u)||!!po["Vertical Forms"](u)||vo.test(String.fromCodePoint(u)));(vu[d]||t||h.imageName||n!==e.length()-2&&bu[e.getCharCode(n+1)])&&s.push(Su(n+1,c,a,s,Eu(d,e.getCharCode(n+1),t&&l),!1))}}var u;return Tu(Su(e.length(),c,a,s,0,!0))}function Au(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Pu(e,t,n){const i=t.getMaxScale()*Hc,{maxImageWidth:r,maxImageHeight:o}=t.getMaxImageSize(e),s=Math.max(i,o*n);return{verticalLineContentWidth:Math.max(i,r*n),horizontalLineContentHeight:s}}function Iu(e){switch(e){case"top":return 0;case"center":return.5;default:return 1}}function Mu(t,n,i){return!(t===e.ao.horizontal||!n&&!bo(i)||n&&(yu[i]||(r=i,/\p{sc=Arab}/u.test(String.fromCodePoint(r)))));var r}function Ru(e,t,n,i,r,o){const s=o[e.fontStack],a=function(e,t,n,i){if(e&&e.rect)return e;const r=t[n.fontStack],o=r&&r[i];return o?{rect:null,metrics:o.metrics}:null}(s&&s[t],r,e,t);if(null===a)return null;let l;if(n)l=i.verticalLineContentWidth-e.scale*Hc;else{const t=Iu(e.verticalAlign);l=(i.horizontalLineContentHeight-e.scale*Hc)*t}return{rect:a.rect,metrics:a.metrics,baselineOffset:l}}function ku(e,t,n,i,r){const o=r[e.imageName];if(!o)return null;const s=o.paddedRect,a=o.displaySize,l={width:a[0],height:a[1],left:1,top:-3,advance:t?a[1]:a[0]};let c;if(t)c=i.verticalLineContentWidth-a[1]*e.scale;else{const t=Iu(e.verticalAlign);c=(i.horizontalLineContentHeight-a[1]*e.scale)*t}return{rect:s,metrics:l,baselineOffset:c,imageOffset:(t?a[0]:a[1])*e.scale-Hc*n}}function Ou(e,t,n,i){if(0===i)return;const r=e[n],o=(e[n].x+r.metrics.advance*r.scale)*i;for(let i=t;i<=n;i++)e[i].x-=o}function Lu(e,t,n){const{horizontalAlign:i,verticalAlign:r}=Au(n),o=t[0]-e.displaySize[0]*i,s=t[1]-e.displaySize[1]*r;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Du(e){var t,n;let i=e.left,r=e.top,o=e.right-i,s=e.bottom-r;const a=null!==(t=e.image.textFitWidth)&&void 0!==t?t:"stretchOrShrink",l=null!==(n=e.image.textFitHeight)&&void 0!==n?n:"stretchOrShrink",c=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const e=Math.ceil(s*c);i*=e/o,o=e}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const e=Math.ceil(o/c);r*=e/s,s=e}return{x1:i,y1:r,x2:i+o,y2:r+s}}function Fu(e,t,n,i,r,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,g=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+g+i[2]):(u=r[1]+(f+g-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const Nu=128,Bu=32640;function zu(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ao(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new Ao(s)),maxSize:n.evaluate(new Ao(a)),interpolationType:i}}}function ju(e,t,n){let i="never";const r=e.get(t);return r?i=r:e.get(n)&&(i="always"),i}const Uu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vu(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=a?Math.min(Bu,Math.round(a[0])):0,f=a?Math.min(Bu,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function $u(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function Gu(e){for(const t of e.sections)if(To(t.text))return!0;return!1}class Wu{constructor(e){this.layoutVertexArray=new Ns,this.indexArray=new Vs,this.programConfigurations=e,this.segments=new Hs,this.dynamicLayoutVertexArray=new Bs,this.opacityVertexArray=new zs,this.hasVisibleVertices=!1,this.placedSymbolArray=new xs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,jc.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Uu,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}oo("SymbolBuffers",Wu);class Hu{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Hs,this.collisionVertexArray=new Us}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Uc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}oo("CollisionBuffers",Hu);class Zu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zu(this.zoom,n["text-size"]),this.iconSizeData=zu(this.zoom,n["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap="never"!==ju(i,"text-overlap","text-allow-overlap")||"never"!==ju(i,"icon-overlap","icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((t=>e.ao[t]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Wu(new va(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Wu(new va(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Ss,this.lineVertexArray=new Ts,this.symbolInstances=new Es,this.textAnchorOffsets=new As}calculateGlyphDependencies(e,t,n,i,r){for(let o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(n||i)&&r){const n=Wc[e.charAt(o)];n&&(t[n.charCodeAt(0)]=!0)}}populate(t,n,i){const r=this.layers[0],o=r.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Mt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,g=new Ao(this.zoom,{globalState:this.globalState});for(const{feature:n,id:a,index:l,sourceLayerIndex:m}of t){const t=r._featureFilter.needGeometry,_=Ta(n,t);if(!r._featureFilter.filter(g,_,i))continue;let y,v;if(t||(_.geometry=Sa(n)),c){const e=r.getValueAndResolveTokens("text-field",_,i,f),t=Mt.factory(e),n=this.hasRTLText=this.hasRTLText||Gu(t);(!n||"unavailable"===Co.getRTLTextPluginStatus()||n&&Co.isParsed())&&(y=Gc(t,r,_))}if(u){const e=r.getValueAndResolveTokens("icon-image",_,i,f);v=e instanceof Nt?e:Nt.fromString(e)}if(!y&&!v)continue;const b=this.sortFeaturesByKey?h.evaluate(_,{},i):void 0;if(this.features.push({id:a,text:y,icon:v,index:l,sourceLayerIndex:m,geometry:_.geometry,properties:n.properties,type:ac.types[n.type],sortKey:b}),v&&(d[v.name]=!0),y){const t=s.evaluate(_,{},i).join(","),n="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.ao.vertical)>=0;for(const e of y.sections)if(e.image)d[e.image.name]=!0;else{const i=fo(y.toString()),r=e.fontStack||t,o=p[r]=p[r]||{};this.calculateGlyphDependencies(e.text,o,n,this.allowVerticalPlacement,i)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function s(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:${i.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=a(p,f,h),r=s(p,f,i[e].geometry);delete t[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=r-1,n[f]=r-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment){let n=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]);const r={};for(let i=e.segment+1;i<t.length;i++)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i<t.length-1&&(n+=t[i+1].dist(t[i]));for(let n=e.segment||0;n>=0;n--)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n>0&&(i+=t[n-1].dist(t[n]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,n,i,r,o,s,a,l,c,u,h,d){const p=t.indexArray,f=t.layoutVertexArray,g=t.segments.prepareSegment(4*n.length,f,p,this.canOverlap?s.sortKey:void 0),m=this.glyphOffsetArray.length,_=g.vertexLength,y=this.allowVerticalPlacement&&a===e.ao.vertical?Math.PI/2:0,v=s.text&&s.text.sections;for(let e=0;e<n.length;e++){const{tl:r,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:m,minFontScaleX:_,minFontScaleY:b,glyphOffset:x,isSDF:w,sectionIndex:E}=n[e],S=g.vertexLength,T=x[1];Vu(f,l.x,l.y,r.x,T+r.y,u.x,u.y,i,w,h.x,h.y,_,b),Vu(f,l.x,l.y,o.x,T+o.y,u.x+u.w,u.y,i,w,m.x,h.y,_,b),Vu(f,l.x,l.y,a.x,T+a.y,u.x,u.y+u.h,i,w,h.x,m.y,_,b),Vu(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,i,w,m.x,m.y,_,b),$u(t.dynamicLayoutVertexArray,l,y),p.emplaceBack(S,S+2,S+1),p.emplaceBack(S+1,S+2,S+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),e!==n.length-1&&E===n[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,v&&v[E])}t.placedSymbolArray.emplaceBack(l.x,l.y,m,this.glyphOffsetArray.length-m,_,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],a,0,!1,0,h)}_addCollisionDebugVertex(e,t,n,i,r,o){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,i,r,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(e,t,i,r,o,s,a){const l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=l.vertexLength,u=o.layoutVertexArray,h=o.collisionVertexArray,d=a.anchorX,p=a.anchorY;this._addCollisionDebugVertex(u,h,s,d,p,new n(e,t)),this._addCollisionDebugVertex(u,h,s,d,p,new n(i,t)),this._addCollisionDebugVertex(u,h,s,d,p,new n(i,r)),this._addCollisionDebugVertex(u,h,s,d,p,new n(e,r)),l.vertexLength+=4;const f=o.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(e,t,n,i){for(let r=e;r<t;r++){const e=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,i?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hu(js,Vc.members,$s),this.iconCollisionBox=new Hu(js,Vc.members,$s);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,s,a,l){const c={};for(let i=t;i<n;i++){const t=e.get(i);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let t=i;t<r;t++){const n=e.get(t);c.verticalTextBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalTextFeatureIndex=n.featureIndex;break}for(let t=o;t<s;t++){const n=e.get(t);c.iconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.iconFeatureIndex=n.featureIndex;break}for(let t=a;t<l;t++){const n=e.get(t);c.verticalIconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalIconFeatureIndex=n.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let t=n.vertexStartIndex;t<i;t+=4)e.indexArray.emplaceBack(t,t+2,t+1),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);i.push(0|Math.round(t*s.anchorX+n*s.anchorY)),r.push(s.featureIndex)}return o.sort(((e,t)=>i[e]-i[t]||r[t]-r[e])),o}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let qu,Xu;oo("SymbolBucket",Zu,{omit:["layers","collisionBoxArray","features","compareText"]}),Zu.MAX_GLYPHS=65535,Zu.addDynamicAttributes=$u;var Yu={get paint(){return Xu=Xu||new Uo({"icon-opacity":new No(ye.paint_symbol["icon-opacity"]),"icon-color":new No(ye.paint_symbol["icon-color"]),"icon-halo-color":new No(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new No(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new No(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Fo(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fo(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new No(ye.paint_symbol["text-opacity"]),"text-color":new No(ye.paint_symbol["text-color"],{runtimeType:Be,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new No(ye.paint_symbol["text-halo-color"]),"text-halo-width":new No(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new No(ye.paint_symbol["text-halo-blur"]),"text-translate":new Fo(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Fo(ye.paint_symbol["text-translate-anchor"])})},get layout(){return qu=qu||new Uo({"symbol-placement":new Fo(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Fo(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fo(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new No(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fo(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Fo(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Fo(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Fo(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fo(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fo(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new No(ye.layout_symbol["icon-size"]),"icon-text-fit":new Fo(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fo(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new No(ye.layout_symbol["icon-image"]),"icon-rotate":new No(ye.layout_symbol["icon-rotate"]),"icon-padding":new No(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Fo(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new No(ye.layout_symbol["icon-offset"]),"icon-anchor":new No(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fo(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fo(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fo(ye.layout_symbol["text-rotation-alignment"]),"text-field":new No(ye.layout_symbol["text-field"]),"text-font":new No(ye.layout_symbol["text-font"]),"text-size":new No(ye.layout_symbol["text-size"]),"text-max-width":new No(ye.layout_symbol["text-max-width"]),"text-line-height":new Fo(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new No(ye.layout_symbol["text-letter-spacing"]),"text-justify":new No(ye.layout_symbol["text-justify"]),"text-radial-offset":new No(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fo(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new No(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new No(ye.layout_symbol["text-anchor"]),"text-max-angle":new Fo(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Fo(ye.layout_symbol["text-writing-mode"]),"text-rotate":new No(ye.layout_symbol["text-rotate"]),"text-padding":new Fo(ye.layout_symbol["text-padding"]),"text-keep-upright":new Fo(ye.layout_symbol["text-keep-upright"]),"text-transform":new No(ye.layout_symbol["text-transform"]),"text-offset":new No(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Fo(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Fo(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Fo(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Fo(ye.layout_symbol["text-optional"])})}};class Ku{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Le,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}oo("FormatSectionOverride",Ku,{omit:["defaultValue"]});class Ju extends $o{constructor(e){super(e,Yu)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const n of e)t.indexOf(n)<0&&t.push(n);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||er(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>e&&n in e?String(e[n]):""))}(t.properties,r)}createBucket(e){return new Zu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Yu.paint.overridableProperties){if(!Ju.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new Ku(t),i=new Qi(n,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new nr("source",i):new ir("composite",i,t.value.zoomStops),this.paint._values[e]=new Lo(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&Ju.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=Yu.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Mt)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof $t&&Ut(t.value)===$e?o(t.value.sections):t instanceof An?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}}let Qu;var eh={get paint(){return Qu=Qu||new Uo({"background-color":new Fo(ye.paint_background["background-color"]),"background-pattern":new zo(ye.paint_background["background-pattern"]),"background-opacity":new Fo(ye.paint_background["background-opacity"])})}};class th extends $o{constructor(e){super(e,eh)}}let nh;var ih={get paint(){return nh=nh||new Uo({"raster-opacity":new Fo(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Fo(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fo(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fo(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Fo(ye.paint_raster["raster-saturation"]),"raster-contrast":new Fo(ye.paint_raster["raster-contrast"]),"raster-resampling":new Fo(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Fo(ye.paint_raster["raster-fade-duration"])})}};class rh extends $o{constructor(e){super(e,ih)}}class oh extends $o{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class sh{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ah={once:!0},lh=6371008.8;class ch{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ch(N(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return lh*Math.acos(Math.min(r,1))}static convert(e){if(e instanceof ch)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ch(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ch(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const uh=2*Math.PI*lh;function hh(e){return uh*Math.cos(e*Math.PI/180)}function dh(e){return(180+e)/360}function ph(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function fh(e,t){return e/hh(t)}function gh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function mh(e,t){return e*hh(gh(t))}class _h{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=ch.convert(e);return new _h(dh(n.lng),ph(n.lat),fh(t,n.lat))}toLngLat(){return new ch(360*this.x-180,gh(this.y))}toAltitude(){return mh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/uh*(e=gh(this.y),1/Math.cos(e*Math.PI/180));var e}}function yh(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}class vh{constructor(e,t,n){if(!function(e,t,n){return!(e<0||e>25||n<0||n>=Math.pow(2,e)||t<0||t>=Math.pow(2,e))}(e,t,n))throw new Error(`x=${t}, y=${n}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=t,this.y=n,this.key=wh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,n){const i=(o=this.y,s=this.z,a=yh(256*(r=this.x),256*(o=Math.pow(2,s)-o-1),s),l=yh(256*(r+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var r,o,s,a,l;const c=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new n((e.x*t-this.x)*I,(e.y*t-this.y)*I)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=wh(e,t.z,t.z,t.x,t.y)}}class xh{constructor(e,t,n,i,r){if(this.terrainRttPosMatrix32f=null,e<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=t,this.canonical=new vh(n,+i,+r),this.key=wh(t,e,n,i,r)}clone(){return new xh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const t=this.canonical.z-e;return e>this.canonical.z?new xh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?wh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):wh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new xh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new xh(t,this.wrap,t,n,i),new xh(t,this.wrap,t,n+1,i),new xh(t,this.wrap,t,n,i+1),new xh(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new xh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new xh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new _h(e.x-this.wrap,e.y))}}function wh(e,t,n,i,r){(e*=2)<0&&(e=-1*e-1);const o=1<<n;return(o*o*e+o*r+i).toString(36)+n.toString(36)+t.toString(36)}function Eh(e,t){return t?e.properties[t]:e.id}oo("CanonicalTileID",vh),oo("OverscaledTileID",xh,{omit:["terrainRttPosMatrix32f"]});class Sh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const t=new Sh;return t.extend(e(new n(this.minX,this.minY))),t.extend(e(new n(this.maxX,this.minY))),t.extend(e(new n(this.minX,this.maxY))),t.extend(e(new n(this.maxX,this.maxY))),t}static fromPoints(e){const t=new Sh;for(const n of e)t.extend(n);return t}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Th{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Ch{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class Ah{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new io(I,16,0),this.grid3D=new io(I,16,0),this.featureIndexArray=new Is,this.promoteId=t}insert(e,t,n,i,r,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);const a=o?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const n=t[e],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<n.length;e++){const t=n[e];i[0]=Math.min(i[0],t.x),i[1]=Math.min(i[1],t.y),i[2]=Math.max(i[2],t.x),i[3]=Math.max(i[3],t.y)}i[0]<I&&i[1]<I&&i[2]>=0&&i[3]>=0&&a.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new dc(new Yc(this.rawTileData)).layers,this.sourceLayerCoder=new Th(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,i,r){this.loadVTLayers();const o=e.params,s=I/e.tileSize/e.scale,a=ur(o.filter),l=e.queryGeometry,c=e.queryPadding*s,u=Sh.fromPoints(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Sh.fromPoints(e.cameraQueryGeometry).expandBy(c),p=this.grid3D.query(d.minX,d.minY,d.maxX,d.maxY,((t,i,r,o)=>function(e,t,i,r,o){for(const n of e)if(t<=n.x&&i<=n.y&&r>=n.x&&o>=n.y)return!0;const s=[new n(t,i),new n(t,o),new n(r,o),new n(r,i)];if(e.length>2)for(const t of s)if(Ba(e,t))return!0;for(let t=0;t<e.length-1;t++)if(za(e[t],e[t+1],s))return!0;return!1}(e.cameraQueryGeometry,t-c,i-c,r+c,o+c)));for(const e of p)h.push(e);h.sort(Ih);const f={};let g;for(let n=0;n<h.length;n++){const c=h[n];if(c===g)continue;g=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,a,o.layers,o.availableImages,t,i,r,((t,n,i)=>(d||(d=Sa(t)),n.queryIntersectsFeature({queryGeometry:l,feature:t,featureState:i,geometry:d,zoom:this.z,transform:e.transform,pixelsToTileUnits:s,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return f}loadMatchingFeature(e,t,n,i,r,o,s,a,l,c,u){const h=this.bucketLayerIDs[t];if(o&&!h.some((e=>o.has(e))))return;const d=this.sourceLayerCoder.decode(n),p=this.vtLayers[d].feature(i);if(r.needGeometry){const e=Ta(p,!0);if(!r.filter(new Ao(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Ao(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let t=0;t<h.length;t++){const n=h[t];if(o&&!o.has(n))continue;const r=a[n];if(!r)continue;let d={};f&&c&&(d=c.getState(r.sourceLayer||"_geojsonTileLayer",f));const g=B({},l[n]);g.paint=Ph(g.paint,r.paint,p,d,s),g.layout=Ph(g.layout,r.layout,p,d,s);const m=!u||u(p,r,d);if(!m)continue;const _=new Ch(p,this.z,this.x,this.y,f);_.layer=g;let y=e[n];void 0===y&&(y=e[n]=[]),y.push({featureIndex:i,feature:_,intersectionZ:m})}}lookupSymbolFeatures(e,t,n,i,r,o,s,a){const l={};this.loadVTLayers();const c=ur(r);for(const r of e)this.loadMatchingFeature(l,n,i,r,c,o,s,a,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){var n;let i=e.id;return this.promoteId&&(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof i&&(i=Number(i)),void 0===i&&(null===(n=e.properties)||void 0===n?void 0:n.cluster)&&this.promoteId&&(i=Number(e.properties.cluster_id))),i}}function Ph(e,t,n,i,r){return j(e,((e,o)=>{const s=t instanceof Do?t.get(o):null;return s&&s.evaluate?s.evaluate(n,i,r):s}))}function Ih(e,t){return t-e}function Mh(e,t,i,r,o){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;for(let e=0;e<l.length-1;e++){let a=l[e],u=l[e+1];a.x<t&&u.x<t||(a.x<t?a=new n(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<t&&(u=new n(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new n(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new n(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=r&&u.x>=r||(a.x>=r?a=new n(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=r&&(u=new n(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new n(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new n(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}oo("FeatureIndex",Ah,{omit:["rawTileData","sourceLayerCoder"]});class Rh extends n{constructor(e,t,n,i){super(e,t),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new Rh(this.x,this.y,this.angle,this.segment)}}function kh(e,t,n,i,r){if(void 0===t.segment||0===n)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(n)}return!0}function Oh(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Lh(e,t,n){return e?.6*t*n:0}function Dh(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Fh(e,t,n,i,r,o){const s=Lh(n,r,o),a=Dh(n,i)*o;let l=0;const c=Oh(e)/2;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1],o=i.dist(r);if(l+o>c){const u=(c-l)/o,h=fn.number(i.x,r.x,u),d=fn.number(i.y,r.y,u),p=new Rh(h,d,r.angleTo(i),n);return p._round(),!s||kh(e,p,a,s,t)?p:void 0}l+=o}}function Nh(e,t,n,i,r,o,s,a,l){const c=Lh(i,o,s),u=Dh(i,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Bh(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function Bh(e,t,n,i,r,o,s,a,l){const c=o/2,u=Oh(e);let h=0,d=t-n,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),g=a.angleTo(s);for(;d+n<h+f;){d+=n;const m=(d-h)/f,_=fn.number(s.x,a.x,m),y=fn.number(s.y,a.y,m);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const n=new Rh(_,y,g,t);n._round(),i&&!kh(e,n,o,i,r)||p.push(n)}}h+=f}return a||p.length||s||(p=Bh(e,h/2,n,i,r,o,s,!0,l)),p}function zh(e,t,i,r){const o=[],s=e.image,a=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2;let u={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const h=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),g=d.reduce(p,0),m=l-f,_=c-g;let y=0,v=f,b=0,x=g,w=0,E=m,S=0,T=_;if(s.content&&r){const t=s.content,n=t[2]-t[0],i=t[3]-t[1];(s.textFitWidth||s.textFitHeight)&&(u=Du(e)),y=jh(h,0,t[0]),b=jh(d,0,t[1]),v=jh(h,t[0],t[2]),x=jh(d,t[1],t[3]),w=t[0]-y,S=t[1]-b,E=n-v,T=i-x}const C=u.x1,A=u.y1,P=u.x2-C,I=u.y2-A,M=(e,r,o,l)=>{const c=Vh(e.stretch-y,v,P,C),u=$h(e.fixed-w,E,e.stretch,f),h=Vh(r.stretch-b,x,I,A),d=$h(r.fixed-S,T,r.stretch,g),p=Vh(o.stretch-y,v,P,C),m=$h(o.fixed-w,E,o.stretch,f),_=Vh(l.stretch-b,x,I,A),M=$h(l.fixed-S,T,l.stretch,g),R=new n(c,h),k=new n(p,h),O=new n(p,_),L=new n(c,_),D=new n(u/a,d/a),F=new n(m/a,M/a),N=t*Math.PI/180;if(N){const e=Math.sin(N),t=Math.cos(N),n=[t,-e,e,t];R._matMult(n),k._matMult(n),L._matMult(n),O._matMult(n)}const B=e.stretch+e.fixed,z=r.stretch+r.fixed;return{tl:R,tr:k,bl:L,br:O,tex:{x:s.paddedRect.x+1+B,y:s.paddedRect.y+1+z,w:o.stretch+o.fixed-B,h:l.stretch+l.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:F,minFontScaleX:E/a/P,minFontScaleY:T/a/I,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const e=Uh(h,m,f),t=Uh(d,_,g);for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)o.push(M(i,t[e],r,t[e+1]))}}else o.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function jh(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function Uh(e,t,n){const i=[{fixed:-1,stretch:0}];for(const[t,n]of e){const e=i[i.length-1];i.push({fixed:t-e.stretch,stretch:e.stretch}),i.push({fixed:t-e.stretch,stretch:e.stretch+(n-t)})}return i.push({fixed:t+1,stretch:n}),i}function Vh(e,t,n,i){return e/t*n+i}function $h(e,t,n,i){return e-t*n/i}oo("Anchor",Rh);class Gh{constructor(e,t,i,r,o,s,a,l,c,u){var h;if(this.boxStartIndex=e.length,c){let e=s.top,t=s.bottom;const n=s.collisionPadding;n&&(e-=n[1],t+=n[3]);let i=t-e;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{const c=(null===(h=s.image)||void 0===h?void 0:h.content)&&(s.image.textFitWidth||s.image.textFitHeight)?Du(s):{x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};c.y1=c.y1*a-l[0],c.y2=c.y2*a+l[2],c.x1=c.x1*a-l[3],c.x2=c.x2*a+l[1];const d=s.collisionPadding;if(d&&(c.x1-=d[0]*a,c.y1-=d[1]*a,c.x2+=d[2]*a,c.y2+=d[3]*a),u){const e=new n(c.x1,c.y1),t=new n(c.x2,c.y1),i=new n(c.x1,c.y2),r=new n(c.x2,c.y2),o=u*Math.PI/180;e._rotate(o),t._rotate(o),i._rotate(o),r._rotate(o),c.x1=Math.min(e.x,t.x,i.x,r.x),c.x2=Math.max(e.x,t.x,i.x,r.x),c.y1=Math.min(e.y,t.y,i.y,r.y),c.y2=Math.max(e.y,t.y,i.y,r.y)}e.emplaceBack(t.x,t.y,c.x1,c.y1,c.x2,c.y2,i,r,o)}this.boxEndIndex=e.length}}class Wh{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1);const o=i+1;if(o<this.length&&n(t[o],t[i])<0&&(i=o),n(t[i],r)>=0)break;t[e]=t[i],e=i}t[e]=r}}function Hh(e,t=1,i=!1){const r=Sh.fromPoints(e[0]),o=Math.min(r.width(),r.height());let s=o/2;const a=new Wh([],Zh),{minX:l,minY:c,maxX:u,maxY:h}=r;if(0===o)return new n(l,c);for(let t=l;t<u;t+=o)for(let n=c;n<h;n+=o)a.push(new qh(t+s,n+s,s,e));let d=function(e){let t=0,n=0,i=0;const r=e[0];for(let e=0,o=r.length,s=o-1;e<o;s=e++){const o=r[e],a=r[s],l=o.x*a.y-a.x*o.y;n+=(o.x+a.x)*l,i+=(o.y+a.y)*l,t+=3*l}return new qh(n/t,i/t,0,e)}(e),p=a.length;for(;a.length;){const n=a.pop();(n.d>d.d||!d.d)&&(d=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=t||(s=n.h/2,a.push(new qh(n.p.x-s,n.p.y-s,s,e)),a.push(new qh(n.p.x+s,n.p.y-s,s,e)),a.push(new qh(n.p.x-s,n.p.y+s,s,e)),a.push(new qh(n.p.x+s,n.p.y+s,s,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Zh(e,t){return t.max-e.max}function qh(e,t,i,r){this.p=new n(e,t),this.h=i,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,Fa(e,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Xh;e.aE=void 0,(Xh=e.aE||(e.aE={}))[Xh.center=1]="center",Xh[Xh.left=2]="left",Xh[Xh.right=3]="right",Xh[Xh.top=4]="top",Xh[Xh.bottom=5]="bottom",Xh[Xh["top-left"]=6]="top-left",Xh[Xh["top-right"]=7]="top-right",Xh[Xh["bottom-left"]=8]="bottom-left",Xh[Xh["bottom-right"]=9]="bottom-right";const Yh=Number.POSITIVE_INFINITY;function Kh(e,t){return t[1]!==Yh?function(e,t,n){let i=0,r=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}return[i,r]}(e,t[0],t[1]):function(e,t){let n=0,i=0;t<0&&(t=0);const r=t/Math.SQRT2;switch(e){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-t;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}return[n,i]}(e,t[0])}function Jh(e,t,n){var i;const r=e.layout,o=null===(i=r.get("text-variable-anchor-offset"))||void 0===i?void 0:i.evaluate(t,{},n);if(o){const e=o.values,t=[];for(let n=0;n<e.length;n+=2){const i=t[n]=e[n],r=e[n+1].map((e=>e*Hc));i.startsWith("top")?r[1]-=7:i.startsWith("bottom")&&(r[1]+=7),t[n+1]=r}return new Ft(t)}const s=r.get("text-variable-anchor");if(s){let i;i=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[r.get("text-radial-offset").evaluate(t,{},n)*Hc,Yh]:r.get("text-offset").evaluate(t,{},n).map((e=>e*Hc));const o=[];for(const e of s)o.push(e,Kh(e,i));return new Ft(o)}return null}function Qh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ed(t,n,i,r,o,s,a,l,c,u,h,d){let p=s.textMaxSize.evaluate(n,{});void 0===p&&(p=a);const f=t.layers[0].layout,g=f.get("icon-offset").evaluate(n,{},h),m=nd(i.horizontal),_=a/24,y=t.tilePixelRatio*_,v=t.tilePixelRatio*p/24,b=t.tilePixelRatio*l,x=t.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*t.tilePixelRatio,E=function(e,t,n,i=1){const r=e.get("icon-padding").evaluate(t,{},n),o=r&&r.values;return[o[0]*i,o[1]*i,o[2]*i,o[3]*i]}(f,n,h,t.tilePixelRatio),S=f.get("text-max-angle")/180*Math.PI,T="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),C="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),A=f.get("symbol-placement"),P=x/2,M=f.get("icon-text-fit");let R;r&&"none"!==M&&(t.allowVerticalPlacement&&i.vertical&&(R=Fu(r,i.vertical,M,f.get("icon-text-fit-padding"),g,_)),m&&(r=Fu(r,m,M,f.get("icon-text-fit-padding"),g,_)));const k=h?d.line.getGranularityForZoomLevel(h.z):1,O=(l,d)=>{d.x<0||d.x>=I||d.y<0||d.y>=I||function(t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v,b,x,w,E,S,T){const C=t.addToLineVertexArray(n,i);let A,P,I,M,R=0,k=0,O=0,L=0,D=-1,F=-1;const N={};let B=na("");if(t.allowVerticalPlacement&&r.vertical){const e=l.layout.get("text-rotate").evaluate(x,{},S)+90;I=new Gh(c,n,u,h,d,r.vertical,p,f,g,e),a&&(M=new Gh(c,n,u,h,d,a,_,y,g,e))}if(o){const i=l.layout.get("icon-rotate").evaluate(x,{}),r="none"!==l.layout.get("icon-text-fit"),s=zh(o,i,E,r),p=a?zh(a,i,E,r):void 0;P=new Gh(c,n,u,h,d,o,_,y,!1,i),R=4*s.length;const f=t.iconSizeData;let g=null;"source"===f.kind?(g=[Nu*l.layout.get("icon-size").evaluate(x,{})],g[0]>Bu&&G(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(g=[Nu*w.compositeIconSizes[0].evaluate(x,{},S),Nu*w.compositeIconSizes[1].evaluate(x,{},S)],(g[0]>Bu||g[1]>Bu)&&G(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,g,b,v,x,e.ao.none,n,C.lineStartIndex,C.lineLength,-1,S),D=t.icon.placedSymbolArray.length-1,p&&(k=4*p.length,t.addSymbols(t.icon,p,g,b,v,x,e.ao.vertical,n,C.lineStartIndex,C.lineLength,-1,S),F=t.icon.placedSymbolArray.length-1)}const z=Object.keys(r.horizontal);for(const i of z){const o=r.horizontal[i];if(!A){B=na(o.text);const e=l.layout.get("text-rotate").evaluate(x,{},S);A=new Gh(c,n,u,h,d,o,p,f,g,e)}const a=1===o.positionedLines.length;if(O+=td(t,n,o,s,l,g,x,m,C,r.vertical?e.ao.horizontal:e.ao.horizontalOnly,a?z:[i],N,D,w,S),a)break}r.vertical&&(L+=td(t,n,r.vertical,s,l,g,x,m,C,e.ao.vertical,["vertical"],N,F,w,S));const j=A?A.boxStartIndex:t.collisionBoxArray.length,U=A?A.boxEndIndex:t.collisionBoxArray.length,V=I?I.boxStartIndex:t.collisionBoxArray.length,$=I?I.boxEndIndex:t.collisionBoxArray.length,W=P?P.boxStartIndex:t.collisionBoxArray.length,H=P?P.boxEndIndex:t.collisionBoxArray.length,Z=M?M.boxStartIndex:t.collisionBoxArray.length,q=M?M.boxEndIndex:t.collisionBoxArray.length;let X=-1;const Y=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;X=Y(A,X),X=Y(I,X),X=Y(P,X),X=Y(M,X);const K=X>-1?1:0;K&&(X*=T/Hc),t.glyphOffsetArray.length>=Zu.MAX_GLYPHS&&G("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey);const J=Jh(l,x,S),[Q,ee]=function(t,n){const i=t.length,r=null==n?void 0:n.values;if((null==r?void 0:r.length)>0)for(let n=0;n<r.length;n+=2){const i=r[n+1];t.emplaceBack(e.aE[r[n]],i[0],i[1])}return[i,t.length]}(t.textAnchorOffsets,J);t.symbolInstances.emplaceBack(n.x,n.y,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical||-1,D,F,B,j,U,V,$,W,H,Z,q,u,O,L,R,k,K,0,p,X,Q,ee)}(t,d,l,i,r,o,R,t.layers[0],t.collisionBoxArray,n.index,n.sourceLayerIndex,t.index,y,[w,w,w,w],T,c,b,E,C,g,n,s,u,h,a)};if("line"===A)for(const e of Mh(n.geometry,0,0,I,I)){const n=Xl(e,k),o=Nh(n,x,S,i.vertical||m,r,24,v,t.overscaling,I);for(const e of o)m&&id(t,m.text,P,e)||O(n,e)}else if("line-center"===A){for(const e of n.geometry)if(e.length>1){const t=Xl(e,k),n=Fh(t,S,i.vertical||m,r,24,v);n&&O(t,n)}}else if("Polygon"===n.type)for(const e of Qn(n.geometry,0)){const t=Hh(e,16);O(Xl(e[0],k,!0),new Rh(t.x,t.y,0))}else if("LineString"===n.type)for(const e of n.geometry){const t=Xl(e,k);O(t,new Rh(t[0].x,t[0].y,0))}else if("Point"===n.type)for(const e of n.geometry)for(const t of e)O([t],new Rh(t.x,t.y,0))}function td(e,t,i,r,o,s,a,l,c,u,h,d,p,f,g){const m=function(e,t,i,r,o,s,a,l){const c=r.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const e of t.positionedLines)for(const r of e.positionedGlyphs){if(!r.rect)continue;const s=r.rect||{};let h=4,d=!0,p=1,f=0;const g=(o||l)&&r.vertical,m=r.metrics.advance*r.scale/2;if(l&&t.verticalizable&&(f=e.lineOffset/2-(r.imageName?-(Hc-r.metrics.width*r.scale)/2:(r.scale-1)*Hc)),r.imageName){const e=a[r.imageName];d=e.sdf,p=e.pixelRatio,h=1/p}const _=o?[r.x+m,r.y]:[0,0];let y=o?[0,0]:[r.x+m+i[0],r.y+i[1]-f],v=[0,0];g&&(v=y,y=[0,0]);const b=r.metrics.isDoubleResolution?2:1,x=(r.metrics.left-h)*r.scale-m+y[0],w=(-r.metrics.top-h)*r.scale+y[1],E=x+s.w/b*r.scale/p,S=w+s.h/b*r.scale/p,T=new n(x,w),C=new n(E,w),A=new n(x,S),P=new n(E,S);if(g){const e=new n(-m,m- -17),t=-Math.PI/2,i=12-m,o=new n(22-i,-(r.imageName?i:0)),s=new n(...v);T._rotateAround(t,e)._add(o)._add(s),C._rotateAround(t,e)._add(o)._add(s),A._rotateAround(t,e)._add(o)._add(s),P._rotateAround(t,e)._add(o)._add(s)}if(c){const e=Math.sin(c),t=Math.cos(c),n=[t,-e,e,t];T._matMult(n),C._matMult(n),A._matMult(n),P._matMult(n)}const I=new n(0,0),M=new n(0,0);u.push({tl:T,tr:C,bl:A,br:P,tex:s,writingMode:t.writingMode,glyphOffset:_,sectionIndex:r.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,o,s,a,r,e.allowVerticalPlacement),_=e.textSizeData;let y=null;"source"===_.kind?(y=[Nu*o.layout.get("text-size").evaluate(a,{})],y[0]>Bu&&G(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===_.kind&&(y=[Nu*f.compositeTextSizes[0].evaluate(a,{},g),Nu*f.compositeTextSizes[1].evaluate(a,{},g)],(y[0]>Bu||y[1]>Bu)&&G(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,m,y,l,s,a,u,t,c.lineStartIndex,c.lineLength,p,g);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*m.length}function nd(e){for(const t in e)return e[t];return null}function id(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}const rd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class od{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const r=rd[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new od(s,o,r,e)}constructor(e,t=64,n=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=rd.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return sd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)ud(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];ud(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function sd(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;ad(e,t,s,i,r,o),sd(e,t,n,i,s-1,1-o),sd(e,t,n,s+1,r,1-o)}function ad(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);ad(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(ld(e,t,i,n),t[2*r+o]>s&&ld(e,t,i,r);a<l;){for(ld(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?ld(e,t,i,l):(l++,ld(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function ld(e,t,n,i){cd(e,n,i),cd(t,2*n,2*i),cd(t,2*n+1,2*i+1)}function cd(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function ud(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}var hd;e.cx=void 0,(hd=e.cx||(e.cx={})).create="create",hd.load="load",hd.fullLoad="fullLoad";let dd=null,pd=[];const fd=1e3/60,gd="loadTime",md="fullLoadTime",_d={mark(e){performance.mark(e)},frame(e){const t=e;null!=dd&&pd.push(t-dd),dd=t},clearMetrics(){dd=null,pd=[],performance.clearMeasures(gd),performance.clearMeasures(md);for(const t in e.cx)performance.clearMarks(e.cx[t])},getPerformanceMetrics(){performance.measure(gd,e.cx.create,e.cx.load),performance.measure(md,e.cx.create,e.cx.fullLoad);const t=performance.getEntriesByName(gd)[0].duration,n=performance.getEntriesByName(md)[0].duration,i=pd.length,r=1/(pd.reduce(((e,t)=>e+t),0)/i/1e3),o=pd.filter((e=>e>fd)).reduce(((e,t)=>e+(t-fd)/fd),0);return{loadTime:t,fullLoadTime:n,fps:r,percentDroppedFrames:o/(i+o)*100,totalFrames:i}}};e.$=I,e.A=p,e.B=function([e,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(n),y:e*Math.sin(t)*Math.sin(n),z:e*Math.cos(n)}},e.C=fn,e.D=Fo,e.E=_e,e.F=Ao,e.G=Qr,e.H=function(e){if(null==Z){const t=e.navigator?e.navigator.userAgent:null;Z=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Z},e.I=du,e.J=class{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new sh((()=>this.process())),this.subscription=Q(this.target,"message",(e=>this.receive(e)),!1),this.globalScope=H(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(e,t){return new Promise(((n,i)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10),o=t?Q(t.signal,"abort",(()=>{null==o||o.unsubscribe(),delete this.resolveRejects[r];const t={id:r,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(t)}),ah):null;this.resolveRejects[r]={resolve:e=>{null==o||o.unsubscribe(),n(e)},reject:e=>{null==o||o.unsubscribe(),i(e)}};const s=[],a=Object.assign(Object.assign({},e),{id:r,sourceMapId:this.mapId,origin:location.origin,data:co(e.data,s)});this.target.postMessage(a,{transfer:s})}))}receive(e){const t=e.data,n=t.id;if(!("file://"!==t.origin&&"file://"!==location.origin&&"resource://android"!==t.origin&&"resource://android"!==location.origin&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[n];const e=this.abortControllers[n];return delete this.abortControllers[n],void(e&&e.abort())}if(H(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,n){return t(this,void 0,void 0,(function*(){if("<response>"===n.type){const t=this.resolveRejects[e];if(delete this.resolveRejects[e],!t)return;return void(n.error?t.reject(uo(n.error)):t.resolve(uo(n.data)))}if(!this.messageHandlers[n.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const t=uo(n.data),i=new AbortController;this.abortControllers[e]=i;try{const r=yield this.messageHandlers[n.type](n.sourceMapId,t,i);this.completeTask(e,null,r)}catch(t){this.completeTask(e,t)}}))}completeTask(e,t,n){const i=[];delete this.abortControllers[e];const r={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?co(t):null,data:co(n,i)};this.target.postMessage(r,{transfer:i})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},e.K=le,e.L=function(){var e=new p(16);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.M=function(e,t,n){var i,r,o,s,a,l,c,u,h,d,p,f,g=n[0],m=n[1],_=n[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*_+t[12],e[13]=t[1]*g+t[5]*m+t[9]*_+t[13],e[14]=t[2]*g+t[6]*m+t[10]*_+t[14],e[15]=t[3]*g+t[7]*m+t[11]*_+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*g+a*m+h*_+t[12],e[13]=r*g+l*m+d*_+t[13],e[14]=o*g+c*m+p*_+t[14],e[15]=s*g+u*m+f*_+t[15]),e},e.N=function(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.O=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],_=t[14],y=t[15],v=n[0],b=n[1],x=n[2],w=n[3];return e[0]=v*i+b*a+x*h+w*g,e[1]=v*r+b*l+x*d+w*m,e[2]=v*o+b*c+x*p+w*_,e[3]=v*s+b*u+x*f+w*y,e[4]=(v=n[4])*i+(b=n[5])*a+(x=n[6])*h+(w=n[7])*g,e[5]=v*r+b*l+x*d+w*m,e[6]=v*o+b*c+x*p+w*_,e[7]=v*s+b*u+x*f+w*y,e[8]=(v=n[8])*i+(b=n[9])*a+(x=n[10])*h+(w=n[11])*g,e[9]=v*r+b*l+x*d+w*m,e[10]=v*o+b*c+x*p+w*_,e[11]=v*s+b*u+x*f+w*y,e[12]=(v=n[12])*i+(b=n[13])*a+(x=n[14])*h+(w=n[15])*g,e[13]=v*r+b*l+x*d+w*m,e[14]=v*o+b*c+x*p+w*_,e[15]=v*s+b*u+x*f+w*y,e},e.P=n,e.Q=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.R=tl,e.S=ch,e.T=ul,e.U=ph,e.V=dh,e.W=u,e.X=h,e.Y=Y,e.Z=xh,e._=t,e.a=se,e.a$=E,e.a0=function(e,t){var n,i,r,o;if(!e)return null!=t?t:{};if(!t)return e;const s=Object.assign({},e);if(t.removeAll&&(s.removeAll=!0),t.remove){const e=new Set(s.remove?s.remove.concat(t.remove):t.remove);s.remove=Array.from(e.values())}if(t.add){const e=s.add?s.add.concat(t.add):t.add,n=new Map(e.map((e=>[e.id,e])));s.add=Array.from(n.values())}if(t.update){const e=new Map(null===(n=s.update)||void 0===n?void 0:n.map((e=>[e.id,e])));for(const n of t.update){const t=null!==(i=e.get(n.id))&&void 0!==i?i:{id:n.id};n.newGeometry&&(t.newGeometry=n.newGeometry),n.addOrUpdateProperties&&(t.addOrUpdateProperties=(null!==(r=t.addOrUpdateProperties)&&void 0!==r?r:[]).concat(n.addOrUpdateProperties)),n.removeProperties&&(t.removeProperties=(null!==(o=t.removeProperties)&&void 0!==o?o:[]).concat(n.removeProperties)),n.removeAllProperties&&(t.removeAllProperties=!0),e.set(n.id,t)}s.update=Array.from(e.values())}return s},e.a1=_h,e.a2=Sh,e.a3=25,e.a4=vh,e.a5=e=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const n of e){const e=window.document.createElement("source");de(n)||(t.crossOrigin="Anonymous"),e.src=n,t.appendChild(e)}}))},e.a6=Me,e.a7=function(){return z++},e.a8=vs,e.a9=Zu,e.aA=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return[t,n,i,r]},e.aB=Hc,e.aC=M,e.aD=function(e,t,n,i,r=!1){if(!n[0]&&!n[1])return[0,0];const o=r?"map"===i?-e.bearingInRadians:0:"viewport"===i?e.bearingInRadians:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}return[r?n[0]:M(t,n[0],e.zoom),r?n[1]:M(t,n[1],e.zoom)]},e.aF=ju,e.aG=Qh,e.aH=Au,e.aI=od,e.aJ=Zo,e.aK=Gl,e.aL=Ms,e.aM=Hs,e.aN=Vs,e.aO=N,e.aP=te,e.aQ=mh,e.aR=b,e.aS=v,e.aT=function(e){var t=new p(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.aU=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},e.aV=function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},e.aW=x,e.aX=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.aY=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.aZ=_,e.a_=function(e,t,n){const i=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return 0===i?null:(-(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])-n[3])/i},e.aa=ur,e.ab=Ta,e.ac=Ch,e.ad=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.ae=ee,e.af=function(e){return Math.pow(2,e)},e.ag=g,e.ah=F,e.ai=85.051129,e.aj=fh,e.ak=function(e){return Math.log(e)/Math.LN2},e.al=function(e){var t=e[0],n=e[1];return t*t+n*n},e.am=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n},e.an=function(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?F(dn.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?i=fn.number(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:i}},e.ap=function(e,{uSize:t,uSizeT:n},{lowerSize:i,upperSize:r}){return"source"===e.kind?i/Nu:"composite"===e.kind?fn.number(i/Nu,r/Nu,n):t},e.aq=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],_=t[15],y=n*a-i*s,v=n*l-r*s,b=n*c-o*s,x=i*l-r*a,w=i*c-o*a,E=r*c-o*l,S=u*g-h*f,T=u*m-d*f,C=u*_-p*f,A=h*m-d*g,P=h*_-p*g,I=d*_-p*m,M=y*I-v*P+b*A+x*C-w*T+E*S;return M?(e[0]=(a*I-l*P+c*A)*(M=1/M),e[1]=(r*P-i*I-o*A)*M,e[2]=(g*E-m*w+_*x)*M,e[3]=(d*w-h*E-p*x)*M,e[4]=(l*C-s*I-c*T)*M,e[5]=(n*I-r*C+o*T)*M,e[6]=(m*b-f*E-_*v)*M,e[7]=(u*E-d*b+p*v)*M,e[8]=(s*P-a*C+c*S)*M,e[9]=(i*C-n*P-o*S)*M,e[10]=(f*w-g*b+_*y)*M,e[11]=(h*b-u*w-p*y)*M,e[12]=(a*T-s*A-l*S)*M,e[13]=(n*A-i*T+r*S)*M,e[14]=(g*v-f*x-m*y)*M,e[15]=(u*x-h*v+d*y)*M,e):null},e.ar=A,e.as=function(e){return Math.hypot(e[0],e[1])},e.at=function(e){return e[0]=0,e[1]=0,e},e.au=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},e.av=$u,e.aw=S,e.ax=function(e,t,i,r){const o=t.y-e.y,s=t.x-e.x,a=r.y-i.y,l=r.x-i.x,c=a*s-l*o;if(0===c)return null;const u=(l*(e.y-i.y)-a*(e.x-i.x))/c;return new n(e.x+u*s,e.y+u*o)},e.ay=Mh,e.az=Ia,e.b=q,e.b$=class extends as{},e.b0=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.b1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},e.b2=bh,e.b3=wh,e.b4=function(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e},e.b5=function(e){var t=new p(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.b6=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e},e.b7=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e},e.b8=function(){const e=new Float32Array(16);return g(e),e},e.b9=function(){const e=new Float64Array(16);return g(e),e},e.bA=function(e,t){const n=R(e,360),i=R(t,360),r=i-n,o=i>n?r-360:r+360;return Math.abs(r)<Math.abs(o)?r:o},e.bB=function(e){return e[0]=0,e[1]=0,e[2]=0,e},e.bC=function(e,t,n,i){const r=Math.sqrt(e*e+t*t),o=Math.sqrt(n*n+i*i);e/=r,t/=r,n/=o,i/=o;const s=Math.acos(e*n+t*i);return-t*n+e*i>0?s:-s},e.bD=function(e,t){const n=R(e,2*Math.PI),i=R(t,2*Math.PI);return Math.min(Math.abs(n-i),Math.abs(n-i+2*Math.PI),Math.abs(n-i-2*Math.PI))},e.bE=function(){const e={},t=ye.$version;for(const n in ye.$root){const i=ye.$root[n];if(i.required){let r=null;r="version"===n?t:"array"===i.type?[]:{},null!=r&&(e[n]=r)}}return e},e.bF=ho,e.bG=ue,e.bH=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],n[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const i in t)if(!e(t[i],n[i]))return!1;return!0}return t===n},e.bI=function(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=be(e[n],t[e[n].ref]));return e},e.bJ=function(e){if("custom"===e.type)return new oh(e);switch(e.type){case"background":return new th(e);case"circle":return new Ha(e);case"color-relief":return new pl(e);case"fill":return new ic(e);case"fill-extrusion":return new wc(e);case"heatmap":return new rl(e);case"hillshade":return new al(e);case"line":return new Nc(e);case"raster":return new rh(e);case"symbol":return new Ju(e)}},e.bK=V,e.bL=function(e,t){if(!e)return[{command:"setStyle",args:[t]}];let n=[];try{if(!xe(e.version,t.version))return[{command:"setStyle",args:[t]}];xe(e.center,t.center)||n.push({command:"setCenter",args:[t.center]}),xe(e.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),xe(e.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),xe(e.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),xe(e.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),xe(e.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),xe(e.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),xe(e.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),xe(e.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),xe(e.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),xe(e.light,t.light)||n.push({command:"setLight",args:[t.light]}),xe(e.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),xe(e.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),xe(e.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const i={},r=[];!function(e,t,n,i){let r;for(r in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)||Se(r,n,i));for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?xe(e[r],t[r])||("geojson"===e[r].type&&"geojson"===t[r].type&&Ce(e,t,r)?we(n,{command:"setGeoJSONSourceData",args:[r,t[r].data]}):Te(r,t,n,i)):Ee(r,t,n))}(e.sources,t.sources,r,i);const o=[];e.layers&&e.layers.forEach((e=>{"source"in e&&i[e.source]?n.push({command:"removeLayer",args:[e.id]}):o.push(e)})),n=n.concat(r),function(e,t,n){t=t||[];const i=(e=e||[]).map(Pe),r=t.map(Pe),o=e.reduce(Ie,{}),s=t.reduce(Ie,{}),a=i.slice(),l=Object.create(null);let c,u,h,d,p;for(let e=0,t=0;e<i.length;e++)c=i[e],Object.prototype.hasOwnProperty.call(s,c)?t++:(we(n,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,t),1));for(let e=0,t=0;e<r.length;e++)c=r[r.length-1-e],a[a.length-1-e]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(we(n,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-t),1)):t++,d=a[a.length-e],we(n,{command:"addLayer",args:[s[c],d]}),a.splice(a.length-e,0,c),l[c]=!0);for(let e=0;e<r.length;e++)if(c=r[e],u=o[c],h=s[c],!l[c]&&!xe(u,h))if(xe(u.source,h.source)&&xe(u["source-layer"],h["source-layer"])&&xe(u.type,h.type)){for(p in Ae(u.layout,h.layout,n,c,null,"setLayoutProperty"),Ae(u.paint,h.paint,n,c,null,"setPaintProperty"),xe(u.filter,h.filter)||we(n,{command:"setFilter",args:[c,h.filter]}),xe(u.minzoom,h.minzoom)&&xe(u.maxzoom,h.maxzoom)||we(n,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ae(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):xe(u[p],h[p])||we(n,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Ae(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):xe(u[p],h[p])||we(n,{command:"setLayerProperty",args:[c,p,h[p]]}))}else we(n,{command:"removeLayer",args:[c]}),d=a[a.lastIndexOf(c)+1],we(n,{command:"addLayer",args:[h,d]})}(o,t.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:"setStyle",args:[t]}]}return n},e.bM=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.bN=j,e.bO=U,e.bP=class extends aa{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.bQ=ua,e.bR=class extends aa{constructor(e,t){super(e,t),this.current=ha}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.bS=ca,e.bT=class extends aa{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.bU=class extends aa{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.bV=f,e.bW=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.bX=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e},e.bY=function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e},e.bZ=class extends aa{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(4*e.length);for(let n=0;n<e.length;n++)t[4*n]=e[n].r,t[4*n+1]=e[n].g,t[4*n+2]=e[n].b,t[4*n+3]=e[n].a;this.gl.uniform4fv(this.location,t)}}},e.b_=class extends aa{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(e);this.gl.uniform1fv(this.location,t)}}},e.ba=function(){return new Float64Array(16)},e.bb=function(e,t,n){const i=new Float64Array(4);return C(i,e,t-90,n),i},e.bc=function(e,t,n,i){var r,o,s,a,l,c=t[0],u=t[1],h=t[2],p=t[3],f=n[0],g=n[1],m=n[2],_=n[3];return(o=c*f+u*g+h*m+p*_)<0&&(o=-o,f=-f,g=-g,m=-m,_=-_),1-o>d?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(a=1-i,l=i),e[0]=a*c+l*f,e[1]=a*u+l*g,e[2]=a*h+l*m,e[3]=a*p+l*_,e},e.bd=function(e){const t=new Float64Array(9);var n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v;h=(r=(i=e)[0])*(l=r+r),d=(o=i[1])*l,f=(s=i[2])*l,g=s*(c=o+o),_=(a=i[3])*l,y=a*c,v=a*(u=s+s),(n=t)[0]=1-(p=o*c)-(m=s*u),n[3]=d-v,n[6]=f+y,n[1]=d+v,n[4]=1-h-m,n[7]=g-_,n[2]=f-y,n[5]=g+_,n[8]=1-h-p;const b=te(-Math.asin(F(t[2],-1,1)));let x,w;return Math.hypot(t[5],t[8])<.001?(x=0,w=-te(Math.atan2(t[3],t[4]))):(x=te(0===t[5]&&0===t[8]?0:Math.atan2(t[5],t[8])),w=te(0===t[1]&&0===t[0]?0:Math.atan2(t[1],t[0]))),{roll:x,pitch:b+90,bearing:w}},e.be=function(e,t){return e.roll==t.roll&&e.pitch==t.pitch&&e.bearing==t.bearing},e.bf=Ct,e.bg=la,e.bh=Wl,e.bi=Hl,e.bj=$l,e.bk=k,e.bl=O,e.bm=Bt,e.bn=function(e,t,n,i,r){return k(i,r,F((e-t)/(n-t),0,1))},e.bo=R,e.bp=function(){return new Float64Array(3)},e.bq=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},e.br=C,e.bs=function(e,t,n){var i=n[0],r=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=r*h-o*u,p=o*c-i*h,f=i*u-r*c,g=2*n[3];return u*=g,h*=g,p*=2,f*=2,e[0]=s+(c*=g)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},e.bt=function(e,t,n){const i=(r=[e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((u=r[8])*(s=r[4])-(a=r[5])*(c=r[7]))+r[1]*(-u*(o=r[3])+a*(l=r[6]))+r[2]*(c*o-s*l);var r,o,s,a,l,c,u;if(0===i)return null;const h=x([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),d=x([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),p=x([],[e[0],e[1],e[2]],[t[0],t[1],t[2]]),f=b([],h,-e[3]);return v(f,f,b([],d,-t[3])),v(f,f,b([],p,-n[3])),b(f,f,1/i),f},e.bu=lh,e.bv=function(){return new Float64Array(4)},e.bw=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},e.bx=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},e.by=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},e.bz=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r,e},e.c=oe,e.c0=$c,e.c1=class extends cs{},e.c2=il,e.c3=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.c4=nl,e.c5=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e},e.c6=class extends Ko{},e.c7=class extends ms{},e.c8=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},e.c9=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],m=e[13],_=e[14],y=e[15],v=t[0],b=t[1],x=t[2],w=t[3],E=t[4],S=t[5],T=t[6],C=t[7],A=t[8],P=t[9],I=t[10],M=t[11],R=t[12],k=t[13],O=t[14],L=t[15];return Math.abs(n-v)<=d*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-b)<=d*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(r-x)<=d*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(o-w)<=d*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-E)<=d*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-S)<=d*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-T)<=d*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-C)<=d*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-A)<=d*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-P)<=d*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(p-I)<=d*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-M)<=d*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-R)<=d*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-k)<=d*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(_-O)<=d*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(y-L)<=d*Math.max(1,Math.abs(y),Math.abs(L))},e.cA=function(e,t){se.REGISTERED_PROTOCOLS[e]=t},e.cB=function(e){delete se.REGISTERED_PROTOCOLS[e]},e.cC=function(e,t){const n={};for(let i=0;i<e.length;i++){const r=t&&t[e[i].id]||vr(e[i]);t&&(t[e[i].id]=r);let o=n[r];o||(o=n[r]=[]),o.push(e[i])}const i=[];for(const e in n)i.push(n[e]);return i},e.cD=oo,e.cE=Th,e.cF=Ah,e.cG=pu,e.cH=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=I/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;const n=t.bucket.layers[0],i=n.layout,r=n._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new Ao(t.bucket.zoom+1),t.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Ao(t.bucket.zoom+1),t.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Ao(18))};if("composite"===t.bucket.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Ao(e),t.canonical),r["text-size"].possiblyEvaluate(new Ao(n),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Ao(e),t.canonical),r["icon-size"].possiblyEvaluate(new Ao(n),t.canonical)]}const s=i.get("text-line-height")*Hc,a="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),l=i.get("text-keep-upright"),c=i.get("text-size");for(const r of t.bucket.features){const u=i.get("text-font").evaluate(r,{},t.canonical).join(","),h=c.evaluate(r,{},t.canonical),d=o.layoutTextSize.evaluate(r,{},t.canonical),p=o.layoutIconSize.evaluate(r,{},t.canonical),f={horizontal:{},vertical:void 0},g=r.text;let m,_=[0,0];if(g){const o=g.toString(),c=i.get("text-letter-spacing").evaluate(r,{},t.canonical)*Hc,p=go(o)?c:0,m=i.get("text-anchor").evaluate(r,{},t.canonical),y=Jh(n,r,t.canonical);if(!y){const e=i.get("text-radial-offset").evaluate(r,{},t.canonical);_=e?Kh(m,[e*Hc,Yh]):i.get("text-offset").evaluate(r,{},t.canonical).map((e=>e*Hc))}let v=a?"center":i.get("text-justify").evaluate(r,{},t.canonical);const b="point"===i.get("symbol-placement")?i.get("text-max-width").evaluate(r,{},t.canonical)*Hc:1/0,x=()=>{t.bucket.allowVerticalPlacement&&fo(o)&&(f.vertical=_u(g,t.glyphMap,t.glyphPositions,t.imagePositions,u,b,s,m,"left",p,_,e.ao.vertical,!0,d,h))};if(!a&&y){const n=new Set;if("auto"===v)for(let e=0;e<y.values.length;e+=2)n.add(Qh(y.values[e]));else n.add(v);let i=!1;for(const r of n)if(!f.horizontal[r])if(i)f.horizontal[r]=f.horizontal[0];else{const n=_u(g,t.glyphMap,t.glyphPositions,t.imagePositions,u,b,s,"center",r,p,_,e.ao.horizontal,!1,d,h);n&&(f.horizontal[r]=n,i=1===n.positionedLines.length)}x()}else{"auto"===v&&(v=Qh(m));const n=_u(g,t.glyphMap,t.glyphPositions,t.imagePositions,u,b,s,m,v,p,_,e.ao.horizontal,!1,d,h);n&&(f.horizontal[v]=n),x(),fo(o)&&a&&l&&(f.vertical=_u(g,t.glyphMap,t.glyphPositions,t.imagePositions,u,b,s,m,v,p,_,e.ao.vertical,!1,d,h))}}let y=!1;if(r.icon&&r.icon.name){const e=t.imageMap[r.icon.name];e&&(m=Lu(t.imagePositions[r.icon.name],i.get("icon-offset").evaluate(r,{},t.canonical),i.get("icon-anchor").evaluate(r,{},t.canonical)),y=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=y:t.bucket.sdfIcons!==y&&G("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}const v=nd(f.horizontal)||f.vertical;t.bucket.iconsInText=!!v&&v.iconsInText,(v||m)&&ed(t.bucket,r,f,m,t.imageMap,o,d,p,_,y,t.canonical,t.subdivisionGranularity)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.cI=Rc,e.cJ=Ql,e.cK=mc,e.cL=dc,e.cM=Yc,e.cN=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.cO=function(e,n,i,r,o){return t(this,void 0,void 0,(function*(){if(h())try{return yield Y(e,n,i,r,o)}catch(e){}return function(e,t,n,i,r){const o=e.width,s=e.height;K&&J||(K=new OffscreenCanvas(o,s),J=K.getContext("2d",{willReadFrequently:!0})),K.width=o,K.height=s,J.drawImage(e,0,0,o,s);const a=J.getImageData(t,n,i,r);return J.clearRect(0,0,o,s),a.data}(e,n,i,r,o)}))},e.cP=hl,e.cQ=i,e.cR=uc,e.cS=ac,e.cT=tr,e.cU=function(e,t){const n=new Map;if(null==e);else if("Feature"===e.type)n.set(Eh(e,t),e);else for(const i of e.features)n.set(Eh(i,t),i);return n},e.cV=function(e,t){if(null==e)return!0;if("Feature"===e.type)return null!=Eh(e,t);if("FeatureCollection"===e.type){const n=new Set;for(const i of e.features){const e=Eh(i,t);if(null==e)return!1;if(n.has(e))return!1;n.add(e)}return!0}return!1},e.cW=function(e,t,n){var i,r,o,s;if(t.removeAll&&e.clear(),t.remove)for(const n of t.remove)e.delete(n);if(t.add)for(const i of t.add){const t=Eh(i,n);null!=t&&e.set(t,i)}if(t.update)for(const n of t.update){let t=e.get(n.id);if(null==t)continue;const a=!n.removeAllProperties&&((null===(i=n.removeProperties)||void 0===i?void 0:i.length)>0||(null===(r=n.addOrUpdateProperties)||void 0===r?void 0:r.length)>0);if((n.newGeometry||n.removeAllProperties||a)&&(t=Object.assign({},t),e.set(n.id,t),a&&(t.properties=Object.assign({},t.properties))),n.newGeometry&&(t.geometry=n.newGeometry),n.removeAllProperties)t.properties={};else if((null===(o=n.removeProperties)||void 0===o?void 0:o.length)>0)for(const e of n.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if((null===(s=n.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:e,value:i}of n.addOrUpdateProperties)t.properties[e]=i}},e.cX=Co,e.ca=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.cb=e=>"symbol"===e.type,e.cc=e=>"circle"===e.type,e.cd=e=>"heatmap"===e.type,e.ce=e=>"line"===e.type,e.cf=e=>"fill"===e.type,e.cg=e=>"fill-extrusion"===e.type,e.ch=e=>"hillshade"===e.type,e.ci=e=>"color-relief"===e.type,e.cj=e=>"raster"===e.type,e.ck=e=>"background"===e.type,e.cl=e=>"custom"===e.type,e.cm=L,e.cn=function(e,t,n){const i=P(t.x-n.x,t.y-n.y),r=P(e.x-n.x,e.y-n.y);var o,s;return te(Math.atan2(i[0]*r[1]-i[1]*r[0],(o=i)[0]*(s=r)[0]+o[1]*s[1]))},e.co=D,e.cp=function(e,t){return ie[t]&&(e instanceof MouseEvent||e instanceof WheelEvent)},e.cq=function(e,t){return ne[t]&&"touches"in e},e.cr=function(e){return ne[e]||ie[e]},e.cs=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},e.ct=function(e,t){const{x:n,y:i}=_h.fromLngLat(t);return!(e<0||e>25||i<0||i>=1||n<0||n>=1)},e.cu=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.cv=class extends Yo{},e.cw=_d,e.cy=function(e){return e.message===re},e.cz=ce,e.d=de,e.e=B,e.f=e=>t(void 0,void 0,void 0,(function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(t)}catch(e){throw new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),e.g=ae,e.h=e=>new Promise(((t,n)=>{const i=new Image;i.onload=()=>{t(i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame((()=>{i.src=X}))},i.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?URL.createObjectURL(r):X})),e.i=H,e.j=(e,t)=>he(B(e,{type:"json"}),t),e.k=me,e.l=ge,e.m=he,e.n=(e,t)=>he(B(e,{type:"arrayBuffer"}),t),e.o=function(e){return new Yc(e).readFields(lu,[])},e.p=hu,e.q=el,e.r=Uo,e.s=Q,e.t=Mo,e.u=po,e.v=ye,e.w=G,e.x=Jr,e.y=no,e.z=Kr})),n("worker",0,(function(e){class t{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.bJ(n);t._featureFilter=e.aa(t.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const i=e.cC(Object.values(this._layerConfigs),this.keyCache);for(const e of i){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}class n{constructor(t){const n={},i=[];for(const e in t){const r=t[e],o=n[e]={};for(const e in r){const t=r[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};i.push(n),o[e]={rect:n,metrics:t.metrics}}}const{w:r,h:o}=e.p(i),s=new e.q({width:r||1,height:o||1});for(const i in t){const r=t[i];for(const t in r){const o=r[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=n[i][t].rect;e.q.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=n}}e.cD("GlyphAtlas",n);class i{constructor(t){this.tileID=new e.Z(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[],this.globalState=t.globalState}parse(t,i,o,s,a){return e._(this,void 0,void 0,(function*(){this.status="parsing",this.data=t,this.collisionBoxArray=new e.a8;const l=new e.cE(Object.keys(t.layers).sort()),c=new e.cF(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o,subdivisionGranularity:a},d=i.familiesBySource[this.source];for(const n in d){const i=t.layers[n];if(!i)continue;1===i.version&&e.w(`Vector tile source "${this.source}" layer "${n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(n),a=[];for(let e=0;e<i.length;e++){const t=i.feature(e),r=c.getId(t,n);a.push({feature:t,id:r,index:e,sourceLayerIndex:s})}for(const t of d[n]){const n=t[0];n.source!==this.source&&e.w(`layer.source = ${n.source} does not equal this.source = ${this.source}`),n.minzoom&&this.zoom<Math.floor(n.minzoom)||n.maxzoom&&this.zoom>=n.maxzoom||"none"!==n.visibility&&(r(t,this.zoom,o),(u[n.id]=n.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source,globalState:this.globalState})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(t.map((e=>e.id))))}}const p=e.bN(h.glyphDependencies,(e=>Object.keys(e).map(Number)));this.inFlightDependencies.forEach((e=>null==e?void 0:e.abort())),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const e=new AbortController;this.inFlightDependencies.push(e),f=s.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const g=Object.keys(h.iconDependencies);let m=Promise.resolve({});if(g.length){const e=new AbortController;this.inFlightDependencies.push(e),m=s.sendAsync({type:"GI",data:{icons:g,source:this.source,tileID:this.tileID,type:"icons"}},e)}const _=Object.keys(h.patternDependencies);let y=Promise.resolve({});if(_.length){const e=new AbortController;this.inFlightDependencies.push(e),y=s.sendAsync({type:"GI",data:{icons:_,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const[v,b,x]=yield Promise.all([f,m,y]),w=new n(v),E=new e.cG(b,x);for(const t in u){const n=u[t];n instanceof e.a9?(r(n.layers,this.zoom,o),e.cH({bucket:n,glyphMap:v,glyphPositions:w.positions,imageMap:b,imagePositions:E.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):n.hasPattern&&(n instanceof e.cI||n instanceof e.cJ||n instanceof e.cK)&&(r(n.layers,this.zoom,o),n.addFeatures(h,this.tileID.canonical,E.patternPositions))}return this.status="done",{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:w.image,imageAtlas:E,glyphMap:this.returnDependencies?v:null,iconMap:this.returnDependencies?b:null,glyphPositions:this.returnDependencies?w.positions:null}}))}}function r(t,n,i){const r=new e.F(n);for(const e of t)e.recalculate(r,i)}class o{constructor(e,t,n){this.actor=e,this.layerIndex=t,this.availableImages=n,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(t,n){return e._(this,void 0,void 0,(function*(){const i=yield e.n(t.request,n);try{return{vectorTile:new e.cL(new e.cM(i.data)),rawData:i.data,cacheControl:i.cacheControl,expires:i.expires}}catch(e){const n=new Uint8Array(i.data);let r=`Unable to parse the tile at ${t.request.url}, `;throw r+=31===n[0]&&139===n[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${e.message}`,new Error(r)}}))}loadTile(t){return e._(this,void 0,void 0,(function*(){const n=t.uid,r=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cN(t.request),o=new i(t);this.loading[n]=o;const s=new AbortController;o.abort=s;try{const i=yield this.loadVectorTile(t,s);if(delete this.loading[n],!i)return null;const a=i.rawData,l={};i.expires&&(l.expires=i.expires),i.cacheControl&&(l.cacheControl=i.cacheControl);const c={};if(r){const e=r.finish();e&&(c.resourceTiming=JSON.parse(JSON.stringify(e)))}o.vectorTile=i.vectorTile;const u=o.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);this.loaded[n]=o,this.fetching[n]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const t=yield u;return e.e({rawTileData:a.slice(0)},t,l,c)}finally{delete this.fetching[n]}}catch(e){throw delete this.loading[n],o.status="done",this.loaded[n]=o,e}}))}reloadTile(t){return e._(this,void 0,void 0,(function*(){const n=t.uid;if(!this.loaded||!this.loaded[n])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const i=this.loaded[n];if(i.showCollisionBoxes=t.showCollisionBoxes,i.globalState=t.globalState,"parsing"===i.status){const r=yield i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);let o;if(this.fetching[n]){const{rawTileData:t,cacheControl:i,resourceTiming:s}=this.fetching[n];delete this.fetching[n],o=e.e({rawTileData:t.slice(0)},r,i,s)}else o=r;return o}if("done"===i.status&&i.vectorTile)return i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){const e=this.loading,n=t.uid;e&&e[n]&&e[n].abort&&(e[n].abort.abort(),delete e[n])}))}removeTile(t){return e._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[t.uid]&&delete this.loaded[t.uid]}))}}class s{constructor(){this.loaded={}}loadTile(t){return e._(this,void 0,void 0,(function*(){const{uid:n,encoding:i,rawImageData:r,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=t,c=r.width+2,u=r.height+2,h=e.b(r)?new e.R({width:c,height:u},yield e.cO(r,-1,-1,c,u)):r,d=new e.cP(n,h,i,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[n]=d,d}))}removeTile(e){const t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]}}var a,l,c=function(){if(l)return a;function e(e,n){if(0!==e.length){t(e[0],n);for(var i=1;i<e.length;i++)t(e[i],!n)}}function t(e,t){for(var n=0,i=0,r=0,o=e.length,s=o-1;r<o;s=r++){var a=(e[r][0]-e[s][0])*(e[s][1]+e[r][1]),l=n+a;i+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+i>=0!=!!t&&e.reverse()}return l=1,a=function t(n,i){var r,o=n&&n.type;if("FeatureCollection"===o)for(r=0;r<n.features.length;r++)t(n.features[r],i);else if("GeometryCollection"===o)for(r=0;r<n.geometries.length;r++)t(n.geometries[r],i);else if("Feature"===o)t(n.geometry,i);else if("Polygon"===o)e(n.coordinates,i);else if("MultiPolygon"===o)for(r=0;r<n.coordinates.length;r++)e(n.coordinates[r],i);return n}}(),u=e.cQ(c);class h extends e.cS{constructor(t,n){super(new e.cM,0,n,[],[]),this.feature=t,this.type=t.type,this.properties=t.tags?t.tags:{},"id"in t&&("string"==typeof t.id?this.id=parseInt(t.id,10):"number"!=typeof t.id||isNaN(t.id)||(this.id=t.id))}loadGeometry(){const t=[],n=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const i of n){const n=[];for(const t of i)n.push(new e.P(t[0],t[1]));t.push(n)}return t}}class d extends e.cR{constructor(t,n){super(new e.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=n?n.version:1,this.extent=n?n.extent:4096,this.length=t.length,this.features=t}feature(e){return new h(this.features[e],this.extent)}}function p(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let i=0;i<e.length;i++)n.feature=e.feature(i),t.writeMessage(2,f,n);const i=n.keys;for(const e of i)t.writeStringField(3,e);const r=n.values;for(const e of r)t.writeMessage(4,v,e)}function f(e,t){if(!e.feature)return;const n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,g,e),t.writeVarintField(3,n.type),t.writeMessage(4,y,n)}function g(e,t){for(const n in e.feature?.properties){let i=e.feature.properties[n],r=e.keycache[n];if(null===i)continue;void 0===r&&(e.keys.push(n),r=e.keys.length-1,e.keycache[n]=r),t.writeVarint(r),"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i&&(i=JSON.stringify(i));const o=typeof i+":"+i;let s=e.valuecache[o];void 0===s&&(e.values.push(i),s=e.values.length-1,e.valuecache[o]=s),t.writeVarint(s)}}function m(e,t){return(t<<3)+(7&e)}function _(e){return e<<1^e>>31}function y(e,t){const n=e.loadGeometry(),i=e.type;let r=0,o=0;for(const s of n){let n=1;1===i&&(n=s.length),t.writeVarint(m(1,n));const a=3===i?s.length-1:s.length;for(let e=0;e<a;e++){1===e&&1!==i&&t.writeVarint(m(2,a-1));const n=s[e].x-r,l=s[e].y-o;t.writeVarint(_(n)),t.writeVarint(_(l)),r+=n,o+=l}3===e.type&&t.writeVarint(m(7,1))}}function v(e,t){const n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const b={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},x=Math.fround||(w=new Float32Array(1),e=>(w[0]=+e,w[0]));var w;class E{constructor(e){this.options=Object.assign(Object.create(b),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r=`prepare ${e.length} points`;t&&console.time(r),this.points=e;const o=[];for(let t=0;t<e.length;t++){const n=e[t];if(!n.geometry)continue;const[i,r]=n.geometry.coordinates,s=x(C(i)),a=x(A(r));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let e=i;e>=n;e--){const n=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-n)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(C(n),A(o),C(r),A(i)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+5]>1?S(l,t,this.clusterProps):this.points[l[t+3]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const n=t*this.stride;o[n+4]===e&&l.push(o[n+5]>1?S(o,n,this.clusterProps):this.points[o[n+3]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=i?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,n,i,r):r<i?r++:e.push(t),e.length===n)break}return r}_createTree(t){const n=new e.aI(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+5]>1;let l,c,u;if(a)l=T(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+3]];l=n.properties;const[i,r]=n.geometry.coordinates;c=C(i),u=A(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+3]:this.points[t[e+3]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let n=0;n<a.length;n+=c){if(a[n+2]<=t)continue;a[n+2]=t;const i=a[n],u=a[n+1],h=e.within(a[n],a[n+1],s),d=a[n+5];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+5])}if(p>d&&p>=o){let e,o=i*d,s=u*d,f=-1;const g=(n/c<<5)+(t+1)+this.points.length;for(const i of h){const l=i*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+5];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=g,r&&(e||(e=this._map(a,n,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,l)))}a[n+4]=g,l.push(o/p,s/p,1/0,g,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[n+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+5]>1){const i=this.clusterProps[e[t+6]];return n?Object.assign({},i):i}const i=this.points[e[t+3]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function S(e,t,n){return{type:"Feature",id:e[t+3],properties:T(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),P(e[t+1])]}};var i}function T(e,t,n){const i=e[t+5],r=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+6],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+3],point_count:i,point_count_abbreviated:r})}function C(e){return e/360+.5}function A(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function P(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function I(e,t,n,i){let r=i;const o=t+(n-t>>1);let s,a=n-t;const l=e[t],c=e[t+1],u=e[n],h=e[n+1];for(let i=t+3;i<n;i+=3){const t=M(e[i],e[i+1],l,c,u,h);if(t>r)s=i,r=t;else if(t===r){const e=Math.abs(i-o);e<a&&(s=i,a=e)}}r>i&&(s-t>3&&I(e,t,s,i),e[s+2]=r,n-s>3&&I(e,s,n,i))}function M(e,t,n,i,r,o){let s=r-n,a=o-i;if(0!==s||0!==a){const l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return s=e-n,a=t-i,s*s+a*a}function R(e,t,n,i){const r={id:null==e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)k(r,n);else if("Polygon"===t)k(r,n[0]);else if("MultiLineString"===t)for(const e of n)k(r,e);else if("MultiPolygon"===t)for(const e of n)k(r,e[0]);return r}function k(e,t){for(let n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function O(e,t,n,i){if(!t.geometry)return;const r=t.geometry.coordinates;if(r&&0===r.length)return;const o=t.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let a=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===o)L(r,a);else if("MultiPoint"===o)for(const e of r)L(e,a);else if("LineString"===o)D(r,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(const n of r)a=[],D(n,a,s,!1),e.push(R(l,"LineString",a,t.properties));return}F(r,a,s,!1)}else if("Polygon"===o)F(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const r of t.geometry.geometries)O(e,{id:l,geometry:r,properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of r){const t=[];F(e,t,s,!0),a.push(t)}}e.push(R(l,o,a,t.properties))}function L(e,t){t.push(N(e[0]),B(e[1]),0)}function D(e,t,n,i){let r,o,s=0;for(let n=0;n<e.length;n++){const a=N(e[n][0]),l=B(e[n][1]);t.push(a,l,0),n>0&&(s+=i?(r*l-a*o)/2:Math.sqrt(Math.pow(a-r,2)+Math.pow(l-o,2))),r=a,o=l}const a=t.length-3;t[2]=1,I(t,0,a,n),t[a+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function F(e,t,n,i){for(let r=0;r<e.length;r++){const o=[];D(e[r],o,n,i),t.push(o)}}function N(e){return e/360+.5}function B(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function z(e,t,n,i,r,o,s,a){if(i/=t,o>=(n/=t)&&s<i)return e;if(s<n||o>=i)return null;const l=[];for(const t of e){const e=t.geometry;let o=t.type;const s=0===r?t.minX:t.minY,c=0===r?t.maxX:t.maxY;if(s>=n&&c<i){l.push(t);continue}if(c<n||s>=i)continue;let u=[];if("Point"===o||"MultiPoint"===o)j(e,u,n,i,r);else if("LineString"===o)U(e,u,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===o)$(e,u,n,i,r,!1);else if("Polygon"===o)$(e,u,n,i,r,!0);else if("MultiPolygon"===o)for(const t of e){const e=[];$(t,e,n,i,r,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const e of u)l.push(R(t.id,o,e,t.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push(R(t.id,o,u,t.tags))}}return l.length?l:null}function j(e,t,n,i,r){for(let o=0;o<e.length;o+=3){const s=e[o+r];s>=n&&s<=i&&G(t,e[o],e[o+1],e[o+2])}}function U(e,t,n,i,r,o,s){let a=V(e);const l=0===r?W:H;let c,u,h=e.start;for(let d=0;d<e.length-3;d+=3){const p=e[d],f=e[d+1],g=e[d+2],m=e[d+3],_=e[d+4],y=0===r?p:f,v=0===r?m:_;let b=!1;s&&(c=Math.sqrt(Math.pow(p-m,2)+Math.pow(f-_,2))),y<n?v>n&&(u=l(a,p,f,m,_,n),s&&(a.start=h+c*u)):y>i?v<i&&(u=l(a,p,f,m,_,i),s&&(a.start=h+c*u)):G(a,p,f,g),v<n&&y>=n&&(u=l(a,p,f,m,_,n),b=!0),v>i&&y<=i&&(u=l(a,p,f,m,_,i),b=!0),!o&&b&&(s&&(a.end=h+c*u),t.push(a),a=V(e)),s&&(h+=c)}let d=e.length-3;const p=e[d],f=e[d+1],g=0===r?p:f;g>=n&&g<=i&&G(a,p,f,e[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&G(a,a[0],a[1],a[2]),a.length&&t.push(a)}function V(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function $(e,t,n,i,r,o){for(const s of e)U(s,t,n,i,r,o,!1)}function G(e,t,n,i){e.push(t,n,i)}function W(e,t,n,i,r,o){const s=(o-t)/(i-t);return G(e,o,n+(r-n)*s,1),s}function H(e,t,n,i,r,o){const s=(o-n)/(r-n);return G(e,t+(i-t)*s,o,1),s}function Z(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],o=r.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=q(r.geometry,t);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const e of r.geometry)s.push(q(e,t))}else if("MultiPolygon"===o){s=[];for(const e of r.geometry){const n=[];for(const i of e)n.push(q(i,t));s.push(n)}}n.push(R(r.id,o,s,r.tags))}return n}function q(e,t){const n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(let i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function X(e,t){if(e.transformed)return e;const n=1<<e.z,i=e.x,r=e.y;for(const o of e.features){const e=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<e.length;s+=2)o.geometry.push(Y(e[s],e[s+1],t,n,i,r));else for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o+=2)a.push(Y(e[s][o],e[s][o+1],t,n,i,r));o.geometry.push(a)}}return e.transformed=!0,e}function Y(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function K(e,t,n,i,r){const o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const t of e)J(s,t,o,r);return s}function J(e,t,n,i){const r=t.geometry,o=t.type,s=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let t=0;t<r.length;t+=3)s.push(r[t],r[t+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)Q(s,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let t=0;t<r.length;t++)Q(s,r[t],e,n,"Polygon"===o,0===t);else if("MultiPolygon"===o)for(let t=0;t<r.length;t++){const i=r[t];for(let t=0;t<i.length;t++)Q(s,i[t],e,n,!0,0===t)}if(s.length){let n=t.tags||null;if("LineString"===o&&i.lineMetrics){n={};for(const e in t.tags)n[e]=t.tags[e];n.mapbox_clip_start=r.start/r.size,n.mapbox_clip_end=r.end/r.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:n};null!==t.id&&(a.id=t.id),e.features.push(a)}}function Q(e,t,n,i,r,o){const s=i*i;if(i>0&&t.size<(r?s:i))return void(n.numPoints+=t.length/3);const a=[];for(let e=0;e<t.length;e+=3)(0===i||t[e+2]>s)&&(n.numSimplified++,a.push(t[e],t[e+1])),n.numPoints++;r&&function(e,t){let n=0;for(let t=0,i=e.length,r=i-2;t<i;r=t,t+=2)n+=(e[t]-e[r])*(e[t+1]+e[r+1]);if(n>0===t)for(let t=0,n=e.length;t<n/2;t+=2){const i=e[t],r=e[t+1];e[t]=e[n-2-t],e[t+1]=e[n-1-t],e[n-2-t]=i,e[n-1-t]=r}}(a,o),e.push(a)}const ee={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class te{constructor(e,t){const n=(t=this.options=function(e,t){for(const n in t)e[n]=t[n];return e}(Object.create(ee),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(e,t){const n=[];if("FeatureCollection"===e.type)for(let i=0;i<e.features.length;i++)O(n,e.features[i],t,i);else O(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(e,t){const n=t.buffer/t.extent;let i=e;const r=z(e,1,-1-n,n,0,-1,2,t),o=z(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=z(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=Z(r,1).concat(i)),o&&(i=i.concat(Z(o,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,n,i,r,o,s){const a=[e,t,n,i],l=this.options,c=l.debug;for(;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,h=ne(t,n,i);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=K(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==r){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===r)continue;if(null!=r){const e=r-t;if(n!==o>>e||i!==s>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,g=.5+p,m=1+p;let _=null,y=null,v=null,b=null,x=z(e,u,n-p,n+g,0,d.minX,d.maxX,l),w=z(e,u,n+f,n+m,0,d.minX,d.maxX,l);e=null,x&&(_=z(x,u,i-p,i+g,1,d.minY,d.maxY,l),y=z(x,u,i+f,i+m,1,d.minY,d.maxY,l),x=null),w&&(v=z(w,u,i-p,i+g,1,d.minY,d.maxY,l),b=z(w,u,i+f,i+m,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(_||[],t+1,2*n,2*i),a.push(y||[],t+1,2*n,2*i+1),a.push(v||[],t+1,2*n+1,2*i),a.push(b||[],t+1,2*n+1,2*i+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const i=this.options,{extent:r,debug:o}=i;if(e<0||e>24)return null;const s=1<<e,a=ne(e,t=t+s&s-1,n);if(this.tiles[a])return X(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);let l,c=e,u=t,h=n;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[ne(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?X(this.tiles[a],r):null):null}}function ne(e,t,n){return 32*((1<<e)*n+t)+e}class ie extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(t,n){return e._(this,void 0,void 0,(function*(){const n=t.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return null;const r=new d(i.features,{version:2,extent:e.$});let o=function(t){const n=new e.cM;return function(e,t){for(const n in e.layers)t.writeMessage(3,p,e.layers[n])}(t,n),n.finish()}(r);return 0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),{vectorTile:r,rawData:o.buffer}}))}loadData(t){return e._(this,void 0,void 0,(function*(){var n;null===(n=this._pendingRequest)||void 0===n||n.abort();const i=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cN(t.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(t,this._pendingRequest);const n=yield this._pendingData;this._geoJSONIndex=t.cluster?new E(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;const i={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(n);for(const t of a){const[o,s]=n[t],a=e.cT(s),l=e.cT("string"==typeof o?[o,["accumulated"],["get",t]]:o);i[t]=a.value,r[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=i[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=r[t].evaluate(o,s)},t}(t)).load(n.features):function(e,t){return new te(e,t)}(n,t.geojsonVtOptions),this.loaded={};const r={data:n};if(i){const e=i.finish();e&&(r.resourceTiming={},r.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}return r}catch(t){if(delete this._pendingRequest,e.cy(t))return{abandoned:!0};throw t}}))}getData(){return e._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(t,n){return e._(this,void 0,void 0,(function*(){let i=yield this.loadGeoJSON(t,n);if(delete this._pendingRequest,"object"!=typeof i)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(u(i,!0),t.filter){const n=e.cT(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=i.features.filter((e=>n.value.evaluate({zoom:0},e)));i={type:"FeatureCollection",features:r}}return i}))}loadGeoJSON(t,n){return e._(this,void 0,void 0,(function*(){const{promoteId:i}=t;if(t.request){const r=yield e.j(t.request,n);return this._dataUpdateable=e.cV(r.data,i)?e.cU(r.data,i):void 0,r.data}if("string"==typeof t.data)try{const n=JSON.parse(t.data);return this._dataUpdateable=e.cV(n,i)?e.cU(n,i):void 0,n}catch(e){throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`)}if(!t.dataDiff)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${t.source}`);return e.cW(this._dataUpdateable,t.dataDiff,i),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(t){return e._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class re{constructor(t){this.self=t,this.actor=new e.J(t),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=e.cA,this.self.removeProtocol=e.cB,this.self.registerRTLTextPlugin=t=>{e.cX.setMethods(t)},this.actor.registerMessageHandler("LDT",((e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t))),this.actor.registerMessageHandler("RDT",((t,n)=>e._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(t,n.source).removeTile(n)})))),this.actor.registerMessageHandler("GCEZ",((t,n)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterExpansionZoom(n)})))),this.actor.registerMessageHandler("GCC",((t,n)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterChildren(n)})))),this.actor.registerMessageHandler("GCL",((t,n)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterLeaves(n)})))),this.actor.registerMessageHandler("LD",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t))),this.actor.registerMessageHandler("GD",((e,t)=>this._getWorkerSource(e,t.type,t.source).getData())),this.actor.registerMessageHandler("LT",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t))),this.actor.registerMessageHandler("RT",((e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t))),this.actor.registerMessageHandler("AT",((e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t))),this.actor.registerMessageHandler("RMT",((e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t))),this.actor.registerMessageHandler("RS",((t,n)=>e._(this,void 0,void 0,(function*(){if(!this.workerSources[t]||!this.workerSources[t][n.type]||!this.workerSources[t][n.type][n.source])return;const e=this.workerSources[t][n.type][n.source];delete this.workerSources[t][n.type][n.source],void 0!==e.removeSource&&e.removeSource(n)})))),this.actor.registerMessageHandler("RM",(t=>e._(this,void 0,void 0,(function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t]})))),this.actor.registerMessageHandler("SR",((t,n)=>e._(this,void 0,void 0,(function*(){this.referrer=n})))),this.actor.registerMessageHandler("SRPS",((e,t)=>this._syncRTLPluginState(e,t))),this.actor.registerMessageHandler("IS",((t,n)=>e._(this,void 0,void 0,(function*(){this.self.importScripts(n)})))),this.actor.registerMessageHandler("SI",((e,t)=>this._setImages(e,t))),this.actor.registerMessageHandler("UL",((t,n)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).update(n.layers,n.removedIds)})))),this.actor.registerMessageHandler("SL",((t,n)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).replace(n)}))))}_setImages(t,n){return e._(this,void 0,void 0,(function*(){this.availableImages[t]=n;for(const e in this.workerSources[t]){const i=this.workerSources[t][e];for(const e in i)i[e].availableImages=n}}))}_syncRTLPluginState(t,n){return e._(this,void 0,void 0,(function*(){return yield e.cX.syncState(n,this.self.importScripts)}))}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let n=this.layerIndexes[e];return n||(n=this.layerIndexes[e]=new t),n}_getWorkerSource(e,t,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){const i={sendAsync:(t,n)=>(t.targetMapId=e,this.actor.sendAsync(t,n))};switch(t){case"vector":this.workerSources[e][t][n]=new o(i,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][n]=new ie(i,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][n]=new this.externalWorkerSourceTypes[t](i,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][n]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new s),this.demWorkerSources[e][t]}}return e.i(self)&&(self.worker=new re(self)),re})),n("index",0,(function(e,t){var n="5.6.2";function i(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}let r,o;const s={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(e,n,i){const r=requestAnimationFrame((e=>{o(),n(e)})),{unsubscribe:o}=t.s(e.signal,"abort",(()=>{o(),cancelAnimationFrame(r),i(t.c())}),!1)},frameAsync(e){return new Promise(((t,n)=>{this.frame(e,t,n)}))},getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),n},resolveURL:e=>(r||(r=document.createElement("a")),r.href=e,r.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==o&&(o=matchMedia("(prefers-reduced-motion: reduce)")),o.matches)}};class a{static testProp(e){if(!a.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in a.docStyle)return e[t];return e[0]}static create(e,t,n){const i=window.document.createElement(e);return void 0!==t&&(i.className=t),n&&n.appendChild(i),i}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(e,t){e.style[a.transformProp]=t}static addEventListener(e,t,n,i={}){e.addEventListener(t,n,"passive"in i?i:i.capture)}static removeEventListener(e,t,n,i={}){e.removeEventListener(t,n,"passive"in i?i:i.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",a.suppressClickInternal,!0)}),0)}static getScale(e){const t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,n,i){const r=n.boundingClientRect;return new t.P((i.clientX-r.left)/n.x-e.clientLeft,(i.clientY-r.top)/n.y-e.clientTop)}static mousePos(e,t){const n=a.getScale(e);return a.getPoint(e,n,t)}static touchPos(e,t){const n=[],i=a.getScale(e);for(let r=0;r<t.length;r++)n.push(a.getPoint(e,i,t[r]));return n}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const t=(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body"),n=t.querySelectorAll("script");for(const e of n)e.remove();return a.clean(t),t.innerHTML}static isPossiblyDangerous(e,t){const n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const t=e.children;for(const e of t)a.removeAttributes(e),a.clean(e)}static removeAttributes(e){for(const{name:t,value:n}of e.attributes)a.isPossiblyDangerous(t,n)&&e.removeAttribute(t)}}a.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);const l={supported:!1,testSupport:function(e){!h&&u&&(d?p(e):c=e)}};let c,u,h=!1,d=!1;function p(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.isContextLost())return;l.supported=!0}catch(e){}e.deleteTexture(t),h=!0}var f;"undefined"!=typeof document&&(u=document.createElement("img"),u.onload=()=>{c&&p(c),c=null,d=!0},u.onerror=()=>{h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let n,i,r,o;e.resetRequestQueue=()=>{n=[],i=0,r=0,o={}},e.addThrottleControl=e=>{const t=r++;return o[t]=e,t},e.removeThrottleControl=e=>{delete o[e],a()},e.getImage=(e,i,r=!0)=>new Promise(((o,s)=>{l.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),t.e(e,{type:"image"}),n.push({abortController:i,requestParameters:e,supportImageRefresh:r,state:"queued",onError:e=>{s(e)},onSuccess:e=>{o(e)}}),a()}));const s=e=>t._(this,void 0,void 0,(function*(){e.state="running";const{requestParameters:n,supportImageRefresh:r,onError:o,onSuccess:s,abortController:l}=e,u=!1===r&&!t.i(self)&&!t.g(n.url)&&(!n.headers||Object.keys(n.headers).reduce(((e,t)=>e&&"accept"===t),!0));i++;const h=u?c(n,l):t.m(n,l);try{const n=yield h;delete e.abortController,e.state="completed",n.data instanceof HTMLImageElement||t.b(n.data)?s(n):n.data&&s({data:yield(d=n.data,"function"==typeof createImageBitmap?t.f(d):t.h(d)),cacheControl:n.cacheControl,expires:n.expires})}catch(t){delete e.abortController,o(t)}finally{i--,a()}var d})),a=()=>{const e=(()=>{for(const e of Object.keys(o))if(o[e]())return!0;return!1})()?t.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=i;t<e&&n.length>0;t++){const e=n.shift();e.abortController.signal.aborted?t--:s(e)}},c=(e,n)=>new Promise(((i,r)=>{const o=new Image,s=e.url,a=e.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!t.d(s))&&(o.crossOrigin="anonymous"),n.signal.addEventListener("abort",(()=>{o.src="",r(t.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,i({data:o})},o.onerror=()=>{o.onerror=o.onload=null,n.signal.aborted||r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(f||(f={})),f.resetRequestQueue();class g{constructor(e){this._transformRequestFn=null!=e?e:null}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function m(e){const t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){const n=[];for(const{id:i,url:r}of e){const e=`${i}${r}`;-1===n.indexOf(e)&&(n.push(e),t.push({id:i,url:r}))}}return t}function _(e,t,n){try{const i=new URL(e);return i.pathname+=`${t}${n}`,i.toString()}catch(t){throw new Error(`Invalid sprite URL "${e}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function y(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class v extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:t}of this.requestors)t(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const e=n.spriteData;n.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),n.spriteData=null}return n}addImage(e,t){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(e,n){let i=!0;const r=n.data||n.spriteData;return this._validateStretch(n.stretchX,r&&r.width)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,r&&r.height)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;const n=t.spriteData,i=n&&n.width||t.data.width,r=n&&n.height||t.data.height;return!(e[0]<0||i<e[0]||e[1]<0||r<e[1]||e[2]<0||i<e[2]||e[3]<0||r<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n=!0){const i=this.getImage(e);if(n&&(i.data.width!==t.data.width||i.data.height!==t.data.height))throw new Error(`size mismatch between old image (${i.data.width}x${i.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=i.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((t,n)=>{let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?t(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:t})}))}_getImagesForIds(e){const n={};for(const i of e){let e=this.getImage(i);e||(this.fire(new t.l("styleimagemissing",{id:i})),e=this.getImage(i)),e?n[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new t.I(n,i);this.patterns[e]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.T(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:i}=t.p(e),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const e in this.patterns){const{bin:n}=this.patterns[e],i=n.x+1,o=n.y+1,s=this.getImage(e).data,a=s.width,l=s.height;t.R.copy(s,r,{x:0,y:0},{x:i,y:o},{width:a,height:l}),t.R.copy(s,r,{x:0,y:l-1},{x:i,y:o-1},{width:a,height:1}),t.R.copy(s,r,{x:0,y:0},{x:i,y:o+l},{width:a,height:1}),t.R.copy(s,r,{x:a-1,y:0},{x:i-1,y:o},{width:1,height:l}),t.R.copy(s,r,{x:0,y:0},{x:i+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const e=this.getImage(n);e||t.w(`Image with ID: "${n}" was not found`),y(e)&&this.updateImage(n,e)}}}const b=1e20;function x(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)w(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)w(e,c*o+t,1,i,s,a,l)}function w(e,t,n,i,r,o,s){o[0]=0,s[0]=-b,s[1]=b,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=b}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}class E{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return t._(this,void 0,void 0,(function*(){const t=[];for(const n in e)for(const i of e[n])t.push(this._getAndCacheGlyphsPromise(n,i));const n=yield Promise.all(t),i={};for(const{stack:e,id:t,glyph:r}of n)i[e]||(i[e]={}),i[e][t]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};return i}))}_getAndCacheGlyphsPromise(e,n){return t._(this,void 0,void 0,(function*(){let t=this.entries[e];t||(t=this.entries[e]={glyphs:{},requests:{},ranges:{}});let i=t.glyphs[n];if(void 0!==i)return{stack:e,id:n,glyph:i};if(i=this._tinySDF(t,e,n),i)return t.glyphs[n]=i,{stack:e,id:n,glyph:i};const r=Math.floor(n/256);if(256*r>65535)throw new Error("glyphs > 65535 not supported");if(t.ranges[r])return{stack:e,id:n,glyph:i};if(!this.url)throw new Error("glyphsUrl is not set");if(!t.requests[r]){const n=E.loadGlyphRange(e,r,this.url,this.requestManager);t.requests[r]=n}const o=yield t.requests[r];for(const e in o)this._doesCharSupportLocalGlyph(+e)||(t.glyphs[+e]=o[+e]);return t.ranges[r]=!0,{stack:e,id:n,glyph:o[n]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))||t.u["CJK Unified Ideographs"](e)||t.u["Hangul Syllables"](e)||t.u.Hiragana(e)||t.u.Katakana(e)||t.u["CJK Symbols and Punctuation"](e)||t.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,i){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(i))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(n)?t="900":/medium/i.test(n)?t="500":/light/i.test(n)&&(t="200"),o=e.tinySDF=new E.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:r,fontWeight:t})}const s=o.draw(String.fromCharCode(i));return{id:i,bitmap:new t.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}E.loadGlyphRange=function(e,n,i,r){return t._(this,void 0,void 0,(function*(){const o=256*n,s=o+255,a=r.transformRequest(i.replace("{fontstack}",e).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield t.n(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${n}, ${o}-${s}`);const c={};for(const e of t.o(l.data))c[e.id]=e;return c}))},E.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal",lang:a=null}={}){this.buffer=t,this.cutoff=i,this.radius=n,this.lang=a;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${o} ${e}px ${r}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:g,gridInner:m,gridOuter:_}=this;this.lang&&(f.lang=this.lang),f.clearRect(g,g,a,l),f.fillText(e,g,g+s);const y=f.getImageData(g,g,a,l);_.fill(b,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=y.data[4*(e*a+t)+3]/255;if(0===n)continue;const i=(e+g)*c+t+g;if(1===n)_[i]=0,m[i]=b;else{const e=.5-n;_[i]=e>0?e*e:0,m[i]=e<0?e*e:0}}x(_,0,0,c,u,c,this.f,this.v,this.z),x(m,g,g,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class S{constructor(){this.specification=t.v.light.position}possiblyEvaluate(e,n){return t.B(e.expression.evaluate(n))}interpolate(e,n,i){return{x:t.C.number(e.x,n.x,i),y:t.C.number(e.y,n.y,i),z:t.C.number(e.z,n.z,i)}}}let T;class C extends t.E{constructor(e){super(),T=T||new t.r({anchor:new t.D(t.v.light.anchor),position:new S,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.t(T),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.x,e,n))for(const t in e){const n=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),n):this._transitionable.setValue(t,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&t.y(this,e.call(t.z,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.v}))}}const A=new t.r({"sky-color":new t.D(t.v.sky["sky-color"]),"horizon-color":new t.D(t.v.sky["horizon-color"]),"fog-color":new t.D(t.v.sky["fog-color"]),"fog-ground-blend":new t.D(t.v.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.v.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.v.sky["atmosphere-blend"])});class P extends t.E{constructor(e){super(),this._transitionable=new t.t(A),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.F(0))}setSky(e,n={}){if(!this._validate(t.G,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const t in e){const n=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),n):this._transitionable.setValue(t,n)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i={}){return!1!==(null==i?void 0:i.validate)&&t.y(this,e.call(t.z,t.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class I{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const n=e.join(",")+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];r=a*n,a+=l,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===l})}return i}addRoundDash(e,t,n){const i=t/2;for(let t=-n;t<=n;t++){const r=this.width*(this.nextRow+n+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/n*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const n=e[t],i=e[t+1];n.zeroLength?e.splice(t,1):i&&i.isDash===n.isDash&&(i.left=n.left,e.splice(t,1))}const t=e[0],n=e[e.length-1];t.isDash===n.isDash&&(t.left=n.left-this.width,n.right=t.right+this.width);const i=this.width*this.nextRow;let r=0,o=e[r];for(let t=0;t<this.width;t++){t/o.right>1&&(o=e[++r]);const n=Math.abs(t-o.left),s=Math.abs(t-o.right),a=Math.min(n,s);this.data[i+t]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(e,n){const i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,r=this.getDashRanges(e,this.width,t);n?this.addRoundDash(r,t,i):this.addRegularDash(r)}const s={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:o};return this.nextRow+=r,this.dirty=!0,s}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}const M="maplibre_preloaded_worker_pool";class R{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<R.workerCount;)this.workers.push(new Worker(t.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[M]}numActive(){return Object.keys(this.active).length}}const k=Math.floor(s.hardwareConcurrency/2);let O,L;function D(){return O||(O=new R),O}R.workerCount=t.H(globalThis)?Math.max(Math.min(k,3),1):1;class F{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const i=this.workerPool.acquire(n);for(let e=0;e<i.length;e++){const r=new t.J(i[e],n);r.name=`Worker ${e}`,this.actors.push(r)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,t){const n=[];for(const i of this.actors)n.push(i.sendAsync({type:e,data:t}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((e=>{e.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,t){for(const n of this.actors)n.registerMessageHandler(e,t)}}function N(){return L||(L=new F(D(),t.K),L.registerMessageHandler("GR",((e,n,i)=>t.m(n,i)))),L}function B(e,n){const i=t.L();return t.M(i,i,[1,1,0]),t.N(i,i,[.5*e.width,.5*e.height,1]),e.calculatePosMatrix?t.O(i,i,e.calculatePosMatrix(n.toUnwrapped())):i}function z(e,t,n,i,r,o,s){var a;const l=function(e,t,n){if(e)for(const i of e){const e=t[i];if(e&&e.source===n&&"fill-extrusion"===e.type)return!0}else for(const e in t){const i=t[e];if(i.source===n&&"fill-extrusion"===i.type)return!0}return!1}(null!==(a=null==r?void 0:r.layers)&&void 0!==a?a:null,t,e.id),c=o.maxPitchScaleFactor(),u=e.tilesIn(i,c,l);u.sort(j);const h=[];for(const i of u)h.push({wrappedTileID:i.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,n,e._state,i.queryGeometry,i.cameraQueryGeometry,i.scale,r,o,c,B(e.transform,i.tileID),s?(e,t)=>s(i.tileID,e,t):void 0)});return function(e,t){for(const n in e)for(const i of e[n])U(i,t);return e}(function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(h),e)}function j(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function U(e,t){const n=e.feature,i=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}function V(e,n,i){return t._(this,void 0,void 0,(function*(){let r=e;if(e.url?r=(yield t.j(n.transformRequest(e.url,"Source"),i)).data:yield s.frameAsync(i),!r)return null;const o=t.Q(t.e(r,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in r&&r.vector_layers&&(o.vectorLayerIds=r.vector_layers.map((e=>e.id))),o}))}class ${constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof t.S?new t.S(e.lng,e.lat):t.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.S?new t.S(e.lng,e.lat):t.S.convert(e),this}extend(e){const n=this._sw,i=this._ne;let r,o;if(e instanceof t.S)r=e,o=e;else{if(!(e instanceof $))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend($.convert(e)):this.extend(t.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.S.convert(e)):this;if(r=e._sw,o=e._ne,!r||!o)return this}return n||i?(n.lng=Math.min(r.lng,n.lng),n.lat=Math.min(r.lat,n.lat),i.lng=Math.max(o.lng,i.lng),i.lat=Math.max(o.lat,i.lat)):(this._sw=new t.S(r.lng,r.lat),this._ne=new t.S(o.lng,o.lat)),this}getCenter(){return new t.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.S(this.getWest(),this.getNorth())}getSouthEast(){return new t.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:i}=t.S.convert(e);let r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return e instanceof $?e:e?new $(e):e}static fromLngLat(e,n=0){const i=360*n/40075017,r=i/Math.cos(Math.PI/180*e.lat);return new $(new t.S(e.lng-r,e.lat-i),new t.S(e.lng+r,e.lat+i))}adjustAntiMeridian(){const e=new t.S(this._sw.lng,this._sw.lat),n=new t.S(this._ne.lng,this._ne.lat);return new $(e,e.lng>n.lng?new t.S(n.lng+360,n.lat):n)}}class G{constructor(e,t,n){this.bounds=$.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(t.V(this.bounds.getWest())*n),r=Math.floor(t.U(this.bounds.getNorth())*n),o=Math.ceil(t.V(this.bounds.getEast())*n),s=Math.ceil(t.U(this.bounds.getSouth())*n);return e.x>=i&&e.x<o&&e.y>=r&&e.y<s}}class W extends t.E{constructor(e,n,i,r){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.Q(n,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(t.e(this,e),e.bounds&&(this.tileBounds=new G(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new t.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(t,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};n.request.collectResourceTiming=this._collectResourceTiming;let i="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise(((t,n)=>{e.reloadPromise={resolve:t,reject:n}}))}else e.actor=this.dispatcher.getActor(),i="LT";e.abortController=new AbortController;try{const t=yield e.actor.sendAsync({type:i,data:n},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,t)}catch(t){if(delete e.abortController,e.aborted)return;if(t&&404!==t.status)throw t;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,t){if(t&&t.resourceTiming&&(e.resourceTiming=t.resourceTiming),t&&this.map._refreshExpiredTiles&&e.setExpiryData(t),e.loadVectorData(t,this.map.painter),e.reloadPromise){const t=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(t.resolve).catch(t.reject)}}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class H extends t.E{constructor(e,n,i,r){super(),this.id=e,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},n),t.e(this,t.Q(n,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(t.e(this,n),n.bounds&&(this.tileBounds=new G(n.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(e){this._tileJSONRequest=null,this.fire(new t.k(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return t.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return t._(this,void 0,void 0,(function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const i=yield f.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&e.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const n=this.map.painter.context,r=n.gl,o=i.data;e.texture=this.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.T(n,o,r.RGBA,{useMipmap:!0}),e.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Z extends H{constructor(e,n,i,r){super(e,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return t._(this,void 0,void 0,(function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const n=yield f.getImage(i,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){const i=n.data;this.map._refreshExpiredTiles&&(n.cacheControl||n.expires)&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const r=t.b(i)&&t.W()?i:yield this.readImageNow(i),o={type:this.type,uid:e.uid,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const t=yield e.actor.sendAsync({type:"LDT",data:o});e.dem=t,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}readImageNow(e){return t._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&t.X()){const n=e.width+2,i=e.height+2;try{return new t.R({width:n,height:i},yield t.Y(e,-1,-1,n,i))}catch(e){}}return s.getImageData(e,1)}))}_getNeighboringTiles(e){const n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?e.wrap-1:e.wrap,s=(n.x+1+i)%i,a=n.x+1===i?e.wrap+1:e.wrap,l={};return l[new t.Z(e.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},l[new t.Z(e.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new t.Z(e.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},l[new t.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.Z(e.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new t.Z(e.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},l[new t.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.Z(e.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),l}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class q extends t.E{constructor(e,n,i,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=t.e({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,void 0!==n.clusterMaxZoom&&this.maxzoom<=n.clusterMaxZoom&&t.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=t.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==n.buffer?n.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==n.tolerance?n.tolerance:.375),extent:t.$,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.$,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(t.$/this.tileSize)}_getClusterMaxZoom(e){const n=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||void 0===e||t.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${n}"`),n}load(){return t._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=t.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return t._(this,void 0,void 0,(function*(){const e=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return"GeometryCollection"===e.type?e.geometries.map((e=>e.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return t._(this,void 0,void 0,(function*(){const e=new $,t=yield this.getData();let n;switch(t.type){case"FeatureCollection":n=t.features.map((e=>this.getCoordinatesFromGeometry(e.geometry))).flat(1/0);break;case"Feature":n=this.getCoordinatesFromGeometry(t.geometry);break;default:n=this.getCoordinatesFromGeometry(t)}if(0==n.length)return e;for(let t=0;t<n.length-1;t+=2)e.extend([n[t],n[t+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,t,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:t,offset:n}})}_updateWorkerData(){return t._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:n}=this._pendingWorkerUpdate;if(!e&&!n)return void t.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const i=t.e({type:this.type},this.workerOptions);e?("string"==typeof e?(i.request=this.map._requestManager.transformRequest(s.resolveURL(e),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):n&&(i.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new t.l("dataloading",{dataType:"source"}));try{const e=yield this.actor.sendAsync({type:"LD",data:i});if(this._isUpdatingWorker=!1,this._removed||e.abandoned)return void this.fire(new t.l("dataabort",{dataType:"source"}));this._data=e.data;let n=null;e.resourceTiming&&e.resourceTiming[this.id]&&(n=e.resourceTiming[this.id].slice(0));const r={dataType:"source"};this._collectResourceTiming&&n&&n.length>0&&t.e(r,{resourceTiming:n}),this.fire(new t.l("data",Object.assign(Object.assign({},r),{sourceDataType:"metadata"}))),this.fire(new t.l("data",Object.assign(Object.assign({},r),{sourceDataType:"content"})))}catch(e){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new t.l("dataabort",{dataType:"source"}));this.fire(new t.k(e))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&void 0===this._pendingWorkerUpdate.data&&void 0===this._pendingWorkerUpdate.diff}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.actor?"RT":"LT";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const i=yield this.actor.sendAsync({type:t,data:n},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(i,this.map.painter,"RT"===t)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class X extends t.E{constructor(e,t,n,i){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=t}load(e){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const t=yield f.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,t&&t.data&&(this.image=t.data,e&&(this.coordinates=e),this._finishLoading())}catch(e){this._request=null,this._loaded=!0,this.fire(new t.k(e))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(t.a1.fromLngLat);var i;return this.tileID=function(e){const n=t.a2.fromPoints(e),i=n.width(),r=n.height(),o=Math.max(i,r),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);return new t.a4(s,Math.floor((n.minX+n.maxX)/2*a),Math.floor((n.minY+n.maxY)/2*a))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map((e=>this.tileID.getTilePoint(e)._round())),this.flippedWindingOrder=((i=this.tileCoords)[1].x-i[0].x)*(i[2].y-i[0].y)-(i[1].y-i[0].y)*(i[2].x-i[0].x)<0,this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new t.T(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return t._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:n,minY:i,maxX:r,maxY:o}=t.a2.fromPoints(e),s={};for(let e=0;e<=t.a3;e++){const t=Math.pow(2,e),a=Math.floor(n*t),l=Math.floor(i*t),c=Math.floor(r*t),u=Math.floor(o*t);s[e]={minTileX:a,minTileY:l,maxTileX:c,maxTileY:u}}return s}}class Y extends X{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,"Source").url);try{const e=yield t.a5(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(e){this.fire(new t.k(e))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.k(new t.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class K extends X{constructor(e,n,i,r){super(e,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new t.k(new t.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.k(new t.a6(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.k(new t.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new t.k(new t.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.k(new t.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(n,this.canvas,i.RGBA,{premultiply:!0});let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const J={},Q=e=>{switch(e){case"geojson":return q;case"image":return X;case"raster":return H;case"raster-dem":return Z;case"vector":return W;case"video":return Y;case"canvas":return K}return J[e]},ee="RTLPluginLoaded";class te extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=N()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((e=>{throw this.status="error",e}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return t._(this,arguments,void 0,(function*(e,t=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=s.resolveURL(e),!this.url)throw new Error(`requested url ${e} is invalid`);if("unavailable"===this.status){if(!t)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return t._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.l(ee))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let ne=null;function ie(){return ne||(ne=new te),ne}class re{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=t.a7(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.id]=i}}return n}(e.buckets,null==n?void 0:n.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.a9){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.a9&&n.hasRTLText){this.hasRTLText=!0,ie().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(e).queryRadius(t))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const n=this.buckets[t];n.uploadPending()&&n.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new t.T(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,i,r,o,s,a,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l,getElevation:u},e,t,n):{}}querySourceFeatures(e,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),o=n&&n.sourceLayer?n.sourceLayer:"",s=r._geojsonTileLayer||r[o];if(!s)return;const a=t.aa(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let n=0;n<s.length;n++){const r=s.feature(n);if(a.needGeometry){const e=t.ab(r,!0);if(!a.filter(new t.F(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.F(this.tileID.overscaledZ),r))continue;const d=i.getId(r,o),p=new t.ac(r,l,c,u,d);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const n=t.ad(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const i=this.expirationTime-n;i?this.expirationTime=e+Math.max(i,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!t.style.hasLayer(i))continue;const r=this.buckets[i],o=r.layers[0].sourceLayer||"_geojsonTileLayer",s=n[o],a=e[o];if(!s||!a||0===Object.keys(a).length)continue;r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=s.now()+e}setDependencies(e,t){const n={};for(const e of t)n[e]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}}class oe{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const e of t)this.remove(e.value.tileID,e)}}class se{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){const r=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},t.e(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])i[t]||(this.deletedStates[e][r][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,n){const i=String(n),r=t.e({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][n];if(null===t)return{};for(const e in t)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,n){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const n={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),t.e(this.state[e][i],this.stateChanges[e][i]),n[i]=this.state[e][i];i[e]=n}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const n={};if(null===this.deletedStates[e])for(const t in this.state[e])n[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else for(const n of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][n];n[t]=this.state[e][t]}i[e]=i[e]||{},t.e(i[e],n)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const t in e)e[t].setFeatureState(i,n)}}const ae=89.25;function le(e,n){const i=t.ah(n.lat,-t.ai,t.ai);return new t.P(t.V(n.lng)*e,t.U(i)*e)}function ce(e,n){return new t.a1(n.x/e,n.y/e).toLngLat()}function ue(e){return e.cameraToCenterDistance*Math.min(.85*Math.tan(t.ae(90-e.pitch)),Math.tan(t.ae(ae-e.pitch)))}function he(e,n){const i=e.canonical,r=n/t.af(i.z),o=i.x+Math.pow(2,i.z)*e.wrap,s=t.ag(new Float64Array(16));return t.M(s,s,[o*r,i.y*r,0]),t.N(s,s,[r/t.$,r/t.$,1]),s}function de(e,n,i,r,o){const s=t.a1.fromLngLat(e,n),a=o*t.aj(1,e.lat),l=a*Math.cos(t.ae(i)),c=Math.sqrt(a*a-l*l),u=c*Math.sin(t.ae(-r)),h=c*Math.cos(t.ae(-r));return new t.a1(s.x+u,s.y+h,s.z+l)}function pe(e,t,n){const i=t.intersectsFrustum(e);if(!n||0===i)return i;const r=t.intersectsPlane(n);return 0===r?0:2===i&&2===r?2:1}function fe(e,t,n){let i=0;const r=(n-t)/10;for(let o=0;o<10;o++)i+=r*Math.pow(Math.cos(t+(o+.5)/10*(n-t)),e);return i}function ge(e,n){return function(i,r,o,s,a){const l=2*((e-1)/t.ak(Math.cos(t.ae(ae-a))/Math.cos(t.ae(ae)))-1),c=Math.acos(o/s),u=2*fe(l-1,0,t.ae(a/2)),h=Math.min(t.ae(ae),c+t.ae(a/2)),d=fe(l-1,Math.min(h,c-t.ae(a/2)),h),p=Math.atan(r/o),f=Math.hypot(r,o);let g=i;return g+=t.ak(s/f/Math.max(.5,Math.cos(t.ae(a/2)))),g+=l*t.ak(Math.cos(p))/2,g-=t.ak(Math.max(1,d/u/n))/2,g}}const me=ge(9.314,3);function _e(e,n){const i=(n.roundZoom?Math.round:Math.floor)(e.zoom+t.ak(e.tileSize/n.tileSize));return Math.max(0,i)}function ye(e,n){const i=e.getCameraFrustum(),r=e.getClippingPlane(),o=e.screenPointToMercatorCoordinate(e.getCameraPoint()),s=t.a1.fromLngLat(e.center,e.elevation);o.z=s.z+Math.cos(e.pitchInRadians)*e.cameraToCenterDistance/e.worldSize;const a=e.getCoveringTilesDetailsProvider(),l=a.allowVariableZoom(e,n),c=_e(e,n),u=n.minzoom||0,h=void 0!==n.maxzoom?n.maxzoom:e.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*o.x,p*o.y,0],g=[p*s.x,p*s.y,0],m=Math.hypot(s.x-o.x,s.y-o.y),_=Math.abs(s.z-o.z),y=Math.hypot(m,_),v=e=>({zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),b=[],x=[];if(e.renderWorldCopies&&a.allowWorldCopies())for(let e=1;e<=3;e++)b.push(v(-e)),b.push(v(e));for(b.push(v(0));b.length>0;){const p=b.pop(),m=p.x,v=p.y;let w=p.fullyVisible;const E={x:m,y:v,z:p.zoom},S=a.getTileBoundingVolume(E,p.wrap,e.elevation,n);if(!w){const e=pe(i,S,r);if(0===e)continue;w=2===e}const T=a.distanceToTile2d(o.x,o.y,E,S);let C=c;l&&(C=(n.calculateTileZoom||me)(e.zoom+t.ak(e.tileSize/n.tileSize),T,_,y,e.fov)),C=(n.roundZoom?Math.round:Math.floor)(C),C=Math.max(0,C);const A=Math.min(C,h);if(p.wrap=a.getWrap(s,E,p.wrap),p.zoom>=A){if(p.zoom<u)continue;const e=d-p.zoom,i=f[0]-.5-(m<<e),r=f[1]-.5-(v<<e),o=n.reparseOverscaled?Math.max(p.zoom,C):p.zoom;x.push({tileID:new t.Z(p.zoom===h?o:p.zoom,p.wrap,p.zoom,m,v),distanceSq:t.al([g[0]-.5-m,g[1]-.5-v]),tileDistanceToCamera:Math.sqrt(i*i+r*r)})}else for(let e=0;e<4;e++)b.push({zoom:p.zoom+1,x:(m<<1)+e%2,y:(v<<1)+(e>>1),wrap:p.wrap,fullyVisible:w})}return x.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}const ve=t.a2.fromPoints([new t.P(0,0),new t.P(t.$,t.$)]);class be extends t.E{constructor(e,t,n){super(),this.id=e,this.dispatcher=n,this.on("data",(e=>this._dataHandler(e))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((e,t,n,i)=>{const r=new(Q(t.type))(e,t,n,i);if(r.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${r.id}`);return r})(e,t,n,this),this._tiles={},this._cache=new oe(0,(e=>this._unloadTile(e))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new se,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,i){return t._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,i)}catch(n){e.state="errored",404!==n.status?this._source.fire(new t.k(n,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new t.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(xe).map((e=>e.key))}getRenderableIds(e){const n=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&n.push(this._tiles[t]);return e?n.sort(((e,n)=>{const i=e.tileID,r=n.tileID,o=new t.P(i.canonical.x,i.canonical.y)._rotate(-this.transform.bearingInRadians),s=new t.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians);return i.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(xe).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)e?this._reloadTile(t,"expired"):"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")}}_reloadTile(e,n){return t._(this,void 0,void 0,(function*(){const t=this._tiles[e];t&&("loading"!==t.state&&(t.state=n),yield this._loadTile(t,e,n))}))}_tileLoaded(e,n,i){e.timeAdded=s.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]||e[a.canonical.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,i=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(n*i*(null===this._maxTileCacheZoomLevels?t.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}_updateCoveredAndRetainedTiles(e,t,n,i,r,o){const a={},l={},c=Object.keys(e),u=s.now();for(const n of c){const i=e[n],r=this._tiles[n];if(!r||0!==r.fadeEndTime&&r.fadeEndTime<=u)continue;const o=this.findLoadedParent(i,t),s=this.findLoadedSibling(i),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[n]=i}this._retainLoadedChildren(l,i,n,e);for(const t in a)e[t]||(this._coveredTiles[t]=!0,e[t]=a[t]);if(o){const t={},n={};for(const e of r)this._tiles[e.key].hasData()?t[e.key]=e:n[e.key]=e;for(const i in n){const r=n[i].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(t[r[0].key]=e[r[0].key]=r[0],t[r[1].key]=e[r[1].key]=r[1],t[r[2].key]=e[r[2].key]=r[2],t[r[3].key]=e[r[3].key]=r[3],delete n[i])}for(const i in n){const r=n[i],o=this.findLoadedParent(r,this._source.minzoom),s=this.findLoadedSibling(r),a=o||s||null;if(a){t[a.tileID.key]=e[a.tileID.key]=a.tileID;for(const e in t)t[e].isChildOf(a.tileID)&&delete t[e]}}for(const e in this._tiles)t[e]||(this._coveredTiles[e]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let i;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.Z(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(i=ye(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))))):i=[];const r=_e(e,this._source),o=Math.max(r-be.maxOverzooming,this._source.minzoom),s=Math.max(r+be.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const e={};for(const t of i)if(t.canonical.z>this._source.minzoom){const n=t.scaledTo(t.canonical.z-1);e[n.key]=n;const i=t.scaledTo(Math.max(this._source.minzoom,Math.min(t.canonical.z,5)));e[i.key]=i}i=i.concat(Object.values(e))}const a=0===i.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new t.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(i,r);we(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,r,i,n);for(const e in l)this._tiles[e].clearFadeHold();const c=t.am(this._tiles,l);for(const e of c){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){var n;const i={},r={},o=Math.max(t-be.maxOverzooming,this._source.minzoom),s=Math.max(t+be.maxUnderzooming,this._source.minzoom),a={};for(const n of e){const e=this._addTile(n);i[n.key]=n,e.hasData()||t<this._source.maxzoom&&(a[n.key]=n)}this._retainLoadedChildren(a,t,s,i);for(const s of e){let e=this._tiles[s.key];if(e.hasData())continue;if(t+1>this._source.maxzoom){const e=s.children(this._source.maxzoom)[0],t=this.getTile(e);if(t&&t.hasData()){i[e.key]=e;continue}}else{const e=s.children(this._source.maxzoom);if(i[e[0].key]&&i[e[1].key]&&i[e[2].key]&&i[e[3].key])continue}let a=e.wasRequested();for(let t=s.overscaledZ-1;t>=o;--t){const o=s.scaledTo(t);if(r[o.key])break;if(r[o.key]=!0,e=this.getTile(o),!e&&a&&(e=this._addTile(o)),e){const t=e.hasData();if((t||!(null===(n=this.map)||void 0===n?void 0:n.cancelPendingTileRequestsWhileZooming)||a)&&(i[o.key]=o),a=e.wasRequested(),t)break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const t=this._tiles[e].tileID,n=this._getLoadedTile(t);this._loadedSiblingTiles[t.key]=n}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const i=n;return n||(n=new re(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,i||this._source.fire(new t.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}refreshTiles(e){for(const t in this._tiles)(this._isIdRenderable(t)||"errored"==this._tiles[t].state)&&e.some((e=>e.equals(this._tiles[t].tileID.canonical)))&&this._reloadTile(t,"expired")}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}_dataHandler(e){const t=e.sourceDataType;"source"===e.dataType&&"metadata"===t&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===t&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,i){const r=[],o=this.transform;if(!o)return r;const s=o.getCoveringTilesDetailsProvider().allowWorldCopies(),a=i?o.getCameraQueryGeometry(e):e,l=e=>o.screenPointToMercatorCoordinate(e,this.terrain),c=this.transformBbox(e,l,!s),u=this.transformBbox(a,l,!s),h=this.getIds(),d=t.a2.fromPoints(u);for(let e=0;e<h.length;e++){const i=this._tiles[h[e]];if(i.holdingForFade())continue;const a=s?[i.tileID]:[i.tileID.unwrapTo(-1),i.tileID.unwrapTo(0)],l=Math.pow(2,o.zoom-i.tileID.overscaledZ),p=n*i.queryPadding*t.$/i.tileSize/l;for(const e of a){const n=d.map((n=>e.getTilePoint(new t.a1(n.x,n.y))));if(n.expandBy(p),n.intersects(ve)){const t=c.map((t=>e.getTilePoint(t))),n=u.map((t=>e.getTilePoint(t)));r.push({tile:i,tileID:s?e:e.unwrapTo(0),queryGeometry:t,cameraQueryGeometry:n,scale:l})}}}return r}transformBbox(e,n,i){let r=e.map(n);if(i){const i=t.a2.fromPoints(e);i.shrinkBy(.001*Math.min(i.width(),i.height()));const o=i.map(n);t.a2.fromPoints(r).covers(o)||(r=r.map((e=>e.x>.5?new t.a1(e.x-1,e.y,e.z):e)))}return r}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));return this.transform&&this.transform.populateCache(t),t}hasTransition(){if(this._source.hasTransition())return!0;if(we(this._source.type)){const e=s.now();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}}function xe(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function we(e){return"raster"===e||"image"===e||"video"===e}be.maxOverzooming=10,be.maxUnderzooming=3;class Ee{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ah(e,0,1);let n=1,i=this._distances[n];const r=e*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const o=n-1,s=this._distances[o],a=i-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}function Se(e,t){let n=!0;return"always"===e||"never"!==e&&"never"!==t||(n=!1),n}class Te{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let e=0;e<this.xCellCount*this.yCellCount;e++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o,s){if(n<0||e>this.width||i<0||t>this.height)return[];const a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return[{key:null,x1:e,y1:t,x2:n,y2:i}];for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}}else this._forEachCell(e,t,n,i,this._queryCell,a,{hitTest:r,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(e,t,n,i){return this._query(e,t,n,i,!1,null)}hitTest(e,t,n,i,r,o){return this._query(e,t,n,i,!0,r,o).length>0}hitTestCircle(e,t,n,i,r){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(e,t,n,i,r,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(e<=r[h+2]&&t<=r[h+3]&&n>=r[h+0]&&i>=r[h+1]&&(!a||a(d))&&(!c||!Se(u,d.overlapMode))&&(o.push({key:d,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],e,t,n,i)&&(!a||a(d))&&(!c||!Se(u,d.overlapMode))){const e=r[h],t=r[h+1],n=r[h+2];if(o.push({key:d,x1:e-n,y1:t-n,x2:e+n,y2:t+n}),c)return!0}}}return!1}_queryCellCircle(e,t,n,i,r,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const n=4*t,i=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(i))&&!Se(u,i.overlapMode))return o.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const n=3*t,i=this.circleKeys[t];if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(i))&&!Se(u,i.overlapMode))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const s=i-e,a=r-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}function Ce(e,n,r){const o=t.L();if(!e){const{vecSouth:e,vecEast:t}=Pe(n),r=i();r[0]=t[0],r[1]=t[1],r[2]=e[0],r[3]=e[1],s=r,(d=(l=(a=r)[0])*(h=a[3])-(u=a[2])*(c=a[1]))&&(s[0]=h*(d=1/d),s[1]=-c*d,s[2]=-u*d,s[3]=l*d),o[0]=r[0],o[1]=r[1],o[4]=r[2],o[5]=r[3]}var s,a,l,c,u,h,d;return t.N(o,o,[1/r,1/r,1]),o}function Ae(e,n,i,r){if(e){const e=t.L();if(!n){const{vecSouth:t,vecEast:n}=Pe(i);e[0]=n[0],e[1]=n[1],e[4]=t[0],e[5]=t[1]}return t.N(e,e,[r,r,1]),e}return i.pixelsToClipSpaceMatrix}function Pe(e){const n=Math.cos(e.rollInRadians),i=Math.sin(e.rollInRadians),r=Math.cos(e.pitchInRadians),o=Math.cos(e.bearingInRadians),s=Math.sin(e.bearingInRadians),a=t.ar();a[0]=-o*r*i-s*n,a[1]=-s*r*i+o*n;const l=t.as(a);l<1e-9?t.at(a):t.au(a,a,1/l);const c=t.ar();c[0]=o*r*n-s*i,c[1]=s*r*n+o*i;const u=t.as(c);return u<1e-9?t.at(c):t.au(c,c,1/u),{vecEast:c,vecSouth:a}}function Ie(e,n,i,r){let o;r?(o=[e,n,r(e,n),1],t.aw(o,o,i)):(o=[e,n,0,1],He(o,o,i));const s=o[3];return{point:new t.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}function Me(e,t){return.5+e/t*.5}function Re(e,t){return e.x>=-t[0]&&e.x<=t[0]&&e.y>=-t[1]&&e.y<=t[1]}function ke(e,n,i,r,o,s,a,l,c,u,h,d,p){const f=i?e.textSizeData:e.iconSizeData,g=t.an(f,n.transform.zoom),m=[256/n.width*2+1,256/n.height*2+1],_=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;_.clear();const y=e.lineVertexArray,v=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,b=n.transform.width/n.transform.height;let x=!1;for(let i=0;i<v.length;i++){const w=v.get(i);if(w.hidden||w.writingMode===t.ao.vertical&&!x){We(w.numGlyphs,_);continue}x=!1;const E=new t.P(w.anchorX,w.anchorY),S={getElevation:p,pitchedLabelPlaneMatrix:r,lineVertexArray:y,pitchWithMap:s,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:n.transform,tileAnchorPoint:E,unwrappedTileID:c,width:u,height:h,translation:d},T=je(w.anchorX,w.anchorY,S);if(!Re(T.point,m)){We(w.numGlyphs,_);continue}const C=Me(n.transform.cameraToCenterDistance,T.signedDistanceFromCamera),A=t.ap(f,g,w),P=s?A*n.transform.getPitchedTextCorrection(w.anchorX,w.anchorY,c)/C:A*C,I=De({projectionContext:S,pitchedLabelPlaneMatrixInverse:o,symbol:w,fontSize:P,flip:!1,keepUpright:a,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:_,aspectRatio:b,rotateToLine:l});x=I.useVertical,(I.notEnoughRoom||x||I.needsFlipping&&De({projectionContext:S,pitchedLabelPlaneMatrixInverse:o,symbol:w,fontSize:P,flip:!0,keepUpright:a,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:_,aspectRatio:b,rotateToLine:l}).notEnoughRoom)&&We(w.numGlyphs,_)}i?e.text.dynamicLayoutVertexBuffer.updateData(_):e.icon.dynamicLayoutVertexBuffer.updateData(_)}function Oe(e,t,n,i,r,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=t.getoffsetX(o.glyphStartIndex),d=t.getoffsetX(l-1),p=$e(e*h,n,i,r,o.segment,c,u,a,s);if(!p)return null;const f=$e(e*d,n,i,r,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function Le(e,n,i,r){return e===t.ao.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(e===t.ao.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function De(e){const{projectionContext:n,pitchedLabelPlaneMatrixInverse:i,symbol:r,fontSize:o,flip:s,keepUpright:a,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=e,d=o/24,p=r.lineOffsetX*d,f=r.lineOffsetY*d;let g;if(r.numGlyphs>1){const e=r.glyphStartIndex+r.numGlyphs,t=r.lineStartIndex,o=r.lineStartIndex+r.lineLength,c=Oe(d,l,p,f,s,r,h,n);if(!c)return{notEnoughRoom:!0};const m=ze(c.first.point.x,c.first.point.y,n,i),_=ze(c.last.point.x,c.last.point.y,n,i);if(a&&!s){const e=Le(r.writingMode,m,_,u);if(e)return e}g=[c.first];for(let i=r.glyphStartIndex+1;i<e-1;i++){const e=$e(d*l.getoffsetX(i),p,f,s,r.segment,t,o,n,h);if(!e)return{notEnoughRoom:!0};g.push(e)}g.push(c.last)}else{if(a&&!s){const e=Be(n.tileAnchorPoint.x,n.tileAnchorPoint.y,n).point,o=r.lineStartIndex+r.segment+1,s=new t.P(n.lineVertexArray.getx(o),n.lineVertexArray.gety(o)),a=Be(s.x,s.y,n),l=a.signedDistanceFromCamera>0?a.point:Fe(n.tileAnchorPoint,s,e,1,n),c=ze(e.x,e.y,n,i),h=ze(l.x,l.y,n,i),d=Le(r.writingMode,c,h,u);if(d)return d}const e=$e(d*l.getoffsetX(r.glyphStartIndex),p,f,s,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,n,h);if(!e||n.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};g=[e]}for(const e of g)t.av(c,e.point,e.angle);return{}}function Fe(e,t,n,i,r){const o=e.add(e.sub(t)._unit()),s=Be(o.x,o.y,r).point,a=n.sub(s);return n.add(a._mult(i/a.mag()))}function Ne(e,n,i){const r=n.projectionCache;if(r.projections[e])return r.projections[e];const o=new t.P(n.lineVertexArray.getx(e),n.lineVertexArray.gety(e)),s=Be(o.x,o.y,n);if(s.signedDistanceFromCamera>0)return r.projections[e]=s.point,r.anyProjectionOccluded=r.anyProjectionOccluded||s.isOccluded,s.point;const a=e-i.direction;return Fe(0===i.distanceFromAnchor?n.tileAnchorPoint:new t.P(n.lineVertexArray.getx(a),n.lineVertexArray.gety(a)),o,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,n)}function Be(e,t,n){const i=e+n.translation[0],r=t+n.translation[1];let o;return n.pitchWithMap?(o=Ie(i,r,n.pitchedLabelPlaneMatrix,n.getElevation),o.isOccluded=!1):(o=n.transform.projectTileCoordinates(i,r,n.unwrappedTileID,n.getElevation),o.point.x=(.5*o.point.x+.5)*n.width,o.point.y=(.5*-o.point.y+.5)*n.height),o}function ze(e,n,i,r){if(i.pitchWithMap){const o=[e,n,0,1];return t.aw(o,o,r),i.transform.projectTileCoordinates(o[0]/o[3],o[1]/o[3],i.unwrappedTileID,i.getElevation).point}return{x:e/i.width*2-1,y:1-n/i.height*2}}function je(e,t,n){return n.transform.projectTileCoordinates(e,t,n.unwrappedTileID,n.getElevation)}function Ue(e,t,n){return e._unit()._perp()._mult(t*n)}function Ve(e,n,i,r,o,s,a,l,c){if(l.projectionCache.offsets[e])return l.projectionCache.offsets[e];const u=i.add(n);if(e+c.direction<r||e+c.direction>=o)return l.projectionCache.offsets[e]=u,u;const h=Ne(e+c.direction,l,c),d=Ue(h.sub(i),a,c.direction),p=i.add(d),f=h.add(d);return l.projectionCache.offsets[e]=t.ax(s,u,p,f)||u,l.projectionCache.offsets[e]}function $e(e,t,n,i,r,o,s,a,l){const c=i?e-t:e+t;let u=c>0?1:-1,h=0;i&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+r:o+r+1;a.projectionCache.cachedAnchorPoint?d=a.projectionCache.cachedAnchorPoint:(d=Be(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=d);let f,g,m=d,_=d,y=0,v=0;const b=Math.abs(c),x=[];let w;for(;y+v<=b;){if(p+=u,p<o||p>=s)return null;y+=v,_=m,g=f;const e={absOffsetX:b,direction:u,distanceFromAnchor:y,previousVertex:_};if(m=Ne(p,a,e),0===n)x.push(_),w=m.sub(_);else{let t;const i=m.sub(_);t=0===i.mag()?Ue(Ne(p+u,a,e).sub(m),n,u):Ue(i,n,u),g||(g=_.add(t)),f=Ve(p,t,m,o,s,g,n,a,e),x.push(g),w=f.sub(g)}v=w.mag()}const E=w._mult((b-y)/v)._add(g||_),S=h+Math.atan2(m.y-_.y,m.x-_.x);return x.push(E),{point:E,angle:l?S:0,path:x}}const Ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function We(e,t){for(let n=0;n<e;n++){const e=t.length;t.resize(e+4),t.float32.set(Ge,3*e)}}function He(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const Ze=100;class qe{constructor(e,t=new Te(e.width+200,e.height+200,25),n=new Te(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=n,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ze,this.screenBottomBoundary=e.height+Ze,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,n,i,r,o,s,a,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(e.anchorPointX+a[0],e.anchorPointY+a[1],r,c,h),p=n*d.perspectiveRatio;let f;if(o||s)f=this._projectCollisionBox(e,p,i,r,o,s,a,d,c,u,h);else{const t=d.x+(u?u.x*p:0),n=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[t+e.x1*p,n+e.y1*p,t+e.x2*p,n+e.y2*p]}}const[g,m,_,y]=f.box,v=o?f.allPointsOccluded:d.isOccluded;let b=v;return b||(b=d.perspectiveRatio<this.perspectiveRatioCutoff),b||(b=!this.isInsideGrid(g,m,_,y)),b||"always"!==t&&this.grid.hitTest(g,m,_,y,t,l)?{box:[g,m,_,y],placeable:!1,offscreen:!1,occluded:v}:{box:[g,m,_,y],placeable:!0,offscreen:this.isOffscreen(g,m,_,y),occluded:v}}placeCollisionCircles(e,n,i,r,o,s,a,l,c,u,h,d,p,f){const g=[],m=new t.P(n.anchorX,n.anchorY),_=this.getPerspectiveRatio(m.x,m.y,s,f),y=(c?o*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,s)/_:o*_)/t.aB,v={getElevation:f,pitchedLabelPlaneMatrix:a,lineVertexArray:i,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:m,unwrappedTileID:s,width:this.transform.width,height:this.transform.height,translation:p},b=Oe(y,r,n.lineOffsetX*y,n.lineOffsetY*y,!1,n,!1,v);let x=!1,w=!1,E=!0;if(b){const n=.5*h*_+d,i=new t.P(-100,-100),r=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Ee,s=b.first,a=b.last;let p=[];for(let e=s.path.length-1;e>=1;e--)p.push(s.path[e]);for(let e=1;e<a.path.length;e++)p.push(a.path[e]);const f=2.5*n;if(c){const e=this.projectPathToScreenSpace(p,v);p=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let m=[];if(p.length>0){const e=p[0].clone(),n=p[0].clone();for(let t=1;t<p.length;t++)e.x=Math.min(e.x,p[t].x),e.y=Math.min(e.y,p[t].y),n.x=Math.max(n.x,p[t].x),n.y=Math.max(n.y,p[t].y);m=e.x>=i.x&&n.x<=r.x&&e.y>=i.y&&n.y<=r.y?[p]:n.x<i.x||e.x>r.x||n.y<i.y||e.y>r.y?[]:t.ay([p],i.x,i.y,r.x,r.y)}for(const t of m){o.reset(t,.25*n);let i=0;i=o.length<=.5*n?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<i;t++){const r=t/Math.max(i-1,1),s=o.lerp(r),a=s.x+Ze,c=s.y+Ze;g.push(a,c,n,0);const h=a-n,d=c-n,p=a+n,f=c+n;if(E=E&&this.isOffscreen(h,d,p,f),w=w||this.isInsideGrid(h,d,p,f),"always"!==e&&this.grid.hitTestCircle(a,c,n,e,u)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!w||_<this.perspectiveRatioCutoff?[]:g,offscreen:E,collisionDetected:x}}projectPathToScreenSpace(e,n){const i=function(e,n){const i=t.L();return t.aq(i,n.pitchedLabelPlaneMatrix),e.map((e=>{const t=Ie(e.x,e.y,i,n.getElevation),r=n.transform.projectTileCoordinates(t.point.x,t.point.y,n.unwrappedTileID,n.getElevation);return r.point.x=(.5*r.point.x+.5)*n.width,r.point.y=(.5*-r.point.y+.5)*n.height,r}))}(e,n);return function(e){let t=0,n=0,i=0,r=0;for(let o=0;o<e.length;o++)e[o].isOccluded?(i=o+1,r=0):(r++,r>n&&(n=r,t=i));return e.slice(t,t+n)}(i)}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[],i=new t.a2;for(const r of e){const e=new t.P(r.x+Ze,r.y+Ze);i.extend(e),n.push(e)}const{minX:r,minY:o,maxX:s,maxY:a}=i,l=this.grid.query(r,o,s,a).concat(this.ignoredGrid.query(r,o,s,a)),c={},u={};for(const e of l){const i=e.key;if(void 0===c[i.bucketInstanceId]&&(c[i.bucketInstanceId]={}),c[i.bucketInstanceId][i.featureIndex])continue;const r=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.az(n,r)&&(c[i.bucketInstanceId][i.featureIndex]=!0,void 0===u[i.bucketInstanceId]&&(u[i.bucketInstanceId]=[]),u[i.bucketInstanceId].push(i.featureIndex))}return u}insertCollisionBox(e,t,n,i,r,o){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:o,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r,o){const s=n?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:r,collisionGroupID:o,overlapMode:t};for(let t=0;t<e.length;t+=4)s.insertCircle(a,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,n,i,r,o){if(o){let i;r?(i=[e,n,r(e,n),1],t.aw(i,i,o)):(i=[e,n,0,1],He(i,i,o));const s=i[3];return{x:(i[0]/s+1)/2*this.transform.width+Ze,y:(-i[1]/s+1)/2*this.transform.height+Ze,perspectiveRatio:.5+this.transform.cameraToCenterDistance/s*.5,isOccluded:!1,signedDistanceFromCamera:s}}{const t=this.transform.projectTileCoordinates(e,n,i,r);return{x:(t.point.x+1)/2*this.transform.width+Ze,y:(1-t.point.y)/2*this.transform.height+Ze,perspectiveRatio:.5+this.transform.cameraToCenterDistance/t.signedDistanceFromCamera*.5,isOccluded:t.isOccluded,signedDistanceFromCamera:t.signedDistanceFromCamera}}}getPerspectiveRatio(e,t,n,i){const r=this.transform.projectTileCoordinates(e,t,n,i);return.5+this.transform.cameraToCenterDistance/r.signedDistanceFromCamera*.5}isOffscreen(e,t,n,i){return n<Ze||e>=this.screenRightBoundary||i<Ze||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=t.ag([]);return t.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,i,r,o,s,a,l,c,u,h){let d=1,p=0,f=0,g=1;const m=e.anchorPointX+a[0],_=e.anchorPointY+a[1];if(s&&!o){const e=this.projectAndGetPerspectiveRatio(m+1,_,r,c,h),t=e.x-l.x,n=Math.atan((e.y-l.y)/t)+(t<0?Math.PI:0),i=Math.sin(n),o=Math.cos(n);d=o,p=i,f=-i,g=o}else if(!s&&o){const e=Pe(this.transform);d=e.vecEast[0],p=e.vecEast[1],f=e.vecSouth[0],g=e.vecSouth[1]}let y=l.x,v=l.y,b=n;o&&(y=m,v=_,b=Math.pow(2,-(this.transform.zoom-i.overscaledZ)),b*=this.transform.getPitchedTextCorrection(m,_,r),u||(b*=t.ah(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(y+=d*u.x*b+f*u.y*b,v+=p*u.x*b+g*u.y*b);const x=e.x1*b,w=e.x2*b,E=(x+w)/2,S=e.y1*b,T=e.y2*b,C=(S+T)/2,A=[{offsetX:x,offsetY:S},{offsetX:E,offsetY:S},{offsetX:w,offsetY:S},{offsetX:w,offsetY:C},{offsetX:w,offsetY:T},{offsetX:E,offsetY:T},{offsetX:x,offsetY:T},{offsetX:x,offsetY:C}];let P=[];for(const{offsetX:e,offsetY:n}of A)P.push(new t.P(y+d*e+f*n,v+p*e+g*n));let I=!1;if(o){const e=P.map((e=>this.projectAndGetPerspectiveRatio(e.x,e.y,r,c,h)));I=e.some((e=>!e.isOccluded)),P=e.map((e=>new t.P(e.x,e.y)))}else I=!0;return{box:t.aA(P),allPointsOccluded:!I}}}class Xe{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class Ye{constructor(e,t,n,i,r){this.text=new Xe(e?e.text:null,t,n,r),this.icon=new Xe(e?e.icon:null,t,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ke{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class Je{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class Qe{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function et(e,n,i,r,o){const{horizontalAlign:s,verticalAlign:a}=t.aH(e);return new t.P(-(s-.5)*n+r[0]*o,-(a-.5)*i+r[1]*o)}class tt{constructor(e,t,n,i,r){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new qe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Qe(i),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const t=this.terrain;return t?(n,i)=>t.getElevation(e,n,i):null}getBucketParts(e,n,i,r){const o=i.getBucket(n),s=i.latestFeatureIndex;if(!o||!s||n.id!==o.layerIds[0])return;const a=i.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/t.$,d=i.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=t.aC(i,1,this.transform.zoom),g=t.aD(this.collisionIndex.transform,i,c.get("text-translate"),c.get("text-translate-anchor")),m=t.aD(this.collisionIndex.transform,i,c.get("icon-translate"),c.get("icon-translate-anchor")),_=Ce(p,this.transform,f);this.retainedQueryData[o.bucketInstanceId]=new Je(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,i.tileID);const y={bucket:o,layout:l,translationText:g,translationIcon:m,unwrappedTileID:d,pitchedLabelPlaneMatrix:_,scale:u,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.an(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const t of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=t;e.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}attemptAnchorPlacement(e,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v,b){const x=t.aE[e.textAnchor],w=[e.textOffset0,e.textOffset1],E=et(x,i,r,w,o),S=this.collisionIndex.placeCollisionBox(n,d,l,c,u,a,s,m,h.predicate,v,E,b);if((!y||this.collisionIndex.placeCollisionBox(y,d,l,c,u,a,s,_,h.predicate,v,E,b).placeable)&&S.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(e=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:w,width:i,height:r,anchor:x,textBoxScale:o,prevAnchor:e},this.markUsedJustification(f,x,p,g),f.allowVerticalPlacement&&(this.markUsedOrientation(f,g,p),this.placedOrientations[p.crossTileID]=g),{shift:E,placedGlyphBoxes:S}}}placeLayerBucketPart(e,n,i){const{bucket:r,layout:o,translationText:s,translationIcon:a,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=e.parameters,g=o.get("text-optional"),m=o.get("icon-optional"),_=t.aF(o,"text-overlap","text-allow-overlap"),y="always"===_,v=t.aF(o,"icon-overlap","icon-allow-overlap"),b="always"===v,x="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),E="none"!==o.get("icon-text-fit"),S="viewport-y"===o.get("symbol-z-order"),T=y&&(b||!r.hasIconData()||m),C=b&&(y||!r.hasTextData()||g);!r.collisionArrays&&d&&r.deserializeCollisionBoxes(d);const A=this.retainedQueryData[r.bucketInstanceId].tileID,P=this._getTerrainElevationFunc(A),I=this.transform.getFastPathSimpleProjectionMatrix(A),M=(e,d,b)=>{var S,M;if(n[e.crossTileID])return;if(h)return void(this.placements[e.crossTileID]=new Ke(!1,!1,!1));let R=!1,k=!1,O=!0,L=null,D={box:null,placeable:!1,offscreen:null,occluded:!1},F={placeable:!1},N=null,B=null,z=null,j=0,U=0,V=0;d.textFeatureIndex?j=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(j=e.featureIndex),d.verticalTextFeatureIndex&&(U=d.verticalTextFeatureIndex);const $=d.textBox;if($){const n=n=>{let i=t.ao.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,i=t,this.markUsedOrientation(r,i,e))}return i},o=(n,i)=>{if(r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const e of r.writingModes)if(e===t.ao.vertical?(D=i(),F=D):D=n(),D&&D.placeable)break}else D=n()},c=e.textAnchorOffsetStartIndex,h=e.textAnchorOffsetEndIndex;if(h===c){const i=(t,n)=>{const i=this.collisionIndex.placeCollisionBox(t,_,u,A,l,w,x,s,f.predicate,P,void 0,I);return i&&i.placeable&&(this.markUsedOrientation(r,n,e),this.placedOrientations[e.crossTileID]=n),i};o((()=>i($,t.ao.horizontal)),(()=>{const n=d.verticalTextBox;return r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?i(n,t.ao.vertical):{box:null,offscreen:null}})),n(D&&D.placeable)}else{let p=t.aE[null===(M=null===(S=this.prevPlacement)||void 0===S?void 0:S.variableOffsets[e.crossTileID])||void 0===M?void 0:M.anchor];const g=(t,n,o)=>{const d=t.x2-t.x1,g=t.y2-t.y1,m=e.textBoxScale,y=E&&"never"===v?n:null;let b=null,S="never"===_?1:2,T="never";p&&S++;for(let n=0;n<S;n++){for(let n=c;n<h;n++){const i=r.textAnchorOffsets.get(n);if(p&&i.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(i,t,d,g,m,x,w,u,A,l,f,T,e,r,o,s,a,y,P);if(c&&(b=c.placedGlyphBoxes,b&&b.placeable))return R=!0,L=c.shift,b}p?p=null:T=_}return i&&!b&&(b={box:this.collisionIndex.placeCollisionBox($,"always",u,A,l,w,x,s,f.predicate,P,void 0,I).box,offscreen:!1,placeable:!1,occluded:!1}),b};o((()=>g($,d.iconBox,t.ao.horizontal)),(()=>{const n=d.verticalTextBox;return r.allowVerticalPlacement&&(!D||!D.placeable)&&e.numVerticalGlyphVertices>0&&n?g(n,d.verticalIconBox,t.ao.vertical):{box:null,occluded:!0,offscreen:null}})),D&&(R=D.placeable,O=D.offscreen);const m=n(D&&D.placeable);if(!R&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(r,t.anchor,e,m))}}}if(N=D,R=N&&N.placeable,O=N&&N.offscreen,e.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),a=t.ap(r.textSizeData,p,n),u=o.get("text-padding");B=this.collisionIndex.placeCollisionCircles(_,n,r.lineVertexArray,r.glyphOffsetArray,a,l,c,i,w,f.predicate,e.collisionCircleDiameter,u,s,P),B.circles.length&&B.collisionDetected&&!i&&t.w("Collisions detected, but collision boxes are not shown"),R=y||B.circles.length>0&&!B.collisionDetected,O=O&&B.offscreen}if(d.iconFeatureIndex&&(V=d.iconFeatureIndex),d.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,v,u,A,l,w,x,a,f.predicate,P,E&&L?L:void 0,I);F&&F.placeable&&d.verticalIconBox?(z=e(d.verticalIconBox),k=z.placeable):(z=e(d.iconBox),k=z.placeable),O=O&&z.offscreen}const G=g||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,W=m||0===e.numIconVertices;G||W?W?G||(k=k&&R):R=k&&R:k=R=k&&R;const H=k&&z.placeable;if(R&&N.placeable&&this.collisionIndex.insertCollisionBox(N.box,_,o.get("text-ignore-placement"),r.bucketInstanceId,F&&F.placeable&&U?U:j,f.ID),H&&this.collisionIndex.insertCollisionBox(z.box,v,o.get("icon-ignore-placement"),r.bucketInstanceId,V,f.ID),B&&R&&this.collisionIndex.insertCollisionCircles(B.circles,_,o.get("text-ignore-placement"),r.bucketInstanceId,j,f.ID),i&&this.storeCollisionData(r.bucketInstanceId,b,d,N,z,B),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===r.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new Ke((R||T)&&!(null==N?void 0:N.occluded),(k||C)&&!(null==z?void 0:z.occluded),O||r.justReloaded),n[e.crossTileID]=!0};if(S){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=r.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let e=t.length-1;e>=0;--e){const n=t[e];M(r.symbolInstances.get(n),r.collisionArrays[n],n)}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)M(r.symbolInstances.get(t),r.collisionArrays[t],t);r.justReloaded=!1}storeCollisionData(e,t,n,i,r,o){if(n.textBox||n.iconBox){let o,s;this.collisionBoxArrays.has(e)?o=this.collisionBoxArrays.get(e):(o=new Map,this.collisionBoxArrays.set(e,o)),o.has(t)?s=o.get(t):(s={text:null,icon:null},o.set(t,s)),n.textBox&&(s.text=i.box),n.iconBox&&(s.icon=r.box)}if(o){let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=[]);for(let e=0;e<o.circles.length;e+=4)t.push(o.circles[e+0]-Ze),t.push(o.circles[e+1]-Ze),t.push(o.circles[e+2]),t.push(o.collisionDetected?1:0)}}markUsedJustification(e,n,i,r){let o;o=r===t.ao.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[t.aG(n)];const s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:i.crossTileID)}markUsedOrientation(e,n,i){const r=n===t.ao.horizontal||n===t.ao.horizontalOnly?n:0,o=n===t.ao.vertical?n:0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=r[e];o?(this.opacities[e]=new Ye(o,i,t.text,t.icon),n=n||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new Ye(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new Ye(t,i,!1,!1);r.isHidden()||(this.opacities[e]=r,n=n||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);if(t&&void 0===t.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n={};for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i.tileID,n,i.collisionBoxArray)}}updateBucketOpacities(e,n,i,r){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const o=e.layers[0],s=o.layout,a=new Ye(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new Ye(null,0,l&&(c||!e.hasIconData()||s.get("icon-optional")),c&&(l||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const g=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n);e.hasVisibleVertices=e.hasVisibleVertices||n!==ht},m=this.collisionBoxArrays.get(e.bucketInstanceId);for(let n=0;n<e.symbolInstances.length;n++){const r=e.symbolInstances.get(n),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=r;let c=this.opacities[l];i[l]?c=a:c||(c=f,this.opacities[l]=c),i[l]=!0;const _=r.numIconVertices>0,y=this.placedOrientations[r.crossTileID],v=y===t.ao.vertical,b=y===t.ao.horizontal||y===t.ao.horizontalOnly;if(o>0||s>0){const t=ut(c.text);g(e.text,o,v?ht:t),g(e.text,s,b?ht:t);const n=c.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=n||v?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=n||b?1:0);const i=this.variableOffsets[r.crossTileID];i&&this.markUsedJustification(e,i.anchor,r,y);const a=this.placedOrientations[r.crossTileID];a&&(this.markUsedJustification(e,"left",r,a),this.markUsedOrientation(e,a,r))}if(_){const t=ut(c.icon),n=!(p&&r.verticalPlacedIconSymbolIndex&&v);r.placedIconSymbolIndex>=0&&(g(e.icon,r.numIconVertices,n?t:ht),e.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=c.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(g(e.icon,r.numVerticalIconVertices,n?ht:t),e.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const x=m&&m.has(n)?m.get(n):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[n];if(i){let n=new t.P(0,0);if(i.textBox||i.verticalTextBox){let t=!0;if(u){const e=this.variableOffsets[l];e?(n=et(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),h&&n._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):t=!1}if(i.textBox||i.verticalTextBox){let r;i.textBox&&(r=v),i.verticalTextBox&&(r=b),nt(e.textCollisionBox.collisionVertexArray,c.text.placed,!t||r,x.text,n.x,n.y)}}if(i.iconBox||i.verticalIconBox){const t=Boolean(!b&&i.verticalIconBox);let r;i.iconBox&&(r=t),i.verticalIconBox&&(r=!t),nt(e.iconCollisionBox.collisionVertexArray,c.icon.placed,r,x.icon,p?n.x:0,p?n.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function nt(e,t,n,i,r,o){i&&0!==i.length||(i=[0,0,0,0]);const s=i[0]-Ze,a=i[1]-Ze,l=i[2]-Ze,c=i[3]-Ze;e.emplaceBack(t?1:0,n?1:0,r||0,o||0,s,a),e.emplaceBack(t?1:0,n?1:0,r||0,o||0,l,a),e.emplaceBack(t?1:0,n?1:0,r||0,o||0,l,c),e.emplaceBack(t?1:0,n?1:0,r||0,o||0,s,c)}const it=Math.pow(2,25),rt=Math.pow(2,24),ot=Math.pow(2,17),st=Math.pow(2,16),at=Math.pow(2,9),lt=Math.pow(2,8),ct=Math.pow(2,1);function ut(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*it+t*rt+n*ot+t*st+n*at+t*lt+n*ct+t}const ht=0;class dt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;)if(t.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class pt{constructor(e,t,n,i,r,o,s,a){this.placement=new tt(e,t,o,s,a),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n){const i=s.now(),r=()=>!this._forceFullPlacement&&s.now()-i>2;for(;this._currentPlacementIndex>=0;){const i=t[e[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=o)&&(!i.maxzoom||i.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new dt(i)),this._inProgressLayer.continuePlacement(n[i.source],this.placement,this._showCollisionBoxes,i,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ft=512/t.$/2;class gt{constructor(e,n,i){this.tileID=e,this.bucketInstanceId=i,this._symbolsByKey={};const r=new Map;for(let e=0;e<n.length;e++){const t=n.get(e),i=t.key,o=r.get(i);o?o.push(t):r.set(i,[t])}for(const[e,n]of r){const i={positions:n.map((e=>({x:Math.floor(e.anchorX*ft),y:Math.floor(e.anchorY*ft)}))),crossTileIDs:n.map((e=>e.crossTileID))};if(i.positions.length>128){const e=new t.aI(i.positions.length,16,Uint16Array);for(const{x:t,y:n}of i.positions)e.add(t,n);e.finish(),delete i.positions,i.index=e}this._symbolsByKey[e]=i}}getScaledCoordinates(e,n){const{x:i,y:r,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=n.canonical,c=ft/Math.pow(2,l-o),u=(a*t.$+e.anchorY)*c,h=r*t.$*ft;return{x:Math.floor((s*t.$+e.anchorX)*c-i*t.$*ft),y:Math.floor(u-h)}}findMatches(e,t,n){const i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const o=e.get(r);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);if(s.index){const e=s.index.range(a.x-i,a.y-i,a.x+i,a.y+i).sort();for(const t of e){const e=s.crossTileIDs[t];if(!n[e]){n[e]=!0,o.crossTileID=e;break}}}else if(s.positions)for(let e=0;e<s.positions.length;e++){const t=s.positions[e],r=s.crossTileIDs[e];if(Math.abs(t.x-a.x)<=i&&Math.abs(t.y-a.y)<=i&&!n[r]){n[r]=!0,o.crossTileID=r;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class mt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _t{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const n=this.indexes[e],i={};for(const e in n){const r=n[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[e]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const i=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const r=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in r){const o=r[n];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=r[e.scaledTo(Number(n)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=n.generate(),i[r.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new gt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.getCrossTileIDsLists())for(const t of n)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class yt{constructor(){this.layerIndexes={},this.crossTileIDs=new mt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new _t);let r=!1;const o={};i.handleWrapJump(n);for(const n of t){const t=n.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(n.tileID,t,this.crossTileIDs)&&(r=!0),o[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}var vt="void main() {fragColor=vec4(1.0);}";const bt={prelude:xt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:xt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:xt("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:xt("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:xt("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:xt(vt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:xt("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:xt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:xt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:xt(vt,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:xt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:xt("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:xt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:xt("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:xt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xt("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:xt("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:xt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:xt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:xt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:xt("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:xt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:xt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:xt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:xt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:xt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:xt("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:xt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function xt(e,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=t.match(/in ([\w]+) ([\w]+)/g),r=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(r):r,a={};return{fragmentSource:e=e.replace(n,((e,t,n,i,r)=>(a[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nin ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = u_${r};\n#endif\n`))),vertexSource:t=t.replace(n,((e,t,n,i,r)=>{const o="float"===i?"vec2":"vec4",s=r.match(/color/)?"color":o;return a[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${n} ${o} a_${r};\nout ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${n} ${o} a_${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`})),staticAttributes:i,staticUniforms:s}}class wt{constructor(e,t,n){this.vertexBuffer=e,this.indexBuffer=t,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Et=t.aJ([{name:"a_pos",type:"Int16",components:2}]);const St="#define PROJECTION_MERCATOR",Tt="mercator";class Ct{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Tt}get shaderDefine(){return St}get shaderPreludeCode(){return bt.projectionMercator}get vertexShaderPreludeCode(){return bt.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,i,r,o){if(this._cachedMesh)return this._cachedMesh;const s=new t.aL;s.emplaceBack(0,0),s.emplaceBack(t.$,0),s.emplaceBack(0,t.$),s.emplaceBack(t.$,t.$);const a=e.createVertexBuffer(s,Et.members),l=t.aM.simpleSegment(0,0,4,2),c=new t.aN;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=e.createIndexBuffer(c);return this._cachedMesh=new wt(a,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class At{constructor(e=0,t=0,n=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=t.C.number(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.C.number(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=t.C.number(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=t.C.number(e.right,n.right,i)),this}getCenter(e,n){const i=t.ah((this.left+e-this.right)/2,0,e),r=t.ah((this.top+n-this.bottom)/2,0,n);return new t.P(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new At(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Pt(e,t){if(!e.renderWorldCopies||e.lngRange)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}function It(e){return Math.max(0,Math.floor(e))}class Mt{constructor(e,n,i,r,o,s){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=void 0===s||!!s,this._minZoom=n||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==o?60:o,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=It(this._zoom),this._scale=t.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new At,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,i){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=It(this._zoom),this._scale=t.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new At(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!i&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=t.aO(e,-180,180)*Math.PI/180;var r,o,s,a,l,c,u,h,d;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=i(),r=this._rotationMatrix,s=-this._bearingInRadians,a=(o=this._rotationMatrix)[0],l=o[1],c=o[2],u=o[3],h=Math.sin(s),d=Math.cos(s),r[0]=a*d+c*h,r[1]=l*d+u*h,r[2]=a*-h+c*d,r[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=t.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const t=e/180*Math.PI;this._rollInRadians!==t&&(this._unmodified=!1,this._rollInRadians=t,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aP(this._fovInRadians)}setFov(e){e=t.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=t.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=t.af(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,t){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=t,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}resize(e,t,n=!0){this._width=e,this._height=t,n&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new $([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-t.ai,t.ai])}getConstrained(e,t){return this._callbacks.getConstrained(e,t)}getCameraQueryGeometry(e,n){if(1===n.length)return[n[0],e];{const{minX:i,minY:r,maxX:o,maxY:s}=t.a2.fromPoints(n).extend(e);return[new t.P(i,r),new t.P(o,r),new t.P(o,s),new t.P(i,s),new t.P(i,r)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:t,zoom:n}=this.getConstrained(this.center,this.zoom);this.setCenter(t),this.setZoom(n),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=t.ag(new Float64Array(16));t.N(e,e,[this._width/2,-this._height/2,1]),t.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=t.ag(new Float64Array(16)),t.N(e,e,[1,-1,1]),t.M(e,e,[-1,-1,0]),t.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,i,r){const o=void 0!==i?i:this.bearing,s=r=void 0!==r?r:this.pitch,a=t.a1.fromLngLat(e,n),l=-Math.cos(t.ae(s)),c=Math.sin(t.ae(s)),u=c*Math.sin(t.ae(o)),h=-c*Math.cos(t.ae(o));let d=this.elevation;const p=n-d;let f;l*p>=0||Math.abs(l)<.1?(f=1e4,d=n+f*l):f=-p/l;let g,m,_=t.aQ(1,a.y),y=0;do{if(y+=1,y>10)break;m=f/_,g=new t.a1(a.x+u*m,a.y+h*m),_=1/g.meterInMercatorCoordinateUnits()}while(Math.abs(f-m*_)>1e-12);return{center:g.toLngLat(),elevation:d,zoom:t.ak(this.height/2/Math.tan(this.fovInRadians/2)/m/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=t.aj(1,this.center.lat)*this.worldSize,i=this.cameraToCenterDistance/n,r=t.a1.fromLngLat(this.center,this.elevation),o=de(this.center,this.elevation,this.pitch,this.bearing,i);this._elevation=e;const s=this.calculateCenterFromCameraLngLatAlt(o.toLngLat(),t.aQ(o.z,r.y),this.bearing,this.pitch);this._elevation=s.elevation,this._center=s.center,this.setZoom(s.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=t.aj(1,this.center.lat)*this.worldSize;return de(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/t.$,1/n/t.$]}}class Rt{constructor(e,n){this.min=e,this.max=n,this.center=t.aR([],t.aS([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],i=t.aT(this.min),r=t.aT(this.max);for(let e=0;e<n.length;e++)i[e]=n[e]?this.min[e]:this.center[e],r[e]=n[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Rt(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let t=!0;for(let n=0;n<e.planes.length;n++){const i=this.intersectsPlane(e.planes[n]);if(0===i)return 0;1===i&&(t=!1)}return t?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let t=e[3],n=e[3];for(let i=0;i<3;i++)e[i]>0?(t+=e[i]*this.min[i],n+=e[i]*this.max[i]):(n+=e[i]*this.min[i],t+=e[i]*this.max[i]);return t>=0?2:n<0?0:1}}class kt{distanceToTile2d(e,t,n,i){const r=i.distanceX([e,t]),o=i.distanceY([e,t]);return Math.hypot(r,o)}getWrap(e,t,n){return n}getTileBoundingVolume(e,n,i,r){var o,s;let a=0,l=0;if(null==r?void 0:r.terrain){const c=new t.Z(e.z,n,e.z,e.x,e.y),u=r.terrain.getMinMaxElevation(c);a=null!==(o=u.minElevation)&&void 0!==o?o:Math.min(0,i),l=null!==(s=u.maxElevation)&&void 0!==s?s:Math.max(0,i)}const c=1<<e.z;return new Rt([n+e.x/c,e.y/c,a],[n+(e.x+1)/c,(e.y+1)/c,l])}allowVariableZoom(e,n){const i=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,r=t.ah(78.5-i/2,0,60);return!!n.terrain||e.pitch>r}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ot{constructor(e,t,n){this.points=e,this.planes=t,this.aabb=n}static fromInvProjectionMatrix(e,n=1,i=0,r,o){const s=o?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],a=Math.pow(2,i),l=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>function(e,n,i,r){const o=t.aw([],e,n),s=1/o[3]/i*r;return t.aY(o,o,[s,s,1/o[3],s])}(i,e,n,a)));r&&function(e,n,i,r){const o=r?4:0,s=r?0:4;let a=0;const l=[],c=[];for(let n=0;n<4;n++){const i=t.aU([],e[n+s],e[n+o]),r=t.aZ(i);t.aR(i,i,1/r),l.push(r),c.push(i)}for(let n=0;n<4;n++){const r=t.a_(e[n+o],c[n],i);a=null!==r&&r>=0?Math.max(a,r):Math.max(a,l[n])}const u=function(e,n){const i=t.aU([],e[n[0]],e[n[1]]),r=t.aU([],e[n[2]],e[n[1]]),o=[0,0,0,0];return t.aV(o,t.aW([],i,r)),o[3]=-t.aX(o,e[n[0]]),o}(e,n),h=function(e,n){const i=t.a$(e),r=t.b0([],e,1/i),o=t.aU([],n,t.aR([],r,t.aX(n,r))),s=t.a$(o);if(s>0){const e=Math.sqrt(1-r[3]*r[3]),i=t.aR([],r,-r[3]),a=t.aS([],i,t.aR([],o,e/s));return t.b1(n,a)}return null}(i,u);if(null!==h){const e=h/t.aX(c[0],u);a=Math.min(a,e)}for(let t=0;t<4;t++){const n=Math.min(a,l[t]);e[t+s]=[e[t+o][0]+c[t][0]*n,e[t+o][1]+c[t][1]*n,e[t+o][2]+c[t][2]*n,1]}}(l,s[0],r,o);const c=s.map((e=>{const n=t.aU([],l[e[0]],l[e[1]]),i=t.aU([],l[e[2]],l[e[1]]),r=t.aV([],t.aW([],n,i)),o=-t.aX(r,l[e[1]]);return r.concat(o)})),u=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],h=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of l)for(let t=0;t<3;t++)u[t]=Math.min(u[t],e[t]),h[t]=Math.max(h[t],e[t]);return new Ot(l,c,new Rt(u,h))}}class Lt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,n=!0){this._helper.resize(e,t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,t){}constructor(e,t,n,i,r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Mt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)},e,t,n,i,r),this._coveringTilesDetailsProvider=new kt}clone(){const e=new Lt;return e.apply(this),e}apply(e,t,n){this._helper.apply(e,t,n)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new t.b2(0,e)];if(this._helper._renderWorldCopies){const i=this.screenPointToMercatorCoordinate(new t.P(0,0)),r=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),o=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),s=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),a=Math.floor(Math.min(i.x,r.x,o.x,s.x)),l=Math.floor(Math.max(i.x,r.x,o.x,s.x)),c=1;for(let i=a-c;i<=l+c;i++)0!==i&&n.push(new t.b2(i,e))}return n}getCameraFrustum(){return Ot.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const t=this.screenPointToLocation(this.centerPoint,e),n=e?e.getElevationForLngLatZoom(t,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(n)}setLocationAtPoint(e,n){const i=t.aj(this.elevation,this.center.lat),r=this.screenPointToMercatorCoordinateAtZ(n,i),o=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,i),s=t.a1.fromLngLat(e),a=new t.a1(s.x-(r.x-o.x),s.y-(r.y-o.y));this.setCenter(null==a?void 0:a.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(t.a1.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(t.a1.fromLngLat(e))}screenPointToLocation(e,t){var n;return null===(n=this.screenPointToMercatorCoordinate(e,t))||void 0===n?void 0:n.toLngLat()}screenPointToMercatorCoordinate(e,t){if(t){const n=t.pointCoordinate(e);if(null!=n)return n}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const i=n||0,r=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.aw(r,r,this._pixelMatrixInverse),t.aw(o,o,this._pixelMatrixInverse);const s=r[3],a=o[3],l=r[1]/s,c=o[1]/a,u=r[2]/s,h=o[2]/a,d=u===h?0:(i-u)/(h-u);return new t.a1(t.C.number(r[0]/s,o[0]/a,d)/this.worldSize,t.C.number(l,c,d)/this.worldSize,i)}coordinatePoint(e,n=0,i=this._pixelMatrix){const r=[e.x*this.worldSize,e.y*this.worldSize,n,1];return t.aw(r,r,i),new t.P(r[0]/r[3],r[1]/r[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ue(this));return(new $).extend(this.screenPointToLocation(new t.P(0,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(e,t){return t?null!=t.pointCoordinate(e):e.y>this.height/2-ue(this)}calculatePosMatrix(e,n=!1,i){var r;const o=null!==(r=e.key)&&void 0!==r?r:t.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),s=n?this._alignedPosMatrixCache:this._posMatrixCache;if(s.has(o)){const e=s.get(o);return i?e.f32:e.f64}const a=he(e,this.worldSize);t.O(a,n?this._alignedProjMatrix:this._viewProjMatrix,a);const l={f64:a,f32:new Float32Array(a)};return s.set(o,l),i?l.f32:l.f64}calculateFogMatrix(e){const n=e.key,i=this._fogMatrixCacheF32;if(i.has(n))return i.get(n);const r=he(e,this.worldSize);return t.O(r,this._fogMatrix,r),i.set(n,new Float32Array(r)),i.get(n)}getConstrained(e,n){n=t.ah(+n,this.minZoom,this.maxZoom);const i={center:new t.S(e.lng,e.lat),zoom:n};let r=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===r){const e=180-1e-10;r=[-e,e]}const o=this.tileSize*t.af(i.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const e=this._helper._latRange;s=t.U(e[1])*o,a=t.U(e[0])*o,a-s<p&&(u=p/(a-s))}r&&(l=t.aO(t.V(r[0])*o,0,o),c=t.aO(t.V(r[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:g}=le(o,e);let m,_;const y=Math.max(h||0,u||0);if(y){const e=new t.P(h?(c+l)/2:f,u?(a+s)/2:g);return i.center=ce(o,e).wrap(),i.zoom+=t.ak(y),i}if(this._helper._latRange){const e=p/2;g-e<s&&(_=s+e),g+e>a&&(_=a-e)}if(r){const e=(l+c)/2;let n=f;this._helper._renderWorldCopies&&(n=t.aO(f,e-o/2,e+o/2));const i=d/2;n-i<l&&(m=l+i),n+i>c&&(m=c-i)}if(void 0!==m||void 0!==_){const e=new t.P(null!=m?m:f,null!=_?_:g);i.center=ce(o,e).wrap()}return i}calculateCenterFromCameraLngLatAlt(e,t,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,i)}_calculateNearFarZIfNeeded(e,n,i){if(!this._helper.autoCalculateNearFarZ)return;const r=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),o=e-r*this._helper._pixelPerMeter/Math.cos(n),s=r<0?o:e,a=Math.PI/2+this.pitchInRadians,l=t.ae(this.fov)*(Math.abs(Math.cos(t.ae(this.roll)))*this.height+Math.abs(Math.sin(t.ae(this.roll)))*this.width)/this.height*(.5+i.y/this.height),c=Math.sin(l)*s/Math.sin(t.ah(Math.PI-a-l,.01,Math.PI-.01)),u=ue(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=t.ae(.75),p=h>d?2*h*(.5+i.y/(2*u)):d,f=Math.sin(p)*s/Math.sin(t.ah(Math.PI-a-p,.01,Math.PI-.01)),g=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*g+s),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=le(this.worldSize,this.center),i=n.x,r=n.y;this._helper._pixelPerMeter=t.aj(1,this.center.lat)*this.worldSize;const o=t.ae(Math.min(this.pitch,ae)),s=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(o));let a;this._calculateNearFarZIfNeeded(s,o,e),a=new Float64Array(16),t.b4(a,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.aq(this._invProjMatrix,a),a[8]=2*-e.x/this._helper._width,a[9]=2*e.y/this._helper._height,this._projectionMatrix=t.b5(a),t.N(a,a,[1,-1,1]),t.M(a,a,[0,0,-this._helper.cameraToCenterDistance]),t.b6(a,a,-this.rollInRadians),t.b7(a,a,this.pitchInRadians),t.b6(a,a,-this.bearingInRadians),t.M(a,a,[-i,-r,0]),this._mercatorMatrix=t.N([],a,[this.worldSize,this.worldSize,this.worldSize]),t.N(a,a,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,a),t.M(a,a,[0,0,-this.elevation]),this._viewProjMatrix=a,this._invViewProjMatrix=t.aq([],a);const l=[0,0,-1,1];t.aw(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),t.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,s,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,t.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.M(this._fogMatrix,this._fogMatrix,[-i,-r,0]),t.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,a);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=i-Math.round(i)+h*c+d*u,f=r-Math.round(r)+h*u+d*c,g=new Float64Array(a);if(t.M(g,g,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=g,a=t.aq(new Float64Array(16),this._pixelMatrix),!a)throw new Error("failed to invert matrix");this._pixelMatrixInverse=a,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new t.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.aw(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=t.aj(1,this.center.lat)*this.worldSize;return de(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const i=t.a1.fromLngLat(e),r=[i.x*this.worldSize,i.y*this.worldSize,n,1];return t.aw(r,r,this._viewProjMatrix),r[2]/r[3]}getProjectionData(e){const{overscaledTileID:n,aligned:i,applyTerrainMatrix:r}=e,o=this._helper.getMercatorTileCoordinates(n),s=n?this.calculatePosMatrix(n,i,!0):null;let a;return a=n&&n.terrainRttPosMatrix32f&&r?n.terrainRttPosMatrix32f:s||t.b8(),{mainMatrix:a,tileMercatorCoords:o,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,t,n){return 1}transformLightDirection(e){return t.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,i,r){const o=this.calculatePosMatrix(i);let s;r?(s=[e,n,r(e,n),1],t.aw(s,s,o)):(s=[e,n,0,1],He(s,s,o));const a=s[3];return{point:new t.P(s[0]/a,s[1]/a),signedDistanceFromCamera:a,isOccluded:!1}}populateCache(e){for(const t of e)this.calculatePosMatrix(t)}getMatrixForModel(e,n){const i=t.a1.fromLngLat(e,n),r=i.meterInMercatorCoordinateUnits(),o=t.b9();return t.M(o,o,[i.x,i.y,i.z]),t.b6(o,o,Math.PI),t.b7(o,o,Math.PI/2),t.N(o,o,[-r,r,r]),o}getProjectionDataForCustomLayer(e=!0){const n=new t.Z(0,0,0,0,0),i=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),r=he(n,this.worldSize);t.O(r,this._viewProjMatrix,r),i.tileMercatorCoords=[0,0,1,1];const o=[t.$,t.$,this.worldSize/this._helper.pixelsPerMeter],s=t.ba();return t.N(s,r,o),i.fallbackMatrix=s,i.mainMatrix=s,i}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Dt(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ft(e){if(e.useSlerp)if(e.k<1){const n=t.bb(e.startEulerAngles.roll,e.startEulerAngles.pitch,e.startEulerAngles.bearing),i=t.bb(e.endEulerAngles.roll,e.endEulerAngles.pitch,e.endEulerAngles.bearing),r=new Float64Array(4);t.bc(r,n,i,e.k);const o=t.bd(r);e.tr.setRoll(o.roll),e.tr.setPitch(o.pitch),e.tr.setBearing(o.bearing)}else e.tr.setRoll(e.endEulerAngles.roll),e.tr.setPitch(e.endEulerAngles.pitch),e.tr.setBearing(e.endEulerAngles.bearing);else e.tr.setRoll(t.C.number(e.startEulerAngles.roll,e.endEulerAngles.roll,e.k)),e.tr.setPitch(t.C.number(e.startEulerAngles.pitch,e.endEulerAngles.pitch,e.k)),e.tr.setBearing(t.C.number(e.startEulerAngles.bearing,e.endEulerAngles.bearing,e.k))}function Nt(e,n,i,r,o){const s=o.padding,a=le(o.worldSize,i.getNorthWest()),l=le(o.worldSize,i.getNorthEast()),c=le(o.worldSize,i.getSouthEast()),u=le(o.worldSize,i.getSouthWest()),h=t.ae(-r),d=a.rotate(h),p=l.rotate(h),f=c.rotate(h),g=u.rotate(h),m=new t.P(Math.max(d.x,p.x,g.x,f.x),Math.max(d.y,p.y,g.y,f.y)),_=new t.P(Math.min(d.x,p.x,g.x,f.x),Math.min(d.y,p.y,g.y,f.y)),y=m.sub(_),v=(o.width-(s.left+s.right+n.left+n.right))/y.x,b=(o.height-(s.top+s.bottom+n.top+n.bottom))/y.y;if(b<0||v<0)return void Dt();const x=Math.min(t.ak(o.scale*Math.min(v,b)),e.maxZoom),w=t.P.convert(e.offset),E=new t.P((n.left-n.right)/2,(n.top-n.bottom)/2).rotate(t.ae(r)),S=w.add(E).mult(o.scale/t.af(x));return{center:ce(o.worldSize,a.add(c).div(2).sub(S)),zoom:x,bearing:r}}class Bt{get useGlobeControls(){return!1}handlePanInertia(e,t){return{easingOffset:e,easingCenter:t.center}}handleMapControlsRollPitchBearingZoom(e,t){e.bearingDelta&&t.setBearing(t.bearing+e.bearingDelta),e.pitchDelta&&t.setPitch(t.pitch+e.pitchDelta),e.rollDelta&&t.setRoll(t.roll+e.rollDelta),e.zoomDelta&&t.setZoom(t.zoom+e.zoomDelta)}handleMapControlsPan(e,t,n){e.around.distSqr(t.centerPoint)<.01||t.setLocationAtPoint(n,e.around)}cameraForBoxAndBearing(e,t,n,i,r){return Nt(e,t,n,i,r)}handleJumpToCenterZoom(e,n){e.zoom!==(void 0!==n.zoom?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),void 0!==n.center&&e.setCenter(t.S.convert(n.center))}handleEaseTo(e,n){const i=e.zoom,r=e.padding,o={roll:e.roll,pitch:e.pitch,bearing:e.bearing},s={roll:void 0===n.roll?e.roll:n.roll,pitch:void 0===n.pitch?e.pitch:n.pitch,bearing:void 0===n.bearing?e.bearing:n.bearing},a=void 0!==n.zoom,l=!e.isPaddingEqual(n.padding);let c=!1;const u=a?+n.zoom:e.zoom;let h=e.centerPoint.add(n.offsetAsPoint);const d=e.screenPointToLocation(h),{center:p,zoom:f}=e.getConstrained(t.S.convert(n.center||d),null!=u?u:i);Pt(e,p);const g=le(e.worldSize,d),m=le(e.worldSize,p).sub(g),_=t.af(f-i);return c=f!==i,{easeFunc:a=>{if(c&&e.setZoom(t.C.number(i,f,a)),t.be(o,s)||Ft({startEulerAngles:o,endEulerAngles:s,tr:e,k:a,useSlerp:o.roll!=s.roll}),l&&(e.interpolatePadding(r,n.padding,a),h=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const n=t.af(e.zoom-i),r=f>i?Math.min(2,_):Math.max(.5,_),o=Math.pow(r,1-a),s=ce(e.worldSize,g.add(m.mult(a*o)).mult(n));e.setLocationAtPoint(e.renderWorldCopies?s.wrap():s,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(e,n){const i=void 0!==n.zoom,r=e.zoom,o=e.getConstrained(t.S.convert(n.center||n.locationAtOffset),i?+n.zoom:r),s=o.center,a=o.zoom;Pt(e,s);const l=le(e.worldSize,n.locationAtOffset),c=le(e.worldSize,s).sub(l),u=c.mag(),h=t.af(a-r);let d;if(void 0!==n.minZoom){const i=Math.min(+n.minZoom,r,a),o=e.getConstrained(s,i).zoom;d=t.af(o-r)}return{easeFunc:(n,i,o,u)=>{e.setZoom(1===n?a:r+t.ak(i));const h=1===n?s:ce(e.worldSize,l.add(c.mult(o)).mult(i));e.setLocationAtPoint(e.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:s,scaleOfMinZoom:d,pixelPathLength:u}}}class zt{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}zt.Replace=[1,0],zt.disabled=new zt(zt.Replace,t.bf.transparent,[!1,!1,!1,!1]),zt.unblended=new zt(zt.Replace,t.bf.transparent,[!0,!0,!0,!0]),zt.alphaBlended=new zt([1,771],t.bf.transparent,[!0,!0,!0,!0]);const jt=2305;class Ut{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}Ut.disabled=new Ut(!1,1029,jt),Ut.backCCW=new Ut(!0,1029,jt),Ut.frontCCW=new Ut(!0,1028,jt);class Vt{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const $t=7680;class Gt{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}Gt.disabled=new Gt({func:519,mask:0},0,0,$t,$t,$t);const Wt=new WeakMap;function Ht(e){var t;if(Wt.has(e))return Wt.get(e);{const n=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return Wt.set(e,n),n}}class Zt{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,i=n.gl;this._texFormat=i.RGBA,this._texType=i.UNSIGNED_BYTE;const r=new t.aL;r.emplaceBack(-1,-1),r.emplaceBack(2,-1),r.emplaceBack(-1,2);const o=new t.aN;o.emplaceBack(0,1,2),this._fullscreenTriangle=new wt(n.createVertexBuffer(r,Et.members),n.createIndexBuffer(o),t.aM.simpleSegment(0,0,r.length,o.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(i.TEXTURE1);const s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(s),Ht(i)&&(this._pbo=i.createBuffer(),i.bindBuffer(i.PIXEL_PACK_BUFFER,this._pbo),i.bufferData(i.PIXEL_PACK_BUFFER,4,i.STREAM_READ),i.bindBuffer(i.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,t){const n=this._updateCount;return this._readbackQueue?n>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():n>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,t),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,t=e.gl;e.activeTexture.set(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const i=this._cachedRenderContext.context,r=i.gl;if(this._bindFramebuffer(),i.viewport.set([0,0,this._texWidth,this._texHeight]),i.clear({color:t.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(i,r.TRIANGLES,Vt.disabled,Gt.disabled,zt.unblended,Ut.disabled,((e,t)=>({u_input:e,u_output_expected:t}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ht(r)){r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null);const e=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);r.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:e}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ht(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Zt._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let t=0;return t+=e[0]/256,t+=e[1]/65536,t+=e[2]/16777216,e[3]<127&&(t=-t),t/128}}const qt=t.$/128;function Xt(e,n){const i=void 0!==e.granularity?Math.max(e.granularity,1):1,r=i+(e.generateBorders?2:0),o=i+(e.extendToNorthPole||e.generateBorders?1:0)+(e.extendToSouthPole||e.generateBorders?1:0),s=r+1,a=o+1,l=e.generateBorders?-1:0,c=e.generateBorders||e.extendToNorthPole?-1:0,u=i+(e.generateBorders?1:0),h=i+(e.generateBorders||e.extendToSouthPole?1:0),d=s*a,p=r*o*6,f=s*a>65536;if(f&&"16bit"===n)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const g=f||"32bit"===n,m=new Int16Array(2*d);let _=0;for(let n=c;n<=h;n++)for(let r=l;r<=u;r++){let o=r/i*t.$;-1===r&&(o=-qt),r===i+1&&(o=t.$+qt);let s=n/i*t.$;-1===n&&(s=e.extendToNorthPole?t.bh:-qt),n===i+1&&(s=e.extendToSouthPole?t.bi:t.$+qt),m[_++]=o,m[_++]=s}const y=g?new Uint32Array(p):new Uint16Array(p);let v=0;for(let e=0;e<o;e++)for(let t=0;t<r;t++){const n=t+1+e*s,i=t+(e+1)*s,r=t+1+(e+1)*s;y[v++]=t+e*s,y[v++]=i,y[v++]=n,y[v++]=n,y[v++]=i,y[v++]=r}return{vertices:m.buffer.slice(0),indices:y.buffer.slice(0),uses32bitIndices:g}}const Yt=new t.aK({fill:new t.bj(128,2),line:new t.bj(512,0),tile:new t.bj(128,32),stencil:new t.bj(128,1),circle:3});class Kt{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return bt.projectionGlobe}get vertexShaderPreludeCode(){return bt.projectionMercator.vertexSource}get subdivisionGranularity(){return Yt}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Zt(e));const n=t.U(this._errorQueryLatitudeDegrees),i=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,r=this._errorMeasurement.updateErrorLoop(n,i),o=s.now();r!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=r,this._errorMeasurementLastChangeTime=o);const a=Math.min(Math.max((o-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.bl(a))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,t,n,i,r){const o=("stencil"===r?Yt.stencil:Yt.tile).getGranularityForZoomLevel(t.z);return this._getMesh(e,{granularity:o,generateBorders:n,extendToNorthPole:0===t.y&&i,extendToSouthPole:t.y===(1<<t.z)-1&&i})}_getMesh(e,n){const i=this._getMeshKey(n);if(i in this._tileMeshCache)return this._tileMeshCache[i];const r=function(e,n){const i=Xt(n,"16bit"),r=t.aL.deserialize({arrayBuffer:i.vertices,length:i.vertices.byteLength/2/2}),o=t.aN.deserialize({arrayBuffer:i.indices,length:i.indices.byteLength/2/3});return new wt(e.createVertexBuffer(r,Et.members),e.createIndexBuffer(o),t.aM.simpleSegment(0,0,r.length,o.length))}(e,n);return this._tileMeshCache[i]=r,r}recalculate(e){}hasTransition(){const e=s.now();let t=!1;return t=t||(e-this._errorMeasurementLastChangeTime)/1e3<.7,t=t||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,t}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Jt=new t.r({type:new t.D(t.v.projection.type)});class Qt extends t.E{constructor(e){super(),this._transitionable=new t.t(Jt),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.F(0)),this._mercatorProjection=new Ct,this._verticalPerspectiveProjection=new Kt}get transitionState(){const e=this.properties.get("type");if("string"==typeof e&&"mercator"===e)return 0;if("string"==typeof e&&"vertical-perspective"===e)return 1;if(e instanceof t.bm){if("vertical-perspective"===e.from&&"mercator"===e.to)return 1-e.transition;if("mercator"===e.from&&"vertical-perspective"===e.to)return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,t,n,i,r){return this.currentProjection.getMeshFromTileID(e,t,n,i,r)}setProjection(e){this._transitionable.setValue("type",(null==e?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function en(e){const t=rn(e.worldSize,e.center.lat);return 2*Math.PI*t}function tn(e,n,i,r,o){const s=1/(1<<o),a=n/t.$*s+r*s,l=t.bo((e/t.$*s+i*s)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function nn(e){return function(e,t){const n=Math.cos(t),i=new Float64Array(3);return i[0]=Math.sin(e)*n,i[1]=Math.sin(t),i[2]=Math.cos(e)*n,i}(e.lng*Math.PI/180,e.lat*Math.PI/180)}function rn(e,t){return e/(2*Math.PI)/Math.cos(t*Math.PI/180)}function on(e){const n=Math.asin(e[1])/Math.PI*180,i=Math.sqrt(e[0]*e[0]+e[2]*e[2]);if(i>1e-6){const r=e[0]/i,o=Math.acos(e[2]/i),s=(r>0?o:-o)/Math.PI*180;return new t.S(t.aO(s,-180,180),n)}return new t.S(0,n)}function sn(e){return Math.cos(e*Math.PI/180)}function an(e,n){const i=sn(e),r=sn(n);return t.ak(r/i)}function ln(e,n){const i=e.rotate(n.bearingInRadians),r=n.zoom+an(n.center.lat,0),o=t.bk(1/sn(n.center.lat),1/sn(Math.min(Math.abs(n.center.lat),60)),t.bn(r,7,3,0,1)),s=360/en({worldSize:n.worldSize,center:{lat:n.center.lat}});return new t.S(n.center.lng-i.x*s*o,t.ah(n.center.lat+i.y*s,-t.ai,t.ai))}function cn(e){const t=.5*e,n=Math.sin(t),i=Math.cos(t);return Math.log(n+i)-Math.log(i-n)}function un(e,n,i,r){const o=e.lat+i*r;if(Math.abs(i)>1){const s=(Math.sign(e.lat+i)!==Math.sign(e.lat)?-Math.abs(e.lat):Math.abs(e.lat))*Math.PI/180,a=Math.abs(e.lat+i)*Math.PI/180,l=cn(s+r*(a-s)),c=cn(s),u=cn(a);return new t.S(e.lng+n*((l-c)/(u-c)),o)}return new t.S(e.lng+n*r,o)}class hn{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,t,n,i){const r=`${e.z}_${e.x}_${e.y}_${(null==i?void 0:i.terrain)?"t":""}`,o=this._cache.get(r);if(o)return o;const s=this._cachePrevious.get(r);if(s)return this._cache.set(r,s),s;const a=this._boundingVolumeFactory(e,t,n,i);return this._cache.set(r,a),this._hadAnyChanges=!0,a}}class dn{constructor(e,t,n,i){this.min=n,this.max=i,this.points=e,this.planes=t}static fromAabb(e,t){const n=[];for(let i=0;i<8;i++)n.push([1&~i?e[0]:t[0],1==(i>>1&1)?t[1]:e[1],1==(i>>2&1)?t[2]:e[2]]);return new dn(n,[[-1,0,0,t[0]],[1,0,0,-e[0]],[0,-1,0,t[1]],[0,1,0,-e[1]],[0,0,-1,t[2]],[0,0,1,-e[2]]],e,t)}static fromCenterSizeAngles(e,n,i){const r=t.br([],i[0],i[1],i[2]),o=t.bs([],[n[0],0,0],r),s=t.bs([],[0,n[1],0],r),a=t.bs([],[0,0,n[2]],r),l=[...e],c=[...e];for(let t=0;t<8;t++)for(let n=0;n<3;n++){const i=e[n]+o[n]*(1&~t?-1:1)+s[n]*(1==(t>>1&1)?1:-1)+a[n]*(1==(t>>2&1)?1:-1);l[n]=Math.min(l[n],i),c[n]=Math.max(c[n],i)}const u=[];for(let n=0;n<8;n++){const i=[...e];t.aS(i,i,t.aR([],o,1&~n?-1:1)),t.aS(i,i,t.aR([],s,1==(n>>1&1)?1:-1)),t.aS(i,i,t.aR([],a,1==(n>>2&1)?1:-1)),u.push(i)}return new dn(u,[[...o,-t.aX(o,u[0])],[...s,-t.aX(s,u[0])],[...a,-t.aX(a,u[0])],[-o[0],-o[1],-o[2],-t.aX(o,u[7])],[-s[0],-s[1],-s[2],-t.aX(s,u[7])],[-a[0],-a[1],-a[2],-t.aX(a,u[7])]],l,c)}intersectsFrustum(e){let t=!0;const n=this.points.length,i=this.planes.length,r=e.planes.length,o=e.points.length;for(let i=0;i<r;i++){const r=e.planes[i];let o=0;for(let e=0;e<n;e++){const t=this.points[e];r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0&&o++}if(0===o)return 0;o<n&&(t=!1)}if(t)return 2;for(let t=0;t<i;t++){const n=this.planes[t];let i=0;for(let t=0;t<o;t++){const r=e.points[t];n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]>=0&&i++}if(0===i)return 0}return 1}intersectsPlane(e){const t=this.points.length;let n=0;for(let i=0;i<t;i++){const t=this.points[i];e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]>=0&&n++}return n===t?2:0===n?0:1}}function pn(e,t,n){const i=e-t;return i<0?-i:Math.max(0,i-n)}function fn(e,t,n,i,r){const o=e-n;let s;return s=o<0?Math.min(-o,1+o-r):o>1?Math.min(Math.max(o-r,0),1-o):0,Math.max(s,pn(t,i,r))}class gn{constructor(){this._boundingVolumeCache=new hn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,t,n,i){const r=1<<n.z,o=1/r,s=n.x/r,a=n.y/r;let l=2;return l=Math.min(l,fn(e,t,s,a,o)),l=Math.min(l,fn(e,t,s+.5,-a-o,o)),l=Math.min(l,fn(e,t,s+.5,2-a-o,o)),l}getWrap(e,t,n){const i=1<<t.z,r=1/i,o=t.x/i,s=pn(e.x,o,r),a=pn(e.x,o-1,r),l=pn(e.x,o+1,r),c=Math.min(s,a,l);return c===l?1:c===a?-1:0}allowVariableZoom(e,t){return _e(e,t)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,t,n,i){return this._boundingVolumeCache.getTileBoundingVolume(e,t,n,i)}_computeTileBoundingVolume(e,n,i,r){var o,s;let a=0,l=0;if(null==r?void 0:r.terrain){const c=new t.Z(e.z,n,e.z,e.x,e.y),u=r.terrain.getMinMaxElevation(c);a=null!==(o=u.minElevation)&&void 0!==o?o:Math.min(0,i),l=null!==(s=u.maxElevation)&&void 0!==s?s:Math.max(0,i)}if(a/=t.bu,l/=t.bu,a+=1,l+=1,e.z<=0)return dn.fromAabb([-l,-l,-l],[l,l,l]);if(1===e.z)return dn.fromAabb([0===e.x?-l:0,0===e.y?0:-l,-l],[0===e.x?0:l,0===e.y?l:0,l]);{const n=[tn(0,0,e.x,e.y,e.z),tn(t.$,0,e.x,e.y,e.z),tn(t.$,t.$,e.x,e.y,e.z),tn(0,t.$,e.x,e.y,e.z)],i=[];for(const e of n)i.push(t.aR([],e,l));if(l!==a)for(const e of n)i.push(t.aR([],e,a));0===e.y&&i.push([0,1,0]),e.y===(1<<e.z)-1&&i.push([0,-1,0]);const r=[1,1,1],o=[-1,-1,-1];for(const e of i)for(let t=0;t<3;t++)r[t]=Math.min(r[t],e[t]),o[t]=Math.max(o[t],e[t]);const s=tn(t.$/2,t.$/2,e.x,e.y,e.z),c=t.aW([],[0,1,0],s);t.aV(c,c);const u=t.aW([],s,c);t.aV(u,u);const h=t.aW([],n[2],n[1]);t.aV(h,h);const d=t.aW([],n[0],n[3]);t.aV(d,d),i.push(t.aR([],s,l)),e.y>=(1<<e.z)/2&&i.push(t.aR([],tn(t.$/2,0,e.x,e.y,e.z),l)),e.y<(1<<e.z)/2&&i.push(t.aR([],tn(t.$/2,t.$,e.x,e.y,e.z),l));const p=mn(s,i),f=mn(u,i),g=[-s[0],-s[1],-s[2],p.max],m=[s[0],s[1],s[2],-p.min],_=[-u[0],-u[1],-u[2],f.max],y=[u[0],u[1],u[2],-f.min],v=[...h,0],b=[...d,0],x=[];return 0===e.y?x.push(t.bt(b,v,g),t.bt(b,v,m)):x.push(t.bt(_,v,g),t.bt(_,v,m),t.bt(_,b,g),t.bt(_,b,m)),e.y===(1<<e.z)-1?x.push(t.bt(b,v,g),t.bt(b,v,m)):x.push(t.bt(y,v,g),t.bt(y,v,m),t.bt(y,b,g),t.bt(y,b,m)),new dn(x,[g,m,_,y,v,b],r,o)}}}function mn(e,n){let i=1/0,r=-1/0;for(const o of n){const n=t.aX(e,o);i=Math.min(i,n),r=Math.max(r,n)}return{min:i,max:r}}class _n{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){this._helper.resize(e,t)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=t.bv(),this._projectionMatrix=t.b9(),this._globeViewProjMatrix32f=t.b8(),this._globeViewProjMatrixNoCorrection=t.b9(),this._globeViewProjMatrixNoCorrectionInverted=t.b9(),this._globeProjMatrixInverted=t.b9(),this._cameraPosition=t.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Mt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)}),this._coveringTilesDetailsProvider=new gn}clone(){const e=new _n;return e.apply(this),e}apply(e,t){this._globeLatitudeErrorCorrectionRadians=t||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=t.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:t,applyGlobeMatrix:n}=e,i=this._helper.getMercatorTileCoordinates(t);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:i,clippingPlane:this._cachedClippingPlane,projectionTransition:n?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,i=this.cameraToCenterDistance/e,r=Math.sin(n)*i,o=Math.cos(n)*i+1,s=1/Math.sqrt(r*r+o*o)*1;let a=-r,l=o;const c=Math.sqrt(a*a+l*l);a/=c,l/=c;const u=[0,a,l];t.bw(u,u,[0,0,0],-this.bearingInRadians),t.bx(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),t.by(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/t.aZ(u);return t.aR(u,u,h),[...u,-s*h]}isLocationOccluded(e){return!this.isSurfacePointVisible(nn(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,i=this._helper._center.lat*Math.PI/180,r=Math.cos(i),o=[Math.sin(n)*r,Math.sin(i),Math.cos(n)*r],s=[o[2],0,-o[0]],a=[0,0,0];t.aW(a,s,o),t.aV(s,s),t.aV(a,a);const l=[0,0,0];return t.aV(l,[s[0]*e[0]+a[0]*e[1]+o[0]*e[2],s[1]*e[0]+a[1]*e[1]+o[1]*e[2],s[2]*e[0]+a[2]*e[1]+o[2]*e[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,i){const r=function(e,n,i){const r=1/(1<<i.z);return new t.a1(e/t.$*r+i.x*r,n/t.$*r+i.y*r)}(e,n,i.canonical),o=(s=r.y,[t.bo(r.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI]);var s;return this.getCircleRadiusCorrection()/Math.cos(o[1])}projectTileCoordinates(e,n,i,r){const o=i.canonical,s=tn(e,n,o.x,o.y,o.z),a=1+(r?r(e,n):0)/t.bu,l=[s[0]*a,s[1]*a,s[2]*a,1];t.aw(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]<0;return{point:new t.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=rn(this.worldSize,this.center.lat),n=t.ba(),i=t.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),t.b4(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const r=this.centerOffset;n[8]=2*-r.x/this._helper._width,n[9]=2*r.y/this._helper._height,this._projectionMatrix=t.b5(n),this._globeProjMatrixInverted=t.ba(),t.aq(this._globeProjMatrixInverted,n),t.M(n,n,[0,0,-this.cameraToCenterDistance]),t.b6(n,n,this.rollInRadians),t.b7(n,n,-this.pitchInRadians),t.b6(n,n,this.bearingInRadians),t.M(n,n,[0,0,-e]);const o=t.bp();o[0]=e,o[1]=e,o[2]=e,t.b7(i,n,this.center.lat*Math.PI/180),t.bz(i,i,-this.center.lng*Math.PI/180),t.N(i,i,o),this._globeViewProjMatrixNoCorrection=i,t.b7(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bz(n,n,-this.center.lng*Math.PI/180),t.N(n,n,o),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=t.ba(),t.aq(this._globeViewProjMatrixNoCorrectionInverted,i);const s=t.bp();this._cameraPosition=t.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,t.bw(this._cameraPosition,this._cameraPosition,s,-this.rollInRadians),t.bx(this._cameraPosition,this._cameraPosition,s,this.pitchInRadians),t.bw(this._cameraPosition,this._cameraPosition,s,-this.bearingInRadians),t.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bx(this._cameraPosition,this._cameraPosition,s,-this.center.lat*Math.PI/180),t.by(this._cameraPosition,this._cameraPosition,s,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const a=t.b5(this._globeViewProjMatrixNoCorrectionInverted);t.N(a,a,[1,1,-1]),this._cachedFrustum=Ot.fromInvProjectionMatrix(a,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){t.w("calculateFogMatrix is not supported on globe projection.");const n=t.ba();return t.ag(n),n}getVisibleUnwrappedCoordinates(e){return[new t.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const i=nn(e);t.aR(i,i,1+n/t.bu);const r=t.bv();return t.aw(r,[i[0],i[1],i[2],1],this._globeViewProjMatrixNoCorrection),r[2]/r[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,i=[new t.P(0,0),new t.P(e,0),new t.P(this.width,0),new t.P(this.width,n),new t.P(this.width,this.height),new t.P(e,this.height),new t.P(0,this.height),new t.P(0,n)],r=[];for(const e of i)r.push(this.unprojectScreenPoint(e));let o=0,s=0,a=0,l=0;const c=this.center;for(const e of r){const n=t.bA(c.lng,e.lng),i=t.bA(c.lat,e.lat);n<s&&(s=n),n>o&&(o=n),i<l&&(l=i),i>a&&(a=i)}const u=[c.lng+s,c.lat+l,c.lng+o,c.lat+a];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new $(u)}getConstrained(e,n){const i=t.ah(e.lat,-t.ai,t.ai),r=t.ah(+n,this.minZoom+an(0,i),this.maxZoom);return{center:new t.S(e.lng,i),zoom:r}}calculateCenterFromCameraLngLatAlt(e,t,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,i)}setLocationAtPoint(e,n){const i=nn(this.unprojectScreenPoint(n)),r=nn(e),o=t.bp();t.bB(o);const s=t.bp();t.by(s,i,o,-this.center.lng*Math.PI/180),t.bx(s,s,o,this.center.lat*Math.PI/180);const a=r[0]*r[0]+r[2]*r[2],l=s[0]*s[0];if(a<l)return;const c=Math.sqrt(a-l),u=-c,h=t.bC(r[0],r[2],s[0],c),d=t.bC(r[0],r[2],s[0],u),p=t.bp();t.by(p,r,o,-h);const f=t.bC(p[1],p[2],s[1],s[2]),g=t.bp();t.by(g,r,o,-d);const m=t.bC(g[1],g[2],s[1],s[2]),_=.5*Math.PI,y=f>=-_&&f<=_,v=m>=-_&&m<=_;let b,x;if(y&&v){const e=this.center.lng*Math.PI/180,n=this.center.lat*Math.PI/180;t.bD(h,e)+t.bD(f,n)<t.bD(d,e)+t.bD(m,n)?(b=h,x=f):(b=d,x=m)}else if(y)b=h,x=f;else{if(!v)return;b=d,x=m}const w=b/Math.PI*180,E=x/Math.PI*180,S=this.center.lat;this.setCenter(new t.S(w,t.ah(E,-90,90))),this.setZoom(this.zoom+an(S,this.center.lat))}locationToScreenPoint(e,n){const i=nn(e);if(n){const r=n.getElevationForLngLatZoom(e,this._helper._tileZoom);t.aR(i,i,1+r/t.bu)}return this._projectSurfacePointToScreen(i)}_projectSurfacePointToScreen(e){const n=t.bv();return t.aw(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new t.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const t=n.pointCoordinate(e);if(t)return t}return t.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,t){var n;return null===(n=this.screenPointToMercatorCoordinate(e,t))||void 0===n?void 0:n.toLngLat()}isPointOnMapSurface(e,t){const n=this._cameraPosition,i=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(n,i)}getRayDirectionFromPixel(e){const n=t.bv();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,t.aw(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const i=t.bp();i[0]=n[0]-this._cameraPosition[0],i[1]=n[1]-this._cameraPosition[1],i[2]=n[2]-this._cameraPosition[2];const r=t.bp();return t.aV(r,i),r}isSurfacePointVisible(e){const t=this._cachedClippingPlane;return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=t.bv();return t.aw(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const i=t.aX(e,n),r=t.bp(),o=t.bp();t.aR(o,n,i),t.aU(r,e,o);const s=1-t.aX(r,r);if(s<0)return null;const a=t.aX(e,e)-1,l=-i+(i<0?1:-1)*Math.sqrt(s),c=a/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(e){const n=this._cameraPosition,i=this.getRayDirectionFromPixel(e),r=this.rayPlanetIntersection(n,i);if(r){const e=t.bp();t.aS(e,n,[i[0]*r.tMin,i[1]*r.tMin,i[2]*r.tMin]);const o=t.bp();return t.aV(o,e),on(o)}const o=this._cachedClippingPlane,s=o[0]*i[0]+o[1]*i[1]+o[2]*i[2],a=-t.b1(o,n)/s,l=t.bp();if(a>0)t.aS(l,n,[i[0]*a,i[1]*a,i[2]*a]);else{const e=t.bp();t.aS(e,n,[2*i[0],2*i[1],2*i[2]]);const r=t.b1(this._cachedClippingPlane,e);t.aU(l,e,[this._cachedClippingPlane[0]*r,this._cachedClippingPlane[1]*r,this._cachedClippingPlane[2]*r])}const c=function(e){const n=t.bp();return n[0]=e[0]*-e[3],n[1]=e[1]*-e[3],n[2]=e[2]*-e[3],{center:n,radius:Math.sqrt(1-e[3]*e[3])}}(o);return on(function(e,n,i){const r=t.bp();t.aU(r,i,e);const o=t.bp();return t.bq(o,e,r,n/t.a$(r)),o}(c.center,c.radius,l))}getMatrixForModel(e,n){const i=t.S.convert(e),r=1/t.bu,o=t.b9();return t.bz(o,o,i.lng/180*Math.PI),t.b7(o,o,-i.lat/180*Math.PI),t.M(o,o,[0,0,1+n/t.bu]),t.b7(o,o,.5*Math.PI),t.N(o,o,[r,r,r]),o}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new t.Z(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class yn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,n){return this._helper.interpolatePadding(e,t,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,n=!0){this._helper.resize(e,t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,t){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=t,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Mt({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)}),this._globeness=1,this._mercatorTransform=new Lt,this._verticalPerspectiveTransform=new _n}clone(){const e=new yn;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const t=this._mercatorTransform.getProjectionData(e),n=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?n.mainMatrix:t.mainMatrix,clippingPlane:n.clippingPlane,tileMercatorCoords:n.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:t.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return t.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,i){const r=this._mercatorTransform.getPitchedTextCorrection(e,n,i),o=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,i);return t.bk(r,o,this._globeness)}projectTileCoordinates(e,t,n,i){return this.currentTransform.projectTileCoordinates(e,t,n,i)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,t){return this.currentTransform.lngLatToCameraDepth(e,t)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,t){return this.currentTransform.getConstrained(e,t)}calculateCenterFromCameraLngLatAlt(e,t,n,i){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,n,i)}setLocationAtPoint(e,t){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,t),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,t),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,t){return this.currentTransform.locationToScreenPoint(e,t)}screenPointToMercatorCoordinate(e,t){return this.currentTransform.screenPointToMercatorCoordinate(e,t)}screenPointToLocation(e,t){return this.currentTransform.screenPointToLocation(e,t)}isPointOnMapSurface(e,t){return this.currentTransform.isPointOnMapSurface(e,t)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,t){return this.currentTransform.getMatrixForModel(e,t)}getProjectionDataForCustomLayer(e=!0){const t=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return t;const n=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return n.fallbackMatrix=t.mainMatrix,n}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class vn{get useGlobeControls(){return!0}handlePanInertia(e,n){const i=ln(e,n);return Math.abs(i.lng-n.center.lng)>180&&(i.lng=n.center.lng+179.5*Math.sign(i.lng-n.center.lng)),{easingCenter:i,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const i=e.around,r=n.screenPointToLocation(i);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const o=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const s=n.zoom-o;if(0===s)return;const a=t.bA(n.center.lng,r.lng),l=a/(Math.abs(a/180)+1),c=t.bA(n.center.lat,r.lat),u=n.getRayDirectionFromPixel(i),h=n.cameraPosition,d=-1*t.aX(h,u),p=t.bp();t.aS(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=t.aZ(p)-1,g=Math.exp(.5*-Math.max(f-.3,0)),m=rn(n.worldSize,n.center.lat)/Math.min(n.width,n.height),_=t.bn(m,.9,.5,1,.25),y=(1-t.af(-s))*Math.min(g,_),v=n.center.lat,b=n.zoom,x=new t.S(n.center.lng+l*y,t.ah(n.center.lat+c*y,-t.ai,t.ai));n.setLocationAtPoint(r,i);const w=n.center,E=t.bn(Math.abs(a),45,85,0,1),S=t.bn(m,.75,.35,0,1),T=Math.pow(Math.max(E,S),.25),C=t.bA(w.lng,x.lng),A=t.bA(w.lat,x.lat);n.setCenter(new t.S(w.lng+C*T,w.lat+A*T).wrap()),n.setZoom(b+an(v,n.center.lat))}handleMapControlsPan(e,t,n){if(!e.panDelta)return;const i=t.center.lat,r=t.zoom;t.setCenter(ln(e.panDelta,t).wrap()),t.setZoom(r+an(i,t.center.lat))}cameraForBoxAndBearing(e,n,i,r,o){const s=Nt(e,n,i,r,o),a=n.left/o.width*2-1,l=(o.width-n.right)/o.width*2-1,c=n.top/o.height*-2+1,u=(o.height-n.bottom)/o.height*-2+1,h=t.bA(i.getWest(),i.getEast())<0,d=h?i.getEast():i.getWest(),p=h?i.getWest():i.getEast(),f=Math.max(i.getNorth(),i.getSouth()),g=Math.min(i.getNorth(),i.getSouth()),m=d+.5*t.bA(d,p),_=f+.5*t.bA(f,g),y=o.clone();y.setCenter(s.center),y.setBearing(s.bearing),y.setPitch(0),y.setRoll(0),y.setZoom(s.zoom);const v=y.modelViewProjectionMatrix,b=[nn(i.getNorthWest()),nn(i.getNorthEast()),nn(i.getSouthWest()),nn(i.getSouthEast()),nn(new t.S(p,_)),nn(new t.S(d,_)),nn(new t.S(m,f)),nn(new t.S(m,g))],x=nn(s.center);let w=Number.POSITIVE_INFINITY;for(const e of b)a<0&&(w=vn.getLesserNonNegativeNonNull(w,vn.solveVectorScale(e,x,v,"x",a))),l>0&&(w=vn.getLesserNonNegativeNonNull(w,vn.solveVectorScale(e,x,v,"x",l))),c>0&&(w=vn.getLesserNonNegativeNonNull(w,vn.solveVectorScale(e,x,v,"y",c))),u<0&&(w=vn.getLesserNonNegativeNonNull(w,vn.solveVectorScale(e,x,v,"y",u)));if(Number.isFinite(w)&&0!==w)return s.zoom=y.zoom+t.ak(w),s;Dt()}handleJumpToCenterZoom(e,n){const i=e.center.lat,r=e.getConstrained(n.center?t.S.convert(n.center):e.center,e.zoom).center;e.setCenter(r.wrap());const o=void 0!==n.zoom?+n.zoom:e.zoom+an(i,r.lat);e.zoom!==o&&e.setZoom(o)}handleEaseTo(e,n){const i=e.zoom,r=e.center,o=e.padding,s={roll:e.roll,pitch:e.pitch,bearing:e.bearing},a={roll:void 0===n.roll?e.roll:n.roll,pitch:void 0===n.pitch?e.pitch:n.pitch,bearing:void 0===n.bearing?e.bearing:n.bearing},l=void 0!==n.zoom,c=!e.isPaddingEqual(n.padding);let u=!1;const h=n.center?t.S.convert(n.center):r,d=e.getConstrained(h,i).center;Pt(e,d);const p=e.clone();p.setCenter(d),p.setZoom(l?+n.zoom:i+an(r.lat,h.lat)),p.setBearing(n.bearing);const f=new t.P(t.ah(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),t.ah(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));p.setLocationAtPoint(d,f);const g=(n.offset&&n.offsetAsPoint.mag())>0?p.center:d,m=l?+n.zoom:i+an(r.lat,g.lat),_=i+an(r.lat,0),y=m+an(g.lat,0),v=t.bA(r.lng,g.lng),b=t.bA(r.lat,g.lat),x=t.af(y-_);return u=m!==i,{easeFunc:i=>{if(t.be(s,a)||Ft({startEulerAngles:s,endEulerAngles:a,tr:e,k:i,useSlerp:s.roll!=a.roll}),c&&e.interpolatePadding(o,n.padding,i),n.around)t.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const t=y>_?Math.min(2,x):Math.max(.5,x),n=Math.pow(t,1-i),o=un(r,v,b,i*n);e.setCenter(o.wrap())}if(u){const n=t.C.number(_,y,i)+an(0,e.center.lat);e.setZoom(n)}},isZooming:u,elevationCenter:g}}handleFlyTo(e,n){const i=void 0!==n.zoom,r=e.center,o=e.zoom,s=e.padding,a=!e.isPaddingEqual(n.padding),l=e.getConstrained(t.S.convert(n.center||n.locationAtOffset),o).center,c=i?+n.zoom:e.zoom+an(e.center.lat,l.lat),u=e.clone();u.setCenter(l),u.setZoom(c),u.setBearing(n.bearing);const h=new t.P(t.ah(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),t.ah(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));u.setLocationAtPoint(l,h);const d=u.center;Pt(e,d);const p=function(e,n,i){const r=nn(n),o=nn(i),s=t.aX(r,o),a=Math.acos(s),l=en(e);return a/(2*Math.PI)*l}(e,r,d),f=o+an(r.lat,0),g=c+an(d.lat,0),m=t.af(g-f);let _;if("number"==typeof n.minZoom){const i=+n.minZoom+an(d.lat,0),r=Math.min(i,f,g)+an(0,d.lat),o=e.getConstrained(d,r).zoom+an(d.lat,0);_=t.af(o-f)}const y=t.bA(r.lng,d.lng),v=t.bA(r.lat,d.lat);return{easeFunc:(i,o,l,u)=>{const h=un(r,y,v,l);a&&e.interpolatePadding(s,n.padding,i);const p=1===i?d:h;e.setCenter(p.wrap());const g=f+t.ak(o);e.setZoom(1===i?c:g+an(0,p.lat))},scaleOfZoom:m,targetCenter:d,scaleOfMinZoom:_,pixelPathLength:p}}static solveVectorScale(e,t,n,i,r){const o="x"===i?[n[0],n[4],n[8],n[12]]:[n[1],n[5],n[9],n[13]],s=[n[3],n[7],n[11],n[15]],a=e[0]*o[0]+e[1]*o[1]+e[2]*o[2],l=e[0]*s[0]+e[1]*s[1]+e[2]*s[2],c=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],u=t[0]*s[0]+t[1]*s[1]+t[2]*s[2];return c+r*l===a+r*u||s[3]*(a-c)+o[3]*(u-l)+a*u==c*l?null:(c+o[3]-r*u-r*s[3])/(c-a-r*u+r*l)}static getLesserNonNegativeNonNull(e,t){return null!==t&&t>=0&&t<e?t:e}}class bn{constructor(e){this._globe=e,this._mercatorCameraHelper=new Bt,this._verticalPerspectiveCameraHelper=new vn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,t){return this.currentHelper.handlePanInertia(e,t)}handleMapControlsRollPitchBearingZoom(e,t){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,t)}handleMapControlsPan(e,t,n){this.currentHelper.handleMapControlsPan(e,t,n)}cameraForBoxAndBearing(e,t,n,i,r){return this.currentHelper.cameraForBoxAndBearing(e,t,n,i,r)}handleJumpToCenterZoom(e,t){this.currentHelper.handleJumpToCenterZoom(e,t)}handleEaseTo(e,t){return this.currentHelper.handleEaseTo(e,t)}handleFlyTo(e,t){return this.currentHelper.handleFlyTo(e,t)}}const xn=(e,n)=>t.y(e,n&&n.filter((e=>"source.canvas"!==e.identifier))),wn=t.bE();class En extends t.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const e in this.sourceCaches){const t=this.sourceCaches[e].getSource().type;"vector"!==t&&"geojson"!==t||this.sourceCaches[e].reload()}},this.map=e,this.dispatcher=new F(D(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((e,t)=>this.getGlyphs(e,t))),this.dispatcher.registerMessageHandler("GI",((e,t)=>this.getImages(e,t))),this.imageManager=new v,this.imageManager.setEventedParent(this),this.glyphManager=new E(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new I(256,512),this.crossTileSymbolIndex=new yt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",t.bG()),ie().on(ee,this._rtlPluginLoaded),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const n=t.getSource();if(n&&n.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===n.id&&this._validateLayer(t)}}))}setGlobalStateProperty(e,n){var i,r,o;this._checkLoaded();const s=null===n?null!==(o=null===(r=null===(i=this.stylesheet.state)||void 0===i?void 0:i[e])||void 0===r?void 0:r.default)&&void 0!==o?o:null:n;if(t.bH(s,this._globalState[e]))return this;this._globalState[e]=s;const a=this._findGlobalStateAffectedSources([e]);for(const e in this.sourceCaches)a.has(e)&&(this._reloadSource(e),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const n=[];for(const i in e)!t.bH(this._globalState[i],e[i].default)&&(n.push(i),this._globalState[i]=e[i].default);const i=this._findGlobalStateAffectedSources(n);for(const e in this.sourceCaches)i.has(e)&&(this._reloadSource(e),this._changed=!0)}_findGlobalStateAffectedSources(e){if(0===e.length)return new Set;const t=new Set;for(const n in this._layers){const i=this._layers[n],r=i.getLayoutAffectingGlobalStateRefs();for(const n of e)r.has(n)&&t.add(i.source)}return t}loadURL(e,n={},i){this.fire(new t.l("dataloading",{dataType:"style"})),n.validate="boolean"!=typeof n.validate||n.validate;const r=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const o=this._loadStyleRequest;t.j(r,this._loadStyleRequest).then((e=>{this._loadStyleRequest=null,this._load(e.data,n,i)})).catch((e=>{this._loadStyleRequest=null,e&&!o.signal.aborted&&this.fire(new t.k(e))}))}loadJSON(e,n={},i){this.fire(new t.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,s.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,n.validate=!1!==n.validate,this._load(e,n,i)})).catch((()=>{}))}loadEmpty(){this.fire(new t.l("dataloading",{dataType:"style"})),this._load(wn,{validate:!1})}_load(e,n,i){var r,o,s;const a=n.transformStyle?n.transformStyle(i,e):e;if(!n.validate||!xn(this,t.z(a))){this._loaded=!0,this.stylesheet=a;for(const e in a.sources)this.addSource(e,a.sources[e],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs),this._createLayers(),this.light=new C(this.stylesheet.light),this._setProjectionInternal((null===(r=this.stylesheet.projection)||void 0===r?void 0:r.type)||"mercator"),this.sky=new P(this.stylesheet.sky),this.map.setTerrain(null!==(o=this.stylesheet.terrain)&&void 0!==o?o:null),this.setGlobalState(null!==(s=this.stylesheet.state)&&void 0!==s?s:null),this.fire(new t.l("data",{dataType:"style"})),this.fire(new t.l("style.load"))}}_createLayers(){const e=t.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((e=>e.id)),this._layers={},this._serializedLayers=null;for(const n of e){const e=t.bJ(n);e.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=e}}_loadSprite(e,n=!1,i=void 0){let r;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(e,n,i,r){return t._(this,void 0,void 0,(function*(){const o=m(e),a=i>1?"@2x":"",l={},c={};for(const{id:e,url:i}of o){const o=n.transformRequest(_(i,a,".json"),"SpriteJSON");l[e]=t.j(o,r);const s=n.transformRequest(_(i,a,".png"),"SpriteImage");c[e]=f.getImage(s,r)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(e,n){return t._(this,void 0,void 0,(function*(){const t={};for(const i in e){t[i]={};const r=s.getImageCanvasContext((yield n[i]).data),o=(yield e[i]).data;for(const e in o){const{width:n,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:g}=o[e];t[i][e]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:g,spriteData:{width:n,height:s,x:a,y:l,context:r}}}}return t}))}(l,c)}))}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((e=>{if(this._spriteRequest=null,e)for(const t in e){this._spritesImagesIds[t]=[];const i=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter((t=>!(t in e))):[];for(const e of i)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const i in e[t]){const r="default"===t?i:`${t}:${i}`;this._spritesImagesIds[t].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,e[t][i],!1):this.imageManager.addImage(r,e[t][i]),n&&(this._changedImages[r]=!0)}}})).catch((e=>{this._spriteRequest=null,r=e,this.fire(new t.k(r))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"})),i&&i(r)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const i=e.sourceLayer;if(!i)return;const r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.k(new Error(`Source layer "${i}" does not exist on source "${r.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const i=this._serializedAllLayers();if(!e||0===e.length)return Object.values(n?t.bK(i):i);const r=[];for(const o of e)if(i[o]){const e=n?t.bK(i[o]):i[o];r.push(e)}return r}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const t=Object.keys(this._layers);for(const n of t){const t=this._layers[n];"custom"!==t.type&&(e[n]=t.serialize())}return e}hasTransitions(){var e,t,n;if(null===(e=this.light)||void 0===e?void 0:e.hasTransition())return!0;if(null===(t=this.sky)||void 0===t?void 0:t.hasTransition())return!0;if(null===(n=this.projection)||void 0===n?void 0:n.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];if("reload"===t)this._reloadSource(e);else{if("clear"!==t)throw new Error(`Invalid action ${t}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const i={};for(const e in this.sourceCaches){const t=this.sourceCaches[e];i[e]=t.used,t.used=!1}for(const t of this._order){const n=this._layers[t];n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)&&n.source&&(this.sourceCaches[n.source].used=!0)}for(const e in i){const n=this.sourceCaches[e];!!i[e]!=!!n.used&&n.fire(new t.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new t.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var i;this._checkLoaded();const r=this.serialize();if(e=n.transformStyle?n.transformStyle(r,e):e,(null===(i=n.validate)||void 0===i||i)&&xn(this,t.z(e)))return!1;(e=t.bK(e)).layers=t.bI(e.layers);const o=t.bL(r,e),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const e of s.operations)e();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const t=[],n=[];for(const i of e)switch(i.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":t.push((()=>this.addLayer.apply(this,i.args)));break;case"removeLayer":t.push((()=>this.removeLayer.apply(this,i.args)));break;case"setPaintProperty":t.push((()=>this.setPaintProperty.apply(this,i.args)));break;case"setLayoutProperty":t.push((()=>this.setLayoutProperty.apply(this,i.args)));break;case"setFilter":t.push((()=>this.setFilter.apply(this,i.args)));break;case"addSource":t.push((()=>this.addSource.apply(this,i.args)));break;case"removeSource":t.push((()=>this.removeSource.apply(this,i.args)));break;case"setLayerZoomRange":t.push((()=>this.setLayerZoomRange.apply(this,i.args)));break;case"setLight":t.push((()=>this.setLight.apply(this,i.args)));break;case"setGeoJSONSourceData":t.push((()=>this.setGeoJSONSourceData.apply(this,i.args)));break;case"setGlyphs":t.push((()=>this.setGlyphs.apply(this,i.args)));break;case"setSprite":t.push((()=>this.setSprite.apply(this,i.args)));break;case"setTerrain":t.push((()=>this.map.setTerrain.apply(this,i.args)));break;case"setSky":t.push((()=>this.setSky.apply(this,i.args)));break;case"setProjection":this.setProjection.apply(this,i.args);break;case"setGlobalState":t.push((()=>this.setGlobalState.apply(this,i.args)));break;case"setTransition":t.push((()=>{}));break;default:n.push(i.command)}return{operations:t,unimplemented:n}}addImage(e,n){if(this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.z.source,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=this.sourceCaches[e]=new be(e,n,this.dispatcher);r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:e}))),r.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===e)return this.fire(new t.k(new Error(`Source "${e}" cannot be removed while layer "${n}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error(`There is no source with this ID=${e}`);const n=this.sourceCaches[e].getSource();if("geojson"!==n.type)throw new Error(`geojsonSource.type is ${n.type}, which is !== 'geojson`);n.setData(t),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,i={}){this._checkLoaded();const r=e.id;if(this.getLayer(r))return void this.fire(new t.k(new Error(`Layer "${r}" already exists on this map.`)));let o;if("custom"===e.type){if(xn(this,t.bM(e)))return;o=t.bJ(e)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(r,e.source),e=t.bK(e),e=t.e(e,{source:r})),this._validate(t.z.layer,`layers.${r}`,e,{arrayIndex:-1},i))return;o=t.bJ(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}})}const s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)this.fire(new t.k(new Error(`Cannot add layer "${r}" before non-existing layer "${n}".`)));else{if(this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o,this._removedLayers[r]&&o.source&&"custom"!==o.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,i){this._checkLoaded();const r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,i={}){this._checkLoaded();const r=this.getLayer(e);if(r){if(!t.bH(r.filter,n))return null==n?(r.setFilter(void 0),void this._updateLayer(r)):void(this._validate(t.z.filter,`layers.${r.id}.filter`,n,null,i)||(r.setFilter(t.bK(n)),this._updateLayer(r)))}else this.fire(new t.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.bK(this.getLayer(e).filter)}setLayoutProperty(e,n,i,r={}){this._checkLoaded();const o=this.getLayer(e);o?t.bH(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,r),this._updateLayer(o)):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,i,r={}){this._checkLoaded();const o=this.getLayer(e);o?t.bH(o.getPaintProperty(n),i)||(o.setPaintProperty(n,i,r)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,n){this._checkLoaded();const i=e.source,r=e.sourceLayer,o=this.sourceCaches[i];if(void 0===o)return void this.fire(new t.k(new Error(`The source '${i}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&r?this.fire(new t.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||r?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),o.setFeatureState(r,e.id,n)):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const i=e.source,r=this.sourceCaches[i];if(void 0===r)return void this.fire(new t.k(new Error(`The source '${i}' does not exist in the map's style.`)));const o=r.getSource().type,s="vector"===o?e.sourceLayer:void 0;"vector"!==o||s?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.k(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(s,e.id,n):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,r=this.sourceCaches[n];if(void 0!==r)return"vector"!==r.getSource().type||i?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),r.getFeatureState(i,e.id)):void this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.bN(this.sourceCaches,(e=>e.serialize())),n=this._serializeByIds(this._order,!0),i=this.map.getTerrain()||void 0,r=this.stylesheet;return t.bO({version:r.version,name:r.name,metadata:r.metadata,light:r.light,sky:r.sky,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,projection:r.projection,sources:e,layers:n,terrain:i},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,n={},i=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(t(o)){n[o]=r;for(const t of e){const e=t[o];if(e)for(const t of e)i.push(t)}}}i.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(n[t.layer.id]<o)break;r.push(t),i.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(t.z.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new t.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const s=this._serializedAllLayers(),a=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,l=Object.assign(Object.assign({},n),{layers:a});for(const t in this.sourceCaches)n.layers&&!r[t]||o.push(z(this.sourceCaches[t],this._layers,s,e,l,i,this.map.terrain?(e,t,n)=>this.map.terrain.getElevation(e,t,n):void 0));return this.placement&&o.push(function(e,t,n,i,r,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(j);for(const n of c){const i=n.featureIndex.lookupSymbolFeatures(l[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in i){const t=a[e]=a[e]||[],r=i[e];r.sort(((e,t)=>{const i=n.featureSortOrder;if(i){const n=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}return function(e,t,n){for(const i in e)for(const r of e[i])U(r,n[t[i].source]);return e}(a,e,n)}(this._layers,s,this.sourceCaches,e,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){n&&n.filter&&this._validate(t.z.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this.sourceCaches[e];return i?function(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],r={};for(let e=0;e<n.length;e++){const o=n[e],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(i,t))}return i}(i,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const i=this.light.getLight();let r=!1;for(const n in e)if(!t.bH(e[n],i[n])){r=!0;break}if(!r)return;const o={now:s.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(o)}getProjection(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const i=this.getSky();let r=!1;if(!e&&!i)return;if(e&&!i)r=!0;else if(!e&&i)r=!0;else for(const n in e)if(!t.bH(e[n],i[n])){r=!0;break}if(!r)return;const o={now:s.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(o)}_setProjectionInternal(e){const n=function(e){if(Array.isArray(e)){const t=new Qt({type:e});return{projection:t,transform:new yn,cameraHelper:new bn(t)}}switch(e){case"mercator":return{projection:new Ct,transform:new Lt,cameraHelper:new Bt};case"globe":{const e=new Qt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:e,transform:new yn,cameraHelper:new bn(e)}}case"vertical-perspective":return{projection:new Kt,transform:new _n,cameraHelper:new vn};default:return t.w(`Unknown projection name: ${e}. Falling back to mercator projection.`),{projection:new Ct,transform:new Lt,cameraHelper:new Bt}}}(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const e in this.sourceCaches)this.sourceCaches[e].reload()}_validate(e,n,i,r,o={}){return(!o||!1!==o.validate)&&xn(this,e.call(t.z,t.e({key:n,style:this.serialize(),value:i,styleSpec:t.v},r)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ie().off(ee,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const t in this.sourceCaches)this.sourceCaches[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,t,n,i,r=!1){let o=!1,a=!1;const l={};for(const t of this._order){const n=this._layers[t];if("symbol"!==n.type)continue;if(!l[n.source]){const e=this.sourceCaches[n.source];l[n.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const i=this.crossTileSymbolIndex.addLayer(n,l[n.source],e.center.lng);o=o||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((r=r||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.now(),e.zoom))&&(this.pauseablePlacement=new pt(e,this.map.terrain,this._order,r,t,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return t._(this,void 0,void 0,(function*(){const e=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const t=this.sourceCaches[n.source];return t&&t.setDependencies(n.tileID.key,n.type,n.icons),e}))}getGlyphs(e,n){return t._(this,void 0,void 0,(function*(){const e=yield this.glyphManager.getGlyphs(n.stacks),t=this.sourceCaches[n.source];return t&&t.setDependencies(n.tileID.key,n.type,[""]),e}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(t.z.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,i={},r){this._checkLoaded();const o=[{id:e,url:n}],s=[...m(this.stylesheet.sprite),...o];this._validate(t.z.sprite,"sprite",s,null,i)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,r))}removeSprite(e){this._checkLoaded();const n=m(this.stylesheet.sprite);if(n.find((t=>t.id===e))){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;n.splice(n.findIndex((t=>t.id===e)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}else this.fire(new t.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return m(this.stylesheet.sprite)}setSprite(e,n={},i){this._checkLoaded(),e&&this._validate(t.z.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,i):(this._unloadSprite(),i&&i(null)))}}var Sn=t.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,i,r,o,s,a,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==i.length;for(let e=0;!c&&e<i.length;e++)this.boundPaintVertexBuffers[e]!==i[e]&&(c=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,n,i,r,o,s,a,l):(e.bindVertexArray.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind())}freshBind(e,t,n,i,r,o,s,a){const l=e.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,t.enableAttributes(u,e);for(const t of n)t.enableAttributes(u,e);o&&o.enableAttributes(u,e),s&&s.enableAttributes(u,e),a&&a.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,r);for(const t of n)t.bind(),t.setVertexAttribPointers(u,e,r);o&&(o.bind(),o.setVertexAttribPointers(u,e,r)),i&&i.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,e,r)),a&&(a.bind(),a.setVertexAttribPointers(u,e,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Cn=(e,n,i,r,o)=>({u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:i?i.properties.get("fog-color"):t.bf.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?0:i?i.calculateFogBlendOpacity(r):0,u_horizon_color:i?i.properties.get("horizon-color"):t.bf.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:o?1:0}),An={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Pn(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const i=e[n].split(" ");t.push(i.pop())}return t}class In{constructor(e,n,i,r,o,s,a,l,c=[]){const u=e.gl;this.program=u.createProgram();const h=Pn(n.staticAttributes),d=i?i.getBinderAttributes():[],p=h.concat(d),f=bt.prelude.staticUniforms?Pn(bt.prelude.staticUniforms):[],g=a.staticUniforms?Pn(a.staticUniforms):[],m=n.staticUniforms?Pn(n.staticUniforms):[],_=i?i.getBinderUniforms():[],y=f.concat(g).concat(m).concat(_),v=[];for(const e of y)v.indexOf(e)<0&&v.push(e);const b=i?i.defines():[];Ht(u)&&b.unshift("#version 300 es"),o&&b.push("#define OVERDRAW_INSPECTOR;"),s&&b.push("#define TERRAIN3D;"),l&&b.push(l),c&&b.push(...c);let x=b.concat(bt.prelude.fragmentSource,a.fragmentSource,n.fragmentSource).join("\n"),w=b.concat(bt.prelude.vertexSource,a.vertexSource,n.vertexSource).join("\n");Ht(u)||(x=function(e){return e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(x),w=function(e){return e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const E=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(E,x),u.compileShader(E),!u.getShaderParameter(E,u.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${u.getShaderInfoLog(E)}`);u.attachShader(this.program,E);const S=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,w),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${u.getShaderInfoLog(S)}`);u.attachShader(this.program,S),this.attributes={};const T={};this.numAttributes=p.length;for(let e=0;e<this.numAttributes;e++)p[e]&&(u.bindAttribLocation(this.program,e,p[e]),this.attributes[p[e]]=e);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error(`Program failed to link: ${u.getProgramInfoLog(this.program)}`);u.deleteShader(S),u.deleteShader(E);for(let e=0;e<v.length;e++){const t=v[e];if(t&&!T[t]){const e=u.getUniformLocation(this.program,t);e&&(T[t]=e)}}this.fixedUniforms=r(e,T),this.terrainUniforms=((e,n)=>({u_depth:new t.bP(e,n.u_depth),u_terrain:new t.bP(e,n.u_terrain),u_terrain_dim:new t.bg(e,n.u_terrain_dim),u_terrain_matrix:new t.bR(e,n.u_terrain_matrix),u_terrain_unpack:new t.bS(e,n.u_terrain_unpack),u_terrain_exaggeration:new t.bg(e,n.u_terrain_exaggeration)}))(e,T),this.projectionUniforms=((e,n)=>({u_projection_matrix:new t.bR(e,n.u_projection_matrix),u_projection_tile_mercator_coords:new t.bS(e,n.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.bS(e,n.u_projection_clipping_plane),u_projection_transition:new t.bg(e,n.u_projection_transition),u_projection_fallback_matrix:new t.bR(e,n.u_projection_fallback_matrix)}))(e,T),this.binderUniforms=i?i.getUniforms(e,T):[]}draw(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,y){const v=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(i),e.setColorMode(r),e.setCullFace(o),a){e.activeTexture.set(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,a.depthTexture),e.activeTexture.set(v.TEXTURE3),v.bindTexture(v.TEXTURE_2D,a.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(a[e])}if(l)for(const e in l)this.projectionUniforms[An[e]].set(l[e]);if(s)for(const e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);g&&g.setUniforms(e,this.binderUniforms,p,{zoom:f});let b=0;switch(t){case v.LINES:b=2;break;case v.TRIANGLES:b=3;break;case v.LINE_STRIP:b=1}for(const n of d.get()){const i=n.vaos||(n.vaos={});(i[c]||(i[c]=new Tn)).bind(e,this,u,g?g.getPaintVertexBuffers():[],h,n.vertexOffset,m,_,y),v.drawElements(t,n.primitiveLength*b,v.UNSIGNED_SHORT,n.primitiveOffset*b*2)}}}function Mn(e,n,i){const r=1/t.aC(i,1,n.transform.tileZoom),o=Math.pow(2,i.tileID.overscaledZ),s=i.tileSize*Math.pow(2,n.transform.tileZoom)/o,a=s*(i.tileID.canonical.x+i.tileID.wrap*o),l=s*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const Rn=(e,n,i,r)=>{const o=e.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=t.bV();"viewport"===o.properties.get("anchor")&&t.bW(l,e.transform.bearingInRadians),t.bX(a,a,l);const c=e.transform.transformLightDirection(a),u=o.properties.get("color");return{u_lightpos:a,u_lightpos_globe:c,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+n,u_opacity:i,u_fill_translate:r}},kn=(e,n,i,r,o,s,a)=>t.e(Rn(e,n,i,r),Mn(s,e,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),On=(e,n,i,r)=>t.e(Mn(n,e,i),{u_fill_translate:r}),Ln=(e,t)=>({u_world:e,u_fill_translate:t}),Dn=(e,n,i,r,o)=>t.e(On(e,n,i,o),{u_world:r}),Fn=(e,n,i,r,o)=>{const s=e.transform;let a,l,c=0;if("map"===i.paint.get("circle-pitch-alignment")){const e=t.aC(n,1,s.zoom);a=!0,l=[e,e],c=e/(t.$*Math.pow(2,n.tileID.overscaledZ))*2*Math.PI*o}else a=!1,l=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_pitch_with_map:+a,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:r}},Nn=e=>({u_pixel_extrude_scale:[1/e.width,1/e.height]}),Bn=e=>({u_viewport_size:[e.width,e.height]}),zn=(e,t=1)=>({u_color:e,u_overlay:0,u_overlay_scale:t}),jn=(e,n,i,r)=>{const o=t.aC(e,1,n)/(t.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*r;return{u_extrude_scale:t.aC(e,1,n),u_intensity:i,u_globe_extrude_scale:o}},Un=(e,n,i,r)=>{const o=t.L();t.bY(o,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:i,u_color_ramp:r,u_opacity:n.paint.get("heatmap-opacity")}},Vn=(e,t,n)=>{const i=n.paint.get("hillshade-accent-color");let r;switch(n.paint.get("hillshade-method")){case"basic":r=4;break;case"combined":r=1;break;case"igor":r=2;break;case"multidirectional":r=3;break;default:r=0}const o=n.getIlluminationProperties();for(let t=0;t<o.directionRadians.length;t++)"viewport"===n.paint.get("hillshade-illumination-anchor")&&(o.directionRadians[t]+=e.transform.bearingInRadians);return{u_image:0,u_latrange:Gn(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:o.altitudeRadians,u_azimuths:o.directionRadians,u_accent:i,u_method:r,u_highlights:o.highlightColor,u_shadows:o.shadowColor}},$n=(e,n)=>{const i=n.stride,r=t.L();return t.bY(r,0,t.$,-t.$,0,0,1),t.M(r,r,[0,-t.$,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}};function Gn(e,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new t.a1(0,r/i).toLngLat().lat,new t.a1(0,(r+1)/i).toLngLat().lat]}const Wn=(e,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:e.paint.get("color-relief-opacity")}),Hn=(e,n,i,r)=>{const o=e.transform;return{u_translation:Kn(e,n,i),u_ratio:r/t.aC(n,1,o.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Zn=(e,n,i,r,o)=>t.e(Hn(e,n,i,r),{u_image:0,u_image_height:o}),qn=(e,n,i,r,o)=>{const s=e.transform,a=Yn(n,s);return{u_translation:Kn(e,n,i),u_texsize:n.imageAtlasTexture.size,u_ratio:r/t.aC(n,1,s.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[a,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},Xn=(e,n,i,r,o,s)=>{const a=e.lineAtlas,l=Yn(n,e.transform),c="round"===i.layout.get("line-cap"),u=a.getDash(o.from,c),h=a.getDash(o.to,c),d=u.width*s.fromScale,p=h.width*s.toScale;return t.e(Hn(e,n,i,r),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*e.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:s.t})};function Yn(e,n){return 1/t.aC(e,1,n.tileZoom)}function Kn(e,n,i){return t.aD(e.transform,n,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Jn=(e,t,n,i,r)=>{return{u_tl_parent:e,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(s=i.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Qn(i.paint.get("raster-hue-rotate")),u_coords_top:[r[0].x,r[0].y,r[1].x,r[1].y],u_coords_bottom:[r[3].x,r[3].y,r[2].x,r[2].y]};var o,s};function Qn(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const ei=(e,t,n,i,r,o,s,a,l,c,u,h,d)=>{const p=s.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:p.width/p.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+i,u_is_along_line:r,u_is_variable_anchor:o,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},ti=(e,n,i,r,o,s,a,l,c,u,h,d,p,f)=>{const g=a.transform;return t.e(ei(e,n,i,r,o,s,a,l,c,u,h,d,f),{u_gamma_scale:r?Math.cos(g.pitch*Math.PI/180)*g.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:1})},ni=(e,n,i,r,o,s,a,l,c,u,h,d,p)=>t.e(ti(e,n,i,r,o,s,a,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),ii=(e,t)=>({u_opacity:e,u_color:t}),ri=(e,n,i,r,o)=>t.e(function(e,n,i,r){const o=i.imageManager.getPattern(e.from.toString()),s=i.imageManager.getPattern(e.to.toString()),{width:a,height:l}=i.imageManager.getPixelSize(),c=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,i.transform.tileZoom)/c,h=u*(r.tileID.canonical.x+r.tileID.wrap*c),d=u*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:o.tl,u_pattern_br_a:o.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[a,l],u_mix:n.t,u_pattern_size_a:o.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:n.fromScale,u_scale_b:n.toScale,u_tile_units_to_pixels:1/t.aC(r,1,i.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(i,o,n,r),{u_opacity:e}),oi=(e,t)=>{},si={fillExtrusion:(e,n)=>({u_lightpos:new t.bT(e,n.u_lightpos),u_lightpos_globe:new t.bT(e,n.u_lightpos_globe),u_lightintensity:new t.bg(e,n.u_lightintensity),u_lightcolor:new t.bT(e,n.u_lightcolor),u_vertical_gradient:new t.bg(e,n.u_vertical_gradient),u_opacity:new t.bg(e,n.u_opacity),u_fill_translate:new t.bU(e,n.u_fill_translate)}),fillExtrusionPattern:(e,n)=>({u_lightpos:new t.bT(e,n.u_lightpos),u_lightpos_globe:new t.bT(e,n.u_lightpos_globe),u_lightintensity:new t.bg(e,n.u_lightintensity),u_lightcolor:new t.bT(e,n.u_lightcolor),u_vertical_gradient:new t.bg(e,n.u_vertical_gradient),u_height_factor:new t.bg(e,n.u_height_factor),u_opacity:new t.bg(e,n.u_opacity),u_fill_translate:new t.bU(e,n.u_fill_translate),u_image:new t.bP(e,n.u_image),u_texsize:new t.bU(e,n.u_texsize),u_pixel_coord_upper:new t.bU(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bU(e,n.u_pixel_coord_lower),u_scale:new t.bT(e,n.u_scale),u_fade:new t.bg(e,n.u_fade)}),fill:(e,n)=>({u_fill_translate:new t.bU(e,n.u_fill_translate)}),fillPattern:(e,n)=>({u_image:new t.bP(e,n.u_image),u_texsize:new t.bU(e,n.u_texsize),u_pixel_coord_upper:new t.bU(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bU(e,n.u_pixel_coord_lower),u_scale:new t.bT(e,n.u_scale),u_fade:new t.bg(e,n.u_fade),u_fill_translate:new t.bU(e,n.u_fill_translate)}),fillOutline:(e,n)=>({u_world:new t.bU(e,n.u_world),u_fill_translate:new t.bU(e,n.u_fill_translate)}),fillOutlinePattern:(e,n)=>({u_world:new t.bU(e,n.u_world),u_image:new t.bP(e,n.u_image),u_texsize:new t.bU(e,n.u_texsize),u_pixel_coord_upper:new t.bU(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bU(e,n.u_pixel_coord_lower),u_scale:new t.bT(e,n.u_scale),u_fade:new t.bg(e,n.u_fade),u_fill_translate:new t.bU(e,n.u_fill_translate)}),circle:(e,n)=>({u_camera_to_center_distance:new t.bg(e,n.u_camera_to_center_distance),u_scale_with_map:new t.bP(e,n.u_scale_with_map),u_pitch_with_map:new t.bP(e,n.u_pitch_with_map),u_extrude_scale:new t.bU(e,n.u_extrude_scale),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_globe_extrude_scale:new t.bg(e,n.u_globe_extrude_scale),u_translate:new t.bU(e,n.u_translate)}),collisionBox:(e,n)=>({u_pixel_extrude_scale:new t.bU(e,n.u_pixel_extrude_scale)}),collisionCircle:(e,n)=>({u_viewport_size:new t.bU(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.bQ(e,n.u_color),u_overlay:new t.bP(e,n.u_overlay),u_overlay_scale:new t.bg(e,n.u_overlay_scale)}),depth:oi,clippingMask:oi,heatmap:(e,n)=>({u_extrude_scale:new t.bg(e,n.u_extrude_scale),u_intensity:new t.bg(e,n.u_intensity),u_globe_extrude_scale:new t.bg(e,n.u_globe_extrude_scale)}),heatmapTexture:(e,n)=>({u_matrix:new t.bR(e,n.u_matrix),u_world:new t.bU(e,n.u_world),u_image:new t.bP(e,n.u_image),u_color_ramp:new t.bP(e,n.u_color_ramp),u_opacity:new t.bg(e,n.u_opacity)}),hillshade:(e,n)=>({u_image:new t.bP(e,n.u_image),u_latrange:new t.bU(e,n.u_latrange),u_exaggeration:new t.bg(e,n.u_exaggeration),u_altitudes:new t.b_(e,n.u_altitudes),u_azimuths:new t.b_(e,n.u_azimuths),u_accent:new t.bQ(e,n.u_accent),u_method:new t.bP(e,n.u_method),u_shadows:new t.bZ(e,n.u_shadows),u_highlights:new t.bZ(e,n.u_highlights)}),hillshadePrepare:(e,n)=>({u_matrix:new t.bR(e,n.u_matrix),u_image:new t.bP(e,n.u_image),u_dimension:new t.bU(e,n.u_dimension),u_zoom:new t.bg(e,n.u_zoom),u_unpack:new t.bS(e,n.u_unpack)}),colorRelief:(e,n)=>({u_image:new t.bP(e,n.u_image),u_unpack:new t.bS(e,n.u_unpack),u_dimension:new t.bU(e,n.u_dimension),u_elevation_stops:new t.bP(e,n.u_elevation_stops),u_color_stops:new t.bP(e,n.u_color_stops),u_color_ramp_size:new t.bP(e,n.u_color_ramp_size),u_opacity:new t.bg(e,n.u_opacity)}),line:(e,n)=>({u_translation:new t.bU(e,n.u_translation),u_ratio:new t.bg(e,n.u_ratio),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bU(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_translation:new t.bU(e,n.u_translation),u_ratio:new t.bg(e,n.u_ratio),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bU(e,n.u_units_to_pixels),u_image:new t.bP(e,n.u_image),u_image_height:new t.bg(e,n.u_image_height)}),linePattern:(e,n)=>({u_translation:new t.bU(e,n.u_translation),u_texsize:new t.bU(e,n.u_texsize),u_ratio:new t.bg(e,n.u_ratio),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_image:new t.bP(e,n.u_image),u_units_to_pixels:new t.bU(e,n.u_units_to_pixels),u_scale:new t.bT(e,n.u_scale),u_fade:new t.bg(e,n.u_fade)}),lineSDF:(e,n)=>({u_translation:new t.bU(e,n.u_translation),u_ratio:new t.bg(e,n.u_ratio),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.bU(e,n.u_units_to_pixels),u_patternscale_a:new t.bU(e,n.u_patternscale_a),u_patternscale_b:new t.bU(e,n.u_patternscale_b),u_sdfgamma:new t.bg(e,n.u_sdfgamma),u_image:new t.bP(e,n.u_image),u_tex_y_a:new t.bg(e,n.u_tex_y_a),u_tex_y_b:new t.bg(e,n.u_tex_y_b),u_mix:new t.bg(e,n.u_mix)}),raster:(e,n)=>({u_tl_parent:new t.bU(e,n.u_tl_parent),u_scale_parent:new t.bg(e,n.u_scale_parent),u_buffer_scale:new t.bg(e,n.u_buffer_scale),u_fade_t:new t.bg(e,n.u_fade_t),u_opacity:new t.bg(e,n.u_opacity),u_image0:new t.bP(e,n.u_image0),u_image1:new t.bP(e,n.u_image1),u_brightness_low:new t.bg(e,n.u_brightness_low),u_brightness_high:new t.bg(e,n.u_brightness_high),u_saturation_factor:new t.bg(e,n.u_saturation_factor),u_contrast_factor:new t.bg(e,n.u_contrast_factor),u_spin_weights:new t.bT(e,n.u_spin_weights),u_coords_top:new t.bS(e,n.u_coords_top),u_coords_bottom:new t.bS(e,n.u_coords_bottom)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.bP(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bP(e,n.u_is_size_feature_constant),u_size_t:new t.bg(e,n.u_size_t),u_size:new t.bg(e,n.u_size),u_camera_to_center_distance:new t.bg(e,n.u_camera_to_center_distance),u_pitch:new t.bg(e,n.u_pitch),u_rotate_symbol:new t.bP(e,n.u_rotate_symbol),u_aspect_ratio:new t.bg(e,n.u_aspect_ratio),u_fade_change:new t.bg(e,n.u_fade_change),u_label_plane_matrix:new t.bR(e,n.u_label_plane_matrix),u_coord_matrix:new t.bR(e,n.u_coord_matrix),u_is_text:new t.bP(e,n.u_is_text),u_pitch_with_map:new t.bP(e,n.u_pitch_with_map),u_is_along_line:new t.bP(e,n.u_is_along_line),u_is_variable_anchor:new t.bP(e,n.u_is_variable_anchor),u_texsize:new t.bU(e,n.u_texsize),u_texture:new t.bP(e,n.u_texture),u_translation:new t.bU(e,n.u_translation),u_pitched_scale:new t.bg(e,n.u_pitched_scale)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.bP(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bP(e,n.u_is_size_feature_constant),u_size_t:new t.bg(e,n.u_size_t),u_size:new t.bg(e,n.u_size),u_camera_to_center_distance:new t.bg(e,n.u_camera_to_center_distance),u_pitch:new t.bg(e,n.u_pitch),u_rotate_symbol:new t.bP(e,n.u_rotate_symbol),u_aspect_ratio:new t.bg(e,n.u_aspect_ratio),u_fade_change:new t.bg(e,n.u_fade_change),u_label_plane_matrix:new t.bR(e,n.u_label_plane_matrix),u_coord_matrix:new t.bR(e,n.u_coord_matrix),u_is_text:new t.bP(e,n.u_is_text),u_pitch_with_map:new t.bP(e,n.u_pitch_with_map),u_is_along_line:new t.bP(e,n.u_is_along_line),u_is_variable_anchor:new t.bP(e,n.u_is_variable_anchor),u_texsize:new t.bU(e,n.u_texsize),u_texture:new t.bP(e,n.u_texture),u_gamma_scale:new t.bg(e,n.u_gamma_scale),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_is_halo:new t.bP(e,n.u_is_halo),u_translation:new t.bU(e,n.u_translation),u_pitched_scale:new t.bg(e,n.u_pitched_scale)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.bP(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bP(e,n.u_is_size_feature_constant),u_size_t:new t.bg(e,n.u_size_t),u_size:new t.bg(e,n.u_size),u_camera_to_center_distance:new t.bg(e,n.u_camera_to_center_distance),u_pitch:new t.bg(e,n.u_pitch),u_rotate_symbol:new t.bP(e,n.u_rotate_symbol),u_aspect_ratio:new t.bg(e,n.u_aspect_ratio),u_fade_change:new t.bg(e,n.u_fade_change),u_label_plane_matrix:new t.bR(e,n.u_label_plane_matrix),u_coord_matrix:new t.bR(e,n.u_coord_matrix),u_is_text:new t.bP(e,n.u_is_text),u_pitch_with_map:new t.bP(e,n.u_pitch_with_map),u_is_along_line:new t.bP(e,n.u_is_along_line),u_is_variable_anchor:new t.bP(e,n.u_is_variable_anchor),u_texsize:new t.bU(e,n.u_texsize),u_texsize_icon:new t.bU(e,n.u_texsize_icon),u_texture:new t.bP(e,n.u_texture),u_texture_icon:new t.bP(e,n.u_texture_icon),u_gamma_scale:new t.bg(e,n.u_gamma_scale),u_device_pixel_ratio:new t.bg(e,n.u_device_pixel_ratio),u_is_halo:new t.bP(e,n.u_is_halo),u_translation:new t.bU(e,n.u_translation),u_pitched_scale:new t.bg(e,n.u_pitched_scale)}),background:(e,n)=>({u_opacity:new t.bg(e,n.u_opacity),u_color:new t.bQ(e,n.u_color)}),backgroundPattern:(e,n)=>({u_opacity:new t.bg(e,n.u_opacity),u_image:new t.bP(e,n.u_image),u_pattern_tl_a:new t.bU(e,n.u_pattern_tl_a),u_pattern_br_a:new t.bU(e,n.u_pattern_br_a),u_pattern_tl_b:new t.bU(e,n.u_pattern_tl_b),u_pattern_br_b:new t.bU(e,n.u_pattern_br_b),u_texsize:new t.bU(e,n.u_texsize),u_mix:new t.bg(e,n.u_mix),u_pattern_size_a:new t.bU(e,n.u_pattern_size_a),u_pattern_size_b:new t.bU(e,n.u_pattern_size_b),u_scale_a:new t.bg(e,n.u_scale_a),u_scale_b:new t.bg(e,n.u_scale_b),u_pixel_coord_upper:new t.bU(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.bU(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.bg(e,n.u_tile_units_to_pixels)}),terrain:(e,n)=>({u_texture:new t.bP(e,n.u_texture),u_ele_delta:new t.bg(e,n.u_ele_delta),u_fog_matrix:new t.bR(e,n.u_fog_matrix),u_fog_color:new t.bQ(e,n.u_fog_color),u_fog_ground_blend:new t.bg(e,n.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.bg(e,n.u_fog_ground_blend_opacity),u_horizon_color:new t.bQ(e,n.u_horizon_color),u_horizon_fog_blend:new t.bg(e,n.u_horizon_fog_blend),u_is_globe_mode:new t.bg(e,n.u_is_globe_mode)}),terrainDepth:(e,n)=>({u_ele_delta:new t.bg(e,n.u_ele_delta)}),terrainCoords:(e,n)=>({u_texture:new t.bP(e,n.u_texture),u_terrain_coords_id:new t.bg(e,n.u_terrain_coords_id),u_ele_delta:new t.bg(e,n.u_ele_delta)}),projectionErrorMeasurement:(e,n)=>({u_input:new t.bg(e,n.u_input),u_output_expected:new t.bg(e,n.u_output_expected)}),atmosphere:(e,n)=>({u_sun_pos:new t.bT(e,n.u_sun_pos),u_atmosphere_blend:new t.bg(e,n.u_atmosphere_blend),u_globe_position:new t.bT(e,n.u_globe_position),u_globe_radius:new t.bg(e,n.u_globe_radius),u_inv_proj_matrix:new t.bR(e,n.u_inv_proj_matrix)}),sky:(e,n)=>({u_sky_color:new t.bQ(e,n.u_sky_color),u_horizon_color:new t.bQ(e,n.u_horizon_color),u_horizon:new t.bU(e,n.u_horizon),u_horizon_normal:new t.bU(e,n.u_horizon_normal),u_sky_horizon_blend:new t.bg(e,n.u_sky_horizon_blend),u_sky_blend:new t.bg(e,n.u_sky_blend)})};class ai{constructor(e,t,n){this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const li={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ci{constructor(e,t,n,i){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[li[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ui{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hi extends ui{getDefault(){return t.bf.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class di extends ui{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class pi extends ui{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class fi extends ui{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class gi extends ui{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class mi extends ui{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class _i extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class yi extends ui{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class vi extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class bi extends ui{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class xi extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class wi extends ui{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ei extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Si extends ui{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ti extends ui{getDefault(){return t.bf.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ci extends ui{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ai extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Pi extends ui{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ii extends ui{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Mi extends ui{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ri extends ui{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ki extends ui{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Oi extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Li extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Di extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Fi extends ui{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ni extends ui{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bi extends ui{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;const n=this.gl;Ht(n)?n.bindVertexArray(e):null===(t=n.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class zi extends ui{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ji extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Ui extends ui{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Vi extends ui{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class $i extends Vi{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Gi extends Vi{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Wi extends Vi{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Hi="Framebuffer is not complete";class Zi{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const o=e.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new $i(e,s),i)this.depthAttachment=r?new Wi(e,s):new Gi(e,s);else if(r)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error(Hi)}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class qi{constructor(e){var t,n;if(this.gl=e,this.clearColor=new hi(this),this.clearDepth=new di(this),this.clearStencil=new pi(this),this.colorMask=new fi(this),this.depthMask=new gi(this),this.stencilMask=new mi(this),this.stencilFunc=new _i(this),this.stencilOp=new yi(this),this.stencilTest=new vi(this),this.depthRange=new bi(this),this.depthTest=new xi(this),this.depthFunc=new wi(this),this.blend=new Ei(this),this.blendFunc=new Si(this),this.blendColor=new Ti(this),this.blendEquation=new Ci(this),this.cullFace=new Ai(this),this.cullFaceSide=new Pi(this),this.frontFace=new Ii(this),this.program=new Mi(this),this.activeTexture=new Ri(this),this.viewport=new ki(this),this.bindFramebuffer=new Oi(this),this.bindRenderbuffer=new Li(this),this.bindTexture=new Di(this),this.bindVertexBuffer=new Fi(this),this.bindElementBuffer=new Ni(this),this.bindVertexArray=new Bi(this),this.pixelStoreUnpack=new zi(this),this.pixelStoreUnpackPremultiplyAlpha=new ji(this),this.pixelStoreUnpackFlipY=new Ui(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ht(e)){this.HALF_FLOAT=e.HALF_FLOAT;const i=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==i?void 0:i.RGBA16F_EXT,this.RGB16F=null!==(n=e.RGB16F)&&void 0!==n?n:null==i?void 0:i.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new ai(this,e,t)}createVertexBuffer(e,t,n){return new ci(this,e,t,n)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new Zi(this,e,t,n,i)}clear({color:e,depth:t,stencil:n}){const i=this.gl;let r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==n&&(r|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),i.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.bH(e.blendFunction,zt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ht(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return Ht(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Xi;function Yi(e,n,i,r,o){const s=e.context,a=e.transform,l=s.gl,c=e.useProgram("collisionBox"),u=[];let h=0,d=0;for(let t=0;t<r.length;t++){const p=r[t],f=n.getTile(p).getBucket(i);if(!f)continue;const g=o?f.textCollisionBox:f.iconCollisionBox,m=f.collisionCircleArray;m.length>0&&(u.push({circleArray:m,circleOffset:d,coord:p}),h+=m.length/4,d=h),g&&c.draw(s,l.LINES,Vt.disabled,Gt.disabled,e.colorModeForRenderPass(),Ut.disabled,Nn(e.transform),e.style.map.terrain&&e.style.map.terrain.getTerrainData(p),a.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,null,e.transform.zoom,null,null,g.collisionVertexBuffer)}if(!o||!u.length)return;const p=e.useProgram("collisionCircle"),f=new t.b$;f.resize(4*h),f._trim();let g=0;for(const e of u)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],o=e.circleArray[n+2],s=e.circleArray[n+3];f.emplace(g++,i,r,o,s,0),f.emplace(g++,i,r,o,s,1),f.emplace(g++,i,r,o,s,2),f.emplace(g++,i,r,o,s,3)}(!Xi||Xi.length<2*h)&&(Xi=function(e){const n=2*e,i=new t.c1;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(h));const m=s.createIndexBuffer(Xi,!0),_=s.createVertexBuffer(f,t.c0.members,!0);for(const n of u){const r=Bn(e.transform);p.draw(s,l.TRIANGLES,Vt.disabled,Gt.disabled,e.colorModeForRenderPass(),Ut.disabled,r,e.style.map.terrain&&e.style.map.terrain.getTerrainData(n.coord),null,i.id,_,m,t.aM.simpleSegment(0,2*n.circleOffset,n.circleArray.length,n.circleArray.length/2),null,e.transform.zoom,null,null,null)}_.destroy(),m.destroy()}const Ki=t.ag(new Float32Array(16));function Ji(e,n,i,r,o,s){const{horizontalAlign:a,verticalAlign:l}=t.aH(e);return new t.P((-(a-.5)*n/o+r[0])*s,(-(l-.5)*i/o+r[1])*s)}function Qi(e,n,i,r,o,s){const a=n.tileAnchorPoint.add(new t.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let e=r.mult(s);i||(e=e.rotate(-o));const t=a.add(e);return Ie(t.x,t.y,n.pitchedLabelPlaneMatrix,n.getElevation).point}if(i){const t=Be(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(e),i=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0);return e.add(r.rotate(i))}return e.add(r)}function er(e,n,i,r,o,s,a,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,g=e.icon.dynamicLayoutVertexArray,m={};f.clear();for(let g=0;g<p.length;g++){const _=p.get(g),y=_.hidden||!_.crossTileID||e.allowVerticalPlacement&&!_.placedOrientation?null:r[_.crossTileID];if(y){const r=new t.P(_.anchorX,_.anchorY),p={getElevation:d,width:o.width,height:o.height,pitchedLabelPlaneMatrix:s,pitchWithMap:i,transform:o,tileAnchorPoint:r,translation:u,unwrappedTileID:h},g=i?je(r.x,r.y,p):Be(r.x,r.y,p),v=Me(o.cameraToCenterDistance,g.signedDistanceFromCamera);let b=t.ap(e.textSizeData,l,_)*v/t.aB;i&&(b*=e.tilePixelRatio/a);const{width:x,height:w,anchor:E,textOffset:S,textBoxScale:T}=y,C=Ji(E,x,w,S,T,b),A=o.getPitchedTextCorrection(r.x+u[0],r.y+u[1],h),P=Qi(g.point,p,n,C,-o.bearingInRadians,A),I=e.allowVerticalPlacement&&_.placedOrientation===t.ao.vertical?Math.PI/2:0;for(let e=0;e<_.numGlyphs;e++)t.av(f,P,I);c&&_.associatedIconIndex>=0&&(m[_.associatedIconIndex]={shiftedAnchor:P,angle:I})}else We(_.numGlyphs,f)}if(c){g.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const i=n.get(e);if(i.hidden)We(i.numGlyphs,g);else{const n=m[e];if(n)for(let e=0;e<i.numGlyphs;e++)t.av(g,n.shiftedAnchor,n.angle);else We(i.numGlyphs,g)}}e.icon.dynamicLayoutVertexBuffer.updateData(g)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function tr(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function nr(e,n,i,r,o,s,a,l,c,u,h,d,p){const f=e.context,g=f.gl,m=e.transform,_="map"===l,y="map"===c,v="viewport"!==l&&"point"!==i.layout.get("symbol-placement"),b=_&&!y&&!v,x=!i.layout.get("symbol-sort-key").isConstant();let w=!1;const E=e.getDepthModeForSublayer(0,Vt.ReadOnly),S=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),T=[],C=m.getCircleRadiusCorrection();for(const l of r){const r=n.getTile(l),c=r.getBucket(i);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(i.id),f=o||c.sdfIcons,E=o?c.textSizeData:c.iconSizeData,A=y||0!==m.pitch,P=e.useProgram(tr(f,o,c),d),I=t.an(E,m.zoom),M=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);let R,k,O,L,D=[0,0],F=null;if(o)k=r.glyphAtlasTexture,O=g.LINEAR,R=r.glyphAtlasTexture.size,c.iconsInText&&(D=r.imageAtlasTexture.size,F=r.imageAtlasTexture,L=A||e.options.rotating||e.options.zooming||"composite"===E.kind||"camera"===E.kind?g.LINEAR:g.NEAREST);else{const t=1!==i.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;k=r.imageAtlasTexture,O=f||e.options.rotating||e.options.zooming||t||A?g.LINEAR:g.NEAREST,R=r.imageAtlasTexture.size}const N=t.aC(r,1,e.transform.zoom),B=Ce(_,e.transform,N),z=t.L();t.aq(z,B);const j=Ae(y,_,e.transform,N),U=t.aD(m,r,s,a),V=m.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),$=S&&c.hasTextData(),G="none"!==i.layout.get("icon-text-fit")&&$&&c.hasIconData();if(v){const t=e.style.map.terrain?(t,n)=>e.style.map.terrain.getElevation(l,t,n):null,n="map"===i.layout.get("text-rotation-alignment");ke(c,e,o,B,z,y,u,n,l.toUnwrapped(),m.width,m.height,U,t)}const W=o&&S||G,H=v||W?Ki:y?B:e.transform.clipSpaceToPixelsMatrix,Z=f&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let q;q=f?c.iconsInText?ni(E.kind,I,b,y,v,W,e,H,j,U,R,D,C):ti(E.kind,I,b,y,v,W,e,H,j,U,o,R,0,C):ei(E.kind,I,b,y,v,W,e,H,j,U,o,R,C);const X={program:P,buffers:h,uniformValues:q,projectionData:V,atlasTexture:k,atlasTextureIcon:F,atlasInterpolation:O,atlasInterpolationIcon:L,isSDF:f,hasHalo:Z};if(x&&c.canOverlap){w=!0;const e=h.segments.get();for(const n of e)T.push({segments:new t.aM([n]),sortKey:n.sortKey,state:X,terrainData:M})}else T.push({segments:h.segments,sortKey:0,state:X,terrainData:M})}w&&T.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of T){const n=t.state;if(f.activeTexture.set(g.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,g.CLAMP_TO_EDGE),n.atlasTextureIcon&&(f.activeTexture.set(g.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,g.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,ir(n.buffers,t.segments,i,e,n.program,E,h,d,r,n.projectionData,t.terrainData)),r.u_is_halo=0}ir(n.buffers,t.segments,i,e,n.program,E,h,d,n.uniformValues,n.projectionData,t.terrainData)}}function ir(e,t,n,i,r,o,s,a,l,c,u){const h=i.context;r.draw(h,h.gl.TRIANGLES,o,s,a,Ut.backCCW,l,u,c,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function rr(e,n,i,r,o){const s=e.context,a=s.gl,l=Gt.disabled,c=new zt([a.ONE,a.ONE],t.bf.transparent,[!0,!0,!0,!0]),u=n.getBucket(i);if(!u)return;const h=r.key;let d=i.heatmapFbos.get(h);d||(d=sr(s,n.tileSize,n.tileSize),i.heatmapFbos.set(h,d)),s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,n.tileSize,n.tileSize]),s.clear({color:t.bf.transparent});const p=u.programConfigurations.get(i.id),f=e.useProgram("heatmap",p,!o),g=e.transform.getProjectionData({overscaledTileID:n.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),m=e.style.map.terrain.getTerrainData(r);f.draw(s,a.TRIANGLES,Vt.disabled,l,c,Ut.disabled,jn(n,e.transform.zoom,i.paint.get("heatmap-intensity"),1),m,g,i.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,i.paint,e.transform.zoom,p)}function or(e,t,n,i,r){const o=e.context,s=o.gl,a=e.transform;o.setColorMode(e.colorModeForRenderPass());const l=ar(o,t),c=n.key,u=t.heatmapFbos.get(c);if(!u)return;o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),l.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=a.getProjectionData({overscaledTileID:n,applyTerrainMatrix:r,applyGlobeMatrix:!i});e.useProgram("heatmapTexture").draw(o,s.TRIANGLES,Vt.disabled,Gt.disabled,e.colorModeForRenderPass(),Ut.disabled,Un(e,t,0,1),null,h,t.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments,t.paint,a.zoom),u.destroy(),t.heatmapFbos.delete(c)}function sr(e,t,n){var i,r;const o=e.gl,s=o.createTexture();o.bindTexture(o.TEXTURE_2D,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);const a=null!==(i=e.HALF_FLOAT)&&void 0!==i?i:o.UNSIGNED_BYTE,l=null!==(r=e.RGBA16F)&&void 0!==r?r:o.RGBA;o.texImage2D(o.TEXTURE_2D,0,l,t,n,0,o.RGBA,a,null);const c=e.createFramebuffer(t,n,!1,!1);return c.colorAttachment.set(s),c}function ar(e,n){return n.colorRampTexture||(n.colorRampTexture=new t.T(e,n.colorRamp,e.gl.RGBA)),n.colorRampTexture}function lr(e,t,n,i,r){if(!n||!i||!i.imageAtlas)return;const o=i.imageAtlas.patternPositions;let s=o[n.to.toString()],a=o[n.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const e=r.getPaintProperty(t);s=o[e],a=o[e]}s&&a&&e.setConstantPatternPositions(s,a)}function cr(e,n,i,r,o,s,a,l){const c=e.context.gl,u="fill-pattern",h=i.paint.get(u),d=h&&h.constantOr(1),p=i.getCrossfadeParameters();let f,g,m,_,y;const v=e.transform,b=i.paint.get("fill-translate"),x=i.paint.get("fill-translate-anchor");a?(g=d&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(g=d?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const h of r){const r=n.getTile(h);if(d&&!r.patternsLoaded())continue;const E=r.getBucket(i);if(!E)continue;const S=E.programConfigurations.get(i.id),T=e.useProgram(g,S),C=e.style.map.terrain&&e.style.map.terrain.getTerrainData(h);d&&(e.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),S.updatePaintBuffers(p)),lr(S,u,w,r,i);const A=v.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),P=t.aD(v,r,b,x);if(a){_=E.indexBuffer2,y=E.segments2;const t=[c.drawingBufferWidth,c.drawingBufferHeight];m="fillOutlinePattern"===g&&d?Dn(e,p,r,t,P):Ln(t,P)}else _=E.indexBuffer,y=E.segments,m=d?On(e,p,r,P):{u_fill_translate:P};const I=e.stencilModeForClipping(h);T.draw(e.context,f,o,I,s,Ut.backCCW,m,C,A,i.id,E.layoutVertexBuffer,_,y,i.paint,e.transform.zoom,S)}}function ur(e,n,i,r,o,s,a,l){const c=e.context,u=c.gl,h="fill-extrusion-pattern",d=i.paint.get(h),p=d.constantOr(1),f=i.getCrossfadeParameters(),g=i.paint.get("fill-extrusion-opacity"),m=d.constantOr(null),_=e.transform;for(const d of r){const r=n.getTile(d),y=r.getBucket(i);if(!y)continue;const v=e.style.map.terrain&&e.style.map.terrain.getTerrainData(d),b=y.programConfigurations.get(i.id),x=e.useProgram(p?"fillExtrusionPattern":"fillExtrusion",b);p&&(e.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),b.updatePaintBuffers(f));const w=_.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!l,applyTerrainMatrix:!0});lr(b,h,m,r,i);const E=t.aD(_,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),S=i.paint.get("fill-extrusion-vertical-gradient"),T=p?kn(e,S,g,E,d,f,r):Rn(e,S,g,E);x.draw(c,c.gl.TRIANGLES,o,s,a,Ut.backCCW,T,v,w,i.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,i.paint,e.transform.zoom,b,e.style.map.terrain&&y.centroidVertexBuffer)}}function hr(e,t,n,i,r,o,s,a,l){var c;const u=e.style.projection,h=e.context,d=e.transform,p=h.gl,f=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],g=e.useProgram("hillshade",null,!1,f),m=!e.options.moving;for(const f of i){const i=t.getTile(f),_=i.fbo;if(!_)continue;const y=u.getMeshFromTileID(h,f.canonical,a,!0,"raster"),v=null===(c=e.style.map.terrain)||void 0===c?void 0:c.getTerrainData(f);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,_.colorAttachment.get());const b=d.getProjectionData({overscaledTileID:f,aligned:m,applyGlobeMatrix:!l,applyTerrainMatrix:!0});g.draw(h,p.TRIANGLES,o,r[f.overscaledZ],s,Ut.backCCW,Vn(e,i,n),v,b,n.id,y.vertexBuffer,y.indexBuffer,y.segments)}}function dr(e,n,i,r,o,s,a,l,c){var u;const h=e.style.projection,d=e.context,p=e.transform,f=d.gl,g=e.useProgram("colorRelief"),m=!e.options.moving;let _=!0,y=0;for(const v of r){const r=n.getTile(v),b=r.dem;if(_){const e=f.getParameter(f.MAX_TEXTURE_SIZE),{elevationTexture:t,colorTexture:n}=i.getColorRampTextures(d,e,b.getUnpackVector());d.activeTexture.set(f.TEXTURE1),t.bind(f.NEAREST,f.CLAMP_TO_EDGE),d.activeTexture.set(f.TEXTURE4),n.bind(f.LINEAR,f.CLAMP_TO_EDGE),_=!1,y=t.size[0]}if(!b||!b.data)continue;const x=b.stride,w=b.getPixels();if(d.activeTexture.set(f.TEXTURE0),d.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(x),r.demTexture){const e=r.demTexture;e.update(w,{premultiply:!1}),e.bind(f.LINEAR,f.CLAMP_TO_EDGE)}else r.demTexture=new t.T(d,w,f.RGBA,{premultiply:!1}),r.demTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const E=h.getMeshFromTileID(d,v.canonical,l,!0,"raster"),S=null===(u=e.style.map.terrain)||void 0===u?void 0:u.getTerrainData(v),T=p.getProjectionData({overscaledTileID:v,aligned:m,applyGlobeMatrix:!c,applyTerrainMatrix:!0});g.draw(d,f.TRIANGLES,s,o[v.overscaledZ],a,Ut.backCCW,Wn(i,r.dem,y),S,T,i.id,E.vertexBuffer,E.indexBuffer,E.segments)}}const pr=[new t.P(0,0),new t.P(t.$,0),new t.P(t.$,t.$),new t.P(0,t.$)];function fr(e,t,n,i,r,o,s,a,l=!1,c=!1){const u=i[i.length-1].overscaledZ,h=e.context,d=h.gl,p=e.useProgram("raster"),f=e.transform,g=e.style.projection,m=e.colorModeForRenderPass(),_=!e.options.moving;for(const y of i){const i=e.getDepthModeForSublayer(y.overscaledZ-u,1===n.paint.get("raster-opacity")?Vt.ReadWrite:Vt.ReadOnly,d.LESS),v=t.getTile(y);v.registerFadeDuration(n.paint.get("raster-fade-duration"));const b=t.findLoadedParent(y,0),x=t.findLoadedSibling(y),w=gr(v,b||x||null,t,n,e.transform,e.style.map.terrain);let E,S;const T="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),v.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1),b?(b.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),E=Math.pow(2,b.tileID.overscaledZ-v.tileID.overscaledZ),S=[v.tileID.canonical.x*E%1,v.tileID.canonical.y*E%1]):v.texture.bind(T,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),v.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const C=e.style.map.terrain&&e.style.map.terrain.getTerrainData(y),A=f.getProjectionData({overscaledTileID:y,aligned:_,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),P=Jn(S||[0,0],E||1,w,n,a),I=g.getMeshFromTileID(h,y.canonical,o,s,"raster");p.draw(h,d.TRIANGLES,i,r?r[y.overscaledZ]:Gt.disabled,m,l?Ut.frontCCW:Ut.backCCW,P,C,A,n.id,I.vertexBuffer,I.indexBuffer,I.segments)}}function gr(e,n,i,r,o,a){const l=r.paint.get("raster-fade-duration");if(!a&&l>0){const r=s.now(),a=(r-e.timeAdded)/l,c=n?(r-n.timeAdded)/l:-1,u=i.getSource(),h=_e(o,{tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=d&&e.refreshedUponExpiration?1:t.ah(d?a:1-c,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const mr=new t.bf(1,0,0,1),_r=new t.bf(0,1,0,1),yr=new t.bf(0,0,1,1),vr=new t.bf(1,0,1,1),br=new t.bf(0,1,1,1);function xr(e,t,n,i){Er(e,0,t+n/2,e.transform.width,n,i)}function wr(e,t,n,i){Er(e,t-n/2,0,n,e.transform.height,i)}function Er(e,t,n,i,r,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*e.pixelRatio,n*e.pixelRatio,i*e.pixelRatio,r*e.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function Sr(e,n,i){const r=e.context,o=r.gl,s=e.useProgram("debug"),a=Vt.disabled,l=Gt.disabled,c=e.colorModeForRenderPass(),u="$debug",h=e.style.map.terrain&&e.style.map.terrain.getTerrainData(i);r.activeTexture.set(o.TEXTURE0);const d=n.getTileByID(i.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=n.getTile(i).tileSize,g=512/Math.min(f,512)*(i.overscaledZ/e.transform.zoom)*.5;let m=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(m+=` => ${i.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,`${m} ${p}kB`);const _=e.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});s.draw(r,o.TRIANGLES,a,l,zt.alphaBlended,Ut.disabled,zn(t.bf.transparent,g),null,_,u,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),s.draw(r,o.LINE_STRIP,a,l,c,Ut.disabled,zn(t.bf.red),h,_,u,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function Tr(e,t,n,i){const{isRenderingGlobe:r}=i,o=e.context,s=o.gl,a=e.transform,l=e.colorModeForRenderPass(),c=e.getDepthModeFor3D(),u=e.useProgram("terrain");o.bindFramebuffer.set(null),o.viewport.set([0,0,e.width,e.height]);for(const i of n){const n=t.getTerrainMesh(i.tileID),h=e.renderToTexture.getTexture(i),d=t.getTerrainData(i.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,h.texture);const p=t.getMeshFrameDelta(a.zoom),f=a.calculateFogMatrix(i.tileID.toUnwrapped()),g=Cn(p,f,e.style.sky,a.pitch,r),m=a.getProjectionData({overscaledTileID:i.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(o,s.TRIANGLES,c,Gt.disabled,l,Ut.backCCW,g,d,m,"terrain",n.vertexBuffer,n.indexBuffer,n.segments)}}function Cr(e,n){if(!n.mesh){const i=new t.aL;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const r=new t.aN;r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),n.mesh=new wt(e.createVertexBuffer(i,Et.members),e.createIndexBuffer(r),t.aM.simpleSegment(0,0,i.length,r.length))}return n.mesh}class Ar{constructor(e,n){this.context=new qi(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=be.maxUnderzooming+be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yt}resize(e,t,n){if(this.width=Math.floor(e*n),this.height=Math.floor(t*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style._order)this.style._layers[e].resize()}setup(){const e=this.context,n=new t.aL;n.emplaceBack(0,0),n.emplaceBack(t.$,0),n.emplaceBack(0,t.$),n.emplaceBack(t.$,t.$),this.tileExtentBuffer=e.createVertexBuffer(n,Et.members),this.tileExtentSegments=t.aM.simpleSegment(0,0,4,2);const i=new t.aL;i.emplaceBack(0,0),i.emplaceBack(t.$,0),i.emplaceBack(0,t.$),i.emplaceBack(t.$,t.$),this.debugBuffer=e.createVertexBuffer(i,Et.members),this.debugSegments=t.aM.simpleSegment(0,0,4,5);const r=new t.c6;r.emplaceBack(0,0,0,0),r.emplaceBack(t.$,0,t.$,0),r.emplaceBack(0,t.$,0,t.$),r.emplaceBack(t.$,t.$,t.$,t.$),this.rasterBoundsBuffer=e.createVertexBuffer(r,Sn.members),this.rasterBoundsSegments=t.aM.simpleSegment(0,0,4,2);const o=new t.aL;o.emplaceBack(0,0),o.emplaceBack(t.$,0),o.emplaceBack(0,t.$),o.emplaceBack(t.$,t.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(o,Et.members),this.rasterBoundsSegmentsPosOnly=t.aM.simpleSegment(0,0,4,5);const s=new t.aL;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,Et.members),this.viewportSegments=t.aM.simpleSegment(0,0,4,2);const a=new t.c7;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);const l=new t.aN;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Gt({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new wt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const i=t.L();t.bY(i,0,this.width,this.height,0,0,1),t.N(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const r={mainMatrix:i,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:i};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,Vt.disabled,this.stencilClearMode,zt.disabled,Ut.disabled,null,null,r,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source,this.nextStencilID+t.length>256&&this.clearStencil();const i=this.context;i.setColorMode(zt.disabled),i.setDepthMode(Vt.disabled);const r={};for(const e of t)r[e.key]=this.nextStencilID++;this._renderTileMasks(r,t,n,!0),this._renderTileMasks(r,t,n,!1),this._tileClippingMaskIDs=r}_renderTileMasks(e,t,n,i){const r=this.context,o=r.gl,s=this.style.projection,a=this.transform,l=this.useProgram("clippingMask");for(const c of t){const t=e[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=s.getMeshFromTileID(this.context,c.canonical,i,!0,"stencil"),d=a.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!n,applyTerrainMatrix:!0});l.draw(r,o.TRIANGLES,Vt.disabled,new Gt({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),zt.disabled,n?Ut.disabled:Ut.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const e=this.context,t=e.gl,n=this.style.projection,i=this.transform,r=this.useProgram("depth"),o=this.getDepthModeFor3D(),s=ye(i,{tileSize:i.tileSize});for(const a of s){const s=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a),l=n.getMeshFromTileID(this.context,a.canonical,!0,!0,"raster"),c=i.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});r.draw(e,t.TRIANGLES,o,Gt.disabled,zt.disabled,Ut.backCCW,null,s,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Gt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){const t=this.context.gl;return new Gt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const t=this.context.gl,n=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+i]=new Gt({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[i]:Gt.disabled},n]}stencilConfigForOverlapTwoPass(e){const t=this.context.gl,n=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(this.clearStencil(),r>1){const e={},o={};for(let n=0;n<r;n++)e[n+i]=new Gt({func:t.GREATER,mask:255},r+1+n,255,t.KEEP,t.KEEP,t.REPLACE),o[n+i]=new Gt({func:t.GREATER,mask:255},1+n,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID=2*r+1,[e,o,n]}return this.nextStencilID=3,[{[i]:new Gt({func:t.GREATER,mask:255},2,255,t.KEEP,t.KEEP,t.REPLACE)},{[i]:new Gt({func:t.GREATER,mask:255},1,255,t.KEEP,t.KEEP,t.REPLACE)},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new zt([e.CONSTANT_COLOR,e.ONE],new t.bf(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?zt.unblended:zt.alphaBlended}getDepthModeForSublayer(e,t,n){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Vt(n||this.context.gl.LEQUAL,t,[i,i])}getDepthModeFor3D(){return new Vt(this.context.gl.LEQUAL,Vt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var i,r;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(s.now()),this.imageManager.beginFrame();const o=this.style._order,a=this.style.sourceCaches,l={},c={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(i=e.projection)||void 0===i?void 0:i.transitionState)>0};for(const e in a){const t=a[e];t.used&&t.prepare(this.context),l[e]=t.getVisibleCoordinates(!1),c[e]=l[e].slice().reverse(),u[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(this.style._layers[o[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of o){const t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=c[t.source];("custom"===t.type||n.length)&&this.renderLayer(this,a[t.source],t,n,h)}if(null===(r=this.style.projection)||void 0===r||r.updateGPUdependent({context:this.context,useProgram:e=>this.useProgram(e)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.bf.black:t.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(e,t){const n=e.context,i=n.gl,r=((e,t,n)=>{const i=Math.cos(t.rollInRadians),r=Math.sin(t.rollInRadians),o=ue(t),s=t.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:e.properties.get("sky-color"),u_horizon_color:e.properties.get("horizon-color"),u_horizon:[(t.width/2-o*r)*n,(t.height/2+o*i)*n],u_horizon_normal:[-r,i],u_sky_horizon_blend:e.properties.get("sky-horizon-blend")*t.height/2*n,u_sky_blend:s}})(t,e.style.map.transform,e.pixelRatio),o=new Vt(i.LEQUAL,Vt.ReadWrite,[0,1]),s=Gt.disabled,a=e.colorModeForRenderPass(),l=e.useProgram("sky"),c=Cr(n,t);l.draw(n,i.TRIANGLES,o,s,a,Ut.disabled,r,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[o[this.currentLayer]],t=a[e.source],n=l[e.source];this._renderTileClippingMasks(e,n,!1),this.renderLayer(this,t,e,n,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const e=this.style._layers[o[this.currentLayer]],t=a[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const n=("symbol"===e.type?u:c)[e.source];this._renderTileClippingMasks(e,l[e.source],!!this.renderToTexture),this.renderLayer(this,t,e,n,h)}if(h.isRenderingGlobe&&function(e,n,i){const r=e.context,o=r.gl,s=e.useProgram("atmosphere"),a=new Vt(o.LEQUAL,Vt.ReadOnly,[0,1]),l=e.transform,c=function(e,n){const i=e.properties.get("position"),r=[-i.x,-i.y,-i.z],o=t.ag(new Float64Array(16));return"map"===e.properties.get("anchor")&&(t.b6(o,o,n.rollInRadians),t.b7(o,o,-n.pitchInRadians),t.b6(o,o,n.bearingInRadians),t.b7(o,o,n.center.lat*Math.PI/180),t.bz(o,o,-n.center.lng*Math.PI/180)),t.c5(r,r,o),r}(i,e.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=n.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=rn(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,t.aw(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,t.aw(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const g=((e,t,n,i,r)=>({u_sun_pos:e,u_atmosphere_blend:t,u_globe_position:n,u_globe_radius:i,u_inv_proj_matrix:r}))(c,h,[f[0],f[1],f[2]],d,p),m=Cr(r,n);s.draw(r,o.TRIANGLES,a,Gt.disabled,zt.alphaBlended,Ut.disabled,g,null,null,"atmosphere",m.vertexBuffer,m.indexBuffer,m.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const e=function(e,t){let n=null;const i=Object.values(e._layers).flatMap((n=>n.source&&!n.isHidden(t)?[e.sourceCaches[n.source]]:[])),r=i.filter((e=>"vector"===e.getSource().type)),o=i.filter((e=>"vector"!==e.getSource().type)),s=e=>{(!n||n.getSource().maxzoom<e.getSource().maxzoom)&&(n=e)};return r.forEach((e=>s(e))),n||o.forEach((e=>s(e))),n}(this.style,this.transform.zoom);e&&function(e,t,n){for(let i=0;i<n.length;i++)Sr(e,t,n[i])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;xr(e,e.transform.height-(t.top||0),3,mr),xr(e,t.bottom||0,3,_r),wr(e,t.left||0,3,yr),wr(e,e.transform.width-(t.right||0),3,vr);const n=e.transform.centerPoint;!function(e,t,n,i){Er(e,t-1,n-10,2,20,i),Er(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,br)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,i=this.transform.modelViewProjectionMatrix;let r=this.terrainFacilitator.dirty;r||(r=e?!t.c8(n,i):!t.c9(n,i)),r||(r=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),r&&(t.ca(n,i),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,n){const i=e.context,r=i.gl,o=e.transform,s=zt.unblended,a=new Vt(r.LEQUAL,Vt.ReadWrite,[0,1]),l=n.sourceCache.getRenderableTiles(),c=e.useProgram("terrainDepth");i.bindFramebuffer.set(n.getFramebuffer("depth").framebuffer),i.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),i.clear({color:t.bf.transparent,depth:1});for(const e of l){const t=n.getTerrainMesh(e.tileID),l=n.getTerrainData(e.tileID),u=o.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:n.getMeshFrameDelta(o.zoom)};c.draw(i,r.TRIANGLES,a,Gt.disabled,s,Ut.backCCW,h,l,u,"terrain",t.vertexBuffer,t.indexBuffer,t.segments)}i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,n){const i=e.context,r=i.gl,o=e.transform,s=zt.unblended,a=new Vt(r.LEQUAL,Vt.ReadWrite,[0,1]),l=n.getCoordsTexture(),c=n.sourceCache.getRenderableTiles(),u=e.useProgram("terrainCoords");i.bindFramebuffer.set(n.getFramebuffer("coords").framebuffer),i.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),i.clear({color:t.bf.transparent,depth:1}),n.coordsIndex=[];for(const e of c){const t=n.getTerrainMesh(e.tileID),c=n.getTerrainData(e.tileID);i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(o.zoom)},d=o.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(i,r.TRIANGLES,a,Gt.disabled,s,Ut.backCCW,h,c,d,"terrain",t.vertexBuffer,t.indexBuffer,t.segments),n.coordsIndex.push(e.tileID.key)}i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,n,i,r,o){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||(r||[]).length)&&(this.id=i.id,t.cb(i)?function(e,n,i,r,o,s){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:a}=s,l=Gt.disabled,c=e.colorModeForRenderPass();(i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,n,i,r,o,s,a,l,c){const u=n.transform,h=n.style.map.terrain,d="map"===o,p="map"===s;for(const o of e){const e=r.getTile(o),s=e.getBucket(i);if(!s||!s.text||!s.text.segments.get().length)continue;const f=t.an(s.textSizeData,u.zoom),g=t.aC(e,1,n.transform.zoom),m=Ce(d,n.transform,g),_="none"!==i.layout.get("icon-text-fit")&&s.hasIconData();if(f){const n=Math.pow(2,u.zoom-e.tileID.overscaledZ),i=h?(e,t)=>h.getElevation(o,e,t):null;er(s,d,p,c,u,m,n,f,_,t.aD(u,e,a,l),o.toUnwrapped(),i)}}}(r,e,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&nr(e,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),l,c,a),0!==i.paint.get("text-opacity").constantOr(1)&&nr(e,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),l,c,a),n.map.showCollisionBoxes&&(Yi(e,n,i,r,!0),Yi(e,n,i,r,!1))}(e,n,i,r,this.style.placement.variableOffsets,o):t.cc(i)?function(e,n,i,r,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=i.paint.get("circle-opacity"),l=i.paint.get("circle-stroke-width"),c=i.paint.get("circle-stroke-opacity"),u=!i.layout.get("circle-sort-key").isConstant();if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=e.context,d=h.gl,p=e.transform,f=e.getDepthModeForSublayer(0,Vt.ReadOnly),g=Gt.disabled,m=e.colorModeForRenderPass(),_=[],y=p.getCircleRadiusCorrection();for(let o=0;o<r.length;o++){const a=r[o],l=n.getTile(a),c=l.getBucket(i);if(!c)continue;const h=i.paint.get("circle-translate"),d=i.paint.get("circle-translate-anchor"),f=t.aD(p,l,h,d),g=c.programConfigurations.get(i.id),m=e.useProgram("circle",g),v=c.layoutVertexBuffer,b=c.indexBuffer,x=e.style.map.terrain&&e.style.map.terrain.getTerrainData(a),w={programConfiguration:g,program:m,layoutVertexBuffer:v,indexBuffer:b,uniformValues:Fn(e,l,i,f,y),terrainData:x,projectionData:p.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!s,applyTerrainMatrix:!0})};if(u){const e=c.segments.get();for(const n of e)_.push({segments:new t.aM([n]),sortKey:n.sortKey,state:w})}else _.push({segments:c.segments,sortKey:0,state:w})}u&&_.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of _){const{programConfiguration:n,program:r,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l,projectionData:c}=t.state;r.draw(h,d.TRIANGLES,f,g,m,Ut.backCCW,a,l,c,i.id,o,s,t.segments,i.paint,e.transform.zoom,n)}}(e,n,i,r,o):t.cd(i)?function(e,n,i,r,o){if(0===i.paint.get("heatmap-opacity"))return;const s=e.context,{isRenderingToTexture:a,isRenderingGlobe:l}=o;if(e.style.map.terrain){for(const t of r){const r=n.getTile(t);n.hasRenderableParent(t)||("offscreen"===e.renderPass?rr(e,r,i,t,l):"translucent"===e.renderPass&&or(e,i,t,a,l))}s.viewport.set([0,0,e.width,e.height])}else"offscreen"===e.renderPass?function(e,n,i,r){const o=e.context,s=o.gl,a=e.transform,l=Gt.disabled,c=new zt([s.ONE,s.ONE],t.bf.transparent,[!0,!0,!0,!0]);(function(e,n,i){const r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,n.width/4,n.height/4]);let o=i.heatmapFbos.get(t.c2);o?(r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer)):(o=sr(e,n.width/4,n.height/4),i.heatmapFbos.set(t.c2,o))})(o,e,i),o.clear({color:t.bf.transparent});for(let t=0;t<r.length;t++){const u=r[t];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(i);if(!d)continue;const p=d.programConfigurations.get(i.id),f=e.useProgram("heatmap",p),g=a.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),m=a.getCircleRadiusCorrection();f.draw(o,s.TRIANGLES,Vt.disabled,l,c,Ut.backCCW,jn(h,a.zoom,i.paint.get("heatmap-intensity"),m),null,g,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,a.zoom,p)}o.viewport.set([0,0,e.width,e.height])}(e,n,i,r):"translucent"===e.renderPass&&function(e,n){const i=e.context,r=i.gl;i.setColorMode(e.colorModeForRenderPass());const o=n.heatmapFbos.get(t.c2);o&&(i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1),ar(i,n).bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,Vt.disabled,Gt.disabled,e.colorModeForRenderPass(),Ut.disabled,Un(e,n,0,1),null,null,n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom))}(e,i)}(e,n,i,r,o):t.ce(i)?function(e,n,i,r,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=i.paint.get("line-opacity"),l=i.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const c=e.getDepthModeForSublayer(0,Vt.ReadOnly),u=e.colorModeForRenderPass(),h=i.paint.get("line-dasharray"),d=i.paint.get("line-pattern"),p=d.constantOr(1),f=i.paint.get("line-gradient"),g=i.getCrossfadeParameters(),m=p?"linePattern":h?"lineSDF":f?"lineGradient":"line",_=e.context,y=_.gl,v=e.transform;let b=!0;for(const o of r){const r=n.getTile(o);if(p&&!r.patternsLoaded())continue;const a=r.getBucket(i);if(!a)continue;const l=a.programConfigurations.get(i.id),x=e.context.program.get(),w=e.useProgram(m,l),E=b||w.program!==x,S=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),T=d.constantOr(null);if(T&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[T.to.toString()],n=e.patternPositions[T.from.toString()];t&&n&&l.setConstantPatternPositions(t,n)}const C=v.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),A=v.getPixelScale(),P=p?qn(e,r,i,A,g):h?Xn(e,r,i,A,h,g):f?Zn(e,r,i,A,a.lineClipsArray.length):Hn(e,r,i,A);if(p)_.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),l.updatePaintBuffers(g);else if(h&&(E||e.lineAtlas.dirty))_.activeTexture.set(y.TEXTURE0),e.lineAtlas.bind(_);else if(f){const r=a.gradients[i.id];let s=r.texture;if(i.gradientVersion!==r.version){let l=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=o.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.ah(t.c3(a.maxLineLength/t.$*1024*r),256,_.maxTextureSize)}r.gradient=t.c4({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:a.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new t.T(_,r.gradient,y.RGBA),r.version=i.gradientVersion,s=r.texture}_.activeTexture.set(y.TEXTURE0),s.bind(i.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}const I=e.stencilModeForClipping(o);w.draw(_,y.TRIANGLES,c,I,u,Ut.disabled,P,S,C,i.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,i.paint,e.transform.zoom,l,a.layoutVertexBuffer2),b=!1}}(e,n,i,r,o):t.cf(i)?function(e,n,i,r,o){const s=i.paint.get("fill-color"),a=i.paint.get("fill-opacity");if(0===a.constantOr(1))return;const{isRenderingToTexture:l}=o,c=e.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),h=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===s.constantOr(t.bf.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===h){const t=e.getDepthModeForSublayer(1,"opaque"===e.renderPass?Vt.ReadWrite:Vt.ReadOnly);cr(e,n,i,r,t,c,!1,l)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){const t=e.getDepthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);cr(e,n,i,r,t,c,!0,l)}}(e,n,i,r,o):t.cg(i)?function(e,t,n,i,r){const o=n.paint.get("fill-extrusion-opacity");if(0===o)return;const{isRenderingToTexture:s}=r;if("translucent"===e.renderPass){const r=new Vt(e.context.gl.LEQUAL,Vt.ReadWrite,e.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))ur(e,t,n,i,r,Gt.disabled,zt.disabled,s),ur(e,t,n,i,r,e.stencilModeFor3D(),e.colorModeForRenderPass(),s);else{const o=e.colorModeForRenderPass();ur(e,t,n,i,r,Gt.disabled,o,s)}}}(e,n,i,r,o):t.ch(i)?function(e,n,i,r,o){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=e.context,l=e.style.projection.useSubdivision,c=e.getDepthModeForSublayer(0,Vt.ReadOnly),u=e.colorModeForRenderPass();if("offscreen"===e.renderPass)!function(e,n,i,r,o,s,a){const l=e.context,c=l.gl;for(const u of i){const i=n.getTile(u),h=i.dem;if(!h||!h.data)continue;if(!i.needsHillshadePrepare)continue;const d=h.dim,p=h.stride,f=h.getPixels();if(l.activeTexture.set(c.TEXTURE1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(p),i.demTexture){const e=i.demTexture;e.update(f,{premultiply:!1}),e.bind(c.NEAREST,c.CLAMP_TO_EDGE)}else i.demTexture=new t.T(l,f,c.RGBA,{premultiply:!1}),i.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);l.activeTexture.set(c.TEXTURE0);let g=i.fbo;if(!g){const e=new t.T(l,{width:d,height:d,data:null},c.RGBA);e.bind(c.LINEAR,c.CLAMP_TO_EDGE),g=i.fbo=l.createFramebuffer(d,d,!0,!1),g.colorAttachment.set(e.texture)}l.bindFramebuffer.set(g.framebuffer),l.viewport.set([0,0,d,d]),e.useProgram("hillshadePrepare").draw(l,c.TRIANGLES,o,s,a,Ut.disabled,$n(i.tileID,h),null,null,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}(e,n,r,i,c,Gt.disabled,u),a.viewport.set([0,0,e.width,e.height]);else if("translucent"===e.renderPass)if(l){const[t,o,a]=e.stencilConfigForOverlapTwoPass(r);hr(e,n,i,a,t,c,u,!1,s),hr(e,n,i,a,o,c,u,!0,s)}else{const[t,o]=e.getStencilConfigForOverlapAndUpdateStencilID(r);hr(e,n,i,o,t,c,u,!1,s)}}(e,n,i,r,o):t.ci(i)?function(e,t,n,i,r){if("translucent"!==e.renderPass)return;if(!i.length)return;const{isRenderingToTexture:o}=r,s=e.style.projection.useSubdivision,a=e.getDepthModeForSublayer(0,Vt.ReadOnly),l=e.colorModeForRenderPass();if(s){const[r,s,c]=e.stencilConfigForOverlapTwoPass(i);dr(e,t,n,c,r,a,l,!1,o),dr(e,t,n,c,s,a,l,!0,o)}else{const[r,s]=e.getStencilConfigForOverlapAndUpdateStencilID(i);dr(e,t,n,s,r,a,l,!1,o)}}(e,n,i,r,o):t.cj(i)?function(e,t,n,i,r){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!i.length)return;const{isRenderingToTexture:o}=r,s=t.getSource(),a=e.style.projection.useSubdivision;if(s instanceof X)fr(e,t,n,i,null,!1,!1,s.tileCoords,s.flippedWindingOrder,o);else if(a){const[r,s,a]=e.stencilConfigForOverlapTwoPass(i);fr(e,t,n,a,r,!1,!0,pr,!1,o),fr(e,t,n,a,s,!0,!0,pr,!1,o)}else{const[r,s]=e.getStencilConfigForOverlapAndUpdateStencilID(i);fr(e,t,n,s,r,!1,!0,pr,!1,o)}}(e,n,i,r,o):t.ck(i)?function(e,t,n,i,r){const o=n.paint.get("background-color"),s=n.paint.get("background-opacity");if(0===s)return;const{isRenderingToTexture:a}=r,l=e.context,c=l.gl,u=e.style.projection,h=e.transform,d=h.tileSize,p=n.paint.get("background-pattern");if(e.isPatternMissing(p))return;const f=!p&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==f)return;const g=Gt.disabled,m=e.getDepthModeForSublayer(0,"opaque"===f?Vt.ReadWrite:Vt.ReadOnly),_=e.colorModeForRenderPass(),y=e.useProgram(p?"backgroundPattern":"background"),v=i||ye(h,{tileSize:d,terrain:e.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context));const b=n.getCrossfadeParameters();for(const t of v){const i=h.getProjectionData({overscaledTileID:t,applyGlobeMatrix:!a,applyTerrainMatrix:!0}),r=p?ri(s,e,p,{tileID:t,tileSize:d},b):ii(s,o),f=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t),v=u.getMeshFromTileID(l,t.canonical,!1,!0,"raster");y.draw(l,c.TRIANGLES,m,g,_,Ut.backCCW,r,f,i,n.id,v.vertexBuffer,v.indexBuffer,v.segments)}}(e,0,i,r,o):t.cl(i)&&function(e,t,n,i){const{isRenderingGlobe:r}=i,o=e.context,s=n.implementation,a=e.style.projection,l=e.transform,c=l.getProjectionDataForCustomLayer(r),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:a.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${a.shaderPreludeCode.vertexSource}`,define:a.shaderDefine},defaultProjectionData:c},h=s.renderingMode?s.renderingMode:"2d";if("offscreen"===e.renderPass){const t=s.prerender;t&&(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),t.call(s,o.gl,u),o.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(Gt.disabled);const t="3d"===h?e.getDepthModeFor3D():e.getDepthModeForSublayer(0,Vt.ReadOnly);o.setDepthMode(t),s.render(o.gl,u),o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}(e,0,i,o))}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}useProgram(e,t,n=!1,i=[]){this.cache=this.cache||{};const r=!!this.style.map.terrain,o=this.style.projection,s=n?bt.projectionMercator:o.shaderPreludeCode,a=n?St:o.shaderDefine,l=e+(t?t.cacheKey:"")+`/${n?Tt:o.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(r?"/terrain":"")+(i?`/${i.join("/")}`:"");return this.cache[l]||(this.cache[l]=new In(this.context,bt[e],t,si[e],this._showOverdrawInspector,r,s,a,i)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}function Pr(e,t){let n,i=!1,r=null,o=null;const s=()=>{r=null,i&&(e.apply(o,n),r=setTimeout(s,t),i=!1)};return(...e)=>(i=!0,o=this,n=e,r||s(),r)}class Ir{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(!this._isValidHash(e))return!1;const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,e)},this._removeHash=()=>{const e=this._getCurrentHash();if(0===e.length)return;const t=e.join("/");let n=t;n.split("&").length>0&&(n=n.split("&")[0]),this._hashName&&(n=`${this._hashName}=${t}`);let i=window.location.hash.replace(n,"");i.startsWith("#&")?i=i.slice(0,1)+i.slice(2):"#"===i&&(i="");let r=window.location.href.replace(/(#.+)?$/,i);r=r.replace("&&","&"),window.history.replaceState(window.history.state,null,r)},this._updateHash=Pr(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const t=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),o=Math.round(t.lng*r)/r,s=Math.round(t.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=e?`/${o}/${s}/${n}`:`${n}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const e=this._hashName;let t=!1;const n=window.location.hash.slice(1).split("&").map((n=>{const i=n.split("=")[0];return i===e?(t=!0,`${i}=${c}`):n})).filter((e=>e));return t||n.push(`${e}=${c}`),`#${n.join("&")}`}return`#${c}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new t.S(+e[2],+e[1])}catch(e){return!1}const n=+e[0],i=+(e[3]||0),r=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&i>=-180&&i<=180&&r>=this._map.getMinPitch()&&r<=this._map.getMaxPitch()}}const Mr={linearity:.3,easing:t.cm(0,0,.3,1)},Rr=t.e({deceleration:2500,maxSpeed:1400},Mr),kr=t.e({deceleration:20,maxSpeed:1400},Mr),Or=t.e({deceleration:1e3,maxSpeed:360},Mr),Lr=t.e({deceleration:1e3,maxSpeed:90},Mr),Dr=t.e({deceleration:1e3,maxSpeed:360},Mr);class Fr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=s.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,n.roll+=e.rollDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const o=Br(n.pan.mag(),i,t.e({},Rr,e||{})),s=n.pan.mult(o.amount/n.pan.mag()),a=this._map.cameraHelper.handlePanInertia(s,this._map.transform);r.center=a.easingCenter,r.offset=a.easingOffset,Nr(r,o)}if(n.zoom){const e=Br(n.zoom,i,kr);r.zoom=this._map.transform.zoom+e.amount,Nr(r,e)}if(n.bearing){const e=Br(n.bearing,i,Or);r.bearing=this._map.transform.bearing+t.ah(e.amount,-179,179),Nr(r,e)}if(n.pitch){const e=Br(n.pitch,i,Lr);r.pitch=this._map.transform.pitch+e.amount,Nr(r,e)}if(n.roll){const e=Br(n.roll,i,Dr);r.roll=this._map.transform.roll+t.ah(e.amount,-179,179),Nr(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),t.e(r,{noMoveStart:!0})}}function Nr(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Br(e,n,i){const{maxSpeed:r,linearity:o,deceleration:s}=i,a=t.ah(e*o/(n/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class zr extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,r={}){i=i instanceof MouseEvent?i:new MouseEvent(e,i);const o=a.mousePos(n.getCanvas(),i),s=n.unproject(o);super(e,t.e({point:o,lngLat:s,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class jr extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){const r="touchend"===e?i.changedTouches:i.touches,o=a.touchPos(n.getCanvasContainer(),r),s=o.map((e=>n.unproject(e))),l=o.reduce(((e,t,n,i)=>e.add(t.div(i.length))),new t.P(0,0));super(e,{points:o,point:l,lngLats:s,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class Ur extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Vr{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ur(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new zr(e.type,this._map,e))}mouseup(e){this._map.fire(new zr(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new zr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new zr(e.type,this._map,e))}mouseover(e){this._map.fire(new zr(e.type,this._map,e))}mouseout(e){this._map.fire(new zr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new jr(e.type,this._map,e))}touchmove(e){this._map.fire(new jr(e.type,this._map,e))}touchend(e){this._map.fire(new jr(e.type,this._map,e))}touchcancel(e){this._map.fire(new jr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $r{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new zr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new zr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this._map.terrain)}}class Wr{constructor(e,t){this._map=e,this._tr=new Gr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(a.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(i.x,n.x),o=Math.max(i.x,n.x),s=Math.min(i.y,n.y),l=Math.max(i.y,n.y);a.setTransform(this._box,`translate(${r}px,${s}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-s+"px"}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const i=this._startPos,r=n;if(this.reset(),a.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new t.l("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.l(e,{originalEvent:n}))}}function Hr(e,t){if(e.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class Zr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){const n=new t.P(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=Hr(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=Hr(n,t);for(const e in this.touches){const t=i[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class qr{constructor(e){this.singleTap=new Zr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Xr{constructor(e){this._tr=new Gr(e),this._zoomIn=new qr({numTouches:1,numTaps:2}),this._zoomOut=new qr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n),o=this._tr;return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.rollDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(t)?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const i=Array.isArray(t)?t[0]:t;return!this._moved&&i.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=i,this._move(n,i))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&a.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Kr=0,Jr=2,Qr={[Kr]:1,[Jr]:2};class eo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const t=a.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){const n=Qr[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton)}isValidEndEvent(e){return a.mouseButton(e)===this._eventButton}}class to{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class no{constructor(e=new eo({checkCorrectEvent:()=>!0}),t=new to){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=t}_executeRelevantHandler(e,t,n){return e instanceof MouseEvent?t(e):"undefined"!=typeof TouchEvent&&e instanceof TouchEvent?n(e):void 0}startMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.startMove(e)),(e=>this.oneFingerTouchMoveStateManager.startMove(e)))}endMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.endMove(e)),(e=>this.oneFingerTouchMoveStateManager.endMove(e)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidStartEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidStartEvent(e)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidMoveEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(e)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidEndEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidEndEvent(e)))}}const io=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}};class ro{constructor(e,t){this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active){if(!this._shouldBePrevented(n.length))return e.preventDefault(),this._calculateTransform(e,t,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const r=Hr(i,n),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(o._add(t),s._add(t.sub(n)),a++,r[e]=t)}if(this._touches=r,this._shouldBePrevented(a)||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();const[i,r]=this._firstTwoTouches,o=so(n,t,i),s=so(n,t,r);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=so(n,t,i),s=so(n,t,r);o&&s||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function so(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function ao(e,t){return Math.log(e/t)/Math.LN2}class lo extends oo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ao(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ao(this._distance,n),pinchAround:t}}}function co(e,t){return 180*e.angleWith(t)/Math.PI}class uo extends oo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,n){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:co(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=co(e,this._startVector);return Math.abs(n)<t}}function ho(e){return Math.abs(e.y)>Math.abs(e.x)}class po extends oo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,n){super.touchstart(e,t,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,ho(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const i=e[0].sub(this._lastPoints[0]),r=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return ho(e)&&ho(t)&&o}}const fo={panStep:100,bearingStep:15,pitchStep:10};class go{constructor(e){this._tr=new Gr(e);const t=fo;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:mo,zoom:t?Math.round(a.zoom)+t*(e.shiftKey?2:1):a.zoom,bearing:a.bearing+n*this._bearingStep,pitch:a.pitch+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:a.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mo(e){return e*(2-e)}const _o=4.000244140625,yo=1/450;class vo{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new Gr(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=yo}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=s.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==t&&t%_o==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=a.mousePos(this._map.getCanvas(),e),i=this._tr;this._aroundPoint=this._aroundCenter?i.transform.locationToScreenPoint(t.S.convert(i.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const t=e.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=t),"number"==typeof this._targetZoom&&(this._targetZoom+=t)}if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>_o?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);const r="number"!=typeof this._targetZoom?e.scale:t.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),t.ak(r*i)).zoom,"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"!=typeof this._targetZoom?e.zoom:this._targetZoom,i=this._startZoom,r=this._easing;let o,a=!1;if("wheel"===this._type&&i&&r){const e=s.now()-this._lastWheelEventTime,l=Math.min((e+5)/200,1),c=r(l);o=t.C.number(i,n,c),l<1?this._frameId||(this._frameId=!0):a=!0}else o=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=o,{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.co;if(this._prevEase){const e=this._prevEase,i=(s.now()-e.start)/e.duration,r=e.easing(i+.01)-e.easing(i),o=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-o*o);n=t.cm(o,a,.25,1)}return this._prevEase={start:s.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class bo{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xo{constructor(e){this._tr=new Gr(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo{constructor(){this._tap=new qr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,n){if(!this._swipePoint)if(this._tapTime){const i=t[0],r=e.timeStamp-this._tapTime<500,o=this._tapPoint.dist(i)<30;r&&o?n.length>0&&(this._swipePoint=i,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,t,n)}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{const i=this._tap.touchend(e,t,n);i&&(this._tapTime=e.timeStamp,this._tapPoint=i)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eo{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class So{constructor(e,t,n,i){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=t,this._mousePitch=n,this._mouseRoll=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class To{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Co{constructor(e,t){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=a.create("div","maplibregl-cooperative-gesture-screen",e);let t=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(t=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),i=document.createElement("div");i.className="maplibregl-desktop-message",i.textContent=t,this._container.appendChild(i);const r=document.createElement("div");r.className="maplibregl-mobile-message",r.textContent=n,this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(a.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new t.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Ao=e=>e.zoom||e.drag||e.roll||e.pitch||e.rotate;class Po extends t.l{}function Io(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta||e.rollDelta}class Mo{constructor(e,n){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,n)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const i="renderFrame"===e.type?void 0:e,r={needsRenderFrame:!1},o={},s={};for(const{handlerName:l,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;if(this._blockedByActive(s,u,l))c.reset();else if(c[n||e.type]){if(t.cp(e,n||e.type)){const t=a.mousePos(this._map.getCanvas(),e);h=c[n||e.type](e,t)}else if(t.cq(e,n||e.type)){const t=this._getMapTouches(e.touches),i=a.touchPos(this._map.getCanvas(),t);h=c[n||e.type](e,i,t)}else t.cr(n||e.type)||(h=c[n||e.type](e));this.mergeHandlerResult(r,o,h,l,i),h&&h.needsRenderFrame&&this._triggerRenderFrame()}(h||c.isActive())&&(s[l]=c)}const l={};for(const e in this._previousActiveHandlers)s[e]||(l[e]=i);this._previousActiveHandlers=s,(Object.keys(l).length||Io(r))&&(this._changes.push([r,o,l]),this._triggerRenderFrame()),(Object.keys(s).length||Io(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=r;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fr(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,n]of this._listeners)a.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[e,t,n]of this._listeners)a.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new Vr(n,e));const r=n.boxZoom=new Wr(n,e);this._add("boxZoom",r),e.interactive&&e.boxZoom&&r.enable();const o=n.cooperativeGestures=new Co(n,e.cooperativeGestures);this._add("cooperativeGestures",o),e.cooperativeGestures&&o.enable();const s=new Xr(n),l=new xo(n);n.doubleClickZoom=new bo(l,s),this._add("tapZoom",s),this._add("clickZoom",l),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const c=new wo;this._add("tapDragZoom",c);const u=n.touchPitch=new po(n);this._add("touchPitch",u),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const h=()=>n.project(n.getCenter()),d=function({enable:e,clickTolerance:n,aroundCenter:i=!0,minPixelCenterThreshold:r=100,rotateDegreesPerPixelMoved:o=.8},s){const l=new eo({checkCorrectEvent:e=>0===a.mouseButton(e)&&e.ctrlKey||2===a.mouseButton(e)&&!e.ctrlKey});return new Yr({clickTolerance:n,move:(e,n)=>{const a=s();if(i&&Math.abs(a.y-e.y)>r)return{bearingDelta:t.cn(new t.P(e.x,n.y),n,a)};let l=(n.x-e.x)*o;return i&&n.y<a.y&&(l=-l),{bearingDelta:l}},moveStateManager:l,enable:e,assignEvents:io})}(e,h),p=function({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5}){const i=new eo({checkCorrectEvent:e=>0===a.mouseButton(e)&&e.ctrlKey||2===a.mouseButton(e)});return new Yr({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*n}),moveStateManager:i,enable:e,assignEvents:io})}(e),f=function({enable:e,clickTolerance:t,rollDegreesPerPixelMoved:n=.3},i){const r=new eo({checkCorrectEvent:e=>2===a.mouseButton(e)&&e.ctrlKey});return new Yr({clickTolerance:t,move:(e,t)=>{const r=i();let o=(t.x-e.x)*n;return t.y<r.y&&(o=-o),{rollDelta:o}},moveStateManager:r,enable:e,assignEvents:io})}(e,h);n.dragRotate=new So(e,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const g=function({enable:e,clickTolerance:t}){const n=new eo({checkCorrectEvent:e=>0===a.mouseButton(e)&&!e.ctrlKey});return new Yr({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:n,enable:e,assignEvents:io})}(e),m=new ro(e,n);n.dragPan=new Eo(i,g,m),this._add("mousePan",g),this._add("touchPan",m,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const _=new uo,y=new lo;n.touchZoomRotate=new To(i,y,_,c),this._add("touchRotate",_,["touchPan","touchZoom"]),this._add("touchZoom",y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const v=n.scrollZoom=new vo(n,(()=>this._triggerRenderFrame()));this._add("scrollZoom",v,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const b=n.keyboard=new go(n);this._add("keyboard",b),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new $r(n))}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ao(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}mergeHandlerResult(e,n,i,r,o){if(!i)return;t.e(e,i);const s={handlerName:r,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(n.zoom=s),void 0!==i.panDelta&&(n.drag=s),void 0!==i.rollDelta&&(n.roll=s),void 0!==i.pitchDelta&&(n.pitch=s),void 0!==i.bearingDelta&&(n.rotate=s)}_applyChanges(){const e={},n={},i={};for(const[r,o,s]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),r.rollDelta&&(e.rollDelta=(e.rollDelta||0)+r.rollDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.e(n,o),t.e(i,s);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,t,n){const i=this._map,r=i._getTransformForUpdate(),o=i.terrain;if(!(Io(e)||o&&this._terrainMovement))return this._fireEvents(t,n,!0);i._stop(!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=e;void 0!==d&&(h=d),h=h||i.transform.centerPoint,o&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const p={panDelta:s,zoomDelta:a,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const f=h.distSqr(r.centerPoint)<.01?r.center:r.screenPointToLocation(s?h.sub(s):h);o?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,r),this._terrainMovement||!t.drag&&!t.zoom?t.drag&&this._terrainMovement?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(s))):this._map.cameraHelper.handleMapControlsPan(p,r,f):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(p,r,f))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,r),this._map.cameraHelper.handleMapControlsPan(p,r,f)),i._applyUpdatedTransform(r),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(e,n,i){const r=Ao(this._eventsInProgress),o=Ao(e),a={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const l={};let c;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=n[t]||i,l[`${e}end`]=c)}for(const e in l)this._fireEvent(e,l[e]);const u=Ao(this._eventsInProgress),h=(r||o)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const e=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&e.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(e)}if(i&&h){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&s.prefersReducedMotion?(this._map.fire(new t.l("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Po("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Ro extends t.E{constructor(e,t,n){super(),this._renderFrameCallback=()=>{const e=Math.min((s.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.cameraHelper=t,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,t){e.apply(this.transform),this.transform=e,this.cameraHelper=t}getCenter(){return new t.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,t){return this.jumpTo({elevation:e},t),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,i){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},n),i)}panTo(e,n,i){return this.easeTo(t.e({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,n,i){return this.easeTo(t.e({zoom:e},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new t.l("movestart",n)).fire(new t.l("move",n)).fire(new t.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,n,i){return this.easeTo(t.e({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,t.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}getRoll(){return this.transform.roll}setRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(e,t){e=$.convert(e).adjustAntiMeridian();const n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}_cameraForBoxAndBearing(e,n,i,r){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const e=r.padding;r.padding={top:e,bottom:e,right:e,left:e}}const s=t.e(o,r.padding);r.padding=s;const a=this.transform,l=new $(e,n);return this.cameraHelper.cameraForBoxAndBearing(r,s,l,i,a)}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}fitScreenCoordinates(e,n,i,r,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(e)),this.transform.screenPointToLocation(t.P.convert(n)),i,r),r,o)}_fitInternal(e,n,i){return e?(delete(n=t.e(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=this._getTransformForUpdate();let r=!1,o=!1,s=!1;const a=i.zoom;this.cameraHelper.handleJumpToCenterZoom(i,e);const l=i.zoom!==a;return"elevation"in e&&i.elevation!==+e.elevation&&i.setElevation(+e.elevation),"bearing"in e&&i.bearing!==+e.bearing&&(r=!0,i.setBearing(+e.bearing)),"pitch"in e&&i.pitch!==+e.pitch&&(o=!0,i.setPitch(+e.pitch)),"roll"in e&&i.roll!==+e.roll&&(s=!0,i.setRoll(+e.roll)),null==e.padding||i.isPaddingEqual(e.padding)||i.setPadding(e.padding),this._applyUpdatedTransform(i),this.fire(new t.l("movestart",n)).fire(new t.l("move",n)),l&&this.fire(new t.l("zoomstart",n)).fire(new t.l("zoom",n)).fire(new t.l("zoomend",n)),r&&this.fire(new t.l("rotatestart",n)).fire(new t.l("rotate",n)).fire(new t.l("rotateend",n)),o&&this.fire(new t.l("pitchstart",n)).fire(new t.l("pitch",n)).fire(new t.l("pitchend",n)),s&&this.fire(new t.l("rollstart",n)).fire(new t.l("roll",n)).fire(new t.l("rollend",n)),this.fire(new t.l("moveend",n))}calculateCameraOptionsFromTo(e,n,i,r=0){const o=t.a1.fromLngLat(e,n),s=t.a1.fromLngLat(i,r),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=t.ak(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),elevation:r,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(e,t,n,i,r){const o=this.transform.calculateCenterFromCameraLngLatAlt(e,t,n,i);return{center:o.center,elevation:o.elevation,zoom:o.zoom,bearing:n,pitch:i,roll:r}}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.co},e)).animate||!e.essential&&s.prefersReducedMotion)&&(e.duration=0);const i=this._getTransformForUpdate(),r=this.getBearing(),o=i.pitch,a=i.roll,l="bearing"in e?this._normalizeBearing(e.bearing,r):r,c="pitch"in e?+e.pitch:o,u="roll"in e?this._normalizeBearing(e.roll,a):a,h="padding"in e?e.padding:i.padding,d=t.P.convert(e.offset);let p,f;e.around&&(p=t.S.convert(e.around),f=i.locationToScreenPoint(p));const g={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},m=this.cameraHelper.handleEaseTo(i,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||r!==l,this._pitching=this._pitching||c!==o,this._rolling=this._rolling||u!==a,this._padding=!i.isPaddingEqual(h),this._zooming=this._zooming||m.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,g),this.terrain&&this._prepareElevation(m.elevationCenter),this._ease((t=>{m.easeFunc(t),this.terrain&&!e.freezeElevation&&this._updateElevation(t),this._applyUpdatedTransform(i),this._fireMoveEvents(n)}),(t=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,t)}),e),this}_prepareEase(e,n,i={}){this._moving=!0,n||i.moving||this.fire(new t.l("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.l("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.l("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.l("pitchstart",e)),this._rolling&&!i.rolling&&this.fire(new t.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(n-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(t.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const t=e.getCameraLngLat(),n=e.getCameraAltitude(),i=this.terrain?this.terrain.getElevationForLngLatZoom(t,e.zoom):0;if(n<i){const n=this.calculateCameraOptionsFromTo(t,i,e.center,e.elevation);return{pitch:n.pitch,zoom:n.zoom}}return{}}_applyUpdatedTransform(e){const t=[];if(t.push((e=>this._elevateCameraIfInsideTerrain(e))),this.transformCameraUpdate&&t.push((e=>this.transformCameraUpdate(e))),!t.length)return;const n=e.clone();for(const e of t){const t=n.clone(),{center:i,zoom:r,roll:o,pitch:s,bearing:a,elevation:l}=e(t);i&&t.setCenter(i),void 0!==l&&t.setElevation(l),void 0!==r&&t.setZoom(r),void 0!==o&&t.setRoll(o),void 0!==s&&t.setPitch(s),void 0!==a&&t.setBearing(a),n.apply(t)}this.transform.apply(n)}_fireMoveEvents(e){this.fire(new t.l("move",e)),this._zooming&&this.fire(new t.l("zoom",e)),this._rotating&&this.fire(new t.l("rotate",e)),this._pitching&&this.fire(new t.l("pitch",e)),this._rolling&&this.fire(new t.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const i=this._zooming,r=this._rotating,o=this._pitching,s=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,i&&this.fire(new t.l("zoomend",e)),r&&this.fire(new t.l("rotateend",e)),o&&this.fire(new t.l("pitchend",e)),s&&this.fire(new t.l("rollend",e)),this.fire(new t.l("moveend",e))}flyTo(e,n){if(!e.essential&&s.prefersReducedMotion){const i=t.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(i,n)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.co},e);const i=this._getTransformForUpdate(),r=i.bearing,o=i.pitch,a=i.roll,l=i.padding,c="bearing"in e?this._normalizeBearing(e.bearing,r):r,u="pitch"in e?+e.pitch:o,h="roll"in e?this._normalizeBearing(e.roll,a):a,d="padding"in e?e.padding:i.padding,p=t.P.convert(e.offset);let f=i.centerPoint.add(p);const g=i.screenPointToLocation(f),m=this.cameraHelper.handleFlyTo(i,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:g,offsetAsPoint:p,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let _=e.curve;const y=Math.max(i.width,i.height),v=y/m.scaleOfZoom,b=m.pixelPathLength;"number"==typeof m.scaleOfMinZoom&&(_=Math.sqrt(y/m.scaleOfMinZoom/b*2));const x=_*_;function w(e){const t=(v*v-y*y+(e?-1:1)*x*x*b*b)/(2*(e?v:y)*x*b);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function S(e){return(Math.exp(e)+Math.exp(-e))/2}const T=w(!1);let C=function(e){return S(T)/S(T+_*e)},A=function(e){return y*((S(T)*(E(t=T+_*e)/S(t))-E(T))/x)/b;var t},P=(w(!0)-T)/_;if(Math.abs(b)<2e-6||!isFinite(P)){if(Math.abs(y-v)<1e-6)return this.easeTo(e,n);const t=v<y?-1:1;P=Math.abs(Math.log(v/y))/_,A=()=>0,C=e=>Math.exp(t*_*e)}return e.duration="duration"in e?+e.duration:1e3*P/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=r!==c,this._pitching=u!==o,this._rolling=h!==a,this._padding=!i.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(m.targetCenter),this._ease((s=>{const g=s*P,_=1/C(g),y=A(g);this._rotating&&i.setBearing(t.C.number(r,c,s)),this._pitching&&i.setPitch(t.C.number(o,u,s)),this._rolling&&i.setRoll(t.C.number(a,h,s)),this._padding&&(i.interpolatePadding(l,d,s),f=i.centerPoint.add(p)),m.easeFunc(s,_,y,f),this.terrain&&!e.freezeElevation&&this._updateElevation(s),this._applyUpdatedTransform(i),this._fireMoveEvents(n)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}return e||null===(n=this.handlers)||void 0===n||n.stop(!1),this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=s.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=t.aO(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.S.convert(e),this.transform.tileZoom):null}}const ko={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Oo{constructor(e=ko){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString(`AttributionControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style.sourceCaches;for(const n in t){const i=t[n];if(i.used||i.usedForTerrain){const t=i.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter((e=>String(e).trim())),e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=a.sanitize(n),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Lo{constructor(e={}){this._updateCompact=()=>{const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");const t=a.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Do{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const t of n)if(t.id===e)return void(t.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fo=t.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class No extends t.E{constructor(e){super(),this._lastTilesetChange=s.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const i={};for(const r of ye(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))i[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.terrainRttPosMatrix32f=new Float64Array(16),t.bY(r.terrainRttPosMatrix32f,0,t.$,t.$,0,0,1),this._tiles[r.key]=new re(r,this.tileSize),this._lastTilesetChange=s.now());for(const e in this._tiles)i[e]||delete this._tiles[e]}freeRtt(e){for(const t in this._tiles){const n=this._tiles[t];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,t){return t?this._getTerrainCoordsForTileRanges(e,t):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const i of this._renderableTilesKeys){const r=this._tiles[i].tileID,o=e.clone(),s=t.ba();if(r.canonical.equals(e.canonical))t.bY(s,0,t.$,t.$,0,0,1);else if(r.canonical.isChildOf(e.canonical)){const n=r.canonical.z-e.canonical.z,i=r.canonical.x-(r.canonical.x>>n<<n),o=r.canonical.y-(r.canonical.y>>n<<n),a=t.$>>n;t.bY(s,0,a,a,0,0,1),t.M(s,s,[-i*a,-o*a,0])}else{if(!e.canonical.isChildOf(r.canonical))continue;{const n=e.canonical.z-r.canonical.z,i=e.canonical.x-(e.canonical.x>>n<<n),o=e.canonical.y-(e.canonical.y>>n<<n),a=t.$>>n;t.bY(s,0,t.$,t.$,0,0,1),t.M(s,s,[i*a,o*a,0]),t.N(s,s,[1/2**n,1/2**n,0])}}o.terrainRttPosMatrix32f=new Float32Array(s),n[i]=o}return n}_getTerrainCoordsForTileRanges(e,n){const i={};for(const r of this._renderableTilesKeys){const o=this._tiles[r].tileID;if(!this._isWithinTileRanges(o,n))continue;const s=e.clone(),a=t.ba();if(o.canonical.z===e.canonical.z){const n=e.canonical.x-o.canonical.x,i=e.canonical.y-o.canonical.y;t.bY(a,0,t.$,t.$,0,0,1),t.M(a,a,[n*t.$,i*t.$,0])}else if(o.canonical.z>e.canonical.z){const n=o.canonical.z-e.canonical.z,i=o.canonical.x-(o.canonical.x>>n<<n),r=o.canonical.y-(o.canonical.y>>n<<n),s=e.canonical.x-(o.canonical.x>>n),l=e.canonical.y-(o.canonical.y>>n),c=t.$>>n;t.bY(a,0,c,c,0,0,1),t.M(a,a,[-i*c+s*t.$,-r*c+l*t.$,0])}else{const n=e.canonical.z-o.canonical.z,i=e.canonical.x-(e.canonical.x>>n<<n),r=e.canonical.y-(e.canonical.y>>n<<n),s=(e.canonical.x>>n)-o.canonical.x,l=(e.canonical.y>>n)-o.canonical.y,c=t.$<<n;t.bY(a,0,c,c,0,0,1),t.M(a,a,[i*t.$+s*c,r*t.$+l*c,0])}s.terrainRttPosMatrix32f=new Float32Array(a),i[r]=s}return i}getSourceTile(e,t){const n=this.sourceCache._source;let i=e.overscaledZ-this.deltaZoom;if(i>n.maxzoom&&(i=n.maxzoom),i<n.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(i).key);let r=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!r||!r.dem)&&t)for(;i>=n.minzoom&&(!r||!r.dem);)r=this.sourceCache.getTileByID(e.scaledTo(i--).key);return r}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,t){return t[e.canonical.z]&&e.canonical.x>=t[e.canonical.z].minTileX&&e.canonical.x<=t[e.canonical.z].maxTileX&&e.canonical.y>=t[e.canonical.z].minTileY&&e.canonical.y<=t[e.canonical.z].maxTileY}}class Bo{constructor(e,t,n){this._meshCache={},this.painter=e,this.sourceCache=new No(t),this.options=n,this.exaggeration="number"==typeof n.exaggeration?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,i,r=t.$){var o;if(!(n>=0&&n<r&&i>=0&&i<r))return 0;const s=this.getTerrainData(e),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=t.cs([],[n/r*t.$,i/r*t.$],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,n){if(!t.ct(n,e.wrap()))return 0;const{tileID:i,mercatorX:r,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(i,r%t.$,o%t.$,t.$)}getElevation(e,n,i,r=t.$){return this.getDEMElevation(e,n,i,r)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,n=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new t.T(e,n,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new t.T(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ag([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const e=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new t.T(e,n.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),n.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const i=n&&n+n.tileID.key+e.key;if(i&&!this._demMatrixCache[i]){const i=this.sourceCache.sourceCache._source.maxzoom;let r=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=i?r=e.canonical.z-i:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>r<<r),s=e.canonical.y-(e.canonical.y>>r<<r),a=t.cu(new Float64Array(16),[1/(t.$<<r),1/(t.$<<r),0]);t.M(a,a,[o*t.$,s*t.$,0]),this._demMatrixCache[e.key]={matrix:a,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:i?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,i=n.width/devicePixelRatio,r=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new t.T(n.context,{width:i,height:r,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new t.T(n.context,{width:i,height:r,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,t=0;e<this._coordsTextureSize;e++)for(let i=0;i<this._coordsTextureSize;i++,t+=4)n[t+0]=255&i,n[t+1]=255&e,n[t+2]=i>>8<<4|e>>8,n[t+3]=0;const i=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),r=new t.T(e,i,e.gl.RGBA,{premultiply:!1});return r.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),i=this.painter.context,r=i.gl,o=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);i.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(o,a-s-1,1,1,r.RGBA,r.UNSIGNED_BYTE,n),i.bindFramebuffer.set(null);const l=n[0]+(n[2]>>4<<8),c=n[1]+((15&n[2])<<8),u=this.coordsIndex[255-n[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new t.a1((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(e){const t=new Uint8Array(4),n=this.painter.context,i=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),i.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,i.RGBA,i.UNSIGNED_BYTE,t),n.bindFramebuffer.set(null),(t[0]/16777216+t[1]/65536+t[2]/256+t[3])/256}getTerrainMesh(e){var n;const i=(null===(n=this.painter.style.projection)||void 0===n?void 0:n.transitionState)>0,r=i&&0===e.canonical.y,o=i&&e.canonical.y===(1<<e.canonical.z)-1,s=`m_${r?"n":""}_${o?"s":""}`;if(this._meshCache[s])return this._meshCache[s];const a=this.painter.context,l=new t.cv,c=new t.aN,u=this.meshSize,h=t.$/u,d=u*u;for(let e=0;e<=u;e++)for(let t=0;t<=u;t++)l.emplaceBack(t*h,e*h,0);for(let e=0;e<d;e+=u+1)for(let t=0;t<u;t++)c.emplaceBack(t+e,u+t+e+1,u+t+e+2),c.emplaceBack(t+e,u+t+e+2,t+e+1);const p=l.length,f=p+(u+1),g=(u+1)*u,m=r?t.bh:0,_=r?0:1,y=o?t.bi:t.$,v=o?0:1;for(let e=0;e<=u;e++)l.emplaceBack(e*h,m,_);for(let e=0;e<=u;e++)l.emplaceBack(e*h,y,v);for(let e=0;e<u;e++)c.emplaceBack(g+e,f+e,f+e+1),c.emplaceBack(g+e,f+e+1,g+e+1),c.emplaceBack(0+e,p+e+1,p+e),c.emplaceBack(0+e,0+e+1,p+e+1);const b=l.length,x=b+2*(u+1);for(const e of[0,1])for(let n=0;n<=u;n++)for(const i of[0,1])l.emplaceBack(e*t.$,n*h,i);for(let e=0;e<2*u;e+=2)c.emplaceBack(b+e,b+e+1,b+e+3),c.emplaceBack(b+e,b+e+3,b+e+2),c.emplaceBack(x+e,x+e+3,x+e+1),c.emplaceBack(x+e,x+e+2,x+e+3);const w=new wt(a.createVertexBuffer(l,Fo.members),a.createIndexBuffer(c),t.aM.simpleSegment(0,0,l.length,c.length));return this._meshCache[s]=w,w}getMeshFrameDelta(e){return 2*Math.PI*t.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,t){var n;const{tileID:i}=this._getOverscaledTileIDFromLngLatZoom(e,t);return null!==(n=this.getMinMaxElevation(i).minElevation)&&void 0!==n?n:0}getMinMaxElevation(e){const t=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return t&&t.dem&&(n.minElevation=t.dem.min*this.exaggeration,n.maxElevation=t.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(e,n){const i=t.a1.fromLngLat(e.wrap()),r=(1<<n)*t.$,o=i.x*r,s=i.y*r,a=Math.floor(o/t.$),l=Math.floor(s/t.$);return{tileID:new t.Z(n,0,n,a,l),mercatorX:o,mercatorY:s}}}class zo{constructor(e,t,n){this._context=e,this._size=t,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new t.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(i.texture),{id:e,fbo:n,texture:i,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((t=>e.id!==t)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((e=>!e.inUse))}}const jo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Uo{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new zo(e.context,30,t.sourceCache.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((n=>!e._layers[n].isHidden(t))),this._coordsAscending={};for(const t in e.sourceCaches){this._coordsAscending[t]={};const n=e.sourceCaches[t].getVisibleCoordinates(),i=e.sourceCaches[t].getSource(),r=i instanceof X?i.terrainTileRanges:null;for(const e of n){const n=this.terrain.sourceCache.getTerrainCoords(e,r);for(const e in n)this._coordsAscending[t][e]||(this._coordsAscending[t][e]=[]),this._coordsAscending[t][e].push(n[e])}}this._coordsAscendingStr={};for(const t of e._order){const n=e._layers[t],i=n.source;if(jo[n.type]&&!this._coordsAscendingStr[i]){this._coordsAscendingStr[i]={};for(const e in this._coordsAscending[i])this._coordsAscendingStr[i][e]=this._coordsAscending[i][e].map((e=>e.key)).sort().join()}}for(const e of this._renderableTiles)for(const t in this._coordsAscendingStr){const n=this._coordsAscendingStr[t][e.tileID.key];n&&n!==e.rttCoords[t]&&(e.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const i=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),r=e.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(jo[r]&&(this._prevType&&jo[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(jo[this._prevType]||jo[r]&&s){this._prevType=r;const e=this._stacks.length-1,n=this._stacks[e]||[];for(const r of this._renderableTiles){if(this.pool.isFull()&&(Tr(this.painter,this.terrain,this._rttTiles,i),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(r),r.rtt[e]){const t=this.pool.getObjectForId(r.rtt[e].id);if(t.stamp===r.rtt[e].stamp){this.pool.useObject(t);continue}}const s=this.pool.getOrCreateFreeObject();this.pool.useObject(s),this.pool.stampObject(s),r.rtt[e]={id:s.id,stamp:s.stamp},o.context.bindFramebuffer.set(s.fbo.framebuffer),o.context.clear({color:t.bf.transparent,stencil:0}),o.currentStencilSource=void 0;for(let e=0;e<n.length;e++){const t=o.style._layers[n[e]],a=t.source?this._coordsAscending[t.source][r.tileID.key]:[r.tileID];o.context.viewport.set([0,0,s.fbo.width,s.fbo.height]),o._renderTileClippingMasks(t,a,!0),o.renderLayer(o,o.style.sourceCaches[t.source],t,a,i),t.source&&(r.rttCoords[t.source]=this._coordsAscendingStr[t.source][r.tileID.key])}}return Tr(this.painter,this.terrain,this._rttTiles,i),this._rttTiles=[],this.pool.freeAllObjects(),jo[r]}return!1}}const Vo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$o=n,Go={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ko,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Wo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ho{constructor(e,n,i=!1){this.mousedown=e=>{this.startMove(e,a.mousePos(this.element,e)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.move(e,a.mousePos(this.element,e))},this.mouseup=e=>{this._rotatePitchHandler.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.startMove(e,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.move(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const r=new no;this._rotatePitchHandler=new Yr({clickTolerance:3,move:(e,r)=>{const o=n.getBoundingClientRect(),s=new t.P((o.bottom-o.top)/2,(o.right-o.left)/2);return{bearingDelta:t.cn(new t.P(e.x,r.y),r,s),pitchDelta:i?-.5*(r.y-e.y):void 0}},moveStateManager:r,enable:!0,assignEvents:()=>{}}),this.map=e,a.addEventListener(n,"mousedown",this.mousedown),a.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(n,"touchcancel",this.reset)}startMove(e,t){this._rotatePitchHandler.dragStart(e,t),a.disableDrag()}move(e,t){const n=this.map,{bearingDelta:i,pitchDelta:r}=this._rotatePitchHandler.dragMove(e,t)||{};i&&n.setBearing(n.getBearing()+i),r&&n.setPitch(n.getPitch()+r)}off(){const e=this.element;a.removeEventListener(e,"mousedown",this.mousedown),a.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let Zo;function qo(e,n,i,r=!1){if(r||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return null==e?void 0:e.wrap();const o=new t.S(e.lng,e.lat);if(e=new t.S(e.lng,e.lat),n){const r=new t.S(e.lng-360,e.lat),o=new t.S(e.lng+360,e.lat),s=i.locationToScreenPoint(e).distSqr(n);i.locationToScreenPoint(r).distSqr(n)<s?e=r:i.locationToScreenPoint(o).distSqr(n)<s&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){const t=i.locationToScreenPoint(e);if(t.x>=0&&t.y>=0&&t.x<=i.width&&t.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e.lng!==o.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(e))?e:o}const Xo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yo(e,t,n){const i=e.classList;for(const e in Xo)i.remove(`maplibregl-${n}-anchor-${e}`);i.add(`maplibregl-${n}-anchor-${t}`)}class Ko extends t.E{constructor(e){if(super(),this._onKeyPress=e=>{const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()},this._onMapClick=e=>{const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;const t=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!t)&&this._map.once("render",this._update),this._lngLat=qo(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let n="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?n=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let i="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?i="rotateX(0deg)":"map"===this._pitchAlignment&&(i=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||e&&"moveend"!==e.type||(this._pos=this._pos.round()),a.setTransform(this._element,`${Xo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${i} ${n}`),s.frameAsync(new AbortController).then((()=>{this._updateOpacity(e&&"moveend"===e.type)})).catch((()=>{}))},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.l("dragstart"))),this.fire(new t.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.l("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div");const n=a.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${i}px`),n.setAttributeNS(null,"width",`${r}px`),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const o=a.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const s=a.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=a.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=a.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const u=a.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=a.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=a.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=a.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=a.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const g=a.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=a.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const _=a.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),g.appendChild(m),g.appendChild(_),s.appendChild(l),s.appendChild(u),s.appendChild(d),s.appendChild(f),s.appendChild(g),n.appendChild(s),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),Yo(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.abs(n)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,i;const r=null===(n=this._map)||void 0===n?void 0:n.terrain,o=this._map.transform.isLocationOccluded(this._lngLat);if(!r||o){const e=o?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==e&&(this._element.style.opacity=e))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const s=this._map,a=s.terrain.depthAtPoint(this._pos),l=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,l)-a<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/s.transform.pixelsPerMeter,u=Math.sin(s.getPitch()*Math.PI/180)*c,h=s.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),d=s.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(i=this._popup)||void 0===i?void 0:i.isOpen())&&d&&this._popup.remove(),this._element.style.opacity=d?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,t){return(void 0===this._opacity||void 0===e&&void 0===t)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==t&&(this._opacityWhenCovered=t),this._map&&this._updateOpacity(!0),this}}const Jo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Qo=0,es=!1;const ts={maxWidth:100,unit:"metric"};function ns(e,t,n){const i=n&&n.maxWidth||100,r=e._container.clientHeight/2,o=e._container.clientWidth/2,s=e.unproject([o-i/2,r]),a=e.unproject([o+i/2,r]),l=Math.round(e.project(a).x-e.project(s).x),c=Math.min(i,l,e._container.clientWidth),u=s.distanceTo(a);if(n&&"imperial"===n.unit){const n=3.2808*u;n>5280?is(t,c,n/5280,e._getUIString("ScaleControl.Miles")):is(t,c,n,e._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?is(t,c,u/1852,e._getUIString("ScaleControl.NauticalMiles")):u>=1e3?is(t,c,u/1e3,e._getUIString("ScaleControl.Kilometers")):is(t,c,u,e._getUIString("ScaleControl.Meters"))}function is(e,t,n,i){const r=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(n);e.style.width=t*(r/n)+"px",e.innerHTML=`${r}&nbsp;${i}`}const rs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},os=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ss(e){if(e){if("number"==typeof e){const n=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(n,n),"top-right":new t.P(-n,n),bottom:new t.P(0,-e),"bottom-left":new t.P(n,-n),"bottom-right":new t.P(-n,-n),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const n=t.P.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return ss(new t.P(0,0))}const as=n;e.AJAXError=t.cz,e.Event=t.l,e.Evented=t.E,e.LngLat=t.S,e.MercatorCoordinate=t.a1,e.Point=t.P,e.addProtocol=t.cA,e.config=t.a,e.removeProtocol=t.cB,e.AttributionControl=Oo,e.BoxZoomHandler=Wr,e.CanvasSource=K,e.CooperativeGesturesHandler=Co,e.DoubleClickZoomHandler=bo,e.DragPanHandler=Eo,e.DragRotateHandler=So,e.EdgeInsets=At,e.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{var e;let t=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)t=t.shadowRoot.fullscreenElement;t===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},e.GeoJSONSource=q,e.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new t.S(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),o=t.e({bearing:r},this.options.fitBoundsOptions),s=$.fromLngLat(n,i);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new t.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&es)return;this.options.trackUserLocation&&this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ko({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ko({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{const n=(null==e?void 0:e[0])instanceof ResizeObserverEntry;e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.l("trackuserlocationend")),this.fire(new t.l("userlocationlostfocus")))}))}},this.options=t.e({},Jo,e)}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return t._(this,arguments,void 0,(function*(e=!1){if(void 0!==Zo&&!e)return Zo;if(void 0===window.navigator.permissions)return Zo=!!window.navigator.geolocation,Zo;try{const e=yield window.navigator.permissions.query({name:"geolocation"});Zo="denied"!==e.state}catch(e){Zo=!!window.navigator.geolocation}return Zo}))}().then((e=>this._finishSetupUI(e))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Qo=0,es=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const e=this._map.getBounds(),t=e.getSouthEast(),n=e.getNorthEast(),i=t.distanceTo(n),r=Math.ceil(this._accuracy/(i/this._map._container.clientHeight)*2);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Qo--,es=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.l("trackuserlocationstart")),this.fire(new t.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Qo++,Qo>1?(e={maximumAge:6e5,timeout:0},es=!0):(e=this.options.positionOptions,es=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},e.GlobeControl=class{constructor(){this._toggleProjection=()=>{var e;const t=null===(e=this._map.getProjection())||void 0===e?void 0:e.type;this._map.setProjection("mercator"!==t&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var e;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(e=this._map.getProjection())||void 0===e?void 0:e.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=a.create("button","maplibregl-ctrl-globe",this._container),a.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},e.Hash=Ir,e.ImageSource=X,e.KeyboardHandler=go,e.LngLatBounds=$,e.LogoControl=Lo,e.Map=class extends Ro{constructor(e){var n,i;t.cw.mark(t.cx.create);const r=Object.assign(Object.assign(Object.assign({},Go),e),{canvasContextAttributes:Object.assign(Object.assign({},Go.canvasContextAttributes),e.canvasContextAttributes)});if(null!=r.minZoom&&null!=r.maxZoom&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=r.minPitch&&null!=r.maxPitch&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=r.minPitch&&r.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=r.maxPitch&&r.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const o=new Lt,s=new Bt;if(void 0!==r.minZoom&&o.setMinZoom(r.minZoom),void 0!==r.maxZoom&&o.setMaxZoom(r.maxZoom),void 0!==r.minPitch&&o.setMinPitch(r.minPitch),void 0!==r.maxPitch&&o.setMaxPitch(r.maxPitch),void 0!==r.renderWorldCopies&&o.setRenderWorldCopies(r.renderWorldCopies),super(o,s,{bearingSnap:r.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Do,this._controls=[],this._mapId=t.a7(),this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new t.l("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.l("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._maxTileCacheZoomLevels=r.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},r.canvasContextAttributes),this._trackResize=!0===r.trackResize,this._bearingSnap=r.bearingSnap,this._centerClampedToGround=r.centerClampedToGround,this._refreshExpiredTiles=!0===r.refreshExpiredTiles,this._fadeDuration=r.fadeDuration,this._crossSourceCollisions=!0===r.crossSourceCollisions,this._collectResourceTiming=!0===r.collectResourceTiming,this._locale=Object.assign(Object.assign({},Vo),r.locale),this._clickTolerance=r.clickTolerance,this._overridePixelRatio=r.pixelRatio,this._maxCanvasSize=r.maxCanvasSize,this.transformCameraUpdate=r.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===r.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=f.addThrottleControl((()=>this.isMoving())),this._requestManager=new g(r.transformRequest),"string"==typeof r.container){if(this._container=document.getElementById(r.container),!this._container)throw new Error(`Container '${r.container}' not found.`)}else{if(!(r.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let e=!1;const t=Pr((e=>{this._trackResize&&!this._removed&&(this.resize(e),this.redraw())}),50);this._resizeObserver=new ResizeObserver((n=>{e?t(n):e=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Mo(this,r),this._hash=r.hash&&new Ir("string"==typeof r.hash&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,elevation:r.elevation,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,roll:r.roll}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,t.e({},r.fitBoundsOptions,{duration:0}))));const a="string"==typeof r.style||!("globe"===(null===(i=null===(n=r.style)||void 0===n?void 0:n.projection)||void 0===i?void 0:i.type));this.resize(null,a),this._localIdeographFontFamily=r.localIdeographFontFamily,this._validateStyle=r.validateStyle,r.style&&this.setStyle(r.style,{localIdeographFontFamily:r.localIdeographFontFamily}),r.attributionControl&&this.addControl(new Oo("boolean"==typeof r.attributionControl?void 0:r.attributionControl)),r.maplibreLogo&&this.addControl(new Lo,r.logoPosition),this.on("style.load",(()=>{if(a||this._resizeTransform(),this.transform.unmodified){const e=t.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(e)}})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.l(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.l(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.l("sourcedataabort",e))}))}_getMapId(){return this._mapId}setGlobalStateProperty(e,t){return this.style.setGlobalStateProperty(e,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}calculateCameraOptionsFromTo(e,t,n,i){return null==i&&this.terrain&&(i=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,n,i)}resize(e,n=!0){const[i,r]=this._containerDimensions(),o=this._getClampedPixelRatio(i,r);if(this._resizeCanvas(i,r,o),this.painter.resize(i,r,o),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const t=this._getClampedPixelRatio(i,r);this._resizeCanvas(i,r,t),this.painter.resize(i,r,t)}this._resizeTransform(n);const s=!this._moving;return s&&(this.stop(),this.fire(new t.l("movestart",e)).fire(new t.l("move",e))),this.fire(new t.l("resize",e)),s&&this.fire(new t.l("moveend",e)),this}_resizeTransform(e=!0){var t;const[n,i]=this._containerDimensions();this.transform.resize(n,i,e),null===(t=this._requestedCameraState)||void 0===t||t.resize(n,i,e)}_getClampedPixelRatio(e,t){const{0:n,1:i}=this._maxCanvasSize,r=this.getPixelRatio(),o=e*r,s=t*r;return Math.min(o>n?n/o:1,s>i?i/s:1)*r}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds($.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.setMinZoom(e),this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.setMaxZoom(e),this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.setMinPitch(e),this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>180)throw new Error("maxPitch must be less than or equal to 180");if(e>=this.transform.minPitch)return this.transform.setMaxPitch(e),this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.setRenderWorldCopies(e),this._update()}project(e){return this.transform.locationToScreenPoint(t.S.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e))),s=0!==o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?i||(i=!0,n.call(this,new zr(e,this,r.originalEvent,{features:s}))):i=!1};return{layers:t,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e)));(0!==o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?i=!0:i&&(i=!1,n.call(this,new zr(e,this,r.originalEvent)))},o=t=>{i&&(i=!1,n.call(this,new zr(e,this,t.originalEvent)))};return{layers:t,listener:n,delegates:{mousemove:r,mouseout:o}}}{const i=e=>{const i=t.filter((e=>this.getLayer(e))),r=0!==i.length?this.queryRenderedFeatures(e.point,{layers:i}):[];r.length&&(e.features=r,n.call(this,e),delete e.features)};return{layers:t,listener:n,delegates:{[e]:i}}}}_saveDelegatedListener(e,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(t)}_removeDelegatedListener(e,t,n){if(!this._delegatedListeners||!this._delegatedListeners[e])return;const i=this._delegatedListeners[e];for(let e=0;e<i.length;e++){const r=i[e];if(r.listener===n&&r.layers.length===t.length&&r.layers.every((e=>t.includes(e)))){for(const e in r.delegates)this.off(e,r.delegates[e]);return void i.splice(e,1)}}}on(e,t,n){if(void 0===n)return super.on(e,t);const i="string"==typeof t?[t]:t,r=this._createDelegatedListener(e,i,n);this._saveDelegatedListener(e,r);for(const e in r.delegates)this.on(e,r.delegates[e]);return{unsubscribe:()=>{this._removeDelegatedListener(e,i,n)}}}once(e,t,n){if(void 0===n)return super.once(e,t);const i="string"==typeof t?[t]:t,r=this._createDelegatedListener(e,i,n);for(const t in r.delegates){const o=r.delegates[t];r.delegates[t]=(...t)=>{this._removeDelegatedListener(e,i,n),o(...t)}}this._saveDelegatedListener(e,r);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,n){return void 0===n?super.off(e,t):(this._removeDelegatedListener(e,"string"==typeof t?[t]:t,n),this)}queryRenderedFeatures(e,n){if(!this.style)return[];let i;const r=e instanceof t.P||Array.isArray(e),o=r?e:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(r?{}:e)||{},o instanceof t.P||"number"==typeof o[0])i=[t.P.convert(o)];else{const e=t.P.convert(o[0]),n=t.P.convert(o[1]);i=[e,new t.P(n.x,e.y),n,new t.P(e.x,n.y),e]}return this.style.queryRenderedFeatures(i,n,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,n){return!1!==(n=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){var n,i;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(e,t)));const r=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new En(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,r):this.style.loadJSON(e,t,r),this):(null===(i=null===(n=this.style)||void 0===n?void 0:n.projection)||void 0===i||i.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new En(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const i=this._requestManager.transformRequest(e,"Style");t.j(i,new AbortController).then((e=>{this._updateDiff(e.data,n)})).catch((e=>{e&&this.fire(new t.k(e))}))}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e,n)&&this._update(!0)}catch(i){t.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.k(new Error(`There is no source with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const n=this.style.sourceCaches[e.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);null===this.terrain&&n.reload();for(const n in this.style._layers){const i=this.style._layers[n];"hillshade"===i.type&&i.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===i.type&&i.source===e.source&&t.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bo(this.painter,n,e),this.painter.renderToTexture=new Uo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=t=>{var n;"style"===t.dataType?this.terrain.sourceCache.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(n=t.source)||void 0===n?void 0:n.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.l("terrain",{terrain:e})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}setSourceTileLodParams(e,t,n){if(n){const i=this.getSource(n);if(!i)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);i.calculateTileZoom=ge(Math.max(1,e),Math.max(1,t))}else for(const n in this.style.sourceCaches)this.style.sourceCaches[n].getSource().calculateTileZoom=ge(Math.max(1,e),Math.max(1,t));return this._update(!0),this}refreshTiles(e,n){const i=this.style.sourceCaches[e];if(!i)throw new Error(`There is no source cache with ID "${e}", cannot refresh tile`);void 0===n?i.reload(!0):i.refreshTiles(n.map((e=>new t.a4(e.z,e.x,e.y))))}addImage(e,n,i={}){const{pixelRatio:r=1,sdf:o=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=i;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||t.b(n))){if(void 0===n.width||void 0===n.height)return this.fire(new t.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:i,height:s,data:d}=n,p=n;return this.style.addImage(e,{data:new t.R({width:i,height:s},new Uint8Array(d)),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e),this}}{const{width:i,height:d,data:p}=s.getImageData(n);this.style.addImage(e,{data:new t.R({width:i,height:d},p),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0})}}updateImage(e,n){const i=this.style.getImage(e);if(!i)return this.fire(new t.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof HTMLImageElement||t.b(n)?s.getImageData(n):n,{width:o,height:a,data:l}=r;if(void 0===o||void 0===a)return this.fire(new t.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==i.data.width||a!==i.data.height)return this.fire(new t.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(n instanceof HTMLImageElement||t.b(n));return i.data.replace(l,c),this.style.updateImage(e,i),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.k(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return f.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t,n={}){return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n,i={}){return this.style.setPaintProperty(e,t,n,i),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n,i={}){return this.style.setLayoutProperty(e,t,n,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,n,(e=>{e||this._update(!0)})),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,(e=>{e||this._update(!0)})),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(e,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const t=this._canvasContainer=a.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),i=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],i);const r=this._controlContainer=a.create("div","maplibregl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{o[e]=a.create("div",`maplibregl-ctrl-${e} `,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t,n){this._canvas.width=Math.floor(n*e),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const e=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(n=>{t={requestedAttributes:e},n&&(t.statusMessage=n.statusMessage,t.type=n.type)}),{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,e):this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e),!n){const e="Failed to initialize WebGL";throw t?(t.message=e,new Error(JSON.stringify(t))):new Error(e)}this.painter=new Ar(n,this.transform),l.testSupport(n)}migrateProjection(e,n){super.migrateProjection(e,n),this.painter.transform=e,this.fire(new t.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){var n,i,r,o,a;const l=this._idleTriggered?this._fadeDuration:0,c=(null===(n=this.style.projection)||void 0===n?void 0:n.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=s.now();this.style.zoomHistory.update(e,n);const i=new t.F(e,{now:n,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(u=!0,this._crossFadingFactor=r),this.style.update(i)}const h=(null===(i=this.style.projection)||void 0===i?void 0:i.transitionState)>0!==c;null===(r=this.style.projection)||void 0===r||r.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState,null===(a=this.style.projection)||void 0===a?void 0:a.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new t.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cw.mark(t.cx.load),this.fire(new t.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,t.cw.mark(t.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),f.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==n?void 0:n.loseContext)&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cw.clearMetrics(),this._removed=!0,this.fire(new t.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,s.frame(this._frameRequest,(e=>{t.cw.frame(e),this._frameRequest=null;try{this._render(e)}catch(e){if(!t.cy(e)&&!function(e){return e.message===Hi}(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return $o}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(e){return this._lazyInitEmptyStyle(),this.style.setProjection(e),this._update(!0)}},e.MapMouseEvent=zr,e.MapTouchEvent=jr,e.MapWheelEvent=Ur,e.Marker=Ko,e.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,t)=>{const n=this._map._getUIString(`NavigationControl.${t}`);e.title=n,e.setAttribute("aria-label",n)},this.options=t.e({},Wo,e),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ho(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const n=a.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}},e.Popup=class extends t.E{constructor(e){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=qo(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const t=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let n=this.options.anchor;const i=ss(this.options.offset);if(!n){const e=this._container.offsetWidth,r=this._container.offsetHeight;let o;o=t.y+i.bottom.y<r?["top"]:t.y>this._map.transform.height-r?["bottom"]:[],t.x<e/2?o.push("left"):t.x>this._map.transform.width-e/2&&o.push("right"),n=0===o.length?"bottom":o.join("-")}let r=t.add(i[n]);this.options.subpixelPositioning||(r=r.round()),a.setTransform(this._container,`${Xo[n]} translate(${r.x}px,${r.y}px)`),Yo(this._container,n,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(rs),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.S.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(os);e&&e.focus()}},e.RasterDEMTileSource=Z,e.RasterTileSource=H,e.ScaleControl=class{constructor(e){this._onMove=()=>{ns(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ns(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ts),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},e.ScrollZoomHandler=vo,e.Style=En,e.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},e.TwoFingersTouchPitchHandler=po,e.TwoFingersTouchRotateHandler=uo,e.TwoFingersTouchZoomHandler=lo,e.TwoFingersTouchZoomRotateHandler=To,e.VectorTileSource=W,e.VideoSource=Y,e.addSourceType=(e,n)=>t._(void 0,void 0,void 0,(function*(){if(Q(e))throw new Error(`A source type called "${e}" already exists.`);((e,t)=>{J[e]=t})(e,n)})),e.clearPrewarmedResources=function(){const e=O;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(M),O=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.createTileMesh=Xt,e.getMaxParallelImageRequests=function(){return t.a.MAX_PARALLEL_IMAGE_REQUESTS},e.getRTLTextPluginStatus=function(){return ie().getRTLTextPluginStatus()},e.getVersion=function(){return as},e.getWorkerCount=function(){return R.workerCount},e.getWorkerUrl=function(){return t.a.WORKER_URL},e.importScriptInWorkers=function(e){return N().broadcast("IS",e)},e.prewarm=function(){D().acquire(M)},e.setMaxParallelImageRequests=function(e){t.a.MAX_PARALLEL_IMAGE_REQUESTS=e},e.setRTLTextPlugin=function(e,t){return ie().setRTLTextPlugin(e,t)},e.setWorkerCount=function(e){R.workerCount=e},e.setWorkerUrl=function(e){t.a.WORKER_URL=e}})),e}()},6657:(e,t,n)=>{"use strict";const i=n(6879);e.exports=(e,t)=>e.sort(((e,n)=>i(e,n,t)))},6877:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>0!==i(e,t,n)},6879:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t,n)=>{const r=new i(e,n),o=new i(t,n);return r.compare(o)||r.compareBuild(o)}},6884:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7192:(e,t,n)=>{"use strict";const i=n(9534),r=n(9618),{safeRe:o,t:s}=n(2728);e.exports=(e,t)=>{if(e instanceof i)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){const i=t.includePrerelease?o[s.COERCERTLFULL]:o[s.COERCERTL];let r;for(;(r=i.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&r.index+r[0].length===n.index+n[0].length||(n=r),i.lastIndex=r.index+r[1].length+r[2].length;i.lastIndex=-1}else n=e.match(t.includePrerelease?o[s.COERCEFULL]:o[s.COERCE]);if(null===n)return null;const a=n[2],l=n[3]||"0",c=n[4]||"0",u=t.includePrerelease&&n[5]?`-${n[5]}`:"",h=t.includePrerelease&&n[6]?`+${n[6]}`:"";return r(`${a}.${l}.${c}${u}${h}`,t)}},7278:(e,t,n)=>{"use strict";const i=n(9618);e.exports=(e,t)=>{const n=i(e,null,!0),r=i(t,null,!0),o=n.compare(r);if(0===o)return null;const s=o>0,a=s?n:r,l=s?r:n,c=!!a.prerelease.length;if(l.prerelease.length&&!c){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(a))return l.minor&&!l.patch?"minor":"patch"}const u=c?"pre":"";return n.major!==r.major?u+"major":n.minor!==r.minor?u+"minor":n.patch!==r.patch?u+"patch":"prerelease"}},7287:(e,t,n)=>{"use strict";const i=n(4120),r=n(5566);e.exports=(e,t,n)=>{const o=[];let s=null,a=null;const l=e.sort(((e,t)=>r(e,t,n)));for(const e of l)i(e,t,n)?(a=e,s||(s=e)):(a&&o.push([s,a]),a=null,s=null);s&&o.push([s,null]);const c=[];for(const[e,t]of o)e===t?c.push(e):t||e!==l[0]?t?e===l[0]?c.push(`<=${t}`):c.push(`${e} - ${t}`):c.push(`>=${e}`):c.push("*");const u=c.join(" || "),h="string"==typeof t.raw?t.raw:String(t);return u.length<h.length?u:t}},7574:(e,t,n)=>{"use strict";const i=n(5566);e.exports=(e,t,n)=>i(e,t,n)>0},7685:(e,t,n)=>{"use strict";const i=n(6175),r=n(6877),o=n(7574),s=n(3039),a=n(5161),l=n(1178);e.exports=(e,t,n,c)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return i(e,n,c);case"!=":return r(e,n,c);case">":return o(e,n,c);case">=":return s(e,n,c);case"<":return a(e,n,c);case"<=":return l(e,n,c);default:throw new TypeError(`Invalid operator: ${t}`)}}},7781:t=>{"use strict";t.exports=e},7997:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},8029:e=>{"use strict";const t=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:n},8398:e=>{"use strict";e.exports=i},8531:e=>{"use strict";e.exports=o},8752:(e,t,n)=>{"use strict";const i=n(9534),r=n(6293);e.exports=(e,t,n)=>{let o=null,s=null,a=null;try{a=new r(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(o&&1!==s.compare(e)||(o=e,s=new i(o,n)))})),o}},8968:(e,t,n)=>{"use strict";const i=n(9618);e.exports=(e,t)=>{const n=i(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},8992:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t)=>new i(e,t).major},9088:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},9089:e=>{"use strict";e.exports=a},9383:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},9534:(e,t,n)=>{"use strict";const i=n(5906),{MAX_LENGTH:r,MAX_SAFE_INTEGER:o}=n(6484),{safeRe:s,t:a}=n(2728),l=n(8029),{compareIdentifiers:c}=n(410);class u{constructor(e,t){if(t=l(t),e instanceof u){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>r)throw new TypeError(`version is longer than ${r} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?s[a.LOOSE]:s[a.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<o)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof u)){if("string"==typeof e&&e===this.version)return 0;e=new u(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof u||(e=new u(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof u||(e=new u(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(i("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return c(n,r)}while(++t)}compareBuild(e){e instanceof u||(e=new u(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(i("build compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return c(n,r)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?s[a.PRERELEASELOOSE]:s[a.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let i=[t,e];!1===n&&(i=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=u},9618:(e,t,n)=>{"use strict";const i=n(9534);e.exports=(e,t,n=!1)=>{if(e instanceof i)return e;try{return new i(e,t)}catch(e){if(!n)return null;throw e}}},9893:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},h={};function d(e){var t=h[e];if(void 0!==t)return t.exports;var n=h[e]={id:e,exports:{}};return u[e].call(n.exports,n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},c=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,d.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);d.r(n);var i={};l=l||[null,c({}),c([]),c(c)];for(var r=2&t&&e;("object"==typeof r||"function"==typeof r)&&!~l.indexOf(r);r=c(r))Object.getOwnPropertyNames(r).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,d.d(n,i),n},d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.nc=void 0;var p={};return(()=>{"use strict";d.r(p),d.d(p,{plugin:()=>$O});var e=d(7781),t=function(e){return e.Zero="zero",e.Coordinates="coords",e.Auto="auto",e}({});const n=new e.Registry((()=>[{id:"auto",name:"Fit to data"},{id:"zero",name:"(0, 0)",lat:0,lon:0},{id:"north-america",name:"North America",lat:40,lon:-100,zoom:4},{id:"europe",name:"Europe",lat:46,lon:14,zoom:4},{id:"west-asia",name:"West Asia",lat:26,lon:53,zoom:4},{id:"se-asia",name:"South-east Asia",lat:10,lon:106,zoom:4},{id:"coords",name:"Coordinates"}])),i={id:t.Zero,lat:0,lon:0,zoom:1};var r=d(5959),o=d.n(r),s=6371008.8,a={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*s,kilometers:6371.0088,kilometres:6371.0088,meters:s,metres:s,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:s/1852,radians:1,yards:6967335.223679999};function l(e,t,n={}){const i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function c(e){return e%(2*Math.PI)*180/Math.PI}function u(e){return e%360*Math.PI/180}function h(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function f(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}var g=function e(t,n,i={}){if(!0===i.final)return function(t,n){let i=e(n,t);return i=(i+180)%360,i}(t,n);const r=f(t),o=f(n),s=u(r[0]),a=u(o[0]),l=u(r[1]),h=u(o[1]),d=Math.sin(a-s)*Math.cos(h),p=Math.cos(l)*Math.sin(h)-Math.sin(l)*Math.cos(h)*Math.cos(a-s);return c(Math.atan2(d,p))};function m(e,t,n){if(null!==e)for(var i,r,o,s,a,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,g="Feature"===p,_=f?e.features.length:1,y=0;y<_;y++){a=(u=!!(c=f?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<a;v++){var b=0,x=0;if(null!==(s=u?c.geometries[v]:c)){l=s.coordinates;var w=s.type;switch(h=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,y,b,x))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===t(l[i],d,y,b,x))return!1;d++,"MultiPoint"===w&&b++}"LineString"===w&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(r=0;r<l[i].length-h;r++){if(!1===t(l[i][r],d,y,b,x))return!1;d++}"MultiLineString"===w&&b++,"Polygon"===w&&x++}"Polygon"===w&&b++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(x=0,r=0;r<l[i].length;r++){for(o=0;o<l[i][r].length-h;o++){if(!1===t(l[i][r][o],d,y,b,x))return!1;d++}x++}b++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===m(s.geometries[i],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _(e,t){!function(e,t){var n,i,r,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,g=p?e.features.length:1;for(n=0;n<g;n++){for(a=p?e.features[n].geometry:f?e.geometry:e,c=p?e.features[n].properties:f?e.properties:{},u=p?e.features[n].bbox:f?e.bbox:void 0,h=p?e.features[n].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=l?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===t(o.geometries[i],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}(e,(function(e,n,i,r,o){var s,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==t(l(e,i,{bbox:r,id:o}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u=e.coordinates[c];if(!1===t(l({type:s,coordinates:u},i),n,c))return!1}}))}function y(e,t={}){if(null!=e.bbox&&!0!==t.recompute)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return m(e,(e=>{n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])})),n}var v=y;const b={Alerting:"rgb(224, 34, 110)",Pending:"rgba(255, 153, 0)",Normal:"rgb(27, 133, 94)"},x="-:",w={},E=["node","connector"];var S=function(e){return e.Icons="icons",e.Points="markers",e.Lines="edit-lines",e.Polygons="polygons",e.Path="path",e.GeoJson="geojson",e.Text="text",e.Hull="convex-hull",e}({}),T=function(e){return e.MoveNode="dragNode",e.DragLine="dragLine",e.SetLineId="setLineId",e.DeleteSource="deleteSource",e}({});function C(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){C(o,i,r,s,a,"next",e)}function a(e){C(o,i,r,s,a,"throw",e)}s(void 0)}))}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){P(e,t,n[t])}))}return e}function M(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function R(e,t){if(!(null==e?void 0:e.length))return[];if(!t)return e.map((e=>e.at(-1)));const n=[];for(const i of e){let e=0,r=i.length-1,o=null;for(;e<=r;){const n=Math.floor((e+r)/2),s=i[n];s.timeEnd<=t?(o=s,e=n+1):r=n-1}o&&n.push(o)}const i=n.sort(((e,t)=>{const n={Alerting:1,Pending:2,Normal:3},i=e.newState.startsWith("Alerting")?"Alerting":e.newState.startsWith("Pending")?"Pending":"Normal",r=t.newState.startsWith("Alerting")?"Alerting":t.newState.startsWith("Pending")?"Pending":"Normal";return n[i]-n[r]}));return i}const k=e=>{const t=e.match(/[\d.]+/g);if(null===t||t.length<3)return[0,0,0];const n=t.slice(0).map(Number);return n[3]=255*(n[3]||1),n};function O(e){e.startsWith("#")&&(e=e.slice(1));let t=1;8===e.length&&(t=parseInt(e.substr(6,2),16)/255,e=e.substr(0,6));const n=parseInt(e.substr(0,2),16),i=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return 1!==t?`rgba(${n}, ${i}, ${r}, ${t.toFixed(2)})`:`rgb(${n}, ${i}, ${r})`}function L(e){if(!e||!e.startsWith("[")&&parseInt(e,10))return null!=e?e:null;try{var t;return null!==(t=JSON.parse(e))&&void 0!==t?t:e}catch(t){return null!=e?e:null}}function D({features:e,switchMap:t,lineSwitchMap:n,getisOffset:i,time:r}){if(!e||!Array.isArray(e)||(null==e?void 0:e.length)<1)return[[],[]];const o=[],s=[...e];return e.forEach(((e,r)=>{if(!(null==e?void 0:e.properties))return;const{parPath:a}=null==e?void 0:e.properties;if(a&&!((null==a?void 0:a.length)<1))if(i)for(let i=1;i<(null==a?void 0:a.length);i++){var l,c,u,h,d,p,f,g,m,_,y;let r=a[i],V=a[i-1];const $="string"==typeof r&&t.get(null==r?void 0:r.split(x)[0]),G="string"==typeof V&&t.get(null==V?void 0:V.split(x)[0]);var v;const W=null!==(v=(null==$||null===(l=$.properties)||void 0===l?void 0:l.sources)&&Object.values($.properties.sources))&&void 0!==v?v:[];var b;const H=null!==(b=(null==G||null===(c=G.properties)||void 0===c?void 0:c.sources)&&Object.values(G.properties.sources))&&void 0!==b?b:[];let Z=null,q=null;(null==W?void 0:W.length)>0&&(null==H?void 0:H.length)>0?W.forEach(((e,t)=>{const{parPath:n}=e;H.forEach(((e,t)=>{const{parPath:i}=e;i[0]===(null==n?void 0:n.at(-1))&&(Z=n),n[0]===(null==i?void 0:i.at(-1))&&(q=i)}))})):(null==W?void 0:W.length)<1&&(null==H?void 0:H.length)>0&&H.forEach(((e,t)=>{const{parPath:n}=e;n.at(-1)===r&&(Z=n)}));const X="string"==typeof r?null==t?void 0:t.get(r):null;s.push(X);let Y=null==X||null===(h=X.properties)||void 0===h||null===(u=h.threshold)||void 0===u?void 0:u.color,K=null==X||null===(p=X.properties)||void 0===p||null===(d=p.threshold)||void 0===d?void 0:d.lineWidth;const J=null==X?void 0:X.properties.aggrType,Q="string"==typeof V?null==t?void 0:t.get(V):null,ee=null==Q||null===(f=Q.properties)||void 0===f?void 0:f.aggrType;let te=null==Q||null===(m=Q.properties)||void 0===m||null===(g=m.threshold)||void 0===g?void 0:g.color,ne=null==Q||null===(y=Q.properties)||void 0===y||null===(_=y.threshold)||void 0===_?void 0:_.lineWidth;if("string"==typeof r&&"string"==typeof V||Array.isArray(r)||Array.isArray(V)&&(X||Q)){var w,S,T,C;let i,s,a,l,c,u;if(E.includes(ee)&&E.includes(J)&&(Z||q)){const e=Z||(null!=q?q:[]),i=te||Y,r=ne||K,s=[];if(null==e||e.forEach((e=>{if("string"==typeof e){var i,r;const a=null!==(r=null==n?void 0:n.get(e))&&void 0!==r?r:null==n?void 0:n.get(e+x+0),l=(null==a||a.properties.aggrType,null==a?void 0:a.geometry);var o;const c=l&&l.coordinates&&l.coordinates.length>0?l.coordinates[0][0]:null!==(o=null==t||null===(i=t.get(e))||void 0===i?void 0:i.geometry.coordinates)&&void 0!==o?o:null;c&&s.push(c)}else{if(!Array.isArray(e))return null;s.push(e)}})),o.push([s,i,r]),e)continue}if("string"==typeof r){var A,P,I,M,R,k,O;const e=null!==(O=null==n?void 0:n.get(r))&&void 0!==O?O:null==n?void 0:n.get(r+x+0);s=null==e||null===(P=e.properties)||void 0===P||null===(A=P.threshold)||void 0===A?void 0:A.color,a=null==e||null===(M=e.properties)||void 0===M||null===(I=M.threshold)||void 0===I?void 0:I.lineWidth;const o=null==e?void 0:e.geometry;var L;i=(null==o||null===(R=o.coordinates)||void 0===R?void 0:R.length)>0?o.coordinates[0][0]:null!==(L=null==t||null===(k=t.get(r))||void 0===k?void 0:k.geometry.coordinates)&&void 0!==L?L:null}else i=r;if("string"==typeof V){var D,F,N,B,z,j;const e=null!==(j=null==n?void 0:n.get(V))&&void 0!==j?j:null==n?void 0:n.get(V+x+0);l=null==e||null===(F=e.properties)||void 0===F||null===(D=F.threshold)||void 0===D?void 0:D.color,c=null==e||null===(B=e.properties)||void 0===B||null===(N=B.threshold)||void 0===N?void 0:N.lineWidth;const i=null==e?void 0:e.geometry;var U;u=i&&i.coordinates&&i.coordinates.length>0?i.coordinates[0][0]:null!==(U=null==t||null===(z=t.get(V))||void 0===z?void 0:z.geometry.coordinates)&&void 0!==U?U:null}else u=V;o.push([[u,i],E.includes(ee)&&E.includes(J)?l:null==e||null===(S=e.properties)||void 0===S||null===(w=S.threshold)||void 0===w?void 0:w.color,E.includes(ee)?c:null==e||null===(C=e.properties)||void 0===C||null===(T=C.threshold)||void 0===T?void 0:T.lineWidth])}}else{var V,$,G,W,H;const t=n.get(a.at(-1));s.push(e),s.push(t);const i=null==e?void 0:e.geometry,r=null==i?void 0:i.coordinates,l=null===(V=r[0])||void 0===V?void 0:V[0],c=r[r.length-1],u=null==c?void 0:c.at(-1),h=l&&u&&(null==e||null===(G=e.properties)||void 0===G||null===($=G.threshold)||void 0===$?void 0:$.color),d=l&&u&&(null==e||null===(H=e.properties)||void 0===H||null===(W=H.threshold)||void 0===W?void 0:W.lineWidth);l&&u&&h&&o.push([[l,u],h,d])}})),[s.filter((e=>null!==e)),o.filter((e=>e[0].every((e=>null!==e))))]}function F(e){if(e)return"Point"===e.type?e.coordinates:"MultiPoint"===e.type||"LineString"===e.type?e.coordinates[0]:"Polygon"===e.type||"MultiLineString"===e.type?e.coordinates[0][0]:"MultiPolygon"===e.type?e.coordinates[0][0][0]:void 0}function N(e){return e>=0&&e<=20?"rgba(14, 205, 50,1)":e<=30?"rgba(255, 221, 87, 0.9)":e<=40?"rgba(237, 129, 40, 1)":e<=50?"rgba(219, 92, 158,1)":e<=75?"rgba(163, 27, 50,1)":e<=100?"rgba(164, 50, 168,1)":"rgb(72, 190, 194)"}function B(e,t=!1){const n=new DOMParser,i=n.parseFromString(e,"image/svg+xml");t&&(i.querySelector("symbol"),i.querySelectorAll("use").forEach((e=>{const t=e.getAttribute("xlink:href");if(t&&t.startsWith("#")){const o=t.substring(1),s=i.getElementById(o);if(s){var r;const t=s.innerHTML;null===(r=e.parentNode)||void 0===r||r.replaceChild(n.parseFromString(t,"image/svg+xml").documentElement,e)}}})));let r=i.getElementsByTagName("svg")[0],o=r.getAttribute("width"),s=r.getAttribute("height");const a=r.getAttribute("viewBox");if((!o||!s)&&a){var l,c;const e=a.split(" ").map(parseFloat);o=null===(l=e[2])||void 0===l?void 0:l.toString(),s=null===(c=e[3])||void 0===c?void 0:c.toString(),r.setAttribute("width",o),r.setAttribute("height",s)}return{svgText:(new XMLSerializer).serializeToString(i),width:o,height:s}}function z(e){return A((function*(){const{iconName:t,svgColor:n}=e;if(!t)return null;let i=t.startsWith("public/")?t:"public/plugins/vaduga-mapgl-panel/img/icons/"+t+".svg";const r=t.startsWith("http")?t:i;try{const e=yield fetch(r);if(!e.ok)throw new Error(`Failed to fetch SVG file. Status: ${e.status}`);let n=yield e.text();const{svgText:i,width:o,height:s}=B(n);return[t,{svgText:i,width:o,height:s}]}catch(e){return console.error("Error fetching SVG file:",e),null}}))()}const j=(e,t,n,i=!1)=>{const r=[];let o=i?.1:n;for(let i=e;i<=t;i+=o){const e=parseFloat(i.toFixed(1));r.push({value:e,label:e.toString()}),1===e&&(o=n)}return r};function U(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw new Error("number"==typeof e?"[MobX] minified error nr: "+e+(n.length?" "+n.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+e)}var V={};function $(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==d.g?d.g:"undefined"!=typeof self?self:V}var G=Object.assign,W=Object.getOwnPropertyDescriptor,H=Object.defineProperty,Z=Object.prototype,q=[];Object.freeze(q);var X={};Object.freeze(X);var Y="undefined"!=typeof Proxy,K=Object.toString();function J(){Y||U("Proxy not available")}function Q(e){var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}}var ee=function(){};function te(e){return"function"==typeof e}function ne(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function ie(e){return null!==e&&"object"==typeof e}function re(e){if(!ie(e))return!1;var t=Object.getPrototypeOf(e);if(null==t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n.toString()===K}function oe(e){var t=null==e?void 0:e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName)}function se(e,t,n){H(e,t,{enumerable:!1,writable:!0,configurable:!0,value:n})}function ae(e,t,n){H(e,t,{enumerable:!1,writable:!1,configurable:!0,value:n})}function le(e,t){var n="isMobX"+e;return t.prototype[n]=!0,function(e){return ie(e)&&!0===e[n]}}function ce(e){return null!=e&&"[object Map]"===Object.prototype.toString.call(e)}function ue(e){return null!=e&&"[object Set]"===Object.prototype.toString.call(e)}var he=void 0!==Object.getOwnPropertySymbols,de="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:he?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function pe(e){return null===e?null:"object"==typeof e?""+e:e}function fe(e,t){return Z.hasOwnProperty.call(e,t)}var ge=Object.getOwnPropertyDescriptors||function(e){var t={};return de(e).forEach((function(n){t[n]=W(e,n)})),t};function me(e,t){return!!(e&t)}function _e(e,t,n){return n?e|=t:e&=~t,e}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ve(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Te(i.key),i)}}function be(e,t,n){return t&&ve(e.prototype,t),n&&ve(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function xe(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},we.apply(null,arguments)}function Ee(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Se(e,t)}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}function Te(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}var Ce=Symbol("mobx-stored-annotations");function Ae(e){return Object.assign((function(t,n){if(Ie(n))return e.decorate_20223_(t,n);Pe(t,n,e)}),e)}function Pe(e,t,n){fe(e,Ce)||se(e,Ce,we({},e[Ce])),function(e){return e.annotationType_===Ne}(n)||(e[Ce][t]=n)}function Ie(e){return"object"==typeof e&&"string"==typeof e.kind}var Me=Symbol("mobx administration"),Re=function(){function e(e){void 0===e&&(e="Atom"),this.name_=void 0,this.flags_=0,this.observers_=new Set,this.lastAccessedBy_=0,this.lowestObserverState_=Lt.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e}var t=e.prototype;return t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.reportObserved=function(){return nn(this)},t.reportChanged=function(){en(),rn(this),tn()},t.toString=function(){return this.name_},be(e,[{key:"isBeingObserved",get:function(){return me(this.flags_,e.isBeingObservedMask_)},set:function(t){this.flags_=_e(this.flags_,e.isBeingObservedMask_,t)}},{key:"isPendingUnobservation",get:function(){return me(this.flags_,e.isPendingUnobservationMask_)},set:function(t){this.flags_=_e(this.flags_,e.isPendingUnobservationMask_,t)}},{key:"diffValue",get:function(){return me(this.flags_,e.diffValueMask_)?1:0},set:function(t){this.flags_=_e(this.flags_,e.diffValueMask_,1===t)}}])}();Re.isBeingObservedMask_=1,Re.isPendingUnobservationMask_=2,Re.diffValueMask_=4;var ke=le("Atom",Re);function Oe(e,t,n){void 0===t&&(t=ee),void 0===n&&(n=ee);var i=new Re(e);return t!==ee&&Tn(wn,i,t,undefined),n!==ee&&Sn(i,n),i}var Le={identity:function(e,t){return e===t},structural:function(e,t){return Vi(e,t)},default:function(e,t){return Object.is?Object.is(e,t):e===t?0!==e||1/e==1/t:e!=e&&t!=t},shallow:function(e,t){return Vi(e,t,1)}};function De(e,t,n){return Nn(e)?e:Array.isArray(e)?bt.array(e,{name:n}):re(e)?bt.object(e,void 0,{name:n}):ce(e)?bt.map(e,{name:n}):ue(e)?bt.set(e,{name:n}):"function"!=typeof e||bn(e)||Fn(e)?e:oe(e)?Ln(e):vn(n,e)}function Fe(e){return e}var Ne="override";function Be(e,t){return{annotationType_:e,options_:t,make_:ze,extend_:je,decorate_20223_:Ue}}function ze(e,t,n,i){var r;if(null!=(r=this.options_)&&r.bound)return null===this.extend_(e,t,n,!1)?0:1;if(i===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(bn(n.value))return 1;var o=Ve(e,this,t,n,!1);return H(i,t,o),2}function je(e,t,n,i){var r=Ve(e,this,t,n);return e.defineProperty_(t,r,i)}function Ue(e,t){var n,i=t.kind,r=t.name,o=t.addInitializer,s=this,a=function(e){var t,n,i,o;return It(null!=(t=null==(n=s.options_)?void 0:n.name)?t:r.toString(),e,null!=(i=null==(o=s.options_)?void 0:o.autoAction)&&i)};return"field"==i?function(e){var t,n=e;return bn(n)||(n=a(n)),null!=(t=s.options_)&&t.bound&&((n=n.bind(this)).isMobxAction=!0),n}:"method"==i?(bn(e)||(e=a(e)),null!=(n=this.options_)&&n.bound&&o((function(){var e=this,t=e[r].bind(e);t.isMobxAction=!0,e[r]=t})),e):void U("Cannot apply '"+s.annotationType_+"' to '"+String(r)+"' (kind: "+i+"):\n'"+s.annotationType_+"' can only be used on properties with a function value.")}function Ve(e,t,n,i,r){var o,s,a,l,c,u,h,d;void 0===r&&(r=Kt.safeDescriptors),d=i,t.annotationType_,d.value;var p,f=i.value;return null!=(o=t.options_)&&o.bound&&(f=f.bind(null!=(p=e.proxy_)?p:e.target_)),{value:It(null!=(s=null==(a=t.options_)?void 0:a.name)?s:n.toString(),f,null!=(l=null==(c=t.options_)?void 0:c.autoAction)&&l,null!=(u=t.options_)&&u.bound?null!=(h=e.proxy_)?h:e.target_:void 0),configurable:!r||e.isPlainObject_,enumerable:!1,writable:!r}}function $e(e,t){return{annotationType_:e,options_:t,make_:Ge,extend_:We,decorate_20223_:He}}function Ge(e,t,n,i){var r;if(i===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(null!=(r=this.options_)&&r.bound&&(!fe(e.target_,t)||!Fn(e.target_[t]))&&null===this.extend_(e,t,n,!1))return 0;if(Fn(n.value))return 1;var o=Ze(e,this,0,n,!1,!1);return H(i,t,o),2}function We(e,t,n,i){var r,o=Ze(e,this,0,n,null==(r=this.options_)?void 0:r.bound);return e.defineProperty_(t,o,i)}function He(e,t){var n,i=t.name,r=t.addInitializer;return Fn(e)||(e=Ln(e)),null!=(n=this.options_)&&n.bound&&r((function(){var e=this,t=e[i].bind(e);t.isMobXFlow=!0,e[i]=t})),e}function Ze(e,t,n,i,r,o){var s;void 0===o&&(o=Kt.safeDescriptors),s=i,t.annotationType_,s.value;var a,l=i.value;return Fn(l)||(l=Ln(l)),r&&((l=l.bind(null!=(a=e.proxy_)?a:e.target_)).isMobXFlow=!0),{value:l,configurable:!o||e.isPlainObject_,enumerable:!1,writable:!o}}function qe(e,t){return{annotationType_:e,options_:t,make_:Xe,extend_:Ye,decorate_20223_:Ke}}function Xe(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function Ye(e,t,n,i){return r=n,this.annotationType_,r.get,e.defineComputedProperty_(t,we({},this.options_,{get:n.get,set:n.set}),i);var r}function Ke(e,t){var n=this,i=t.name;return(0,t.addInitializer)((function(){var t=bi(this)[Me],r=we({},n.options_,{get:e,context:this});r.name||(r.name="ObservableObject."+i.toString()),t.values_.set(i,new Ot(r))})),function(){return this[Me].getObservablePropValue_(i)}}function Je(e,t){return{annotationType_:e,options_:t,make_:Qe,extend_:et,decorate_20223_:tt}}function Qe(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function et(e,t,n,i){var r,o;return this.annotationType_,e.defineObservableProperty_(t,n.value,null!=(r=null==(o=this.options_)?void 0:o.enhancer)?r:De,i)}function tt(e,t){var n=this,i=t.kind,r=t.name,o=new WeakSet;function s(e,t){var i,s,a=bi(e)[Me],l=new kt(t,null!=(i=null==(s=n.options_)?void 0:s.enhancer)?i:De,"ObservableObject."+r.toString(),!1);a.values_.set(r,l),o.add(e)}if("accessor"==i)return{get:function(){return o.has(this)||s(this,e.get.call(this)),this[Me].getObservablePropValue_(r)},set:function(e){return o.has(this)||s(this,e),this[Me].setObservablePropValue_(r,e)},init:function(e){return o.has(this)||s(this,e),e}}}var nt="true",it=rt();function rt(e){return{annotationType_:nt,options_:e,make_:ot,extend_:st,decorate_20223_:at}}function ot(e,t,n,i){var r,o,s,a;if(n.get)return St.make_(e,t,n,i);if(n.set){var l=It(t.toString(),n.set);return i===e.target_?null===e.defineProperty_(t,{configurable:!Kt.safeDescriptors||e.isPlainObject_,set:l})?0:2:(H(i,t,{configurable:!0,set:l}),2)}if(i!==e.target_&&"function"==typeof n.value)return oe(n.value)?(null!=(a=this.options_)&&a.autoBind?Ln.bound:Ln).make_(e,t,n,i):(null!=(s=this.options_)&&s.autoBind?vn.bound:vn).make_(e,t,n,i);var c,u=!1===(null==(r=this.options_)?void 0:r.deep)?bt.ref:bt;return"function"==typeof n.value&&null!=(o=this.options_)&&o.autoBind&&(n.value=n.value.bind(null!=(c=e.proxy_)?c:e.target_)),u.make_(e,t,n,i)}function st(e,t,n,i){var r,o,s;return n.get?St.extend_(e,t,n,i):n.set?e.defineProperty_(t,{configurable:!Kt.safeDescriptors||e.isPlainObject_,set:It(t.toString(),n.set)},i):("function"==typeof n.value&&null!=(r=this.options_)&&r.autoBind&&(n.value=n.value.bind(null!=(s=e.proxy_)?s:e.target_)),(!1===(null==(o=this.options_)?void 0:o.deep)?bt.ref:bt).extend_(e,t,n,i))}function at(e,t){U("'"+this.annotationType_+"' cannot be used as a decorator")}var lt={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function ct(e){return e||lt}Object.freeze(lt);var ut=Je("observable"),ht=Je("observable.ref",{enhancer:Fe}),dt=Je("observable.shallow",{enhancer:function(e,t,n){return null==e||Ei(e)||si(e)||hi(e)||gi(e)?e:Array.isArray(e)?bt.array(e,{name:n,deep:!1}):re(e)?bt.object(e,void 0,{name:n,deep:!1}):ce(e)?bt.map(e,{name:n,deep:!1}):ue(e)?bt.set(e,{name:n,deep:!1}):void 0}}),pt=Je("observable.struct",{enhancer:function(e,t){return Vi(e,t)?t:e}}),ft=Ae(ut);function gt(e){return!0===e.deep?De:!1===e.deep?Fe:(t=e.defaultDecorator)&&null!=(n=null==(i=t.options_)?void 0:i.enhancer)?n:De;var t,n,i}function mt(e,t,n){return Ie(t)?ut.decorate_20223_(e,t):ne(t)?void Pe(e,t,ut):Nn(e)?e:re(e)?bt.object(e,t,n):Array.isArray(e)?bt.array(e,t):ce(e)?bt.map(e,t):ue(e)?bt.set(e,t):"object"==typeof e&&null!==e?e:bt.box(e,t)}G(mt,ft);var _t,yt,vt={box:function(e,t){var n=ct(t);return new kt(e,gt(n),n.name,!0,n.equals)},array:function(e,t){var n=ct(t);return(!1===Kt.useProxies||!1===n.proxy?Di:Qn)(e,gt(n),n.name)},map:function(e,t){var n=ct(t);return new ui(e,gt(n),n.name)},set:function(e,t){var n=ct(t);return new fi(e,gt(n),n.name)},object:function(e,t,n){return zi((function(){return Pn(!1===Kt.useProxies||!1===(null==n?void 0:n.proxy)?bi({},n):function(e,t){var n,i;return J(),null!=(i=(n=(e=bi(e,t))[Me]).proxy_)?i:n.proxy_=new Proxy(e,jn)}({},n),e,t)}))},ref:Ae(ht),shallow:Ae(dt),deep:ft,struct:Ae(pt)},bt=G(mt,vt),xt="computed",wt=qe(xt),Et=qe("computed.struct",{equals:Le.structural}),St=function(e,t){if(Ie(t))return wt.decorate_20223_(e,t);if(ne(t))return Pe(e,t,wt);if(re(e))return Ae(qe(xt,e));var n=re(t)?t:{};return n.get=e,n.name||(n.name=e.name||""),new Ot(n)};Object.assign(St,wt),St.struct=Ae(Et);var Tt=0,Ct=1,At=null!=(_t=null==(yt=W((function(){}),"name"))?void 0:yt.configurable)&&_t,Pt={value:"action",configurable:!0,writable:!1,enumerable:!1};function It(e,t,n,i){function r(){return function(e,t,n,i,r){var o=function(e,t){var n=!1,i=0,r=Kt.trackingDerivation,o=!t||!r;en();var s=Kt.allowStateChanges;o&&($t(),s=Mt(!0));var a={runAsAction_:o,prevDerivation_:r,prevAllowStateChanges_:s,prevAllowStateReads_:Wt(!0),notifySpy_:n,startTime_:i,actionId_:Ct++,parentActionId_:Tt};return Tt=a.actionId_,a}(0,t);try{return n.apply(i,r)}catch(e){throw o.error_=e,e}finally{!function(e){Tt!==e.actionId_&&U(30),Tt=e.parentActionId_,void 0!==e.error_&&(Kt.suppressReactionErrors=!0),Rt(e.prevAllowStateChanges_),Ht(e.prevAllowStateReads_),tn(),e.runAsAction_&&Gt(e.prevDerivation_),Kt.suppressReactionErrors=!1}(o)}}(0,n,t,i||this,arguments)}return void 0===n&&(n=!1),r.isMobxAction=!0,r.toString=function(){return t.toString()},At&&(Pt.value=e,H(r,"name",Pt)),r}function Mt(e){var t=Kt.allowStateChanges;return Kt.allowStateChanges=e,t}function Rt(e){Kt.allowStateChanges=e}var kt=function(e){function t(t,n,i,r,o){var s;return void 0===i&&(i="ObservableValue"),void 0===r&&(r=!0),void 0===o&&(o=Le.default),(s=e.call(this,i)||this).enhancer=void 0,s.name_=void 0,s.equals=void 0,s.hasUnreportedChange_=!1,s.interceptors_=void 0,s.changeListeners_=void 0,s.value_=void 0,s.dehancer=void 0,s.enhancer=n,s.name_=i,s.equals=o,s.value_=n(t,void 0,i),s}Ee(t,e);var n=t.prototype;return n.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},n.set=function(e){this.value_,(e=this.prepareNewValue_(e))!==Kt.UNCHANGED&&this.setNewValue_(e)},n.prepareNewValue_=function(e){if(Un(this)){var t=$n(this,{object:this,type:Yn,newValue:e});if(!t)return Kt.UNCHANGED;e=t.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?Kt.UNCHANGED:e},n.setNewValue_=function(e){var t=this.value_;this.value_=e,this.reportChanged(),Gn(this)&&Hn(this,{type:Yn,object:this,newValue:e,oldValue:t})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(e){return Vn(this,e)},n.observe_=function(e,t){return t&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:Yn,newValue:this.value_,oldValue:void 0}),Wn(this,e)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return pe(this.get())},n[Symbol.toPrimitive]=function(){return this.valueOf()},t}(Re),Ot=function(){function e(e){this.dependenciesState_=Lt.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.observers_=new Set,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Lt.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new Nt(null),this.name_=void 0,this.triggeredBy_=void 0,this.flags_=0,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Dt.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||U(31),this.derivation=e.get,this.name_=e.name||"ComputedValue",e.set&&(this.setter_=It("ComputedValue-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?Le.structural:Le.default),this.scope_=e.context,this.requiresReaction_=e.requiresReaction,this.keepAlive_=!!e.keepAlive}var t=e.prototype;return t.onBecomeStale_=function(){var e;(e=this).lowestObserverState_===Lt.UP_TO_DATE_&&(e.lowestObserverState_=Lt.POSSIBLY_STALE_,e.observers_.forEach((function(e){e.dependenciesState_===Lt.UP_TO_DATE_&&(e.dependenciesState_=Lt.POSSIBLY_STALE_,e.onBecomeStale_())})))},t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.get=function(){if(this.isComputing&&U(32,this.name_,this.derivation),0!==Kt.inBatch||0!==this.observers_.size||this.keepAlive_){if(nn(this),zt(this)){var e=Kt.trackingContext;this.keepAlive_&&!e&&(Kt.trackingContext=this),this.trackAndCompute()&&((t=this).lowestObserverState_!==Lt.STALE_&&(t.lowestObserverState_=Lt.STALE_,t.observers_.forEach((function(e){e.dependenciesState_===Lt.POSSIBLY_STALE_?e.dependenciesState_=Lt.STALE_:e.dependenciesState_===Lt.UP_TO_DATE_&&(t.lowestObserverState_=Lt.UP_TO_DATE_)})))),Kt.trackingContext=e}}else zt(this)&&(this.warnAboutUntrackedRead_(),en(),this.value_=this.computeValue_(!1),tn());var t,n=this.value_;if(Bt(n))throw n.cause;return n},t.set=function(e){if(this.setter_){this.isRunningSetter&&U(33,this.name_),this.isRunningSetter=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter=!1}}else U(34,this.name_)},t.trackAndCompute=function(){var e=this.value_,t=this.dependenciesState_===Lt.NOT_TRACKING_,n=this.computeValue_(!0),i=t||Bt(e)||Bt(n)||!this.equals_(e,n);return i&&(this.value_=n),i},t.computeValue_=function(e){this.isComputing=!0;var t,n=Mt(!1);if(e)t=jt(this,this.derivation,this.scope_);else if(!0===Kt.disableErrorBoundaries)t=this.derivation.call(this.scope_);else try{t=this.derivation.call(this.scope_)}catch(e){t=new Nt(e)}return Rt(n),this.isComputing=!1,t},t.suspend_=function(){this.keepAlive_||(Ut(this),this.value_=void 0)},t.observe_=function(e,t){var n=this,i=!0,r=void 0;return function(e,t){var n,i,r,o;void 0===t&&(t=X);var s,a=null!=(n=null==(i=t)?void 0:i.name)?n:"Autorun";if(t.scheduler||t.delay){var l=function(e){return e.scheduler?e.scheduler:e.delay?function(t){return setTimeout(t,e.delay)}:xn}(t),c=!1;s=new on(a,(function(){c||(c=!0,l((function(){c=!1,s.isDisposed||s.track(u)})))}),t.onError,t.requiresObservable)}else s=new on(a,(function(){this.track(u)}),t.onError,t.requiresObservable);function u(){e(s)}return null!=(r=t)&&null!=(r=r.signal)&&r.aborted||s.schedule_(),s.getDisposer_(null==(o=t)?void 0:o.signal)}((function(){var o=n.get();if(!i||t){var s=$t();e({observableKind:"computed",debugObjectName:n.name_,type:Yn,object:n,newValue:o,oldValue:r}),Gt(s)}i=!1,r=o}))},t.warnAboutUntrackedRead_=function(){},t.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},t.valueOf=function(){return pe(this.get())},t[Symbol.toPrimitive]=function(){return this.valueOf()},be(e,[{key:"isComputing",get:function(){return me(this.flags_,e.isComputingMask_)},set:function(t){this.flags_=_e(this.flags_,e.isComputingMask_,t)}},{key:"isRunningSetter",get:function(){return me(this.flags_,e.isRunningSetterMask_)},set:function(t){this.flags_=_e(this.flags_,e.isRunningSetterMask_,t)}},{key:"isBeingObserved",get:function(){return me(this.flags_,e.isBeingObservedMask_)},set:function(t){this.flags_=_e(this.flags_,e.isBeingObservedMask_,t)}},{key:"isPendingUnobservation",get:function(){return me(this.flags_,e.isPendingUnobservationMask_)},set:function(t){this.flags_=_e(this.flags_,e.isPendingUnobservationMask_,t)}},{key:"diffValue",get:function(){return me(this.flags_,e.diffValueMask_)?1:0},set:function(t){this.flags_=_e(this.flags_,e.diffValueMask_,1===t)}}])}();Ot.isComputingMask_=1,Ot.isRunningSetterMask_=2,Ot.isBeingObservedMask_=4,Ot.isPendingUnobservationMask_=8,Ot.diffValueMask_=16;var Lt,Dt,Ft=le("ComputedValue",Ot);!function(e){e[e.NOT_TRACKING_=-1]="NOT_TRACKING_",e[e.UP_TO_DATE_=0]="UP_TO_DATE_",e[e.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",e[e.STALE_=2]="STALE_"}(Lt||(Lt={})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.BREAK=2]="BREAK"}(Dt||(Dt={}));var Nt=function(e){this.cause=void 0,this.cause=e};function Bt(e){return e instanceof Nt}function zt(e){switch(e.dependenciesState_){case Lt.UP_TO_DATE_:return!1;case Lt.NOT_TRACKING_:case Lt.STALE_:return!0;case Lt.POSSIBLY_STALE_:for(var t=Wt(!0),n=$t(),i=e.observing_,r=i.length,o=0;o<r;o++){var s=i[o];if(Ft(s)){if(Kt.disableErrorBoundaries)s.get();else try{s.get()}catch(e){return Gt(n),Ht(t),!0}if(e.dependenciesState_===Lt.STALE_)return Gt(n),Ht(t),!0}}return Zt(e),Gt(n),Ht(t),!1}}function jt(e,t,n){var i=Wt(!0);Zt(e),e.newObserving_=new Array(0===e.runId_?100:e.observing_.length),e.unboundDepsCount_=0,e.runId_=++Kt.runId;var r,o=Kt.trackingDerivation;if(Kt.trackingDerivation=e,Kt.inBatch++,!0===Kt.disableErrorBoundaries)r=t.call(n);else try{r=t.call(n)}catch(e){r=new Nt(e)}return Kt.inBatch--,Kt.trackingDerivation=o,function(e){for(var t=e.observing_,n=e.observing_=e.newObserving_,i=Lt.UP_TO_DATE_,r=0,o=e.unboundDepsCount_,s=0;s<o;s++){var a=n[s];0===a.diffValue&&(a.diffValue=1,r!==s&&(n[r]=a),r++),a.dependenciesState_>i&&(i=a.dependenciesState_)}for(n.length=r,e.newObserving_=null,o=t.length;o--;){var l=t[o];0===l.diffValue&&Jt(l,e),l.diffValue=0}for(;r--;){var c=n[r];1===c.diffValue&&(c.diffValue=0,h=e,(u=c).observers_.add(h),u.lowestObserverState_>h.dependenciesState_&&(u.lowestObserverState_=h.dependenciesState_))}var u,h;i!==Lt.UP_TO_DATE_&&(e.dependenciesState_=i,e.onBecomeStale_())}(e),Ht(i),r}function Ut(e){var t=e.observing_;e.observing_=[];for(var n=t.length;n--;)Jt(t[n],e);e.dependenciesState_=Lt.NOT_TRACKING_}function Vt(e){var t=$t();try{return e()}finally{Gt(t)}}function $t(){var e=Kt.trackingDerivation;return Kt.trackingDerivation=null,e}function Gt(e){Kt.trackingDerivation=e}function Wt(e){var t=Kt.allowStateReads;return Kt.allowStateReads=e,t}function Ht(e){Kt.allowStateReads=e}function Zt(e){if(e.dependenciesState_!==Lt.UP_TO_DATE_){e.dependenciesState_=Lt.UP_TO_DATE_;for(var t=e.observing_,n=t.length;n--;)t[n].lowestObserverState_=Lt.UP_TO_DATE_}}var qt=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},Xt=!0,Yt=!1,Kt=function(){var e=$();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(Xt=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new qt).version&&(Xt=!1),Xt?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new qt):(setTimeout((function(){Yt||U(35)}),1),new qt)}();function Jt(e,t){e.observers_.delete(t),0===e.observers_.size&&Qt(e)}function Qt(e){!1===e.isPendingUnobservation&&(e.isPendingUnobservation=!0,Kt.pendingUnobservations.push(e))}function en(){Kt.inBatch++}function tn(){if(0===--Kt.inBatch){ln();for(var e=Kt.pendingUnobservations,t=0;t<e.length;t++){var n=e[t];n.isPendingUnobservation=!1,0===n.observers_.size&&(n.isBeingObserved&&(n.isBeingObserved=!1,n.onBUO()),n instanceof Ot&&n.suspend_())}Kt.pendingUnobservations=[]}}function nn(e){var t=Kt.trackingDerivation;return null!==t?(t.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=t.runId_,t.newObserving_[t.unboundDepsCount_++]=e,!e.isBeingObserved&&Kt.trackingContext&&(e.isBeingObserved=!0,e.onBO())),e.isBeingObserved):(0===e.observers_.size&&Kt.inBatch>0&&Qt(e),!1)}function rn(e){e.lowestObserverState_!==Lt.STALE_&&(e.lowestObserverState_=Lt.STALE_,e.observers_.forEach((function(e){e.dependenciesState_===Lt.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=Lt.STALE_})))}var on=function(){function e(e,t,n,i){void 0===e&&(e="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=Lt.NOT_TRACKING_,this.runId_=0,this.unboundDepsCount_=0,this.flags_=0,this.isTracing_=Dt.NONE,this.name_=e,this.onInvalidate_=t,this.errorHandler_=n,this.requiresObservable_=i}var t=e.prototype;return t.onBecomeStale_=function(){this.schedule_()},t.schedule_=function(){this.isScheduled||(this.isScheduled=!0,Kt.pendingReactions.push(this),ln())},t.runReaction_=function(){if(!this.isDisposed){en(),this.isScheduled=!1;var e=Kt.trackingContext;if(Kt.trackingContext=this,zt(this)){this.isTrackPending=!0;try{this.onInvalidate_()}catch(e){this.reportExceptionInDerivation_(e)}}Kt.trackingContext=e,tn()}},t.track=function(e){if(!this.isDisposed){en(),this.isRunning=!0;var t=Kt.trackingContext;Kt.trackingContext=this;var n=jt(this,e,void 0);Kt.trackingContext=t,this.isRunning=!1,this.isTrackPending=!1,this.isDisposed&&Ut(this),Bt(n)&&this.reportExceptionInDerivation_(n.cause),tn()}},t.reportExceptionInDerivation_=function(e){var t=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(Kt.disableErrorBoundaries)throw e;var n="[mobx] uncaught error in '"+this+"'";Kt.suppressReactionErrors||console.error(n,e),Kt.globalReactionErrorHandlers.forEach((function(n){return n(e,t)}))}},t.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.isRunning||(en(),Ut(this),tn()))},t.getDisposer_=function(e){var t=this,n=function n(){t.dispose(),null==e||null==e.removeEventListener||e.removeEventListener("abort",n)};return null==e||null==e.addEventListener||e.addEventListener("abort",n),n[Me]=this,n},t.toString=function(){return"Reaction["+this.name_+"]"},t.trace=function(e){void 0===e&&(e=!1)},be(e,[{key:"isDisposed",get:function(){return me(this.flags_,e.isDisposedMask_)},set:function(t){this.flags_=_e(this.flags_,e.isDisposedMask_,t)}},{key:"isScheduled",get:function(){return me(this.flags_,e.isScheduledMask_)},set:function(t){this.flags_=_e(this.flags_,e.isScheduledMask_,t)}},{key:"isTrackPending",get:function(){return me(this.flags_,e.isTrackPendingMask_)},set:function(t){this.flags_=_e(this.flags_,e.isTrackPendingMask_,t)}},{key:"isRunning",get:function(){return me(this.flags_,e.isRunningMask_)},set:function(t){this.flags_=_e(this.flags_,e.isRunningMask_,t)}},{key:"diffValue",get:function(){return me(this.flags_,e.diffValueMask_)?1:0},set:function(t){this.flags_=_e(this.flags_,e.diffValueMask_,1===t)}}])}();on.isDisposedMask_=1,on.isScheduledMask_=2,on.isTrackPendingMask_=4,on.isRunningMask_=8,on.diffValueMask_=16;var sn=100,an=function(e){return e()};function ln(){Kt.inBatch>0||Kt.isRunningReactions||an(cn)}function cn(){Kt.isRunningReactions=!0;for(var e=Kt.pendingReactions,t=0;e.length>0;){++t===sn&&(console.error("[mobx] cycle in reaction: "+e[0]),e.splice(0));for(var n=e.splice(0),i=0,r=n.length;i<r;i++)n[i].runReaction_()}Kt.isRunningReactions=!1}var un=le("Reaction",on),hn="action",dn="autoAction",pn=Be(hn),fn=Be("action.bound",{bound:!0}),gn=Be(dn,{autoAction:!0}),mn=Be("autoAction.bound",{autoAction:!0,bound:!0});function _n(e){return function(t,n){return te(t)?It(t.name||"<unnamed action>",t,e):te(n)?It(t,n,e):Ie(n)?(e?gn:pn).decorate_20223_(t,n):ne(n)?Pe(t,n,e?gn:pn):ne(t)?Ae(Be(e?dn:hn,{name:t,autoAction:e})):void 0}}var yn=_n(!1);Object.assign(yn,pn);var vn=_n(!0);function bn(e){return te(e)&&!0===e.isMobxAction}Object.assign(vn,gn),yn.bound=Ae(fn),vn.bound=Ae(mn);var xn=function(e){return e()};var wn="onBO",En="onBUO";function Sn(e,t,n){return Tn(En,e,t,n)}function Tn(e,t,n,i){var r="function"==typeof i?Fi(t,n):Fi(t),o=te(i)?i:n,s=e+"L";return r[s]?r[s].add(o):r[s]=new Set([o]),function(){var e=r[s];e&&(e.delete(o),0===e.size&&delete r[s])}}var Cn="always";function An(e){!0===e.isolateGlobalState&&function(){if((Kt.pendingReactions.length||Kt.inBatch||Kt.isRunningReactions)&&U(36),Yt=!0,Xt){var e=$();0===--e.__mobxInstanceCount&&(e.__mobxGlobals=void 0),Kt=new qt}}();var t,n,i=e.useProxies,r=e.enforceActions;if(void 0!==i&&(Kt.useProxies=i===Cn||"never"!==i&&"undefined"!=typeof Proxy),"ifavailable"===i&&(Kt.verifyProxies=!0),void 0!==r){var o=r===Cn?Cn:"observed"===r;Kt.enforceActions=o,Kt.allowStateChanges=!0!==o&&o!==Cn}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach((function(t){t in e&&(Kt[t]=!!e[t])})),Kt.allowStateReads=!Kt.observableRequiresReaction,e.reactionScheduler&&(t=e.reactionScheduler,n=an,an=function(e){return t((function(){return n(e)}))})}function Pn(e,t,n,i){var r=ge(t);return zi((function(){var t=bi(e,i)[Me];de(r).forEach((function(e){t.extend_(e,r[e],!n||!(e in n)||n[e])}))})),e}function In(e){var t,n={name:e.name_};return e.observing_&&e.observing_.length>0&&(n.dependencies=(t=e.observing_,Array.from(new Set(t))).map(In)),n}var Mn=0;function Rn(){this.message="FLOW_CANCELLED"}Rn.prototype=Object.create(Error.prototype);var kn=$e("flow"),On=$e("flow.bound",{bound:!0}),Ln=Object.assign((function(e,t){if(Ie(t))return kn.decorate_20223_(e,t);if(ne(t))return Pe(e,t,kn);var n=e,i=n.name||"<unnamed flow>",r=function(){var e,t=arguments,r=++Mn,o=yn(i+" - runid: "+r+" - init",n).apply(this,t),s=void 0,a=new Promise((function(t,n){var a=0;function l(e){var t;s=void 0;try{t=yn(i+" - runid: "+r+" - yield "+a++,o.next).call(o,e)}catch(e){return n(e)}u(t)}function c(e){var t;s=void 0;try{t=yn(i+" - runid: "+r+" - yield "+a++,o.throw).call(o,e)}catch(e){return n(e)}u(t)}function u(e){if(!te(null==e?void 0:e.then))return e.done?t(e.value):(s=Promise.resolve(e.value)).then(l,c);e.then(u,n)}e=n,l(void 0)}));return a.cancel=yn(i+" - runid: "+r+" - cancel",(function(){try{s&&Dn(s);var t=o.return(void 0),n=Promise.resolve(t.value);n.then(ee,ee),Dn(n),e(new Rn)}catch(t){e(t)}})),a};return r.isMobXFlow=!0,r}),kn);function Dn(e){te(e.cancel)&&e.cancel()}function Fn(e){return!0===(null==e?void 0:e.isMobXFlow)}function Nn(e){return function(e,t){return!!e&&(void 0!==t?!!Ei(e)&&e[Me].values_.has(t):Ei(e)||!!e[Me]||ke(e)||un(e)||Ft(e))}(e)}function Bn(e,t){void 0===t&&(t=void 0),en();try{return e.apply(t)}finally{tn()}}function zn(e){return e[Me]}Ln.bound=Ae(On);var jn={has:function(e,t){return zn(e).has_(t)},get:function(e,t){return zn(e).get_(t)},set:function(e,t,n){var i;return!!ne(t)&&(null==(i=zn(e).set_(t,n,!0))||i)},deleteProperty:function(e,t){var n;return!!ne(t)&&(null==(n=zn(e).delete_(t,!0))||n)},defineProperty:function(e,t,n){var i;return null==(i=zn(e).defineProperty_(t,n))||i},ownKeys:function(e){return zn(e).ownKeys_()},preventExtensions:function(e){U(13)}};function Un(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function Vn(e,t){var n=e.interceptors_||(e.interceptors_=[]);return n.push(t),Q((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function $n(e,t){var n=$t();try{for(var i=[].concat(e.interceptors_||[]),r=0,o=i.length;r<o&&((t=i[r](t))&&!t.type&&U(14),t);r++);return t}finally{Gt(n)}}function Gn(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function Wn(e,t){var n=e.changeListeners_||(e.changeListeners_=[]);return n.push(t),Q((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function Hn(e,t){var n=$t(),i=e.changeListeners_;if(i){for(var r=0,o=(i=i.slice()).length;r<o;r++)i[r](t);Gt(n)}}var Zn=Symbol("mobx-keys");function qn(e,t,n){return re(e)?Pn(e,e,t,n):(zi((function(){var i=bi(e,n)[Me];if(!e[Zn]){var r=Object.getPrototypeOf(e),o=new Set([].concat(de(e),de(r)));o.delete("constructor"),o.delete(Me),se(r,Zn,o)}e[Zn].forEach((function(e){return i.make_(e,!t||!(e in t)||t[e])}))})),e)}var Xn="splice",Yn="update",Kn={get:function(e,t){var n=e[Me];return t===Me?n:"length"===t?n.getArrayLength_():"string"!=typeof t||isNaN(t)?fe(ei,t)?ei[t]:e[t]:n.get_(parseInt(t))},set:function(e,t,n){var i=e[Me];return"length"===t&&i.setArrayLength_(n),"symbol"==typeof t||isNaN(t)?e[t]=n:i.set_(parseInt(t),n),!0},preventExtensions:function(){U(15)}},Jn=function(){function e(e,t,n,i){void 0===e&&(e="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=n,this.legacyMode_=i,this.atom_=new Re(e),this.enhancer_=function(e,n){return t(e,n,"ObservableArray[..]")}}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},t.intercept_=function(e){return Vn(this,e)},t.observe_=function(e,t){return void 0===t&&(t=!1),t&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),Wn(this,e)},t.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},t.setArrayLength_=function(e){("number"!=typeof e||isNaN(e)||e<0)&&U("Out of range: "+e);var t=this.values_.length;if(e!==t)if(e>t){for(var n=new Array(e-t),i=0;i<e-t;i++)n[i]=void 0;this.spliceWithArray_(t,0,n)}else this.spliceWithArray_(e,t-e)},t.updateArrayLength_=function(e,t){e!==this.lastKnownLength_&&U(16),this.lastKnownLength_+=t,this.legacyMode_&&t>0&&Li(e+t+1)},t.spliceWithArray_=function(e,t,n){var i=this;this.atom_;var r=this.values_.length;if(void 0===e?e=0:e>r?e=r:e<0&&(e=Math.max(0,r+e)),t=1===arguments.length?r-e:null==t?0:Math.max(0,Math.min(t,r-e)),void 0===n&&(n=q),Un(this)){var o=$n(this,{object:this.proxy_,type:Xn,index:e,removedCount:t,added:n});if(!o)return q;t=o.removedCount,n=o.added}if(n=0===n.length?n:n.map((function(e){return i.enhancer_(e,void 0)})),this.legacyMode_){var s=n.length-t;this.updateArrayLength_(r,s)}var a=this.spliceItemsIntoValues_(e,t,n);return 0===t&&0===n.length||this.notifyArraySplice_(e,n,a),this.dehanceValues_(a)},t.spliceItemsIntoValues_=function(e,t,n){var i;if(n.length<1e4)return(i=this.values_).splice.apply(i,[e,t].concat(n));var r=this.values_.slice(e,e+t),o=this.values_.slice(e+t);this.values_.length+=n.length-t;for(var s=0;s<n.length;s++)this.values_[e+s]=n[s];for(var a=0;a<o.length;a++)this.values_[e+n.length+a]=o[a];return r},t.notifyArrayChildUpdate_=function(e,t,n){var i=!this.owned_&&!1,r=Gn(this),o=r||i?{observableKind:"array",object:this.proxy_,type:Yn,debugObjectName:this.atom_.name_,index:e,newValue:t,oldValue:n}:null;this.atom_.reportChanged(),r&&Hn(this,o)},t.notifyArraySplice_=function(e,t,n){var i=!this.owned_&&!1,r=Gn(this),o=r||i?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:Xn,index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom_.reportChanged(),r&&Hn(this,o)},t.get_=function(e){if(!(this.legacyMode_&&e>=this.values_.length))return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},t.set_=function(e,t){var n=this.values_;if(this.legacyMode_&&e>n.length&&U(17,e,n.length),e<n.length){this.atom_;var i=n[e];if(Un(this)){var r=$n(this,{type:Yn,object:this.proxy_,index:e,newValue:t});if(!r)return;t=r.newValue}(t=this.enhancer_(t,i))!==i&&(n[e]=t,this.notifyArrayChildUpdate_(e,t,i))}else{for(var o=new Array(e+1-n.length),s=0;s<o.length-1;s++)o[s]=void 0;o[o.length-1]=t,this.spliceWithArray_(n.length,0,o)}},e}();function Qn(e,t,n,i){return void 0===n&&(n="ObservableArray"),void 0===i&&(i=!1),J(),zi((function(){var r=new Jn(n,t,i,!1);ae(r.values_,Me,r);var o=new Proxy(r.values_,Kn);return r.proxy_=o,e&&e.length&&r.spliceWithArray_(0,0,e),o}))}var ei={clear:function(){return this.splice(0)},replace:function(e){var t=this[Me];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=this[Me];switch(arguments.length){case 0:return[];case 1:return o.spliceWithArray_(e);case 2:return o.spliceWithArray_(e,t)}return o.spliceWithArray_(e,t,i)},spliceWithArray:function(e,t,n){return this[Me].spliceWithArray_(e,t,n)},push:function(){for(var e=this[Me],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[Me].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[Me],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return Kt.trackingDerivation&&U(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){Kt.trackingDerivation&&U(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[Me],n=t.dehanceValues_(t.values_).indexOf(e);return n>-1&&(this.splice(n,1),!0)}};function ti(e,t){"function"==typeof Array.prototype[e]&&(ei[e]=t(e))}function ni(e){return function(){var t=this[Me];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_);return n[e].apply(n,arguments)}}function ii(e){return function(t,n){var i=this,r=this[Me];return r.atom_.reportObserved(),r.dehanceValues_(r.values_)[e]((function(e,r){return t.call(n,e,r,i)}))}}function ri(e){return function(){var t=this,n=this[Me];n.atom_.reportObserved();var i=n.dehanceValues_(n.values_),r=arguments[0];return arguments[0]=function(e,n,i){return r(e,n,i,t)},i[e].apply(i,arguments)}}ti("at",ni),ti("concat",ni),ti("flat",ni),ti("includes",ni),ti("indexOf",ni),ti("join",ni),ti("lastIndexOf",ni),ti("slice",ni),ti("toString",ni),ti("toLocaleString",ni),ti("toSorted",ni),ti("toSpliced",ni),ti("with",ni),ti("every",ii),ti("filter",ii),ti("find",ii),ti("findIndex",ii),ti("findLast",ii),ti("findLastIndex",ii),ti("flatMap",ii),ti("forEach",ii),ti("map",ii),ti("some",ii),ti("toReversed",ii),ti("reduce",ri),ti("reduceRight",ri);var oi=le("ObservableArrayAdministration",Jn);function si(e){return ie(e)&&oi(e[Me])}var ai={},li="add",ci="delete",ui=function(){function e(e,t,n){var i=this;void 0===t&&(t=De),void 0===n&&(n="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[Me]=ai,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=t,this.name_=n,te(Map)||U(18),zi((function(){i.keysAtom_=Oe("ObservableMap.keys()"),i.data_=new Map,i.hasMap_=new Map,e&&i.merge(e)}))}var t=e.prototype;return t.has_=function(e){return this.data_.has(e)},t.has=function(e){var t=this;if(!Kt.trackingDerivation)return this.has_(e);var n=this.hasMap_.get(e);if(!n){var i=n=new kt(this.has_(e),Fe,"ObservableMap.key?",!1);this.hasMap_.set(e,i),Sn(i,(function(){return t.hasMap_.delete(e)}))}return n.get()},t.set=function(e,t){var n=this.has_(e);if(Un(this)){var i=$n(this,{type:n?Yn:li,object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return n?this.updateValue_(e,t):this.addValue_(e,t),this},t.delete=function(e){var t=this;if(this.keysAtom_,Un(this)&&!$n(this,{type:ci,object:this,name:e}))return!1;if(this.has_(e)){var n=Gn(this),i=n?{observableKind:"map",debugObjectName:this.name_,type:ci,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return Bn((function(){var n;t.keysAtom_.reportChanged(),null==(n=t.hasMap_.get(e))||n.setNewValue_(!1),t.data_.get(e).setNewValue_(void 0),t.data_.delete(e)})),n&&Hn(this,i),!0}return!1},t.updateValue_=function(e,t){var n=this.data_.get(e);if((t=n.prepareNewValue_(t))!==Kt.UNCHANGED){var i=Gn(this),r=i?{observableKind:"map",debugObjectName:this.name_,type:Yn,object:this,oldValue:n.value_,name:e,newValue:t}:null;n.setNewValue_(t),i&&Hn(this,r)}},t.addValue_=function(e,t){var n=this;this.keysAtom_,Bn((function(){var i,r=new kt(t,n.enhancer_,"ObservableMap.key",!1);n.data_.set(e,r),t=r.value_,null==(i=n.hasMap_.get(e))||i.setNewValue_(!0),n.keysAtom_.reportChanged()}));var i=Gn(this),r=i?{observableKind:"map",debugObjectName:this.name_,type:li,object:this,name:e,newValue:t}:null;i&&Hn(this,r)},t.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},t.values=function(){var e=this,t=this.keys();return di({next:function(){var n=t.next(),i=n.done,r=n.value;return{done:i,value:i?void 0:e.get(r)}}})},t.entries=function(){var e=this,t=this.keys();return di({next:function(){var n=t.next(),i=n.done,r=n.value;return{done:i,value:i?void 0:[r,e.get(r)]}}})},t[Symbol.iterator]=function(){return this.entries()},t.forEach=function(e,t){for(var n,i=xe(this);!(n=i()).done;){var r=n.value,o=r[0],s=r[1];e.call(t,s,o,this)}},t.merge=function(e){var t=this;return hi(e)&&(e=new Map(e)),Bn((function(){var n,i,r;re(e)?function(e){var t=Object.keys(e);if(!he)return t;var n=Object.getOwnPropertySymbols(e);return n.length?[].concat(t,n.filter((function(t){return Z.propertyIsEnumerable.call(e,t)}))):t}(e).forEach((function(n){return t.set(n,e[n])})):Array.isArray(e)?e.forEach((function(e){var n=e[0],i=e[1];return t.set(n,i)})):ce(e)?(n=e,i=Object.getPrototypeOf(n),r=Object.getPrototypeOf(i),null!==Object.getPrototypeOf(r)&&U(19,e),e.forEach((function(e,n){return t.set(n,e)}))):null!=e&&U(20,e)})),this},t.clear=function(){var e=this;Bn((function(){Vt((function(){for(var t,n=xe(e.keys());!(t=n()).done;){var i=t.value;e.delete(i)}}))}))},t.replace=function(e){var t=this;return Bn((function(){for(var n,i=function(e){if(ce(e)||hi(e))return e;if(Array.isArray(e))return new Map(e);if(re(e)){var t=new Map;for(var n in e)t.set(n,e[n]);return t}return U(21,e)}(e),r=new Map,o=!1,s=xe(t.data_.keys());!(n=s()).done;){var a=n.value;if(!i.has(a))if(t.delete(a))o=!0;else{var l=t.data_.get(a);r.set(a,l)}}for(var c,u=xe(i.entries());!(c=u()).done;){var h=c.value,d=h[0],p=h[1],f=t.data_.has(d);if(t.set(d,p),t.data_.has(d)){var g=t.data_.get(d);r.set(d,g),f||(o=!0)}}if(!o)if(t.data_.size!==r.size)t.keysAtom_.reportChanged();else for(var m=t.data_.keys(),_=r.keys(),y=m.next(),v=_.next();!y.done;){if(y.value!==v.value){t.keysAtom_.reportChanged();break}y=m.next(),v=_.next()}t.data_=r})),this},t.toString=function(){return"[object ObservableMap]"},t.toJSON=function(){return Array.from(this)},t.observe_=function(e,t){return Wn(this,e)},t.intercept_=function(e){return Vn(this,e)},be(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Map"}}])}(),hi=le("ObservableMap",ui);function di(e){return e[Symbol.toStringTag]="MapIterator",Hi(e)}var pi={},fi=function(){function e(e,t,n){var i=this;void 0===t&&(t=De),void 0===n&&(n="ObservableSet"),this.name_=void 0,this[Me]=pi,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=n,te(Set)||U(22),this.enhancer_=function(e,i){return t(e,i,n)},zi((function(){i.atom_=Oe(i.name_),e&&i.replace(e)}))}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.clear=function(){var e=this;Bn((function(){Vt((function(){for(var t,n=xe(e.data_.values());!(t=n()).done;){var i=t.value;e.delete(i)}}))}))},t.forEach=function(e,t){for(var n,i=xe(this);!(n=i()).done;){var r=n.value;e.call(t,r,r,this)}},t.add=function(e){var t=this;if(this.atom_,Un(this)){var n=$n(this,{type:li,object:this,newValue:e});if(!n)return this;e=n.newValue}if(!this.has(e)){Bn((function(){t.data_.add(t.enhancer_(e,void 0)),t.atom_.reportChanged()}));var i=Gn(this),r=i?{observableKind:"set",debugObjectName:this.name_,type:li,object:this,newValue:e}:null;i&&Hn(this,r)}return this},t.delete=function(e){var t=this;if(Un(this)&&!$n(this,{type:ci,object:this,oldValue:e}))return!1;if(this.has(e)){var n=Gn(this),i=n?{observableKind:"set",debugObjectName:this.name_,type:ci,object:this,oldValue:e}:null;return Bn((function(){t.atom_.reportChanged(),t.data_.delete(e)})),n&&Hn(this,i),!0}return!1},t.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},t.entries=function(){var e=this.values();return mi({next:function(){var t=e.next(),n=t.value,i=t.done;return i?{value:void 0,done:i}:{value:[n,n],done:i}}})},t.keys=function(){return this.values()},t.values=function(){this.atom_.reportObserved();var e=this,t=this.data_.values();return mi({next:function(){var n=t.next(),i=n.value,r=n.done;return r?{value:void 0,done:r}:{value:e.dehanceValue_(i),done:r}}})},t.intersection=function(e){return ue(e)&&!gi(e)?e.intersection(this):new Set(this).intersection(e)},t.union=function(e){return ue(e)&&!gi(e)?e.union(this):new Set(this).union(e)},t.difference=function(e){return new Set(this).difference(e)},t.symmetricDifference=function(e){return ue(e)&&!gi(e)?e.symmetricDifference(this):new Set(this).symmetricDifference(e)},t.isSubsetOf=function(e){return new Set(this).isSubsetOf(e)},t.isSupersetOf=function(e){return new Set(this).isSupersetOf(e)},t.isDisjointFrom=function(e){return ue(e)&&!gi(e)?e.isDisjointFrom(this):new Set(this).isDisjointFrom(e)},t.replace=function(e){var t=this;return gi(e)&&(e=new Set(e)),Bn((function(){Array.isArray(e)||ue(e)?(t.clear(),e.forEach((function(e){return t.add(e)}))):null!=e&&U("Cannot initialize set from "+e)})),this},t.observe_=function(e,t){return Wn(this,e)},t.intercept_=function(e){return Vn(this,e)},t.toJSON=function(){return Array.from(this)},t.toString=function(){return"[object ObservableSet]"},t[Symbol.iterator]=function(){return this.values()},be(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Set"}}])}(),gi=le("ObservableSet",fi);function mi(e){return e[Symbol.toStringTag]="SetIterator",Hi(e)}var _i=Object.create(null),yi="remove",vi=function(){function e(e,t,n,i){void 0===t&&(t=new Map),void 0===i&&(i=it),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=t,this.name_=n,this.defaultAnnotation_=i,this.keysAtom_=new Re("ObservableObject.keys"),this.isPlainObject_=re(this.target_)}var t=e.prototype;return t.getObservablePropValue_=function(e){return this.values_.get(e).get()},t.setObservablePropValue_=function(e,t){var n=this.values_.get(e);if(n instanceof Ot)return n.set(t),!0;if(Un(this)){var i=$n(this,{type:Yn,object:this.proxy_||this.target_,name:e,newValue:t});if(!i)return null;t=i.newValue}if((t=n.prepareNewValue_(t))!==Kt.UNCHANGED){var r=Gn(this),o=r?{type:Yn,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:n.value_,name:e,newValue:t}:null;n.setNewValue_(t),r&&Hn(this,o)}return!0},t.get_=function(e){return Kt.trackingDerivation&&!fe(this.target_,e)&&this.has_(e),this.target_[e]},t.set_=function(e,t,n){return void 0===n&&(n=!1),fe(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,t):n?Reflect.set(this.target_,e,t):(this.target_[e]=t,!0):this.extend_(e,{value:t,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,n)},t.has_=function(e){if(!Kt.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var t=this.pendingKeys_.get(e);return t||(t=new kt(e in this.target_,Fe,"ObservableObject.key?",!1),this.pendingKeys_.set(e,t)),t.get()},t.make_=function(e,t){if(!0===t&&(t=this.defaultAnnotation_),!1!==t){if(!(e in this.target_)){var n;if(null!=(n=this.target_[Ce])&&n[e])return;U(1,t.annotationType_,this.name_+"."+e.toString())}for(var i=this.target_;i&&i!==Z;){var r=W(i,e);if(r){var o=t.make_(this,e,r,i);if(0===o)return;if(1===o)break}i=Object.getPrototypeOf(i)}Si(this,0,e)}},t.extend_=function(e,t,n,i){if(void 0===i&&(i=!1),!0===n&&(n=this.defaultAnnotation_),!1===n)return this.defineProperty_(e,t,i);var r=n.extend_(this,e,t,i);return r&&Si(this,0,e),r},t.defineProperty_=function(e,t,n){void 0===n&&(n=!1),this.keysAtom_;try{en();var i=this.delete_(e);if(!i)return i;if(Un(this)){var r=$n(this,{object:this.proxy_||this.target_,name:e,type:li,newValue:t.value});if(!r)return null;var o=r.newValue;t.value!==o&&(t=we({},t,{value:o}))}if(n){if(!Reflect.defineProperty(this.target_,e,t))return!1}else H(this.target_,e,t);this.notifyPropertyAddition_(e,t.value)}finally{tn()}return!0},t.defineObservableProperty_=function(e,t,n,i){void 0===i&&(i=!1),this.keysAtom_;try{en();var r=this.delete_(e);if(!r)return r;if(Un(this)){var o=$n(this,{object:this.proxy_||this.target_,name:e,type:li,newValue:t});if(!o)return null;t=o.newValue}var s=wi(e),a={configurable:!Kt.safeDescriptors||this.isPlainObject_,enumerable:!0,get:s.get,set:s.set};if(i){if(!Reflect.defineProperty(this.target_,e,a))return!1}else H(this.target_,e,a);var l=new kt(t,n,"ObservableObject.key",!1);this.values_.set(e,l),this.notifyPropertyAddition_(e,l.value_)}finally{tn()}return!0},t.defineComputedProperty_=function(e,t,n){void 0===n&&(n=!1),this.keysAtom_;try{en();var i=this.delete_(e);if(!i)return i;if(Un(this)&&!$n(this,{object:this.proxy_||this.target_,name:e,type:li,newValue:void 0}))return null;t.name||(t.name="ObservableObject.key"),t.context=this.proxy_||this.target_;var r=wi(e),o={configurable:!Kt.safeDescriptors||this.isPlainObject_,enumerable:!1,get:r.get,set:r.set};if(n){if(!Reflect.defineProperty(this.target_,e,o))return!1}else H(this.target_,e,o);this.values_.set(e,new Ot(t)),this.notifyPropertyAddition_(e,void 0)}finally{tn()}return!0},t.delete_=function(e,t){if(void 0===t&&(t=!1),this.keysAtom_,!fe(this.target_,e))return!0;if(Un(this)&&!$n(this,{object:this.proxy_||this.target_,name:e,type:yi}))return null;try{var n;en();var i,r=Gn(this),o=this.values_.get(e),s=void 0;if(!o&&r&&(s=null==(i=W(this.target_,e))?void 0:i.value),t){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(o&&(this.values_.delete(e),o instanceof kt&&(s=o.value_),rn(o)),this.keysAtom_.reportChanged(),null==(n=this.pendingKeys_)||null==(n=n.get(e))||n.set(e in this.target_),r){var a={type:yi,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:s,name:e};r&&Hn(this,a)}}finally{tn()}return!0},t.observe_=function(e,t){return Wn(this,e)},t.intercept_=function(e){return Vn(this,e)},t.notifyPropertyAddition_=function(e,t){var n,i=Gn(this);if(i){var r=i?{type:li,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:t}:null;i&&Hn(this,r)}null==(n=this.pendingKeys_)||null==(n=n.get(e))||n.set(!0),this.keysAtom_.reportChanged()},t.ownKeys_=function(){return this.keysAtom_.reportObserved(),de(this.target_)},t.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function bi(e,t){var n;if(fe(e,Me))return e;var i=null!=(n=null==t?void 0:t.name)?n:"ObservableObject",r=new vi(e,new Map,String(i),function(e){var t;return e?null!=(t=e.defaultDecorator)?t:rt(e):void 0}(t));return se(e,Me,r),e}var xi=le("ObservableObjectAdministration",vi);function wi(e){return _i[e]||(_i[e]={get:function(){return this[Me].getObservablePropValue_(e)},set:function(t){return this[Me].setObservablePropValue_(e,t)}})}function Ei(e){return!!ie(e)&&xi(e[Me])}function Si(e,t,n){var i;null==(i=e.target_[Ce])||delete i[n]}var Ti,Ci,Ai=ki(0),Pi=function(){var e=!1,t={};return Object.defineProperty(t,"0",{set:function(){e=!0}}),Object.create(t)[0]=1,!1===e}(),Ii=0,Mi=function(){};Ti=Mi,Ci=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(Ti.prototype,Ci):void 0!==Ti.prototype.__proto__?Ti.prototype.__proto__=Ci:Ti.prototype=Ci;var Ri=function(e){function t(t,n,i,r){var o;return void 0===i&&(i="ObservableArray"),void 0===r&&(r=!1),o=e.call(this)||this,zi((function(){var e=new Jn(i,n,r,!0);e.proxy_=o,ae(o,Me,e),t&&t.length&&o.spliceWithArray(0,0,t),Pi&&Object.defineProperty(o,"0",Ai)})),o}Ee(t,e);var n=t.prototype;return n.concat=function(){this[Me].atom_.reportObserved();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.prototype.concat.apply(this.slice(),t.map((function(e){return si(e)?e.slice():e})))},n[Symbol.iterator]=function(){var e=this,t=0;return Hi({next:function(){return t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}})},be(t,[{key:"length",get:function(){return this[Me].getArrayLength_()},set:function(e){this[Me].setArrayLength_(e)}},{key:Symbol.toStringTag,get:function(){return"Array"}}])}(Mi);function ki(e){return{enumerable:!1,configurable:!0,get:function(){return this[Me].get_(e)},set:function(t){this[Me].set_(e,t)}}}function Oi(e){H(Ri.prototype,""+e,ki(e))}function Li(e){if(e>Ii){for(var t=Ii;t<e+100;t++)Oi(t);Ii=e}}function Di(e,t,n){return new Ri(e,t,n)}function Fi(e,t){if("object"==typeof e&&null!==e){if(si(e))return void 0!==t&&U(23),e[Me].atom_;if(gi(e))return e.atom_;if(hi(e)){if(void 0===t)return e.keysAtom_;var n=e.data_.get(t)||e.hasMap_.get(t);return n||U(25,t,Bi(e)),n}if(Ei(e)){if(!t)return U(26);var i=e[Me].values_.get(t);return i||U(27,t,Bi(e)),i}if(ke(e)||Ft(e)||un(e))return e}else if(te(e)&&un(e[Me]))return e[Me];U(28)}function Ni(e,t){return e||U(29),void 0!==t?Ni(Fi(e,t)):ke(e)||Ft(e)||un(e)||hi(e)||gi(e)?e:e[Me]?e[Me]:void U(24,e)}function Bi(e,t){var n;if(void 0!==t)n=Fi(e,t);else{if(bn(e))return e.name;n=Ei(e)||hi(e)||gi(e)?Ni(e):Fi(e)}return n.name_}function zi(e){var t=$t(),n=Mt(!0);en();try{return e()}finally{tn(),Rt(n),Gt(t)}}Object.entries(ei).forEach((function(e){var t=e[0],n=e[1];"concat"!==t&&se(Ri.prototype,t,n)})),Li(1e3);var ji,Ui=Z.toString;function Vi(e,t,n){return void 0===n&&(n=-1),$i(e,t,n)}function $i(e,t,n,i,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;if("function"!==o&&"object"!==o&&"object"!=typeof t)return!1;var s=Ui.call(e);if(s!==Ui.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0===+e?1/+e==1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":n>=0&&n++}e=Gi(e),t=Gi(t);var a="[object Array]"===s;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var l=e.constructor,c=t.constructor;if(l!==c&&!(te(l)&&l instanceof l&&te(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}if(0===n)return!1;n<0&&(n=-1),r=r||[];for(var u=(i=i||[]).length;u--;)if(i[u]===e)return r[u]===t;if(i.push(e),r.push(t),a){if((u=e.length)!==t.length)return!1;for(;u--;)if(!$i(e[u],t[u],n-1,i,r))return!1}else{var h=Object.keys(e),d=h.length;if(Object.keys(t).length!==d)return!1;for(var p=0;p<d;p++){var f=h[p];if(!fe(t,f)||!$i(e[f],t[f],n-1,i,r))return!1}}return i.pop(),r.pop(),!0}function Gi(e){return si(e)?e.slice():ce(e)||hi(e)||ue(e)||gi(e)?Array.from(e.entries()):e}var Wi=(null==(ji=$().Iterator)?void 0:ji.prototype)||{};function Hi(e){return e[Symbol.iterator]=Zi,Object.assign(Object.create(Wi),e)}function Zi(){return this}function qi(e){var t=e[0],n=e[1];return[n[0]-t[0],n[1]-t[1]]}function Xi(e,t){return e[0]*t[1]-t[0]*e[1]}function Yi(e,t,n){var i=[],r=function(e,t){return c(function(e,t="kilometers"){const n=a[t];if(!n)throw new Error(t+" units is invalid");return e/n}(e,t))}(t,n),o=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(e),s=[];return o.forEach((function(e,t){if(t!==o.length-1){var n=function(e,t,n){var i=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),r=e[0]+n*(t[1]-e[1])/i,o=t[0]+n*(t[1]-e[1])/i;return[[r,e[1]+n*(e[0]-t[0])/i],[o,t[1]+n*(e[0]-t[0])/i]]}(e,o[t+1],r);if(i.push(n),t>0){var a=i[t-1],l=function(e,t){return!function(e,t){return 0===Xi(qi(e),qi(t))}(e,t)&&function(e,t){var n,i,r=e[0],o=qi(e),s=t[0],a=qi(t),l=Xi(o,a),c=function(e,t){return[e[0]+t[0],e[1]+t[1]]}(r,function(e,t){return[e*t[0],e*t[1]]}(Xi((i=r,[(n=s)[0]-i[0],n[1]-i[1]]),a)/l,o));return c}(e,t)}(n,a);!1!==l&&(a[1]=l,n[0]=l),s.push(a[0]),t===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}})),function(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return l({type:"LineString",coordinates:e},t,n)}(s,e.properties)}["Symbol","Map","Set"].forEach((function(e){void 0===$()[e]&&U("MobX requires global '"+e+"' to be available or polyfilled")})),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:function(e){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}},extras:{getDebugName:Bi},$mobx:Me});var Ki=function(e,t,n){if(null===(i=n=n||{})||"object"!=typeof i||Array.isArray(i))throw new Error("options is invalid");var i,r=n.units;if(!e)throw new Error("geojson is required");if(null==t||isNaN(t))throw new Error("distance is required");var o=function(e){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}(e),s=e.properties;switch(o){case"LineString":return Yi(e,t,r);case"MultiLineString":var a=[];return _(e,(function(e){a.push(Yi(e,t,r).geometry.coordinates)})),function(e,t,n={}){return l({type:"MultiLineString",coordinates:e},t,n)}(a,s);default:throw new Error("geometry "+o+" is not supported")}},Ji=d(2794),Qi=d.n(Ji);function er(e,t){return e.map((e=>function(e,t){if("string"==typeof e){const n=null==t?void 0:t.get(e),i=null==n?void 0:n.geometry;return(null==i?void 0:i.coordinates)||null}return Array.isArray(e)?e:null}(e.item,t))).filter((e=>e))}function tr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nr(t,n){if(n.every((e=>{const n=e.name;return t.hasOwnProperty(n)}))){if(n.every((n=>{const i=n.name;let r=[];r=n.type===e.FieldType.number?n.value.split(",").map((e=>parseInt(e,10))):n.value.split(",").map((e=>e.trim()));const o=t[i];return r.includes(o)})))return n.length}return-1}const ir=(e,t)=>t.map((t=>{return n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){tr(e,t,n[t])}))}return e}({},t),i=null!=(i={overrides:nr(e,t.overrides)})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})),n;var n,i})).filter((e=>-1!==e.overrides));function rr(e,t,n=[],i="rgba(154, 205, 50)",r=1,o="fixed color"){const s=ir(e,n).sort(((e,t)=>e.value===t.value?e.overrides-t.overrides:e.value-t.value));let a=i,l=r,c="unknown",u=-1;if(null==t)return{color:i,lineWidth:r,label:o};const h=s.length;if(0===h)return{color:i,lineWidth:r,label:o};for(let e=h-1;e>=0;e--){const n=s[e];if(n.value<=t){u=n.overrides,a=n.color,l=n.lineWidth,c=n.label;break}}return{color:a,lineWidth:l,label:c}}var or,sr,ar,lr,cr,ur,hr,dr,pr,fr,gr,mr={},_r=[],yr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,vr=Array.isArray;function br(e,t){for(var n in t)e[n]=t[n];return e}function xr(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function wr(e,t,n,i,r){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==r?++ar:r,__i:-1,__u:0};return null==r&&null!=sr.vnode&&sr.vnode(o),o}function Er(e){return e.children}function Sr(e,t){this.props=e,this.context=t}function Tr(e,t){if(null==t)return e.__?Tr(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Tr(e):null}function Cr(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return Cr(e)}}function Ar(e){(!e.__d&&(e.__d=!0)&&lr.push(e)&&!Pr.__r++||cr!=sr.debounceRendering)&&((cr=sr.debounceRendering)||ur)(Pr)}function Pr(){for(var e,t,n,i,r,o,s,a=1;lr.length;)lr.length>a&&lr.sort(hr),e=lr.shift(),a=lr.length,e.__d&&(n=void 0,r=(i=(t=e).__v).__e,o=[],s=[],t.__P&&((n=br({},i)).__v=i.__v+1,sr.vnode&&sr.vnode(n),Fr(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[r]:null,o,null==r?Tr(i):r,!!(32&i.__u),s),n.__v=i.__v,n.__.__k[n.__i]=n,Br(o,n,s),n.__e!=r&&Cr(n)));Pr.__r=0}function Ir(e,t,n,i,r,o,s,a,l,c,u){var h,d,p,f,g,m,_=i&&i.__k||_r,y=t.length;for(l=Mr(n,t,_,l,y),h=0;h<y;h++)null!=(p=n.__k[h])&&(d=-1==p.__i?mr:_[p.__i]||mr,p.__i=h,m=Fr(e,p,d,r,o,s,a,l,c,u),f=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&Ur(d.ref,null,p),u.push(p.ref,p.__c||f,p)),null==g&&null!=f&&(g=f),4&p.__u||d.__k===p.__k?l=Rr(p,l,e):"function"==typeof p.type&&void 0!==m?l=m:f&&(l=f.nextSibling),p.__u&=-7);return n.__e=g,l}function Mr(e,t,n,i,r){var o,s,a,l,c,u=n.length,h=u,d=0;for(e.__k=new Array(r),o=0;o<r;o++)null!=(s=t[o])&&"boolean"!=typeof s&&"function"!=typeof s?(l=o+d,(s=e.__k[o]="string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?wr(null,s,null,null,null):vr(s)?wr(Er,{children:s},null,null,null):null==s.constructor&&s.__b>0?wr(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=e,s.__b=e.__b+1,a=null,-1!=(c=s.__i=kr(s,n,l,h))&&(h--,(a=n[c])&&(a.__u|=2)),null==a||null==a.__v?(-1==c&&(r>u?d--:r<u&&d++),"function"!=typeof s.type&&(s.__u|=4)):c!=l&&(c==l-1?d--:c==l+1?d++:(c>l?d--:d++,s.__u|=4))):e.__k[o]=null;if(h)for(o=0;o<u;o++)null!=(a=n[o])&&!(2&a.__u)&&(a.__e==i&&(i=Tr(a)),Vr(a,a));return i}function Rr(e,t,n){var i,r;if("function"==typeof e.type){for(i=e.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=e,t=Rr(i[r],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=Tr(e)),n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function kr(e,t,n,i){var r,o,s,a=e.key,l=e.type,c=t[n],u=null!=c&&!(2&c.__u);if(null===c&&null==e.key||u&&a==c.key&&l==c.type)return n;if(i>(u?1:0))for(r=n-1,o=n+1;r>=0||o<t.length;)if(null!=(c=t[s=r>=0?r--:o++])&&!(2&c.__u)&&a==c.key&&l==c.type)return s;return-1}function Or(e,t,n){"-"==t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||yr.test(t)?n:n+"px"}function Lr(e,t,n,i,r){var o,s;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||Or(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||Or(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])o=t!=(t=t.replace(dr,"$1")),s=t.toLowerCase(),t=s in e||"onFocusOut"==t||"onFocusIn"==t?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=pr,e.addEventListener(t,o?gr:fr,o)):e.removeEventListener(t,o?gr:fr,o);else{if("http://www.w3.org/2000/svg"==r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function Dr(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.t)t.t=pr++;else if(t.t<n.u)return;return n(sr.event?sr.event(t):t)}}}function Fr(e,t,n,i,r,o,s,a,l,c){var u,h,d,p,f,g,m,_,y,v,b,x,w,E,S,T,C,A=t.type;if(null!=t.constructor)return null;128&n.__u&&(l=!!(32&n.__u),o=[a=t.__e=n.__e]),(u=sr.__b)&&u(t);e:if("function"==typeof A)try{if(_=t.props,y="prototype"in A&&A.prototype.render,v=(u=A.contextType)&&i[u.__c],b=u?v?v.props.value:u.__:i,n.__c?m=(h=t.__c=n.__c).__=h.__E:(y?t.__c=h=new A(_,b):(t.__c=h=new Sr(_,b),h.constructor=A,h.render=$r),v&&v.sub(h),h.props=_,h.state||(h.state={}),h.context=b,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),y&&null==h.__s&&(h.__s=h.state),y&&null!=A.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=br({},h.__s)),br(h.__s,A.getDerivedStateFromProps(_,h.__s))),p=h.props,f=h.state,h.__v=t,d)y&&null==A.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),y&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(y&&null==A.getDerivedStateFromProps&&_!==p&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(_,b),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(_,h.__s,b)||t.__v==n.__v){for(t.__v!=n.__v&&(h.props=_,h.state=h.__s,h.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some((function(e){e&&(e.__=t)})),x=0;x<h._sb.length;x++)h.__h.push(h._sb[x]);h._sb=[],h.__h.length&&s.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(_,h.__s,b),y&&null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(p,f,g)}))}if(h.context=b,h.props=_,h.__P=e,h.__e=!1,w=sr.__r,E=0,y){for(h.state=h.__s,h.__d=!1,w&&w(t),u=h.render(h.props,h.state,h.context),S=0;S<h._sb.length;S++)h.__h.push(h._sb[S]);h._sb=[]}else do{h.__d=!1,w&&w(t),u=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++E<25);h.state=h.__s,null!=h.getChildContext&&(i=br(br({},i),h.getChildContext())),y&&!d&&null!=h.getSnapshotBeforeUpdate&&(g=h.getSnapshotBeforeUpdate(p,f)),T=u,null!=u&&u.type===Er&&null==u.key&&(T=zr(u.props.children)),a=Ir(e,vr(T)?T:[T],t,n,i,r,o,s,a,l,c),h.base=t.__e,t.__u&=-161,h.__h.length&&s.push(h),m&&(h.__E=h.__=null)}catch(e){if(t.__v=null,l||null!=o)if(e.then){for(t.__u|=l?160:128;a&&8==a.nodeType&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,t.__e=a}else{for(C=o.length;C--;)xr(o[C]);Nr(t)}else t.__e=n.__e,t.__k=n.__k,e.then||Nr(t);sr.__e(e,t,n)}else null==o&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):a=t.__e=jr(n.__e,t,n,i,r,o,s,l,c);return(u=sr.diffed)&&u(t),128&t.__u?void 0:a}function Nr(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Nr)}function Br(e,t,n){for(var i=0;i<n.length;i++)Ur(n[i],n[++i],n[++i]);sr.__c&&sr.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){sr.__e(e,t.__v)}}))}function zr(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:vr(e)?e.map(zr):br({},e)}function jr(e,t,n,i,r,o,s,a,l){var c,u,h,d,p,f,g,m=n.props,_=t.props,y=t.type;if("svg"==y?r="http://www.w3.org/2000/svg":"math"==y?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),null!=o)for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!y&&(y?p.localName==y:3==p.nodeType)){e=p,o[c]=null;break}if(null==e){if(null==y)return document.createTextNode(_);e=document.createElementNS(r,y,_.is&&_),a&&(sr.__m&&sr.__m(t,o),a=!1),o=null}if(null==y)m===_||a&&e.data==_||(e.data=_);else{if(o=o&&or.call(e.childNodes),m=n.props||mr,!a&&null!=o)for(m={},c=0;c<e.attributes.length;c++)m[(p=e.attributes[c]).name]=p.value;for(c in m)if(p=m[c],"children"==c);else if("dangerouslySetInnerHTML"==c)h=p;else if(!(c in _)){if("value"==c&&"defaultValue"in _||"checked"==c&&"defaultChecked"in _)continue;Lr(e,c,null,p,r)}for(c in _)p=_[c],"children"==c?d=p:"dangerouslySetInnerHTML"==c?u=p:"value"==c?f=p:"checked"==c?g=p:a&&"function"!=typeof p||m[c]===p||Lr(e,c,p,m[c],r);if(u)a||h&&(u.__html==h.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(h&&(e.innerHTML=""),Ir("template"==t.type?e.content:e,vr(d)?d:[d],t,n,i,"foreignObject"==y?"http://www.w3.org/1999/xhtml":r,o,s,o?o[0]:n.__k&&Tr(n,0),a,l),null!=o)for(c=o.length;c--;)xr(o[c]);a||(c="value","progress"==y&&null==f?e.removeAttribute("value"):null!=f&&(f!==e[c]||"progress"==y&&!f||"option"==y&&f!=m[c])&&Lr(e,c,f,m[c],r),c="checked",null!=g&&g!=e[c]&&Lr(e,c,g,m[c],r))}return e}function Ur(e,t,n){try{if("function"==typeof e){var i="function"==typeof e.__u;i&&e.__u(),i&&null==t||(e.__u=e(t))}else e.current=t}catch(e){sr.__e(e,n)}}function Vr(e,t,n){var i,r;if(sr.unmount&&sr.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||Ur(i,null,t)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){sr.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&Vr(i[r],t,n||"function"!=typeof e.type);n||xr(e.__e),e.__c=e.__=e.__e=void 0}function $r(e,t,n){return this.constructor(e,n)}function Gr(e,t,n){var i,r,o,s;t==document&&(t=document.documentElement),sr.__&&sr.__(e,t),r=(i="function"==typeof n)?null:n&&n.__k||t.__k,o=[],s=[],Fr(t,e=(!i&&n||t).__k=function(e,t,n){var i,r,o,s={};for(o in t)"key"==o?i=t[o]:"ref"==o?r=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?or.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===s[o]&&(s[o]=e.defaultProps[o]);return wr(e,s,i,r,null)}(Er,null,[e]),r||mr,mr,t.namespaceURI,!i&&n?[n]:r?null:t.firstChild?or.call(t.childNodes):null,o,!i&&n?n:r?r.__e:t.firstChild,i,s),Br(o,e,s)}or=_r.slice,sr={__e:function(e,t,n,i){for(var r,o,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,i||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},ar=0,Sr.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=br({},this.state),"function"==typeof e&&(e=e(br({},n),this.props)),e&&br(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),Ar(this))},Sr.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ar(this))},Sr.prototype.render=Er,lr=[],ur="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,hr=function(e,t){return e.__v.__b-t.__v.__b},Pr.__r=0,dr=/(PointerCapture)$|Capture$/i,pr=0,fr=Dr(!1),gr=Dr(!0);var Wr=0;function Hr(e,t,n,i,r,o){t||(t={});var s,a,l=t;if("ref"in l)for(a in l={},t)"ref"==a?s=t[a]:l[a]=t[a];var c={type:e,props:l,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Wr,__i:-1,__u:0,__source:r,__self:o};if("function"==typeof e&&(s=e.defaultProps))for(a in s)void 0===l[a]&&(l[a]=s[a]);return sr.vnode&&sr.vnode(c),c}function Zr(e,t){t&&Object.entries(t).map((([t,n])=>{t.startsWith("--")?e.style.setProperty(t,n):e.style[t]=n}))}function qr(e,t){t&&Object.keys(t).map((t=>{t.startsWith("--")?e.style.removeProperty(t):e.style[t]=""}))}function Xr(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Xr(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i){if(!t.hasOwnProperty(r))return!1;if(!Xr(e[r],t[r],n-1))return!1}return!0}return!1}Array.isArray;const Yr=e=>{const{className:t,label:n,onClick:i}=e;return Hr("div",{className:"deck-widget-button",children:Hr("button",{className:`deck-widget-icon-button ${t}`,type:"button",onClick:i,title:n,children:Hr("div",{className:"deck-widget-icon"})})})};class Kr{constructor(e){this.id="fullscreen",this.placement="top-left",this.fullscreen=!1,this.id=e.id??this.id,this.placement=e.placement??this.placement,this.props={...e,enterLabel:e.enterLabel??"Enter Fullscreen",exitLabel:e.exitLabel??"Exit Fullscreen",style:e.style??{}}}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-fullscreen"),n&&i.classList.add(n),Zr(i,t),this.deck=e,this.element=i,this.update(),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),i}onRemove(){this.deck=void 0,this.element=void 0,document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}update(){const{enterLabel:e,exitLabel:t}=this.props,n=this.element;n&&Gr(Hr(Yr,{onClick:this.handleClick.bind(this),label:this.fullscreen?t:e,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"}),n)}setProps(e){this.placement=e.placement??this.placement;const t=this.props,n=this.element;n&&(t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),Xr(t.style,e.style,1)||(qr(n,t.style),Zr(n,e.style))),Object.assign(this.props,e),this.update()}getContainer(){return this.props.container||this.deck?.getCanvas()?.parentElement}onFullscreenChange(){this.fullscreen!==(document.fullscreenElement===this.getContainer())&&(this.fullscreen=!this.fullscreen),this.update()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.update()}async requestFullscreen(){const e=this.getContainer();e?.requestFullscreen?await e.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){this.getContainer()?.classList.toggle("deck-pseudo-fullscreen")}}function Jr(e){if("undefined"!=typeof window&&"renderer"===window.process?.type)return!0;if("undefined"!=typeof process&&Boolean(process.versions?.electron))return!0;const t="undefined"!=typeof navigator&&navigator.userAgent,n=e||t;return Boolean(n&&n.indexOf("Electron")>=0)}function Qr(){return!("object"==typeof process&&"[object process]"===String(process)&&!process?.browser)||Jr()}const eo="4.1.0";class to{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var no;function io(e){return"string"!=typeof e?e:(e=e.toUpperCase(),no[e]||no.WHITE)}function ro(e,t){if(!e)throw new Error(t||"Assertion failed")}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(no||(no={}));const oo=globalThis,so=(globalThis.document,globalThis.process||{}),ao=(globalThis.console,globalThis.navigator||{});function lo(){let e;if(Qr()&&oo.performance)e=oo?.performance?.now?.();else if("hrtime"in so){const t=so?.hrtime?.();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const co={debug:Qr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},uo={enabled:!0,level:0};function ho(){}const po={},fo={once:!0};class go{constructor({id:e}={id:""}){this.VERSION=eo,this._startTs=lo(),this._deltaTs=lo(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new to(`__probe-${this.id}__`,uo),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),r=e;for(const n of i){const i=r[n];"function"==typeof i&&(t.find((e=>n===e))||(r[n]=i.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((lo()-this._startTs).toPrecision(10))}getDelta(){return Number((lo()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,co.warn,arguments,fo)}error(e){return this._getLogFunction(0,e,co.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,co.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,co.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,co.debug||co.info,arguments,fo)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||ho,n&&[n],{tag:yo(t)}):ho}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||ho)}group(e,t,n={collapsed:!1}){const i=_o({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ho)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=mo(e)}_getLogFunction(e,t,n,i,r){if(this._shouldLog(e)){r=_o({logLevel:e,message:t,args:i,opts:r}),ro(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=lo();const o=r.tag||r.message;if(r.once&&o){if(po[o])return ho;po[o]=lo()}return t=function(e,t,n){if("string"==typeof t){const s=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";i=t=n.time?`${e}: ${s}  ${t}`:`${e}: ${t}`,r=n.color,o=n.background,Qr||"string"!=typeof i||(r&&(i=`[${io(r)}m${i}[39m`),o&&(i=`[${io(o)+10}m${i}[49m`)),t=i}var i,r,o;return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return ho}}function mo(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return ro(Number.isFinite(t)&&t>=0),t}function _o(e){const{logLevel:t,message:n}=e;e.logLevel=mo(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return ro("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function yo(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}go.VERSION=eo;const vo=new go({id:"deck"}),bo=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:r=0,copy:o=!1,initialize:s=!1,maxCount:a}){const l=i||e&&e.constructor||Float32Array,c=t*n+r;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;a&&(u=a*n+r);const h=this._allocate(l,c,s,u);return e&&o?h.set(e):s||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>i&&(r=i);const o=this._pool,s=e.BYTES_PER_ELEMENT*r,a=o.findIndex((e=>e.byteLength>=s));if(a>=0){const t=new e(o.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex((e=>e.byteLength>=i));r<0?t.push(n):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,n),t.length>this.opts.poolSize&&t.shift()}};Math.PI,Math.PI,globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const xo=globalThis.mathgl.config;function wo(e,{precision:t=xo.precision}={}){return e=function(e){return Math.round(e/xo.EPSILON)*xo.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Eo(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function So(e,t,n){return function(e,t,n){if(Eo(e)){const i=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(i);for(let r=0;r<n.length&&r<i.length;++r){const i="number"==typeof e?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}(e,(e=>Math.max(t,Math.min(n,e))))}function To(e,t,n){return Eo(e)?e.map(((e,i)=>To(e,t[i],n))):n*t+(1-n)*e}function Co(e,t,n){const i=xo.EPSILON;n&&(xo.EPSILON=n);try{if(e===t)return!0;if(Eo(e)&&Eo(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Co(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=xo.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{xo.EPSILON=i}}class Ao extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Eo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(xo)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+wo(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Co(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],o="number"==typeof t?t:t[i];this[i]=r+n*(o-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(xo.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function Po(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Io(e,t,n=""){if(xo.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function Mo(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Ro extends Ao{get x(){return this[0]}set x(e){this[0]=Po(e)}get y(){return this[1]}set y(e){this[1]=Po(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Po(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Po(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Mo(e>=0&&e<this.ELEMENTS,"index is out of range"),Po(this[e])}setComponent(e,t){return Mo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const ko=1e-6;let Oo="undefined"!=typeof Float32Array?Float32Array:Array;function Lo(e,t,n){const i=t[0],r=t[1],o=t[2];let s=n[3]*i+n[7]*r+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}Math.random,Math.PI;const Do=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},Fo=function(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)},No=function(e){const t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i};function Bo(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o||1;return e[0]=(n[0]*i+n[4]*r+n[8]*o)/s,e[1]=(n[1]*i+n[5]*r+n[9]*o)/s,e[2]=(n[2]*i+n[6]*r+n[10]*o)/s,e}!function(){const e=new Oo(3);Oo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0)}();const zo=[0,0,0];let jo;class Uo extends Ro{static get ZERO(){return jo||(jo=new Uo(0,0,0),Object.freeze(jo)),jo}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&Eo(e)?this.copy(e):(xo.debug&&(Po(e),Po(t),Po(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return xo.debug&&(Po(e.x),Po(e.y),Po(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Po(e)}angle(e){return function(e,t){const n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((n*n+i*i+r*r)*(o*o+s*s+a*a)),c=l&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return function(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s}(this,this,e),this.check()}rotateX({radians:e,origin:t=zo}){return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=zo}){return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=zo}){return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Lo(this,this,e),this.check()}transformAsVector(e){return Bo(this,this,e),this.check()}transformByMatrix3(e){return function(e,t,n){const i=t[0],r=t[1],o=t[2];e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){const i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2];let u=r*c-o*l,h=o*a-i*c,d=i*l-r*a,p=r*d-o*h,f=o*u-i*d,g=i*h-r*u;const m=2*s;u*=m,h*=m,d*=m,p*=2,f*=2,g*=2,e[0]=a+u+p,e[1]=l+h+f,e[2]=c+d+g}(this,this,e),this.check()}}const Vo=new Uo;function $o(e,t,n,i){Vo.set(e,t,n);const r=Vo.len();return{distance:i/r,normal:new Uo(-e/r,-t/r,-n/r)}}function Go(e){return e-Math.fround(e)}let Wo;function Ho(e,t){const{size:n=1,startIndex:i=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,o=(r-i)/n;Wo=bo.allocate(Wo,o,{type:Float32Array,size:2*n});let s=i,a=0;for(;s<r;){for(let t=0;t<n;t++){const i=e[s++];Wo[a+t]=i,Wo[a+t+n]=Go(i)}a+=2*n}return Wo.subarray(0,o*n*2)}function Zo(e){let t=null,n=!1;for(const i of e)i&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}class qo extends Ao{toString(){let e="[";if(xo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Po(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[n+e];return t}setColumn(e,t){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)this[n+e]=t[e];return this}}function Xo(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],_=t[15],y=n*a-i*s,v=n*l-r*s,b=n*c-o*s,x=i*l-r*a,w=i*c-o*a,E=r*c-o*l,S=u*g-h*f,T=u*m-d*f,C=u*_-p*f,A=h*m-d*g,P=h*_-p*g,I=d*_-p*m;let M=y*I-v*P+b*A+x*C-w*T+E*S;return M?(M=1/M,e[0]=(a*I-l*P+c*A)*M,e[1]=(r*P-i*I-o*A)*M,e[2]=(g*E-m*w+_*x)*M,e[3]=(d*w-h*E-p*x)*M,e[4]=(l*C-s*I-c*T)*M,e[5]=(n*I-r*C+o*T)*M,e[6]=(m*b-f*E-_*v)*M,e[7]=(u*E-d*b+p*v)*M,e[8]=(s*P-a*C+c*S)*M,e[9]=(i*C-n*P-o*S)*M,e[10]=(f*w-g*b+_*y)*M,e[11]=(h*b-u*w-p*y)*M,e[12]=(a*T-s*A-l*S)*M,e[13]=(n*A-i*T+r*S)*M,e[14]=(g*v-f*x-m*y)*M,e[15]=(u*x-h*v+d*y)*M,e):null}function Yo(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],_=t[14],y=t[15];let v=n[0],b=n[1],x=n[2],w=n[3];return e[0]=v*i+b*a+x*h+w*g,e[1]=v*r+b*l+x*d+w*m,e[2]=v*o+b*c+x*p+w*_,e[3]=v*s+b*u+x*f+w*y,v=n[4],b=n[5],x=n[6],w=n[7],e[4]=v*i+b*a+x*h+w*g,e[5]=v*r+b*l+x*d+w*m,e[6]=v*o+b*c+x*p+w*_,e[7]=v*s+b*u+x*f+w*y,v=n[8],b=n[9],x=n[10],w=n[11],e[8]=v*i+b*a+x*h+w*g,e[9]=v*r+b*l+x*d+w*m,e[10]=v*o+b*c+x*p+w*_,e[11]=v*s+b*u+x*f+w*y,v=n[12],b=n[13],x=n[14],w=n[15],e[12]=v*i+b*a+x*h+w*g,e[13]=v*r+b*l+x*d+w*m,e[14]=v*o+b*c+x*p+w*_,e[15]=v*s+b*u+x*f+w*y,e}function Ko(e,t,n){const i=n[0],r=n[1],o=n[2];let s,a,l,c,u,h,d,p,f,g,m,_;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*o+t[12],e[13]=t[1]*i+t[5]*r+t[9]*o+t[13],e[14]=t[2]*i+t[6]*r+t[10]*o+t[14],e[15]=t[3]*i+t[7]*r+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],p=t[7],f=t[8],g=t[9],m=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=p,e[8]=f,e[9]=g,e[10]=m,e[11]=_,e[12]=s*i+u*r+f*o+t[12],e[13]=a*i+h*r+g*o+t[13],e[14]=l*i+d*r+m*o+t[14],e[15]=c*i+p*r+_*o+t[15]),e}function Jo(e,t,n){const i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qo(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e}function es(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e}function ts(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ns(e,t,n,i){const r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e}function is(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function rs(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}var os;!function(){const e=new Oo(2);Oo!=Float32Array&&(e[0]=0,e[1]=0)}(),function(){const e=new Oo(4);Oo!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}(),function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(os||(os={}));const ss=45*Math.PI/180,as=1,ls=.1,cs=500,us=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class hs extends qo{static get IDENTITY(){return ps||(ps=new hs,Object.freeze(ps)),ps}static get ZERO(){return ds||(ds=new hs([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ds)),ds}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return os}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=p,this[14]=f,this[15]=g,this.check()}setRowMajor(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,g){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=c,this[7]=p,this[8]=n,this[9]=s,this[10]=u,this[11]=f,this[12]=i,this[13]=a,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(us)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,g=o*s,m=o*a,_=o*l;e[0]=1-h-f,e[1]=u+_,e[2]=d-m,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+g,e[7]=0,e[8]=d+m,e[9]=p-g,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:r,near:o=ls,far:s=cs}=e;return s===1/0?function(e,t,n,i,r,o){const s=2*o/(n-t),a=2*o/(r-i),l=(n+t)/(n-t),c=(r+i)/(r-i),u=-2*o;e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0}(this,t,n,i,r,o):function(e,t,n,i,r,o,s){const a=1/(n-t),l=1/(r-i),c=1/(o-s);e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0}(this,t,n,i,r,o,s),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return function(e,t,n,i){let r,o,s,a,l,c,u,h,d,p;const f=t[0],g=t[1],m=t[2],_=i[0],y=i[1],v=i[2],b=n[0],x=n[1],w=n[2];Math.abs(f-b)<ko&&Math.abs(g-x)<ko&&Math.abs(m-w)<ko?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=f-b,d=g-x,p=m-w,r=1/Math.sqrt(h*h+d*d+p*p),h*=r,d*=r,p*=r,o=y*p-v*d,s=v*h-_*p,a=_*d-y*h,r=Math.sqrt(o*o+s*s+a*a),r?(r=1/r,o*=r,s*=r,a*=r):(o=0,s=0,a=0),l=d*a-p*s,c=p*o-h*a,u=h*s-d*o,r=Math.sqrt(l*l+c*c+u*u),r?(r=1/r,l*=r,c*=r,u*=r):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=p,e[11]=0,e[12]=-(o*f+s*g+a*m),e[13]=-(l*f+c*g+u*m),e[14]=-(h*f+d*g+p*m),e[15]=1)}(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:r,near:o=ls,far:s=cs}=e;return function(e,t,n,i,r,o,s){const a=1/(t-n),l=1/(i-r),c=1/(o-s);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1}(this,t,n,i,r,o,s),this.check()}orthographic(e){const{fovy:t=ss,aspect:n=as,focalDistance:i=1,near:r=ls,far:o=cs}=e;fs(t);const s=t/2,a=i*Math.tan(s),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=e;return fs(t),function(e,t,n,i,r){const o=1/Math.tan(t/2);if(e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(i-r);e[10]=(r+i)*t,e[14]=2*r*i*t}else e[10]=-1,e[14]=-2*i}(this,t,n,i,r),this.check()}determinant(){return function(e){const t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=t*s-n*o,_=t*a-i*o,y=n*a-i*s,v=c*f-u*p,b=c*g-h*p,x=u*g-h*f;return l*(t*x-n*b+i*v)-r*(o*x-s*b+a*v)+e[15]*(c*y-u*_+h*m)-d*(p*y-f*_+g*m)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return function(e,t){if(e===t){const n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return Xo(this,this),this.check()}multiplyLeft(e){return Yo(this,e,this),this.check()}multiplyRight(e){return Yo(this,this,e),this.check()}rotateX(e){return Qo(this,this,e),this.check()}rotateY(e){return function(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r}(this,this,e),this.check()}rotateZ(e){return es(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,i){let r,o,s,a,l,c,u,h,d,p,f,g,m,_,y,v,b,x,w,E,S,T,C,A,P=i[0],I=i[1],M=i[2],R=Math.sqrt(P*P+I*I+M*M);R<ko||(R=1/R,P*=R,I*=R,M*=R,o=Math.sin(n),r=Math.cos(n),s=1-r,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],p=t[6],f=t[7],g=t[8],m=t[9],_=t[10],y=t[11],v=P*P*s+r,b=I*P*s+M*o,x=M*P*s-I*o,w=P*I*s-M*o,E=I*I*s+r,S=M*I*s+P*o,T=P*M*s+I*o,C=I*M*s-P*o,A=M*M*s+r,e[0]=a*v+h*b+g*x,e[1]=l*v+d*b+m*x,e[2]=c*v+p*b+_*x,e[3]=u*v+f*b+y*x,e[4]=a*w+h*E+g*S,e[5]=l*w+d*E+m*S,e[6]=c*w+p*E+_*S,e[7]=u*w+f*E+y*S,e[8]=a*T+h*C+g*A,e[9]=l*T+d*C+m*A,e[10]=c*T+p*C+_*A,e[11]=u*T+f*C+y*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Jo(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ko(this,this,e),this.check()}transform(e,t){return 4===e.length?(Io(t=rs(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=function(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:i=Lo(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Io(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const i=t[0],r=t[1],o=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/o,e[1]=(n[1]*i+n[5]*r)/o,e}(t||[-0,-0],e,this);break;case 3:n=Bo(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Io(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let ds,ps;function fs(e){if(e>2*Math.PI)throw Error("expected radians")}function gs(e,t){const n=rs([],t,e);return is(n,n,1/n[3]),n}function ms(e,t){const n=e%t;return n<0?t+n:n}function _s(e,t,n){return e<t?t:e>n?n:e}const ys=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function vs(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const bs=Math.PI,xs=bs/4,ws=bs/180,Es=180/bs,Ss=512,Ts=85.051129,Cs=1.5;function As(e){return Math.pow(2,e)}function Ps(e){return ys(e)}function Is(e){const[t,n]=e;vs(Number.isFinite(t)),vs(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*ws;return[Ss*(t*ws+bs)/(2*bs),Ss*(bs+Math.log(Math.tan(xs+.5*i)))/(2*bs)]}function Ms(e){const[t,n]=e,i=t/Ss*(2*bs)-bs,r=2*(Math.atan(Math.exp(n/Ss*(2*bs)-bs))-xs);return[i*Es,r*Es]}function Rs(e){return 12790407194604047e-21/Math.cos(e*ws)}function ks(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;vs(Number.isFinite(t)&&Number.isFinite(n));const r=Math.cos(t*ws),o=512/360,s=o/r,a=12790407194604047e-21/r,l={unitsPerMeter:[a,a,a],metersPerUnit:[1/a,1/a,1/a],unitsPerDegree:[o,s,a],degreesPerUnit:[.703125,1/s,1/a]};if(i){const e=ws*Math.tan(t*ws)/r,n=o*e/2,i=12790407194604047e-21*e,c=i/s*a;l.unitsPerDegree2=[0,n,i],l.unitsPerMeter2=[c,0,c]}return l}function Os(e,t){const[n,i,r]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=ks({longitude:n,latitude:i,highPrecision:!0}),u=Is(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);const h=Ms(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function Ls(e){return 2*Math.atan(.5/e)*Es}function Ds(e){return.5/Math.tan(.5*e*ws)}function Fs(e,t){const[n,i,r=0]=e;return vs(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),gs(t,[n,i,r,1])}function Ns(e,t,n=0){const[i,r,o]=e;if(vs(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o))return gs(t,[i,r,o,1]);const s=gs(t,[i,r,0,1]),a=gs(t,[i,r,1,1]),l=s[2],c=a[2];return ns([],s,a,l===c?0:((n||0)-l)/(c-l))}const Bs=Math.PI/180;function zs(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=gs(i,[t,0,1,1]),o=gs(i,[t,e.height,1,1]),s=Ms(ns([],r,o,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2])));return s.push(n),s}const js=["longitude","latitude","zoom"],Us={curve:1.414,speed:1.2};function Vs(e,t,n){const i=(n=Object.assign({},Us,n)).curve,r=e.zoom,o=[e.longitude,e.latitude],s=As(r),a=t.zoom,l=[t.longitude,t.latitude],c=As(a-r),u=Is(o),h=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}([],Is(l),u),d=Math.max(e.width,e.height),p=d/c,f=function(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}(h)*s,g=Math.max(f,.01),m=i*i,_=(p*p-d*d+m*m*g*g)/(2*d*m*g),y=(p*p-d*d-m*m*g*g)/(2*p*m*g),v=Math.log(Math.sqrt(_*_+1)-_),b=Math.log(Math.sqrt(y*y+1)-y);return{startZoom:r,startCenterXY:u,uDelta:h,w0:d,u1:f,S:(b-v)/i,rho:i,rho2:m,r0:v,r1:b}}var $s,Gs,Ws;!function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"}($s||($s={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"}(Gs||(Gs={})),function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"}(Ws||(Ws={}));const Hs="manipulation",Zs="none",qs="pan-x",Xs="pan-y";class Ys{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(Zs))return Zs;const t=e.includes(qs),n=e.includes(Xs);return t&&n?Zs:t||n?t?qs:Xs:e.includes(Hs)?Hs:"auto"}(e.join(" "))}}function Ks(e){return e.trim().split(/\s+/g)}function Js(e,t,n){if(e)for(const i of Ks(t))e.addEventListener(i,n,!1)}function Qs(e,t,n){if(e)for(const i of Ks(t))e.removeEventListener(i,n,!1)}function ea(e){return(e.ownerDocument||e).defaultView}function ta(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,i=0,r=0;for(;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:Math.round(n/t),y:Math.round(i/t)}}function na(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:ta(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ia(e,t){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function ra(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}function oa(e,t){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return 180*Math.atan2(i,n)/Math.PI}function sa(e,t){return e===t?Gs.None:Math.abs(e)>=Math.abs(t)?e<0?Gs.Left:Gs.Right:t<0?Gs.Up:Gs.Down}function aa(e,t,n){return{x:t/e||0,y:n/e||0}}class la{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const i=n.pointers.length,r=n.changedPointers.length,o=t&$s.Start&&i-r===0,s=t&($s.End|$s.Cancel)&&i-r===0;n.isFirst=Boolean(o),n.isFinal=Boolean(s),o&&(e.session={}),n.eventType=t;const a=function(e,t){const{session:n}=e,{pointers:i}=t,{length:r}=i;n.firstInput||(n.firstInput=na(t)),r>1&&!n.firstMultiple?n.firstMultiple=na(t):1===r&&(n.firstMultiple=!1);const{firstInput:o,firstMultiple:s}=n,a=s?s.center:o.center,l=t.center=ta(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=function(e,t){const n=t.x-e.x,i=t.y-e.y;return 180*Math.atan2(i,n)/Math.PI}(a,l),t.distance=ia(a,l);const{deltaX:c,deltaY:u}=function(e,t){const n=t.center;let i=e.offsetDelta,r=e.prevDelta;const o=e.prevInput;return t.eventType!==$s.Start&&o?.eventType!==$s.End||(r=e.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y}),{deltaX:r.x+(n.x-i.x),deltaY:r.y+(n.y-i.y)}}(n,t);t.deltaX=c,t.deltaY=u,t.offsetDirection=sa(t.deltaX,t.deltaY);const h=aa(t.deltaTime,t.deltaX,t.deltaY);var d,p;t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,t.scale=s?(d=s.pointers,ra((p=i)[0],p[1])/ra(d[0],d[1])):1,t.rotation=s?function(e,t){return oa(t[1],t[0])-oa(e[1],e[0])}(s.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let f=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,f)&&(f=t.srcEvent.target),t.target=f,function(e,t){const n=e.lastInterval||t,i=t.timeStamp-n.timeStamp;let r,o,s,a;if(t.eventType!==$s.Cancel&&(i>25||void 0===n.velocity)){const l=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,u=aa(i,l,c);o=u.x,s=u.y,r=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=sa(l,c),e.lastInterval=t}else r=n.velocity,o=n.velocityX,s=n.velocityY,a=n.direction;t.velocity=r,t.velocityX=o,t.velocityY=s,t.direction=a}(n,t),t}(e,n);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}(this.manager,e,t)}init(){Js(this.element,this.evEl,this.domHandler),Js(this.target,this.evTarget,this.domHandler),Js(ea(this.element),this.evWin,this.domHandler)}destroy(){Qs(this.element,this.evEl,this.domHandler),Qs(this.target,this.evTarget,this.domHandler),Qs(ea(this.element),this.evWin,this.domHandler)}}const ca={pointerdown:$s.Start,pointermove:$s.Move,pointerup:$s.End,pointercancel:$s.Cancel,pointerout:$s.Cancel};class ua extends la{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=ca[e.type],r=e.pointerType,o="touch"===r;let s=t.findIndex((t=>t.pointerId===e.pointerId));i&$s.Start&&(e.buttons||o)?s<0&&(t.push(e),s=t.length-1):i&($s.End|$s.Cancel)&&(n=!0),s<0||(t[s]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:r,srcEvent:e}),n&&t.splice(s,1))}}const ha=["","webkit","Moz","MS","ms","o"];function da(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const i of ha){const r=i?i+n:t;if(r in e)return r}}const pa={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class fa{constructor(e,t){this.options={...pa,...t,cssProps:{...pa.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new ua(this),this.touchAction=new Ys(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:i}=this;let{curRecognizer:r}=t;(!r||r&&r.state&Ws.Recognized)&&(r=t.curRecognizer=null);let o=0;for(;o<i.length;)n=i[o],2===t.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(Ws.Began|Ws.Changed|Ws.Ended)&&(r=t.curRecognizer=n),o++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"==typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of Ks(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of Ks(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<n.length;)n[r](i),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const r=da(t.style,n);e?(this.oldCssProps[r]=t.style[r],t.style[r]=i):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}}let ga=1;function ma(e){return e&Ws.Cancelled?"cancel":e&Ws.Ended?"end":e&Ws.Changed?"move":e&Ws.Began?"start":""}class _a{constructor(e){this.options=e,this.id=ga++,this.state=Ws.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"==typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"==typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find((e=>e.options.enable)))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<Ws.Ended&&this.manager.emit(this.options.event+ma(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ws.Ended&&this.manager.emit(this.options.event+ma(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ws.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ws.Failed|Ws.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=Ws.Failed);this.state&(Ws.Recognized|Ws.Cancelled|Ws.Failed)&&(this.state=Ws.Possible),this.state=this.process(t),this.state&(Ws.Began|Ws.Changed|Ws.Ended|Ws.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class ya extends _a{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(Ws.Began|Ws.Changed),r=this.attrTest(e);return i&&(n&$s.Cancel||!r)?t|Ws.Cancelled:i||r?n&$s.End?t|Ws.Ended:t&Ws.Began?t|Ws.Changed:Ws.Began:Ws.Failed}}class va extends _a{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Hs]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&$s.Start&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!==$s.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,i=!this.pCenter||ia(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,i&&n?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout((()=>{this.state=Ws.Recognized,this.tryEmit(this._input)}),t.interval),Ws.Began):Ws.Recognized}return Ws.Failed}failTimeout(){return this._timer=setTimeout((()=>{this.state=Ws.Failed}),this.options.interval),Ws.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ws.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const ba=["","start","move","end","cancel","up","down","left","right"];class xa extends ya{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Gs.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Gs.Horizontal&&t.push(Xs),e&Gs.Vertical&&t.push(qs),t}getEventNames(){return ba.map((e=>this.options.event+e))}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:r}=e;const o=e.deltaX,s=e.deltaY;return r&t.direction||(t.direction&Gs.Horizontal?(r=0===o?Gs.None:o<0?Gs.Left:Gs.Right,n=o!==this.pX,i=Math.abs(e.deltaX)):(r=0===s?Gs.None:s<0?Gs.Up:Gs.Down,n=s!==this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&Boolean(r&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&Ws.Began)||!(this.state&Ws.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Gs[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const wa=["","start","move","end","cancel","in","out"];class Ea{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const Sa="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ta=("undefined"!=typeof window?window:global,"undefined"!=typeof global?global:window,"undefined"!=typeof document&&document,-1!==Sa.indexOf("firefox")),Ca=4.000244140625;class Aa extends Ea{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(Ta&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%Ca===0&&(t=Math.floor(t/Ca)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const Pa=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class Ia extends Ea{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,Pa.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){Pa.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Ma=["keydown","keyup"];class Ra extends Ea{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Ma.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){Ma.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class ka extends Ea{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const Oa={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function La(e){const t=Oa[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i}=e.srcEvent;let r=!1,o=!1,s=!1;return 2===t?(r=Boolean(1&n),o=Boolean(4&n),s=Boolean(2&n)):(r=0===i,o=1===i,s=2===i),{leftButton:r,middleButton:o,rightButton:s}}function Da(e,t){const n=e.center;if(!n)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,o=i.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-t.clientLeft)/r,y:(n.y-i.top-t.clientTop)/o}}}const Fa={srcElement:"root",priority:0};class Na{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,r=!1){const{handlers:o,handlersByElement:s}=this,a={...Fa,...n};let l=s.get(a.srcElement);l||(l=[],s.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};i&&(c.once=!0),r&&(c.passive=!0),o.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===e&&o.handler===t){n.splice(r,1);const e=i.get(o.srcElement);e.splice(e.indexOf(o),1),0===e.length&&i.delete(o.srcElement)}}this._active=n.some((e=>!e.passive))}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},o=[];for(let s=0;s<n.length;s++){const{type:a,handler:l,once:c}=n[s];if(l({...e,type:a,stopPropagation:i,stopImmediatePropagation:r}),c&&o.push(n[s]),t)break}for(let e=0;e<o.length;e++){const{type:t,handler:n}=o[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...La(e),...Da(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function Ba(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];return t="function"==typeof n[0]?new(n.shift())(n.shift()||{}):n.shift(),{recognizer:t,recognizeWith:"string"==typeof n[0]?[n[0]]:n[0],requireFailure:"string"==typeof n[1]?[n[1]]:n[1]}}class za{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new fa(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:i}=Ba(e);this.manager.add(t),n&&t.recognizeWith(n),i&&t.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Aa(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Ia(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Ra(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new ka(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:t}),n.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!=typeof e){n=t;for(const[t,o]of Object.entries(e))this._addEventHandler(t,o,n,i,r);return}const{manager:o,events:s}=this;if(!o)return;let a=s.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new Na(this,t),s.set(e,a),o&&o.on(e,a.handleEvent)}a.add(e,t,n,i,r),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:e}=i;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find((t=>t.getEventNames().includes(e)))?.options.event}}const ja={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ja,"IDENTITY",{get:()=>(vo.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ua={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Va={common:0,meters:1,pixels:2},$a={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Ga={multipan:[xa,{threshold:10,direction:Gs.Vertical,pointers:2}],pinch:[class extends ya{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Zs]}getEventNames(){return wa.map((e=>this.options.event+e))}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&Ws.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[xa,{threshold:1},["pinch"],["multipan"]],dblclick:[va,{event:"dblclick",taps:2}],click:[va,{event:"click"},null,["dblclick"]]},Wa=Math.PI/180,Ha=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Za=[0,0,0],qa={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Xa{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||qa,this.focalDistance=e.focalDistance||1,this.position=e.position||Za,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ua.WEB_MERCATOR:Ua.WEB_MERCATOR_AUTO_OFFSET:Ua.IDENTITY}equals(e){return e instanceof Xa&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Co(e.projectionMatrix,this.projectionMatrix)&&Co(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=Fs(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,o=t?r:this.height-r;return 2===e.length?[i,o]:[i,o,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,o]=e,s=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=Ns([i,s,o],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=Is(e);return t[1]=So(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Ms(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1]),Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?ks({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:$o((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:$o(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:$o(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:$o(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:$o(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:$o(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){const{latitude:t}=e;vs(Number.isFinite(t));return Ps(4003e4*Math.cos(t*ws))-9}({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ks({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:o}=e;let s=Za;if(r&&(s=o?new hs(o).transformAsVector(r,[]):r),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new Uo(s).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=Ha,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:o=75,near:s=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new hs).multiplyRight(t).translate(new Uo(this.center).negate()),this.projectionMatrix=n||function({width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:r,padding:o,near:s,far:a}){const l=e/t,c=n?(new hs).orthographic({fovy:i,aspect:l,focalDistance:r,near:s,far:a}):(new hs).perspective({fovy:i,aspect:l,near:s,far:a});if(o){const{left:n=0,right:i=0,top:r=0,bottom:s=0}=o,a=So((n+e-i)/2,0,e)-e/2,l=So((r+t-s)/2,0,t)-t/2;c[8]-=2*a/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||o*Wa,focalDistance:c,padding:l,near:s,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;Yo(u,u,this.projectionMatrix),Yo(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=Xo([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Jo(d,d,[this.width/2,-this.height/2,1]),Ko(d,d,[1,-1,0]),Yo(p,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=Xo([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||vo.warn("Pixel project matrix not invertible")()}}Xa.displayName="Viewport";const Ya=Xa;class Ka extends Ya{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:o=0,nearZMultiplier:s=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:f,padding:g,legacyMeterSizes:m=!1}=e;let{width:_,height:y,altitude:v=1.5}=e;const b=Math.pow(2,i);let x;_=_||1,y=y||1;let w=null;if(h)v=h[5]/2,x=Ls(v);else{let n;if(e.fovy?(x=e.fovy,v=Ds(x)):x=Ls(v),g){const{top:e=0,bottom:t=0}=g;n=[0,So((e+y-t)/2,0,y)-y/2]}w=function(e){const{width:t,height:n,altitude:i,pitch:r=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=Ls(Cs)}=e;void 0!==i&&(u=Ls(i));const h=u*ws,d=r*ws,p=Ds(u);let f=p;s&&(f+=s[2]*a/Math.cos(d)/n);const g=h*(.5+(o?o[1]:0)/n),m=Math.sin(g)*f/Math.sin(_s(Math.PI/2-d-g,.01,Math.PI-.01)),_=Math.sin(d)*m+f,y=10*f;return{fov:h,aspect:t/n,focalDistance:p,near:l,far:Math.min(_*c,y)}}({width:_,height:y,scale:b,center:f&&[0,0,f[2]*Rs(t)],offset:n,pitch:r,fovy:x,nearZMultiplier:s,farZMultiplier:a}),Number.isFinite(l)&&(w.near=l),Number.isFinite(c)&&(w.far=c)}let E=function(e){const{height:t,pitch:n,bearing:i,altitude:r,scale:o,center:s}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ko(a,a,[0,0,-r]),Qo(a,a,-n*ws),es(a,a,i*ws);const l=o/t;return Jo(a,a,[l,l,l]),s&&Ko(a,a,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],s)),a}({height:y,pitch:r,bearing:o,scale:b,altitude:v});p&&(E=(new hs).translate([512*p,0,0]).multiplyLeft(E)),super({...e,width:_,height:y,viewMatrix:E,longitude:n,latitude:t,zoom:i,...w,fovy:x,focalDistance:v}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=o,this.altitude=v,this.fovy=x,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=m,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let e=t;e<=n;e++){const t=e?new Ka({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*Rs(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/Rs(n)]}addMetersToLngLat(e,t){return Os(e,t)}panByPosition(e,t){const n=Ns(t,this.pixelUnprojectionMatrix),i=ts([],this.projectFlat(e),function(e,t){return e[0]=-t[0],e[1]=-t[1],e}([],n)),r=ts([],this.center,i),[o,s]=this.unprojectFlat(r);return{longitude:o,latitude:s}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:i,unproject:r}=e,o={targetZ:t},s=r([0,i],o),a=r([n,i],o);let l,c;return(e.fovy?.5*e.fovy*Bs:Math.atan(.5/e.altitude))>(90-e.pitch)*Bs-.01?(l=zs(e,0,t),c=zs(e,n,t)):(l=r([0,0],o),c=r([n,0],o)),[s,a,c,l]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:o,zoom:s}=function(e){const{width:t,height:n,bounds:i,minExtent:r=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=i,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(vs(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=Is([a,_s(u,-85.051129,Ts)]),p=Is([c,_s(l,-85.051129,Ts)]),f=[Math.max(Math.abs(p[0]-d[0]),r),Math.max(Math.abs(p[1]-d[1]),r)],g=[t-h.left-h.right-2*Math.abs(s[0]),n-h.top-h.bottom-2*Math.abs(s[1])];vs(g[0]>0&&g[1]>0);const m=g[0]/f[0],_=g[1]/f[1],y=(h.right-h.left)/2/m,v=(h.top-h.bottom)/2/_,b=Ms([(p[0]+d[0])/2+y,(p[1]+d[1])/2+v]),x=Math.min(o,ys(Math.abs(Math.min(m,_))));return vs(Number.isFinite(x)),{longitude:b[0],latitude:b[1],zoom:x}}({width:n,height:i,bounds:e,...t});return new Ka({width:n,height:i,longitude:r,latitude:o,zoom:s})}}Ka.displayName="WebMercatorViewport";const Ja=Ka,Qa=Math.PI/180,el=180/Math.PI,tl=6370972,nl=256;function il(){const e=4018225162502676e-20,t=Math.PI/180*nl;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class rl extends Ya{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:r=1,resolution:o=10}=e;let{latitude:s=0,height:a,altitude:l=1.5,fovy:c}=e;s=Math.max(Math.min(s,Ts),-85.051129),a=a||1,c?l=Ds(c):c=Ls(l);const u=1/Math.PI/Math.cos(s*Math.PI/180),h=Math.pow(2,n)*u,d=e.nearZ??i,p=e.farZ??(l+512*h/a)*r,f=(new hs).lookAt({eye:[0,-l,0],up:[0,0,1]});f.rotateX(s*Qa),f.rotateZ(-t*Qa),f.scale(h/a),super({...e,height:a,viewMatrix:f,longitude:t,latitude:s,zoom:n,distanceScales:il(),fovy:c,focalDistance:l,near:d,far:p}),this.scale=h,this.latitude=s,this.longitude=t,this.resolution=o}get projectionMode(){return Ua.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),r=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],i[0],o[0]),Math.min(n[1],r[1],i[1],o[1]),Math.max(n[0],r[0],i[0],o[0]),Math.max(n[1],r[1],i[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,o]=e,s=t?r:this.height-r,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(o))l=ol(a,[i,s,o,1]);else{const e=ol(a,[i,s,-1,1]),t=ol(a,[i,s,1,1]),r=((n||0)/tl+1)*nl,o=No(Do([],e,t)),c=No(e),u=No(t),h=(4*c*u-(o-c-u)**2)/16*4/o;l=function(e,t,n,i){const r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,r*r-h)))/Math.sqrt(o))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,i=0]=e,r=t*Qa,o=n*Qa,s=Math.cos(o),a=(i/tl+1)*nl;return[Math.sin(r)*s*a,-Math.cos(r)*s*a,Math.sin(o)*a]}unprojectPosition(e){const[t,n,i]=e,r=function(e){const t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}(e),o=Math.asin(i/r);return[Math.atan2(t,-n)*el,o*el,(r/nl-1)*tl]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function ol(e,t){const n=rs([],t,e);return is(n,n,1/n[3]),n}function sl(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class al{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Co(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const r of this._propsToExtract)(r in e||r in t)&&(n[r]=e[r],i[r]=t[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach((t=>{const n=e[t];sl(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)}))}}const ll={bearing:0,pitch:0,position:[0,0,0]},cl={speed:1.2,curve:1.414};class ul extends al{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...cl,...e}}interpolateProps(e,t,n){const i=function(e,t,n,i){const{startZoom:r,startCenterXY:o,uDelta:s,w0:a,u1:l,S:c,rho:u,rho2:h,r0:d}=Vs(e,t,i);if(l<.01){const i={};for(const r of js){const o=e[r],s=t[r];i[r]=(p=n)*s+(1-p)*o}return i}var p;const f=n*c,g=Math.cosh(d)/Math.cosh(d+u*f),m=a*((Math.cosh(d)*Math.tanh(d+u*f)-Math.sinh(d))/h)/l,_=r+Ps(1/g),y=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}([],s,m);ts(y,y,o);const v=Ms(y);return{longitude:v[0],latitude:v[1],zoom:_}}(e,t,n,this.opts);for(const r in ll)i[r]=To(e[r]||ll[r],t[r]||ll[r],n);return i}getDuration(e,t){let{transitionDuration:n}=t;return"auto"===n&&(n=function(e,t,n){const i={...Us,...n},{screenSpeed:r,speed:o,maxDuration:s}=i,{S:a,rho:l}=Vs(e,t,i),c=1e3*a;let u;return u=Number.isFinite(r)?c/(r/l):c/o,Number.isFinite(s)&&u>s?0:u}(e,t,this.opts)),n}}class hl{constructor(e){this.id="compass",this.placement="top-left",this.viewId=null,this.viewports={},this.id=e.id??this.id,this.viewId=e.viewId??this.viewId,this.placement=e.placement??this.placement,this.props={...e,transitionDuration:e.transitionDuration??200,label:e.label??"Reset Compass",style:e.style??{}}}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId;const t=this.props,n=this.element;n&&(t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),Xr(t.style,e.style,1)||(qr(n,t.style),Zr(n,e.style))),Object.assign(this.props,e),this.update()}onViewportChange(e){e.equals(this.viewports[e.id])||(this.viewports[e.id]=e,this.update())}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-compass"),n&&i.classList.add(n),Zr(i,t),this.deck=e,this.element=i,this.update(),i}getRotation(e){return e instanceof Ja?[-e.bearing,e.pitch]:e instanceof rl?[0,Math.max(-80,Math.min(80,e.latitude))]:[0,0]}update(){const e=this.viewId||Object.values(this.viewports)[0]?.id||"default-view",t=this.viewports[e],[n,i]=this.getRotation(t),r=this.element;if(!r)return;const o=Hr("div",{className:"deck-widget-button",style:{perspective:100},children:Hr("button",{type:"button",onClick:()=>{for(const e of Object.values(this.viewports))this.handleCompassReset(e)},title:this.props.label,style:{transform:`rotateX(${i}deg)`},children:Hr("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:Hr("g",{transform:`rotate(${n},13,13)`,children:[Hr("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, #F05C44)"}),Hr("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, #C2C2CC)"})]})})})});Gr(o,r)}onRemove(){this.deck=void 0,this.element=void 0}handleCompassReset(e){const t=this.viewId||e.id||"default-view";if(e instanceof Ja){const n={...e,bearing:0,...0===this.getRotation(e)[0]?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new ul};this.deck._onViewStateChange({viewId:t,viewState:n,interactionState:{}})}}}var dl=d(5292),pl=d.n(dl),fl=d(9893),gl=d.n(fl),ml=d(9383),_l=d.n(ml),yl=d(6884),vl=d.n(yl),bl=d(9088),xl=d.n(bl),wl=d(7997),El=d.n(wl),Sl=d(2190),Tl={};Tl.styleTagTransform=El(),Tl.setAttributes=vl(),Tl.insert=_l().bind(null,"head"),Tl.domAPI=gl(),Tl.insertStyleElement=xl(),pl()(Sl.A,Tl),Sl.A&&Sl.A.locals&&Sl.A.locals;var Cl=d(5114),Al=function(e,t={}){t.concavity=t.concavity||1/0;const n=[];if(m(e,(e=>{n.push([e[0],e[1]])})),!n.length)return null;const i=Cl(n,t.concavity);return i.length>3?function(e,t,n={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return l({type:"Polygon",coordinates:e},t,n)}([i]):null},Pl=d(2007);if(!r.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!function(e,t,n){return zi((function(){var i=bi(e,n)[Me];null!=t||(t=function(e){return fe(e,Ce)||se(e,Ce,we({},e[Ce])),e[Ce]}(e)),de(t).forEach((function(e){return i.make_(e,t[e])}))})),e})throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");var Il=d(8398);function Ml(e){e()}function Rl(e){return In(Fi(e,t));var t}var kl,Ol,Ll=function(){function e(e){var t=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(e){void 0===e&&(e=1e4),clearTimeout(t.sweepTimeout),t.sweepTimeout=void 0;var n=Date.now();t.registrations.forEach((function(i,r){n-i.registeredAt>=e&&(t.finalize(i.value),t.registrations.delete(r))})),t.registrations.size>0&&t.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){t.sweep(0)}})}return Object.defineProperty(e.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){this.registrations.set(n,{value:t,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(e.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(e.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){void 0===this.sweepTimeout&&(this.sweepTimeout=setTimeout(this.sweep,1e4))}}),e}(),Dl=new("undefined"!=typeof FinalizationRegistry?FinalizationRegistry:Ll)((function(e){var t;null===(t=e.reaction)||void 0===t||t.dispose(),e.reaction=null})),Fl=d(3676);function Nl(e){e.reaction=new on("observer".concat(e.name),(function(){var t;e.stateVersion=Symbol(),null===(t=e.onStoreChange)||void 0===t||t.call(e)}))}var Bl="function"==typeof Symbol&&Symbol.for,zl=null!==(Ol=null===(kl=Object.getOwnPropertyDescriptor((function(){}),"name"))||void 0===kl?void 0:kl.configurable)&&void 0!==Ol&&Ol,jl=Bl?Symbol.for("react.forward_ref"):"function"==typeof r.forwardRef&&(0,r.forwardRef)((function(e){return null})).$$typeof,Ul=Bl?Symbol.for("react.memo"):"function"==typeof r.memo&&(0,r.memo)((function(e){return null})).$$typeof;function Vl(e,t){var n;if(Ul&&e.$$typeof===Ul)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");var i=null!==(n=null==t?void 0:t.forwardRef)&&void 0!==n&&n,s=e,a=e.displayName||e.name;if(jl&&e.$$typeof===jl&&(i=!0,"function"!=typeof(s=e.render)))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var l,c,u=function(e,t){return function(e,t){void 0===t&&(t="observed");var n=o().useRef(null);if(!n.current){var i={reaction:null,onStoreChange:null,stateVersion:Symbol(),name:t,subscribe:function(e){return Dl.unregister(i),i.onStoreChange=e,i.reaction||(Nl(i),i.stateVersion=Symbol()),function(){var e;i.onStoreChange=null,null===(e=i.reaction)||void 0===e||e.dispose(),i.reaction=null}},getSnapshot:function(){return i.stateVersion}};n.current=i}var r,s,a=n.current;if(a.reaction||(Nl(a),Dl.register(n,a,a)),o().useDebugValue(a.reaction,Rl),(0,Fl.useSyncExternalStore)(a.subscribe,a.getSnapshot,a.getSnapshot),a.reaction.track((function(){try{r=e()}catch(e){s=e}})),s)throw s;return r}((function(){return s(e,t)}),a)};return u.displayName=e.displayName,zl&&Object.defineProperty(u,"name",{value:e.name,writable:!0,configurable:!0}),e.contextTypes&&(u.contextTypes=e.contextTypes),i&&(u=(0,r.forwardRef)(u)),l=e,c=u=(0,r.memo)(u),Object.keys(l).forEach((function(e){$l[e]||Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(l,e))})),u}var $l={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};!function(e){e||(e=Ml),An({reactionScheduler:e})}(Il.unstable_batchedUpdates),Dl.finalizeAllImmediately;let Gl=1,Wl=1;class Hl{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,o=Gl++,s={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(s,this.time),this.channels.set(o,s),o}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const e of t)this._setChannelTime(e,this.time);const n=this.animations.values();for(const e of n){const{animation:t,channel:n}=e;t.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=Wl++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}const Zl={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function ql(e){let t=Xl(e);if("object"!==t)return{value:e,...Zl[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Zl[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Xl(e.value),{...e,...Zl[t],type:t}):{type:"object",value:null};throw new Error("props")}function Xl(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const Yl={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Kl=/void\s+main\s*\([^)]*\)\s*\{\n?/,Jl=/}\n?[^{}]*$/,Ql=[],ec="__LUMA_INJECT_DECLARATIONS__";function tc(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[nc(n)][n]=i}return t}function nc(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function ic(e,t,n,i=!1){const r="vertex"===t;for(const t in n){const i=n[t];i.sort(((e,t)=>e.order-t.order)),Ql.length=i.length;for(let e=0,t=i.length;e<t;++e)Ql[e]=i[e].injection;const o=`${Ql.join("\n")}\n`;switch(t){case"vs:#decl":r&&(e=e.replace(ec,o));break;case"vs:#main-start":r&&(e=e.replace(Kl,(e=>e+o)));break;case"vs:#main-end":r&&(e=e.replace(Jl,(e=>o+e)));break;case"fs:#decl":r||(e=e.replace(ec,o));break;case"fs:#main-start":r||(e=e.replace(Kl,(e=>e+o)));break;case"fs:#main-end":r||(e=e.replace(Jl,(e=>o+e)));break;default:e=e.replace(t,(e=>e+o))}}return e=e.replace(ec,""),i&&(e=e.replace(/\}\s*$/,(e=>e+Yl[t]))),e}function rc(e){e.map((e=>function(e){if(e.instance)return;rc(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:i={}}=e,r={normalizedInjections:tc(i),parsedDeprecations:sc(n)};t&&(r.propValidators=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=ql(i);return t}(t)),e.instance=r;let o={};t&&(o=Object.entries(t).reduce(((e,[t,n])=>{const i=n?.value;return i&&(e[t]=i),e}),{})),e.defaultUniforms={...e.defaultUniforms,...o}}(e)))}function oc(e,t,n){e.deprecations?.forEach((e=>{e.regex?.test(t)&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())}))}function sc(e){return e.forEach((e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)})),e}function ac(e){rc(e);const t={},n={};lc({modules:e,level:0,moduleMap:t,moduleDepth:n});const i=Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]));return rc(i),i}function lc(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const e of t)i[e.name]=e,(void 0===r[e.name]||r[e.name]<n)&&(r[e.name]=n);for(const e of t)e.dependencies&&lc({modules:e.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}const cc=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],uc=[...cc,[pc("attribute"),"in $1"],[pc("varying"),"out $1"]],hc=[...cc,[pc("varying"),"in $1"]];function dc(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function pc(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function fc(e,t){let n="";for(const i in e){const r=e[i];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[i]){const e=t[i];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}function gc(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,o]=i.split(":"),s=i.replace(/\(.+/,""),a=Object.assign(e,{signature:o});switch(r){case"vs":t.vertex[s]=a;break;case"fs":t.fragment[s]=a;break;default:throw new Error(r)}}return t}function mc(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}function _c(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function yc(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const vc=`\n\n${ec}\n`;function bc(e,t){const{source:n,stage:i,modules:r,hookFunctions:o=[],inject:s={},log:a}=t;mc("string"==typeof n,"shader source must be a string");const l=n;let c="";const u=gc(o),h={},d={},p={};for(const e in s){const t="string"==typeof s[e]?{injection:s[e],order:0}:s[e],n=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(n){const i=n[2],r=n[3];i?"decl"===r?d[e]=[t]:p[e]=[t]:h[e]=[t]}else p[e]=[t]}const f=r;for(const e of f){a&&oc(e,l,a),c+=Ec(e,"wgsl");const t=e.injections?.[i]||{};for(const e in t){const n=/^(v|f)s:#([\w-]+)$/.exec(e);if(n){const i="decl"===n[2]?d:p;i[e]=i[e]||[],i[e].push(t[e])}else h[e]=h[e]||[],h[e].push(t[e])}}return c+=vc,c=ic(c,i,d),c+=fc(u[i],h),c+=l,c=ic(c,i,p),c}function xc(e,t){const{id:n,source:i,stage:r,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;mc("string"==typeof i,"shader source must be a string");const d="glsl"===o?function(e){return{name:_c(e,void 0),language:"glsl",version:yc(e)}}(i).version:-1,p=e.shaderLanguageVersion,f=100===d?"#version 100":"#version 300 es",g=i.split("\n").slice(1).join("\n"),m={};s.forEach((e=>{Object.assign(m,e.defines)})),Object.assign(m,a);let _="";switch(o){case"wgsl":break;case"glsl":_=u?`${f}\n\n// ----- PROLOGUE -------------------------\n${function(e){const{id:t,source:n,stage:i}=e;return t&&-1===n.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${t}_${i}`:""}({id:n,source:i,stage:r})}\n#define SHADER_TYPE_${r.toUpperCase()}\n\n${function(e){switch(e?.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===r?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(m)}\n\n`:`${f}\n`}const y=gc(l),v={},b={},x={};for(const e in c){const t="string"==typeof c[e]?{injection:c[e],order:0}:c[e],n=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(n){const i=n[2],r=n[3];i?"decl"===r?b[e]=[t]:x[e]=[t]:v[e]=[t]}else x[e]=[t]}for(const e of s){h&&oc(e,g,h),_+=Ec(e,r);const t=e.instance?.normalizedInjections[r]||{};for(const e in t){const n=/^(v|f)s:#([\w-]+)$/.exec(e);if(n){const i="decl"===n[2]?b:x;i[e]=i[e]||[],i[e].push(t[e])}else v[e]=v[e]||[],v[e].push(t[e])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=vc,_=ic(_,r,b),_+=fc(y[r],v),_+=g,_=ic(_,r,x),"glsl"===o&&d!==p&&(_=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return dc(e,uc);case"fragment":return dc(e,hc);default:throw new Error(t)}}(_,r)),_.trim()}function wc(e){return function(t){const n={};for(const i of e){const e=i.getUniforms?.(t,n);Object.assign(n,e)}return n}}function Ec(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:mc(!1)}if(!e.name)throw new Error("Shader module must have a name");const i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(r+=`#define MODULE_${i}\n`),r+=`${n}\n`,r}const Sc=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,Tc=/^\s*\#\s*endif\s*$/;class Cc{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Cc.defaultShaderAssembler=Cc.defaultShaderAssembler||new Cc,Cc.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:r}=function(e){const t=ac(e.modules||[]);return{source:bc(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:wc(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),o="wgsl"===e.platformInfo.shaderLanguage?function(e){const t=e.split("\n"),n=[];let i=!0,r=null;for(const e of t){const t=e.match(Sc),o=e.match(Tc);t?(r=t[1],i=Boolean(undefined)):o?i=!0:i&&n.push(e)}return n.join("\n")}(i):i;return{source:o,getUniforms:r,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=function(e){const{vs:t,fs:n}=e,i=ac(e.modules||[]);return{vs:xc(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:xc(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:wc(i)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...i,modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let e=0,r=this._defaultModules.length;e<r;++e){const r=this._defaultModules[e],o=r.name;t[i++]=r,n[o]=!0}for(let r=0,o=e.length;r<o;++r){const o=e[r],s=o.name;n[s]||(t[i++]=o,n[s]=!0)}return t.length=i,rc(t),t}}const Ac="#define SMOOTH_EDGE_RADIUS 0.5",Pc={name:"geometry",source:"const SMOOTH_EDGE_RADIUS: f32 = 0.5;\n\nstruct VertexGeometry {\n  position: vec4<f32>,\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  normal: vec3<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\nvar<private> geometry_: VertexGeometry = VertexGeometry(\n  vec4<f32>(0.0, 0.0, 1.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec3<f32>(0.0, 0.0, 0.0)\n);\n\nstruct FragmentGeometry {\n  uv: vec2<f32>,\n};\n\nvar<private> fragmentGeometry: FragmentGeometry;\n\nfn smoothedge(edge: f32, x: f32) -> f32 {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n",vs:`${Ac}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`${Ac}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`},Ic=[Pc],Mc=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Rc=[];function kc(e){const t=Cc.getDefaultShaderAssembler();for(const e of Ic)t.addDefaultModule(e);const n="glsl"===e?Mc:Rc;for(const e of n)t.addShaderHook(e);return t}const Oc="uniform layerUniforms {\n  uniform float opacity;\n} layer;\n",Lc={name:"layer",vs:Oc,fs:Oc,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Dc=Symbol.for("component"),Fc=Symbol.for("propTypes"),Nc=Symbol.for("deprecatedProps"),Bc=Symbol.for("asyncPropDefaults"),zc=Symbol.for("asyncPropOriginal"),jc=Symbol.for("asyncPropResolved");let Uc={};function Vc(e){Uc=e}function $c(e,t,n,i){vo.level>0&&Uc[e]&&Uc[e].call(null,t,n,i)}function Gc(e,t=()=>!0){return Array.isArray(e)?Wc(e,t,[]):t(e)?[e]:[]}function Wc(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?Wc(r,t,n):t(r)&&n.push(r)}return n}function Hc({target:e,source:t,start:n=0,count:i=1}){const r=t.length,o=i*r;let s=0;for(let i=n;s<r;s++)e[i++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+o-s),s=o);return e}function Zc(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class qc{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Zc(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Zc()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Xc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(e=[]){e.forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(i=e instanceof qc?e:new qc(t,n),this.stats[t]=i),i}}const Yc=e=>"function"==typeof e,Kc=e=>null!==e&&"object"==typeof e,Jc=e=>Kc(e)&&e.constructor==={}.constructor,Qc=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,eu=e=>"undefined"!=typeof Blob&&e instanceof Blob,tu=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Kc(e)&&Yc(e.tee)&&Yc(e.cancel)&&Yc(e.getReader))(e)||(e=>Kc(e)&&Yc(e.read)&&Yc(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);function nu(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function iu(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions))}function ru(e){let t;return nu(e,"null loader"),nu(iu(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const ou={};class su extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const au=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,lu=/^([-\w.]+\/[-\w.+]+)/;function cu(e,t){return e.toLowerCase()===t.toLowerCase()}function uu(e){const t=au.exec(e);return t?t[1]:""}const hu=/\?.*/;function du(e){return e.replace(hu,"")}function pu(e){return Qc(e)?e.url:eu(e)?e.name||"":"string"==typeof e?e:""}function fu(e){if(Qc(e)){const t=e,n=t.headers.get("content-type")||"",i=du(t.url);return function(e){const t=lu.exec(e);return t?t[1]:e}(n)||uu(i)}return eu(e)?e.type||"":"string"==typeof e?uu(e):""}async function gu(e){if(Qc(e))return e;const t={},n=function(e){return Qc(e)?e.headers["content-length"]||-1:eu(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const i=pu(e),r=fu(e);r&&(t["content-type"]=r);const o=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>e(t?.target?.result),n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const t=function(e){let t="";const n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return btoa(t)}(e.slice(0,5));return`data:base64,${t}`}return null}(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:i}),s}async function mu(e,t){if("string"==typeof e){const n=function(e){for(const t in ou)if(e.startsWith(t)){const n=ou[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,t):await fetch(n,t)}return await gu(e)}const _u=new go({id:"loaders.gl"});class yu{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const vu=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),bu="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),xu=(bu&&parseFloat(bu[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:vu,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),wu={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Eu(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Su(){const e=Eu();return e.globalOptions=e.globalOptions||{...xu},e.globalOptions}function Tu(e,t,n,i){return n=n||[],function(e,t){Cu(e,null,xu,wu,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Cu(i,n.id,r,o,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const i={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(i,n),null===i.log&&(i.log=new yu),Pu(i,Su()),Pu(i,t),i}(t,e,i)}function Cu(e,t,n,i,r){const o=t||"Top level",s=t?`${t}.`:"";for(const a in e){const l=!t&&Kc(e[a]);if(!(a in n)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in i)_u.warn(`${o} loader option '${s}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const e=Au(a,r);_u.warn(`${o} loader option '${s}${a}' not recognized. ${e}`)()}}}function Au(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const o=t.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||`Did you mean '${r.id}.${t}'?`)}return i}function Pu(e,t){for(const n in t)if(n in t){const i=t[n];Jc(i)&&Jc(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Iu(e,t){const n=Su(),i=e||n;return"function"==typeof i.fetch?i.fetch:Kc(i.fetch)?e=>mu(e,i.fetch):t?.fetch?t?.fetch:mu}function Mu(e,t){return Ru(e||{},t)}function Ru(e,t,n=0){if(n>3)return t;const i={...e};for(const[e,r]of Object.entries(t))r&&"object"==typeof r&&!Array.isArray(r)?i[e]=Ru(i[e]||{},t[e],n+1):i[e]=t[e];return i}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const ku="object"!=typeof process||"[object process]"!==String(process)||process.browser,Ou="undefined"!=typeof window&&void 0!==window.orientation,Lu="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Lu&&parseFloat(Lu[1]);class Du{terminate(){}}function Fu(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Nu=new Map;function Bu(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function zu(e,t=!0,n){const i=n||new Set;if(e)if(ju(e))i.add(e);else if(ju(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const n in e)zu(e[n],t,i);return void 0===n?Array.from(i):[]}function ju(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}const Uu=()=>{};class Vu{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&ku||void 0!==Du&&!ku}constructor(e){const{name:t,source:n,url:i}=e;Fu(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Uu,this.onError=e=>console.log(e),this.worker=ku?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Uu,this.onError=Uu,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||zu(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){Fu(e.source&&!e.url||!e.source&&e.url);let t=Nu.get(e.source||e.url);return t||(e.url&&(t=(n=e.url).startsWith("http")?Bu(`try {\n  importScripts('${n}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):n,Nu.set(e.url,t)),e.source&&(t=Bu(e.source),Nu.set(e.source,t))),Fu(t),t;var n}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Du(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Du(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class $u{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Fu(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Fu(this.isRunning),this.isRunning=!1,this._reject(e)}}class Gu{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Vu.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,n)=>e.done(n),n=(e,t)=>e.error(t)){const i=new Promise((i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new $u(t.name,e);e.onMessage=e=>t.onMessage(n,e.type,e.payload),e.onError=e=>t.onError(n,e),t.onStart(n);try{await n.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!ku||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Vu({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Ou?this.maxMobileConcurrency:this.maxConcurrency}}const Wu={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Hu{props;workerPools=new Map;static _workerFarm;static isSupported(){return Vu.isSupported()}static getWorkerFarm(e={}){return Hu._workerFarm=Hu._workerFarm||new Hu({}),Hu._workerFarm.setProps(e),Hu._workerFarm}constructor(e){this.props={...Wu},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new Gu({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}async function Zu(e,t,n,i,r){const o=e.id,s=function(e,t={}){const n=t[e.id]||{},i=ku?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=ku?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${i}`}return Fu(r),r}(e,n),a=Hu.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",qu.bind(null,r));l.postMessage("process",{input:t,options:n,context:i});const c=await l.result;return await c.result}async function qu(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:r,input:o,options:s}=i;try{const n=await e(o,s);t.postMessage("done",{id:r,result:n})}catch(e){const n=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:n})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version;const Xu=262144;function Yu(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Ku(e,t){return vu?async function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();t?._streamReadAhead&&(i=n.read());const{done:r,value:o}=await e;if(r)return;yield Yu(o)}}catch(e){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield Yu(t)}(e)}const Ju="Cannot convert supplied data type";async function Qu(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t){if(t.text&&"string"==typeof e)return e;if((e=>e&&"object"==typeof e&&e.isBuffer)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(Ju)}(e,t);if(eu(e)&&(e=await gu(e)),Qc(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){const t=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let n=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(e){}return new su(n,i)}(e);throw t}}(n),t.binary?await n.arrayBuffer():await n.text()}if(tu(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const n=t?.chunkSize||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),o=e.slice(i,i+t);i+=t,yield r.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=Xu}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),o=new Uint8Array(e,i,t);new Uint8Array(r).set(o),i+=t,yield r}}(e,t);if(eu(e))return async function*(e,t){const n=t?.chunkSize||1048576;let i=0;for(;i<e.size;){const t=i+n,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(tu(e))return Ku(e,t);if(Qc(e))return Ku(e.body,t);throw new Error("makeIterator")}(e,n)),(e=>Boolean(e)&&"function"==typeof e[Symbol.iterator])(e)||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const n of e)t.push(n);return function(...e){return function(e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i.buffer}(e)}(...t)}(e);throw new Error(Ju)}function eh(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}const th="4.3.3",nh=th[0]>="0"&&th[0]<="9"?`v${th}`:"",ih=function(){const e=new go({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=nh,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}(),rh=()=>{const e=Eu();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},oh=/\.([^.]+)$/;function sh(e,t=[],n,i){if(!ah(e))return null;if(t&&!Array.isArray(t))return ru(t);let r=[];t&&(r=r.concat(t)),n?.ignoreRegisteredLoaders||r.push(...rh()),function(e){for(const t of e)ru(t)}(r);const o=function(e,t,n,i){const r=pu(e),o=fu(e),s=du(r)||i?.url;let a=null,l="";return n?.mimeType&&(a=ch(t,n?.mimeType),l=`match forced by supplied MIME type ${n?.mimeType}`),a=a||function(e,t){const n=t&&oh.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,s),l=l||(a?`matched url ${s}`:""),a=a||ch(t,o),l=l||(a?`matched MIME type ${o}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(uh(t,n))return n}else if(ArrayBuffer.isView(t)){if(hh(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&hh(t,0,n))return n;return null}(t,e),l=l||(a?`matched initial data ${dh(e)}`:""),n?.fallbackMimeType&&(a=a||ch(t,n?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${o}`:"")),l&&ih.log(1,`selectLoader selected ${a?.name}: ${l}.`),a}(e,r,n,i);if(!o&&!n?.nothrow)throw new Error(lh(e));return o}function ah(e){return!(e instanceof Response&&204===e.status)}function lh(e){const t=pu(e),n=fu(e);let i="No valid loader found (";i+=t?`${eh(t)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?dh(e):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function ch(e,t){for(const n of e){if(n.mimeTypes?.some((e=>cu(t,e))))return n;if(cu(t,`application/x.${n.id}`))return n}return null}function uh(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function hh(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((n=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==r[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":return i===ph(e,t,i.length);default:return!1}}(e,t,0,n)))}function dh(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?ph(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?ph(e,0,t):""}function ph(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let e=0;e<n;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}async function fh(e,t,n,i){!t||Array.isArray(t)||iu(t)||(i=void 0,n=t,t=void 0),n=n||{};const r=pu(e=await e),o=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,i),s=await async function(e,t=[],n,i){if(!ah(e))return null;let r=sh(e,t,{...n,nothrow:!0},i);if(r)return r;if(eu(e)&&(r=sh(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!r&&!n?.nothrow)throw new Error(lh(e));return r}(e,o,n);return s?(i=function(e,t,n){if(n)return n;const i={fetch:Iu(t,e),...e};if(i.url){const e=du(i.url);i.baseUrl=e,i.queryString=function(e){const t=e.match(hu);return t&&t[0]}(i.url),i.filename=eh(e),i.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,_parse:fh,loaders:o},n=Tu(n,s,o,r),i||null),await async function(e,t,n,i){if(function(e){Fu(e,"no worker provided");e.version}(e),n=Mu(e.options,n),Qc(t)){const e=t,{ok:n,redirected:r,status:o,statusText:s,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());i.response={headers:c,ok:n,redirected:r,status:o,statusText:s,type:a,url:l}}t=await Qu(t,e,n);const r=e;if(r.parseTextSync&&"string"==typeof t)return r.parseTextSync(t,n,i);if(function(e,t){return!!Hu.isSupported()&&!(!ku&&!t?._nodeWorkers)&&e.worker&&t?.worker}(e,n))return await Zu(e,t,n,i,fh);if(r.parseText&&"string"==typeof t)return await r.parseText(t,n,i);if(r.parse)return await r.parse(t,n,i);throw Fu(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(s,e,n,i)):null}async function gh(e,t,n,i){let r,o;Array.isArray(t)||iu(t)?(r=t,o=n):(r=[],o=t);const s=Iu(o);let a=e;return"string"==typeof e&&(a=await s(e)),eu(e)&&(a=await s(e)),Array.isArray(r),await fh(a,r,o)}class mh{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"==typeof e&&(i=gh(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)})).catch((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const e of this._subscribers)e.onChange(this.getData())}}class _h{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new mh(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e],i=this._resources[n.resourceId];i&&i.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:o}=this;e.startsWith(o)&&(r[e=e.replace(o,"")]||this.add({resourceId:e,data:null,persistent:!1}));const s=r[e];if(this._track(n,i,s,t),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,o=r[e]=r[e]||{};let s=o[t];const a=s&&s.resourceId&&this._resources[s.resourceId];a&&(a.unsubscribe(s),this.prune()),n&&(s?(s.onChange=i,s.resourceId=n.id):s={onChange:i,resourceId:n.id},o[t]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}class yh{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{$c("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:n,stats:i,viewport:r,timeline:o}=t||{};this.layers=[],this.resourceManager=new _h({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:kc(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[Lc],renderPass:void 0,stats:i||new Xc({id:"deck.gl"}),viewport:r||new Ya({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Hl,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter((t=>e.find((e=>0===t.id.indexOf(e))))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){$c("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=Gc(e,Boolean);for(const e of n)e.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find((t=>t.name===e.name))||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex((t=>t.name===e.name));n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const t of e)n[t.id]?vo.warn(`Multiple old layers with same id ${t.id}`)():n[t.id]=t;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const e of i)if(e.hasUniformTransition()){r=`Uniform transition in ${e}`;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const e=t[i.id];null===e&&vo.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let r=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),r=i.isComposite?i.getSubLayers():null}catch(e){this._handleError("matching",e,i)}r&&this._updateSublayersRecursively(r,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}class vh{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter((t=>t.containsPixel(e))):this._viewports}getViews(){const e={};return this.views.forEach((t=>{e[t.id]=t})),e}getView(e){return this.views.find((t=>t.id===e))}getViewState(e){const t="string"==typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(i)){const n=e.slice();return n[0]-=o.x,n[1]-=o.y,o.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Gc(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Xr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):vo.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,n,i){const r=e.controller;if(r&&n){const o={...t,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return i&&i.constructor===r.type||(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const r=e[i],o=this.getViewState(r),s=r.makeViewport({viewState:o,width:this.width,height:this.height});let a=t[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,o,s,a),s&&this._viewports.unshift(s)}for(const e in t){const n=t[e];n&&!this.controllers[e]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)}))}_diffViews(e,t){return e.length!==t.length||e.some(((n,i)=>!e[i].equals(t[i])))}}const bh=/([0-9]+\.?[0-9]*)(%|px)/;function xh(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=bh.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function wh(e,t){return e.relative?Math.round(e.position*t):e.position}class Eh{constructor(e){const{id:t,x:n=0,y:i=0,width:r="100%",height:o="100%",padding:s=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xh(n),this._y=xh(i),this._width=xh(r),this._height=xh(o),this._padding=s&&{left:xh(s.left||0),right:xh(s.right||0),top:xh(s.top||0),bottom:xh(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&Xr(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});return i.height&&i.width?new(this.getViewportType(n))({...n,...this.props,...i}):null}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){const n={x:wh(this._x,e),y:wh(this._y,t),width:wh(this._width,e),height:wh(this._height,t)};return this._padding&&(n.padding={left:wh(this._padding.left,e),top:wh(this._padding.top,t),right:wh(this._padding.right,e),bottom:wh(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class Sh{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Th=()=>{},Ch=e=>e;class Ah{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:o,easing:s}}=e,a=s(t/o),l=n.interpolateProps(i,r,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Sh(e.timeline),this.onViewStateChange=e.onViewStateChange||Th,this.onStateChange=e.onStateChange||Th}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;i={...n,...2===e?t:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator,o=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===o)return;const s=r.initializeProps(e,i);this.propsInTransition={};const a={duration:o,easing:t.transitionEasing||Ch,interpolator:r,interruption:t.transitionInterruption||1,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}const Ph=["longitude","latitude","zoom","bearing","pitch"],Ih=["longitude","latitude","zoom"];class Mh extends al{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Ph,required:Ih},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const o=i(e),s=i(t),a=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:s.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=To(e[r]||0,t[r]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,To(e.around,t.around,n)))}return i}}const Rh={transitionDuration:0},kh=e=>1-(1-e)*(1-e),Oh=["wheel"],Lh=["panstart","panmove","panend"],Dh=["pinchstart","pinchmove","pinchend"],Fh=["multipanstart","multipanmove","multipanend"],Nh=["dblclick"],Bh=["keydown"],zh={};class jh{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Ah({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout((()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)}),e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:s=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(Oh,c&&n),this.toggleEvents(Lh,c),this.toggleEvents(Dh,c&&(s||a)),this.toggleEvents(Fh,c&&a),this.toggleEvents(Nh,c&&o),this.toggleEvents(Bh,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=s,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach((e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))}))}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Rh,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Rh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Rh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==o&&(o=1/o);const s=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Rh,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Rh,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return zh._startPinchRotation=e.rotation,zh._lastPinchEvent=e,this.updateViewport(n,Rh,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:zh._startPinchRotation-n})}return this.updateViewport(t,Rh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),zh._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=zh;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),s=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,o+s*t/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return zh._startPinchRotation=null,zh._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:o}=!0===this.keyboard?{}:this.keyboard,{controllerState:s}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?s.zoomOut(n).zoomOut(n):s.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?s.zoomIn(n).zoomIn(n):s.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=s.rotateLeft(r),l.isRotating=!0):(a=s.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(a=s.rotateRight(r),l.isRotating=!0):(a=s.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(a=s.rotateUp(o),l.isRotating=!0):(a=s.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(a=s.rotateDown(o),l.isRotating=!0):(a=s.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new Mh({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:Rh}}class Uh{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class Vh extends Uh{constructor(e){const{width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:f,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:y,startZoom:v,normalize:b=!0}=e;sl(Number.isFinite(r)),sl(Number.isFinite(i)),sl(Number.isFinite(o)),super({width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:p,normalize:b,position:c},{startPanLngLat:f,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:y,startZoom:v}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:o}=this.getState();if(!i||void 0===r||void 0===o)return this;let s;return s=e?this._getNewRotation(e,i,o,r):{bearing:r+t,pitch:o+n},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:o,minZoom:s}=this.getViewportProps();let a=i+Math.log2(n);a=So(a,s,o);const l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=So(i,n,t);const{maxPitch:r,minPitch:o,pitch:s}=e;e.pitch=So(s,o,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:r,latitude:o,zoom:s,bearing:a=0}=e;(r<-180||r>180)&&(r=ms(r+180,360)-180),(a<-180||a>180)&&(a=ms(a+180,360)-180);const l=ys(n/512);if(s<=l)s=l,o=0;else{const e=n/2/Math.pow(2,s),t=Ms([0,e])[1];if(o<t)o=t;else{const t=Ms([0,512-e])[1];o>t&&(o=t)}}return{width:t,height:n,longitude:r,latitude:o,zoom:s,pitch:i,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const r=e[0]-t[0],o=e[1]-t[1],s=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;o>0?Math.abs(c-a)>5&&(h=o/(a-c)*1.2):o<0&&a>5&&(h=1-s/a),h=So(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps();let f=n;return h>0?f=n+h*(p-n):h<0&&(f=n-h*(d-n)),{pitch:f,bearing:i+180*u}}}class $h extends jh{constructor(){super(...arguments),this.ControllerState=Vh,this.transition={transitionDuration:300,transitionInterpolator:new Mh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Gh extends Eh{constructor(e={}){super(e)}getViewportType(){return Ja}get ControllerType(){return $h}}Gh.displayName="MapView";const Wh=Gh,Hh=[255,255,255],Zh=1;let qh=0;class Xh{constructor(e={}){this.type="ambient";const{color:t=Hh}=e,{intensity:n=Zh}=e;this.id=e.id||"ambient-"+qh++,this.color=t,this.intensity=n}}const Yh=[255,255,255],Kh=1,Jh=[0,0,-1];let Qh=0;class ed{constructor(e={}){this.type="directional";const{color:t=Yh}=e,{intensity:n=Kh}=e,{direction:i=Jh}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-"+Qh++,this.color=t,this.intensity=n,this.type="directional",this.direction=new Uo(i).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class td{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class nd extends td{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,r=e.clearColor??(!!i&&[0,0,0,0]),o=!!i&&1,s=!!i&&0,a=e.colorMask??15,l={viewport:[0,0,t,n]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:r,clearDepth:o,clearStencil:s});try{return this._drawLayers(c,e)}finally{c.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:r,views:o,onViewportActive:s,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const a of r){const r=o&&o[a.id];s?.(a);const c=this._getDrawLayerParams(a,t),u=a.subViewports||[a];for(const o of u){const s=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:o,view:r,pass:t.pass,layers:t.layers},c);l.push(s)}}return l}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:r,cullRect:o,effects:s,shaderModuleProps:a},l=!1){const c=[],u=id(this._lastRenderIndex+1),h={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:o},d={};for(let i=0;i<t.length;i++){const o=t[i],p=this._shouldDrawLayer(o,h,r,d),f={shouldDrawLayer:p};p&&!l&&(f.shouldDrawLayer=!0,f.layerRenderIndex=u(o,p),f.shaderModuleProps=this._getShaderModuleProps(o,s,n,a),f.layerParameters={...o.context.deck?.props.parameters,...this.getLayerParameters(o,i,e)}),c[i]=f}return c}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:i,target:r,viewport:o,view:s},a){const l=function(e,{shaderModuleProps:t,target:n,viewport:i}){const r=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),s=n?n.height:o,a=i;return[a.x*r,s-(a.y+a.height)*r,a.width*r,a.height*r]}(this.device,{shaderModuleProps:n,target:r,viewport:o});if(s&&s.props.clear){const e=!0===s.props.clear?{color:!0,depth:!0}:s.props.clear;this.device.beginRenderPass({framebuffer:r,parameters:{viewport:l,scissorRect:l},clearColor:!!e.color&&[0,0,0,0],clearDepth:!!e.depth&&1}).end()}const c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let n=0;n<t.length;n++){const r=t[n],s=a[n],{shouldDrawLayer:l}=s;if(l&&r.props.pickable&&c.pickableCount++,r.isComposite&&c.compositeCount++,r.isDrawable&&s.shouldDrawLayer){const{layerRenderIndex:t,shaderModuleProps:n,layerParameters:a}=s;c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),n.project&&(n.project.viewport=o),r.context.renderPass=e;try{r._drawLayer({renderPass:e,shaderModuleProps:n,uniforms:{layerIndex:t},parameters:a})}catch(e){r.raiseError(e,`drawing ${r} to ${i}`)}}}return c}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in i||(i[e]=n(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){const r=this.device.canvasContext.cssToDeviceRatio(),o=e.internalState?.propsInTransition||e.props,s={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:r,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const n of t)rd(s,n.getShaderModuleProps?.(e,s));return rd(s,this.getShaderModuleProps(e,t,s),i)}}function id(e=0,t={}){const n={},i=(r,o)=>{const s=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&i(r.parent,!1),l in n){const e=n[l]=n[l]||id(t[l],t);c=e(r,o),n[a]=e}else Number.isFinite(s)?(c=s+(t[l]||0),n[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return i}function rd(e,...t){for(const n of t)if(n)for(const t in n)e[t]?Object.assign(e[t],n[t]):e[t]=n[t];return e}class od extends nd{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],r=i.width*n,o=i.height*n;r===t.width&&o===t.height||t.resize({width:r,height:o}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}function sd(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function ad(e){let t,n={};return i=>{for(const r in i)if(!sd(i[r],n[r])){t=e(i),n=i;break}return t}}const ld=[0,0,0,0],cd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ud=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],hd=[0,0,0],dd=[0,0,0],pd=ad((function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:o,viewProjectionMatrix:s}=e,a=ld,l=ld,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=fd(e,t,n);return d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=rs([],l,s),o=i||o,s=Yo([],r,o),s=Yo([],s,cd)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,n,i),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=rs([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,p={coordinateSystem:n,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:s.slice(0,3),center:r,pseudoMeters:Boolean(e._pseudoMeters),viewportSize:h,devicePixelRatio:t,focalDistance:d,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:hd,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:ud,cameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case ja.METER_OFFSETS:p.commonUnitsPerWorldUnit=t.unitsPerMeter,p.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case ja.LNGLAT:case ja.LNGLAT_OFFSETS:e._pseudoMeters||(p.commonUnitsPerMeter=t.unitsPerMeter),p.commonUnitsPerWorldUnit=t.unitsPerDegree,p.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case ja.CARTESIAN:p.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],p.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return p}));function fd(e,t,n=dd){n.length<3&&(n=[n[0],n[1],0]);let i,r=n,o=!0;switch(i=t===ja.LNGLAT_OFFSETS||t===ja.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Ua.WEB_MERCATOR:t!==ja.LNGLAT&&t!==ja.CARTESIAN||(i=[0,0,0],o=!1);break;case Ua.WEB_MERCATOR_AUTO_OFFSET:t===ja.LNGLAT?r=i:t===ja.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Ua.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case Ua.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}const gd=`${Object.keys(ja).map((e=>`const COORDINATE_SYSTEM_${e}: i32 = ${ja[e]};`)).join("")}\n${Object.keys(Ua).map((e=>`const PROJECTION_MODE_${e}: i32 = ${Ua[e]};`)).join("")}\n${Object.keys(Va).map((e=>`const UNIT_${e.toUpperCase()}: i32 = ${Va[e]};`)).join("")}\n\nconst TILE_SIZE: f32 = 512.0;\nconst PI: f32 = 3.1415926536;\nconst WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);\nconst ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);\nconst EARTH_RADIUS: f32 = 6370972.0; // meters\nconst GLOBE_RADIUS: f32 = 256.0;\n\n// -----------------------------------------------------------------------------\n// Uniform block (converted from GLSL uniform block)\n// -----------------------------------------------------------------------------\nstruct ProjectUniforms {\n  wrapLongitude: i32,\n  coordinateSystem: i32,\n  commonUnitsPerMeter: vec3<f32>,\n  projectionMode: i32,\n  scale: f32,\n  commonUnitsPerWorldUnit: vec3<f32>,\n  commonUnitsPerWorldUnit2: vec3<f32>,\n  center: vec4<f32>,\n  modelMatrix: mat4x4<f32>,\n  viewProjectionMatrix: mat4x4<f32>,\n  viewportSize: vec2<f32>,\n  devicePixelRatio: f32,\n  focalDistance: f32,\n  cameraPosition: vec3<f32>,\n  coordinateOrigin: vec3<f32>,\n  commonOrigin: vec3<f32>,\n  pseudoMeters: i32,\n};\n\n@group(0) @binding(0)\nvar<uniform> project: ProjectUniforms;\n\n// -----------------------------------------------------------------------------\n// Geometry data\n// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,\n// you might supply this via vertex attributes or a uniform. Here we define a\n// uniform struct for demonstration.)\n// -----------------------------------------------------------------------------\n\n// Structure to carry additional geometry data used by deck.gl filters.\nstruct Geometry {\n  worldPosition: vec3<f32>,\n  worldPositionAlt: vec3<f32>,\n  position: vec4<f32>,\n  uv: vec2<f32>,\n  pickingColor: vec3<f32>,\n};\n\n// @group(0) @binding(1)\nvar<private> geometry: Geometry;\n\n\n// -----------------------------------------------------------------------------\n// Functions\n// -----------------------------------------------------------------------------\n\n// Returns an adjustment factor for commonUnitsPerMeter\nfn _project_size_at_latitude(lat: f32) -> f32 {\n  let y = clamp(lat, -89.9, 89.9);\n  return 1.0 / cos(radians(y));\n}\n\n// Overloaded version: scales a value in meters at a given latitude.\nfn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);\n}\n\n// Computes a non-linear scale factor based on geometry.\n// (Note: This function relies on "geometry" being provided.)\nfn project_size() -> f32 {\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n      project.pseudoMeters == 0) {\n    if (geometry.position.w == 0.0) {\n      return _project_size_at_latitude(geometry.worldPosition.y);\n    }\n    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    let y2 = y * y;\n    let y4 = y2 * y2;\n    let y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\n\n// Overloads to scale offsets (meters to world units)\nfn project_size_float(meters: f32) -> f32 {\n  return meters * project.commonUnitsPerMeter.z * project_size();\n}\n\nfn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {\n  return meters * project.commonUnitsPerMeter.xy * project_size();\n}\n\nfn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {\n  return meters * project.commonUnitsPerMeter * project_size();\n}\n\nfn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {\n  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\n\n// Returns a rotation matrix aligning the zaxis with the given up vector.\nfn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {\n  let uz = normalize(up);\n  let ux = select(\n    vec3<f32>(1.0, 0.0, 0.0),\n    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),\n    abs(uz.z) == 1.0\n  );\n  let uy = cross(uz, ux);\n  return mat3x3<f32>(ux, uy, uz);\n}\n\n// Since WGSL does not support "out" parameters, we return a struct.\nstruct RotationResult {\n  needsRotation: bool,\n  transform: mat3x3<f32>,\n};\n\nfn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    return RotationResult(true, project_get_orientation_matrix(commonPosition));\n  } else {\n    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed\n  };\n}\n\n// Projects a normal vector from the current coordinate system to world space.\nfn project_normal(vector: vec3<f32>) -> vec3<f32> {\n  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);\n  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\n  let rotResult = project_needs_rotation(geometry.position.xyz);\n  if (rotResult.needsRotation) {\n    n = rotResult.transform * n;\n  }\n  return n;\n}\n\n// Applies a scale offset based on y-offset (dy)\nfn project_offset_(offset: vec4<f32>) -> vec4<f32> {\n  let dy: f32 = offset.y;\n  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\n  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\n\n// Projects lng/lat coordinates to a unit tile [0,1]\nfn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {\n  var x = lnglat.x;\n  if (project.wrapLongitude != 0) {\n    x = ((x + 180.0) % 360.0) - 180.0;\n  }\n  let y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2<f32>(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// Projects lng/lat/z coordinates for a globe projection.\nfn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {\n  let lambda = radians(lnglatz.x);\n  let phi = radians(lnglatz.y);\n  let cosPhi = cos(phi);\n  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n  return vec3<f32>(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\n\n// Projects positions (with an optional 64-bit low part) from the input\n// coordinate system to the common space.\nfn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {\n  var position_world = project.modelMatrix * position;\n\n  // Work around for a Mac+NVIDIA bug:\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_mercator_(position_world.xy),\n        _project_size_at_latitude_m(position_world.z, position_world.y),\n        position_world.w\n      );\n    }\n    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_GLOBE) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4<f32>(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\n        return vec4<f32>(\n          project_mercator_(position_world.xy) - project.commonOrigin.xy,\n          project_size_float(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);\n  }\n\n  return project_offset_(position_world) +\n         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));\n}\n\n// Overloaded versions for different input types.\nfn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {\n  return project_position_vec4_f64(position, ZERO_64_LOW);\n}\n\nfn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nfn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nfn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {\n  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\n// Transforms a common space position to clip space.\nfn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {\n  return viewProjectionMatrix * position + center;\n}\n\n// Uses the project viewProjectionMatrix and center.\nfn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {\n  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);\n}\n\n// Returns a clip space offset corresponding to a given number of screen pixels.\nfn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {\n  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\n  return offset * project.focalDistance;\n}\n\nfn project_meter_size_to_pixel(meters: f32) -> f32 {\n  return project_size_float(meters) * project.scale;\n}\n\nfn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {\n  if (unit == UNIT_METERS) {\n    return project_meter_size_to_pixel(size);\n  } else if (unit == UNIT_COMMON) {\n    return size * project.scale;\n  }\n  // UNIT_PIXELS: no scaling applied.\n  return size;\n}\n\nfn project_pixel_size_float(pixels: f32) -> f32 {\n  return pixels / project.scale;\n}\n\nfn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {\n  return pixels / project.scale;\n}\n`,md=Object.keys(ja).map((e=>`const int COORDINATE_SYSTEM_${e} = ${ja[e]};`)).join(""),_d=Object.keys(Ua).map((e=>`const int PROJECTION_MODE_${e} = ${Ua[e]};`)).join(""),yd=Object.keys(Va).map((e=>`const int UNIT_${e.toUpperCase()} = ${Va[e]};`)).join(""),vd={},bd={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"},Pc],source:gd,vs:`${md}\n${_d}\n${yd}\nuniform projectUniforms {\nbool wrapLongitude;\nint coordinateSystem;\nvec3 commonUnitsPerMeter;\nint projectionMode;\nfloat scale;\nvec3 commonUnitsPerWorldUnit;\nvec3 commonUnitsPerWorldUnit2;\nvec4 center;\nmat4 modelMatrix;\nmat4 viewProjectionMatrix;\nvec2 viewportSize;\nfloat devicePixelRatio;\nfloat focalDistance;\nvec3 cameraPosition;\nvec3 coordinateOrigin;\nvec3 commonOrigin;\nbool pseudoMeters;\n} project;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject.pseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project.commonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project.commonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project.commonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project.wrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project.modelMatrix * position;\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project.coordinateOrigin;\n}\n}\nif (project.projectionMode == PROJECTION_MODE_GLOBE) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project.commonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project.projectionMode == PROJECTION_MODE_IDENTITY ||\n(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project.coordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;\nreturn offset * project.focalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project.scale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project.scale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project.scale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project.scale;\n}\n`,getUniforms:function(e=vd){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=ja.DEFAULT,coordinateOrigin:r=dd,autoWrapLongitude:o=!1}){i===ja.DEFAULT&&(i=e.isGeospatial?ja.LNGLAT:ja.CARTESIAN);const s=pd({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return s.wrapLongitude=o,s.modelMatrix=n||ud,s}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},xd="\nuniform shadowUniforms {\n  bool drawShadowMap;\n  bool useShadowMap;\n  vec4 color;\n  highp int lightId;\n  float lightCount;\n  mat4 viewProjectionMatrix0;\n  mat4 viewProjectionMatrix1;\n  vec4 projectCenter0;\n  vec4 projectCenter1;\n} shadow;\n",wd=`\n${xd}\n\nconst int max_lights = 2;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  mat4 viewProjectionMatrices[max_lights];\n  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;\n  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;\n  vec4 projectCenters[max_lights];\n  projectCenters[0] = shadow.projectCenter0;\n  projectCenters[1] = shadow.projectCenter1;\n\n  if (shadow.drawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);\n  }\n  if (shadow.useShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow.lightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n\n`,Ed=`\n${xd}\n\nconst int max_lights = 2;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow.drawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow.useShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow.lightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow.color.a / shadow.lightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n\n`,Sd=ad((function({viewport:e,center:t}){return new hs(e.viewProjectionMatrix).invert().transform(t)})),Td=ad((function({viewport:e,shadowMatrices:t}){const n=[],i=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,o=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((e=>function(e,t){const[n,i,r]=e,o=Ns([n,i,r],t);return Number.isFinite(r)?o:[o[0],o[1],0]}(e,i)));for(const i of t){const t=i.clone().translate(new Uo(e.center).negate()),r=o.map((e=>t.transform(e))),s=(new hs).ortho({left:Math.min(...r.map((e=>e[0]))),right:Math.max(...r.map((e=>e[0]))),bottom:Math.min(...r.map((e=>e[1]))),top:Math.max(...r.map((e=>e[1]))),near:Math.min(...r.map((e=>-e[2]))),far:Math.max(...r.map((e=>-e[2])))});n.push(s.multiplyRight(i))}return n})),Cd=[0,0,0,1],Ad=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Pd={name:"shadow",dependencies:[bd],vs:wd,fs:Ed,inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e){const{shadowEnabled:t=!0,project:n}=e;if(!(t&&n&&e.shadowMatrices&&e.shadowMatrices.length))return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const i=bd.getUniforms(n),r=Sd({viewport:n.viewport,center:i.center}),o=[],s=Td({shadowMatrices:e.shadowMatrices,viewport:n.viewport}).slice();for(let t=0;t<e.shadowMatrices.length;t++){const e=s[t],a=e.clone().translate(new Uo(n.viewport.center).negate());i.coordinateSystem===ja.LNGLAT&&i.projectionMode===Ua.WEB_MERCATOR?(s[t]=a,o[t]=r):(s[t]=e.clone().multiplyRight(Ad),o[t]=a.transform(r))}const a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||Cd,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let e=0;e<s.length;e++)a[`viewProjectionMatrix${e}`]=s[e],a[`projectCenter${e}`]=o[e];for(let t=0;t<2;t++)a[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Id={color:[255,255,255],intensity:1},Md=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Rd=[0,0,0,200/255];class kd{constructor(e={}){this.id="lighting-effect",this.shadowColor=Rd,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(Pd),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((e=>e.shadow)),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map((e=>e.getShadowMap())),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((t=>t.getProjectedLight({layer:e}))),pointLights:this.pointLights.map((t=>t.getProjectedLight({layer:e})))},r=e.props.material;return{shadow:n,lighting:i,phongMaterial:r,gouraudMaterial:r}}cleanup(e){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Pd))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new hs).lookAt({eye:new Uo(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new od(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new Xh(Id),this.directionalLights.push(new ed(Md[0]),new ed(Md[1])))}}const Od=new kd;class Ld{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find((t=>t.id===e.id))){const n=t.findIndex((t=>{return n=e,(t.order??1/0)-(n.order??1/0)>0;var n}));n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Xr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const e of this.effects)t[e.id]=e;const n=[];for(const i of e){const e=t[i.id];let r=i;e&&e!==i?e.setProps?(e.setProps(i.props),r=e):e.cleanup(this._context):e||i.setup(this._context),n.push(r),delete t[i.id]}for(const e in t)t[e].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some((e=>e instanceof kd))||this._resolvedEffects.push(Od),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Dd extends nd{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Fd={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Nd extends nd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pickingFBO:o,deviceRect:{x:s,y:a,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:p,shaderModuleProps:f}){this.pickZ=p;const g=this._resetColorEncoder(p),m=[s,a,l,c],_=super.render({target:o,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,cullRect:u,effects:h?.filter((e=>e.useInPicking)),pass:d,isPicking:!0,shaderModuleProps:f,clearColor:[0,0,0,0],colorMask:15,scissorRect:m});return this._colorEncoderState=null,{decodePickingColor:g&&Bd.bind(null,g),stats:_}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:r,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:r&&o.includes("draw")&&(Object.assign(i,Fd),i.blend=!0,i.blendColor=function(e,t,n){const{byLayer:i,byAlpha:r}=e;let o,s=i.get(t);return s?(s.viewports.push(n),o=s.a):(o=i.size+1,o<=255?(s={a:o,layer:t,viewports:[n]},i.set(t,s),r[o]=s):(vo.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Bd(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}class zd{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Dd(e),this.pickLayersPass=new Nd(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,$c("deckRenderer.renderLayers",this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();0===e.length&&[0,1].map((t=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[n]}))}));for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){i.target=r.id===this.lastPostProcessEffect?t.target:void 0;const e=r.postRender(i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const jd={pickedColor:null,pickedObjectIndex:-1};function Ud({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:o}){const{x:s,y:a,width:l,height:c}=o;let u=r*r,h=-1,d=0;for(let t=0;t<c;t++){const r=t+a-i,o=r*r;if(o>u)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){const e=t+s-n,i=e*e+o;i<=u&&(u=i,h=d)}d+=4}}if(h>=0){const n=e.slice(h,h+4),i=t(n);if(i){const e=Math.floor(h/4/l),t=h/4-e*l;return{...i,pickedColor:n,pickedX:s+t,pickedY:a+e}}vo.error("Picked non-existent layer. Is picking buffer corrupt?")()}return jd}function Vd({pickInfo:e,viewports:t,pixelRatio:n,x:i,y:r,z:o}){let s,a=t[0];if(t.length>1&&(a=function(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.containsPixel(t))return i}return e[0]}(e?.pickedViewports||t,{x:i,y:r})),a){const e=[i-a.x,r-a.y];void 0!==o&&(e[2]=o),s=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:s,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function $d(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if("hover"===i){const e=n.index,t=n.layerId,i=s?s.props.id:null;if(i!==t||a!==e){if(i!==t){const e=r.find((e=>e.props.id===t));e&&l.unshift(e)}n.layerId=i,n.index=a,n.info=null}}const c=Vd(e),u=new Map;return u.set(null,c),l.forEach((e=>{let t={...c};e===s&&(t.color=o,t.index=a,t.picked=!0),t=Gd({layer:e,info:t,mode:i});const r=t.layer;e===s&&"hover"===i&&(n.info=t),u.set(r.id,t),"hover"===i&&r.updateAutoHighlight(t)})),u}function Gd({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}class Wd{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Nd(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,s=r&&r.viewport&&r.viewport.id,a=o?n.find((e=>e.id===o)):null,l=s&&i.find((e=>e.id===s))||i[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return{...r,...u}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter((e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite));return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:r,radius:o=0,depth:s=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:Vd({viewports:n,x:i,y:r,pixelRatio:h})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],g=Math.round(o*h),{width:m,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:f[0],deviceY:f[1],deviceRadius:g,deviceWidth:m,deviceHeight:_}),v={x:i-o,y:r-o,width:2*o+1,height:2*o+1};let b;const x=[],w=new Set;for(let e=0;e<s;e++){let o,p;if(o=y?Ud({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:y,cullRect:v,effects:u,pass:`picking:${a}`}),deviceX:f[0],deviceY:f[1],deviceRadius:g,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},o.pickedLayer&&l&&this.depthFBO){const{pickedColors:e}=this._drawAndSample({layers:[o.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:o.pickedX,y:o.pickedY,width:1,height:1},cullRect:v,effects:u,pass:`picking:${a}:z`},!0);e[3]&&(p=e[0])}o.pickedLayer&&e+1<s&&(w.add(o.pickedLayer),o.pickedLayer.disablePickingIndex(o.pickedObjectIndex)),b=$d({pickInfo:o,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:i,y:r,z:p,pixelRatio:h});for(const e of b.values())e.layer&&x.push(e);if(!o.pickedColor)break}for(const e of w)e.restorePickingColors();return{result:x,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:r,width:o=1,height:s=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=p.x,g=p.y+p.height,m=this.device.canvasContext.cssToDevicePixels([i+o,r+s],!0),_=m.x+m.width,y=m.y,v={x:f,y,width:_-f,height:g-y},b=function({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){const r=e.slice(i,i+4),o=r.join(",");if(!n.has(o)){const e=t(r);e?n.set(o,{...e,color:r}):vo.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:v,cullRect:{x:i,y:r,width:o,height:s},effects:u,pass:`picking:${a}`})),x=new Map,w=[],E=Number.isFinite(l);for(let e=0;e<b.length&&!(E&&w.length>=l);e++){const t=b[e];let n={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:d};n=Gd({layer:t.pickedLayer,info:n,mode:a});const o=n.layer.id;x.has(o)||x.set(o,new Set);const s=x.get(o),l=n.object??n.index;s.has(l)||(s.add(l),w.push(n))}return w}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,cullRect:o,effects:s,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:c,deviceRect:r,cullRect:o,effects:s,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(const e of s)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:p,width:f,height:g}=r,m=new(l?Float32Array:Uint8Array)(f*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:p,sourceWidth:f,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const o=Math.max(0,e-n),s=Math.max(0,t-n),a=Math.min(i,e+n+1)-o,l=Math.min(r,t+n+1)-s;return a<=0||l<=0?null:{x:o,y:s,width:a,height:l}}}const Hd={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Zd="top-left",qd="__root";class Xd{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Xr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find((t=>t.id===e.id))||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const e of this.resolvedWidgets)t[e.id]=e;this.resolvedWidgets.length=0;for(const e of this.defaultWidgets)t[e.id]=null,this.resolvedWidgets.push(e);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._remove(e),this._add(n)):n!==e&&(e.setProps(n.props),n=e):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const e in t){const n=t[e];n&&this._remove(n)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=Zd}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const n=e||qd;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let r=i.querySelector(`.${t}`);return r||(r=document.createElement("div"),r.className=t,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,Hd[t]),i.append(r)),r}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,r=n===qd||i,o=this.containers[n];r?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){const n=e.reduce(((e,t)=>(e[t.id]=t,e)),{});for(const i of this.getWidgets()){const{viewId:r}=i;if(r){const e=n[r];e&&(i.onViewportChange&&i.onViewportChange(e),i.onRedraw?.({viewports:[e],layers:t}))}else{if(i.onViewportChange)for(const t of e)i.onViewportChange(t);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){for(const n of this.getWidgets()){const{viewId:i}=n;i&&i!==e.viewport?.id||n.onHover?.(e,t)}}onEvent(e,t){const n=$a[t.type];if(n)for(const i of this.getWidgets()){const{viewId:r}=i;r&&r!==e.viewport?.id||i[n]?.(e,t)}}}const Yd={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Kd{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Yd),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className)}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}const Jd=globalThis.loaders?.parseImageNode,Qd="undefined"!=typeof Image,ep="undefined"!=typeof ImageBitmap,tp=Boolean(Jd),np=!!vu||tp;function ip(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}const rp=/^data:image\/svg\+xml/,op=/\.svg((\?|#).*)?$/;function sp(e){return e&&(rp.test(e)||op.test(e))}function ap(e,t){if(sp(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function lp(e,t,n){const i=function(e,t){if(sp(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return ap(e,t)}(e,n),r=self.URL||self.webkitURL,o="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise(((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(e){t(e)}}))}(o||i,t)}finally{o&&r.revokeObjectURL(o)}}const cp={};let up=!0;const hp=!1,dp=!0;function pp(e){const t=fp(e);return function(e){const t=fp(e);return t.byteLength>=24&&2303741511===t.getUint32(0,hp)?{mimeType:"image/png",width:t.getUint32(16,hp),height:t.getUint32(20,hp)}:null}(t)||function(e){const t=fp(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,hp)&&255===t.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,hp);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,hp),width:t.getUint16(r+7,hp)};if(!n.has(e))return null;r+=2,r+=t.getUint16(r,hp)}return null}(t)||function(e){const t=fp(e);return t.byteLength>=10&&1195984440===t.getUint32(0,hp)?{mimeType:"image/gif",width:t.getUint16(6,dp),height:t.getUint16(8,dp)}:null}(t)||function(e){const t=fp(e);return t.byteLength>=14&&16973===t.getUint16(0,hp)&&t.getUint32(2,dp)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,dp),height:t.getUint32(22,dp)}:null}(t)||function(e){const t=function(e){return function(e,t,n=0){const i=(r="ftyp",[...r].map((e=>e.charCodeAt(0))));var r;for(let t=0;t<i.length;++t)if(i[t]!==e[t+n])return!1;return!0}(e,0,4)&&96&e[8]?function(e){switch((t=e,String.fromCharCode(...t.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t}(e):null}(new Uint8Array(e instanceof DataView?e.buffer:e));return t?{mimeType:t.mimeType,width:0,height:0}:null}(t)}function fp(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const gp={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(ep)return"imagebitmap";if(Qd)return"image";if(np)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return ep||Qd||np;case"imagebitmap":return ep;case"image":return Qd;case"data":return np;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(i)){case"imagebitmap":o=await async function(e,t,n){let i;i=sp(n)?await lp(e,t,n):ap(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){if(!function(e){for(const t in e||cp)return!1;return!0}(t)&&up||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),up=!1}return await createImageBitmap(e)}(i,r)}(e,t,r);break;case"image":o=await lp(e,t,r);break;case"data":o=await async function(e){const{mimeType:t}=pp(e)||{},n=globalThis.loaders?.parseImageNode;return nu(n),await n(e,t)}(e);break;default:nu(!1)}return"data"===i&&(o=function(e){switch(ip(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(o)),o},tests:[e=>Boolean(pp(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},mp={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse},_p=function(){const e="9.1.14",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(vo.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:vo,_registerLoggers:Vc},function(e){const t=rh();e=Array.isArray(e)?e:[e];for(const n of e){const e=ru(n);t.find((t=>e===t))||t.unshift(e)}}([mp,[gp,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}(),yp=new class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Xc({id:e})),this.stats.get(e)}},vp=new go({id:"luma.gl"}),bp={};function xp(e="id"){return bp[e]=bp[e]||1,`${e}-${bp[e]++}`}class wp{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,n){if(!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const t in e)void 0!==e[t]&&(n[t]=e[t]);return n}(t,n);const i="undefined"!==this.props.id?this.props.id:xp(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}class Ep extends wp{static defaultProps={...wp.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const n={...t};(t.usage||0)&Ep.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,Ep.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,n){const i=ArrayBuffer.isView(e)?e.buffer:e,r=Math.min(e?e.byteLength:n,Ep.DEBUG_DATA_MAX_LENGTH);null===i?this.debugData=new ArrayBuffer(r):0===t&&n===i.byteLength?this.debugData=i.slice(0,r):this.debugData=i.slice(t,t+r)}}function Sp(e){const t=function(e){return Cp[e]}(Tp[e]),n=e.includes("norm"),i=!n&&!e.startsWith("float"),r=e.startsWith("s");return{dataType:Tp[e],byteLength:t,integer:i,signed:r,normalized:n}}const Tp={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Cp={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ap="texture-compression-bc",Pp="texture-compression-astc",Ip="texture-compression-etc2",Mp="texture-compression-pvrtc-webgl",Rp="texture-compression-atc-webgl",kp="float32-renderable-webgl",Op="float16-renderable-webgl",Lp="snorm8-renderable-webgl",Dp="norm16-renderable-webgl",Fp="snorm16-renderable-webgl",Np="float32-filterable",Bp="float16-filterable-webgl";function zp(e){const t=jp[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const jp={r8unorm:{},r8snorm:{render:Lp},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Lp},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Op,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Dp},"r16snorm-webgl":{f:Fp},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Lp},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Op,filter:Bp},"rg16unorm-webgl":{render:Dp},"rg16snorm-webgl":{render:Fp},r32uint:{},r32sint:{},r32float:{render:kp,filter:Np},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:kp},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Dp},"rgb16snorm-webgl":{f:Dp},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Np},rgba16uint:{},rgba16sint:{},rgba16float:{render:Op,filter:Bp},"rgba16unorm-webgl":{render:Dp},"rgba16snorm-webgl":{render:Fp},"rgb32float-webgl":{render:kp,filter:Np},rgba32uint:{},rgba32sint:{},rgba32float:{render:kp,filter:Np},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ap},"bc1-rgb-unorm-srgb-webgl":{f:Ap},"bc1-rgba-unorm":{f:Ap},"bc1-rgba-unorm-srgb":{f:Ap},"bc2-rgba-unorm":{f:Ap},"bc2-rgba-unorm-srgb":{f:Ap},"bc3-rgba-unorm":{f:Ap},"bc3-rgba-unorm-srgb":{f:Ap},"bc4-r-unorm":{f:Ap},"bc4-r-snorm":{f:Ap},"bc5-rg-unorm":{f:Ap},"bc5-rg-snorm":{f:Ap},"bc6h-rgb-ufloat":{f:Ap},"bc6h-rgb-float":{f:Ap},"bc7-rgba-unorm":{f:Ap},"bc7-rgba-unorm-srgb":{f:Ap},"etc2-rgb8unorm":{f:Ip},"etc2-rgb8unorm-srgb":{f:Ip},"etc2-rgb8a1unorm":{f:Ip},"etc2-rgb8a1unorm-srgb":{f:Ip},"etc2-rgba8unorm":{f:Ip},"etc2-rgba8unorm-srgb":{f:Ip},"eac-r11unorm":{f:Ip},"eac-r11snorm":{f:Ip},"eac-rg11unorm":{f:Ip},"eac-rg11snorm":{f:Ip},"astc-4x4-unorm":{f:Pp},"astc-4x4-unorm-srgb":{f:Pp},"astc-5x4-unorm":{f:Pp},"astc-5x4-unorm-srgb":{f:Pp},"astc-5x5-unorm":{f:Pp},"astc-5x5-unorm-srgb":{f:Pp},"astc-6x5-unorm":{f:Pp},"astc-6x5-unorm-srgb":{f:Pp},"astc-6x6-unorm":{f:Pp},"astc-6x6-unorm-srgb":{f:Pp},"astc-8x5-unorm":{f:Pp},"astc-8x5-unorm-srgb":{f:Pp},"astc-8x6-unorm":{f:Pp},"astc-8x6-unorm-srgb":{f:Pp},"astc-8x8-unorm":{f:Pp},"astc-8x8-unorm-srgb":{f:Pp},"astc-10x5-unorm":{f:Pp},"astc-10x5-unorm-srgb":{f:Pp},"astc-10x6-unorm":{f:Pp},"astc-10x6-unorm-srgb":{f:Pp},"astc-10x8-unorm":{f:Pp},"astc-10x8-unorm-srgb":{f:Pp},"astc-10x10-unorm":{f:Pp},"astc-10x10-unorm-srgb":{f:Pp},"astc-12x10-unorm":{f:Pp},"astc-12x10-unorm-srgb":{f:Pp},"astc-12x12-unorm":{f:Pp},"astc-12x12-unorm-srgb":{f:Pp},"pvrtc-rgb4unorm-webgl":{f:Mp},"pvrtc-rgba4unorm-webgl":{f:Mp},"pvrtc-rbg2unorm-webgl":{f:Mp},"pvrtc-rgba2unorm-webgl":{f:Mp},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:Rp},"atc-rgba-unorm-webgl":{f:Rp},"atc-rgbai-unorm-webgl":{f:Rp}},Up=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Vp=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function $p(e){return Up.some((t=>e.startsWith(t)))}function Gp(e){let t=function(e){const t=zp(e),n=t.bytesPerPixel||1,i=t.bitsPerChannel||[8,8,8,8];delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store;return{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:n,bitsPerChannel:i,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}(e);if($p(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=function(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,e,n]=t;return{blockWidth:Number(e),blockHeight:Number(n)}}return null}(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const n=Vp.exec(e);if(n){const[,i,r,o,s,a]=n,l=Sp(`${o}${r}`),c=8*l.byteLength,u=i.length,h=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0];t={format:e,attachment:t.attachment,dataType:l.dataType,components:u,channels:i,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:h,bytesPerPixel:l.byteLength*i.length,packed:t.packed,srgb:t.srgb},"-webgl"===a&&(t.webgl=!0),"-srgb"===s&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}class Wp{}class Hp{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Zp{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>vp.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:vp.get("debug")||void 0,debugShaders:vp.get("debug-shaders")||void 0,debugFramebuffers:Boolean(vp.get("debug-framebuffers")),debugWebGL:Boolean(vp.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...Zp.defaultProps,...e},this.id=this.props.id||xp(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=yp;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=function(e){const t=zp(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=Gp(e),r=e.startsWith("depth")||e.startsWith("stencil"),o=i?.signed,s=i?.integer,a=i?.webgl;return n.render&&=!o,n.filter&&=!(r||o||s||a),n}(e),n=e=>("string"==typeof e?this.features.has(e):e)??!0,i=n(t.create),r={format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(r)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return $p(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Ep.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":vp.warn("indices buffer content must be of integer type")()),t}}const qp=Qr()&&"undefined"!=typeof document,Xp="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Yp{static defaultProps={...Zp.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=function(){return qp&&"complete"===document.readyState||"undefined"==typeof window?Promise.resolve():new Promise((e=>{window.addEventListener("load",(()=>e()))}))}().then((()=>{vp.probe(2,"DOM is loaded")()}));stats=yp;log=vp;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw vp.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),vp.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");vp.error("This version of luma.gl has already been initialized")()}vp.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map((([,e])=>e)).filter((e=>e.isSupported?.())).map((e=>e.type))}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(Yp.defaultProps,e)}async createDevice(e={}){(e={...Yp.defaultProps,...e}).waitForPageLoad&&await Yp.pageLoaded;const t=this.getAdapterMap(e.adapters);let n=e.type||"";"best-available"===n&&(n=this.getBestAvailableAdapter(e.adapters)||n);const i=(this.getAdapterMap(e.adapters)||t).get(n),r=await(i?.create?.(e));if(r)return r;throw new Error(Xp)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await Yp.pageLoaded,null===e.handle&&(n="unknown");const i=t.get(n),r=await(i?.attach?.(null));if(r)return r;throw new Error(Xp)}enforceWebGL2(e=!0,t=[]){const n=this.getAdapterMap(t).get("webgl");n||vp.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}registerDevices(e){vp.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const e=t.adapter;e&&this.preregisteredAdapters.set(e.type,e)}}}const Kp=new Yp;class Jp{}const Qp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ef=(e,t,n)=>t?e.enable(n):e.disable(n),tf=(e,t,n)=>e.hint(n,t),nf=(e,t,n)=>e.pixelStorei(n,t),rf=(e,t,n)=>{const i=36006===n?36009:36008;return e.bindFramebuffer(i,t)},of=(e,t,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(i,t)};function sf(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const af={3042:ef,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:ef,2885:(e,t)=>e.cullFace(t),2929:ef,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:ef,35723:tf,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:rf,36010:rf,34964:of,36662:of,36663:of,35053:of,35055:of,2886:(e,t)=>e.frontFace(t),33170:tf,2849:(e,t)=>e.lineWidth(t),32823:ef,32824:"polygonOffset",10752:"polygonOffset",35977:ef,32926:ef,32928:ef,32938:"sampleCoverage",32939:"sampleCoverage",3089:ef,3088:(e,t)=>e.scissor(...t),2960:ef,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:ef,10754:ef,12288:ef,12289:ef,12290:ef,12291:ef,12292:ef,12293:ef,12294:ef,12295:ef,3333:nf,3317:nf,37440:nf,37441:nf,37443:nf,3330:nf,3332:nf,3331:nf,3314:nf,32878:nf,3316:nf,3315:nf,32877:nf,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===t?.length?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=sf(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=sf(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=sf(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function lf(e,t,n){return void 0!==t[e]?t[e]:n[e]}const cf={blendEquation:(e,t,n)=>e.blendEquationSeparate(lf(32777,t,n),lf(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(lf(32969,t,n),lf(32968,t,n),lf(32971,t,n),lf(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(lf(32824,t,n),lf(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(lf(32938,t,n),lf(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,lf(2962,t,n),lf(2967,t,n),lf(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,lf(34816,t,n),lf(36003,t,n),lf(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,lf(2964,t,n),lf(2965,t,n),lf(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,lf(34817,t,n),lf(34818,t,n),lf(34819,t,n))},uf={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},hf=(e,t)=>e.isEnabled(t),df={3042:hf,2884:hf,2929:hf,3024:hf,32823:hf,32926:hf,32928:hf,3089:hf,2960:hf,35977:hf},pf=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ff(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const i in t){const r=Number(i),o=af[i];o&&("string"==typeof o?n[o]=!0:o(e,t[i],r))}const i=e.state&&e.state.cache;if(i)for(const r in n)(0,cf[r])(e,t,i)}function gf(e,t=Qp){if("number"==typeof t){const n=t,i=df[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const t of n){const n=df[t];i[t]=n?n(e,Number(t)):e.getParameter(Number(t))}return i}function mf(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class _f{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ff(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?gf(e):Object.assign({},Qp),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=_f.get(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const t in uf)vf(e,t,uf[t]);yf(e,"getParameter"),yf(e,"isEnabled")}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){const o=e[r],s=this.cache[r];mf(o,s)||(n=!0,t=s,i&&!(r in i)&&(i[r]=s),this.cache[r]=o)}return{valueChanged:n,oldValue:t}}}function yf(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||pf.has(t))return n(t);const i=_f.get(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function vf(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(...t){const r=_f.get(e),{valueChanged:o,oldValue:s}=n(r._updateCache,...t);return o&&i(...t),s},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function bf(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function xf(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function wf(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const Ef="WEBGL_compressed_texture_s3tc",Sf="WEBGL_compressed_texture_s3tc_srgb",Tf="EXT_texture_compression_rgtc",Cf="EXT_texture_compression_bptc",Af="EXT_texture_norm16",Pf="EXT_render_snorm",If={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Pf],"norm16-renderable-webgl":[Af],"snorm16-renderable-webgl":[Af,Pf],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ef,Sf,Tf,Cf],"texture-compression-bc5-webgl":[Tf],"texture-compression-bc7-webgl":[Cf],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]},Mf={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ef},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Sf},"bc1-rgba-unorm":{gl:33777,x:Ef},"bc1-rgba-unorm-srgb":{gl:35916,x:Sf},"bc2-rgba-unorm":{gl:33778,x:Ef},"bc2-rgba-unorm-srgb":{gl:35918,x:Sf},"bc3-rgba-unorm":{gl:33779,x:Ef},"bc3-rgba-unorm-srgb":{gl:35919,x:Sf},"bc4-r-unorm":{gl:36283,x:Tf},"bc4-r-snorm":{gl:36284,x:Tf},"bc5-rg-unorm":{gl:36285,x:Tf},"bc5-rg-snorm":{gl:36286,x:Tf},"bc6h-rgb-ufloat":{gl:36495,x:Cf},"bc6h-rgb-float":{gl:36494,x:Cf},"bc7-rgba-unorm":{gl:36492,x:Cf},"bc7-rgba-unorm-srgb":{gl:36493,x:Cf},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Rf(e){const t=Mf[e],n=function(e){const t=Mf[e],n=t?.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}(e),i=Gp(e);return{internalFormat:n,format:t?.dataFormat||kf(i.channels,i.integer,i.normalized,n),type:i.dataType?wf(i.dataType):t?.types?.[0]||5121,compressed:i.compressed||!1}}function kf(e,t,n,i){if(6408===i||6407===i)return i;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}const Of={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Lf extends Hp{gl;extensions;testedFeatures=new Set;constructor(e,t,n){super([],n),this.gl=e,this.extensions=t,bf(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return!this.disabledFeatures?.[e]&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in If}(e)&&function(e,t,n){return(If[t]||[]).every((t=>bf(e,t,n)))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter((e=>"polygon-mode-webgl"!==e));for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(Of),...Object.keys(If)]}getWebGLFeature(e){const t=Of[e];return"string"==typeof t?Boolean(bf(this.gl,t,this.extensions)):Boolean(t)}}class Df extends Wp{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Ff{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Ff.defaultProps,...e},e=this.props,!Qr())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{const t=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");return i.id=xp("lumagl-auto-created-canvas"),i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",i}(e),n=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}return e||document.body}(e?.container||null);n.insertBefore(t,n.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((e=>{for(const t of e)t.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return"undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas||!(e=void 0===e?this.props.useDevicePixels:e)||e<=0?1:!0===e?"undefined"!=typeof window&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const o=e,s=Nf(o[0],t,n);let a=Bf(o[1],t,i,r),l=Nf(o[0]+1,t,n);const c=l===n-1?l:l-1;let u;return l=Bf(o[1]+1,t,i,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===i-1?l:l-1,{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}(e,n,i,r,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;n&&i||(vp.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==i||r.devicePixelRatio!==e){let t=e;const r=Math.floor(n*t),o=Math.floor(i*t);if(this.htmlCanvas.width=r,this.htmlCanvas.height=o,this.device.gl){const[s,a]=this.getDrawingBufferSize();s===r&&a===o||(t=Math.min(s/n,a/i),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(i*t),vp.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){"lumagl-auto-created-canvas"===this.htmlCanvas?.id&&(this.htmlCanvas.id=e)}}function Nf(e,t,n){return Math.min(Math.round(e*t),n-1)}function Bf(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}class zf extends wp{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...wp.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(super(e,t=zf.normalizeProps(e,t),zf.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,void 0===this.props.width||void 0===this.props.height){const e=zf.getTextureDataSize(this.props.data);this.width=e?.width||1,this.height=e?.height||1}this.props.mipmaps&&void 0===this.props.mipLevels&&(this.props.mipLevels="pyramid"),this.mipLevels="pyramid"===this.props.mipLevels?zf.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if("undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return zf.getTextureDataSize(e[0]);if(zf.isExternalImage(e))return zf.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const n={...t},i=e?.props?._resourceDefaults?.texture||{};Object.assign(n,i);const{width:r,height:o}=n;return"number"==typeof r&&(n.width=Math.max(1,Math.ceil(r))),"number"==typeof o&&(n.height=Math.max(1,Math.ceil(o))),n}}class jf extends wp{static defaultProps={...wp.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,jf.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map((t=>t.texture.clone(e))),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(vp.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(((e,t)=>{if("string"==typeof e){const n=this.createColorTexture(e,t);return this.attachResource(n),n.view}return e instanceof zf?e.view:e}));const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof zf?e.view:e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:zf.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:zf.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}}class Uf extends jf{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const n=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const t=this.colorAttachments[e];if(t){const n=36064+e;this._attachTextureView(n,t)}}if(this.depthStencilAttachment){const e=function(e){switch(Gp(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:i}=t,r=t.props.baseMipLevel,o=t.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,r,o);break;case 34067:const t=function(e){return e<34069?e+34069:e}(o);n.framebufferTexture2D(36160,e,t,i.handle,r);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,r);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}class Vf extends Ff{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Uf(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e)}}commit(){}}async function $f(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),t&&(i.id=t),new Promise(((t,r)=>{i.onload=t,i.onerror=t=>r(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(i)}))}let Gf=null,Wf=!1;const Hf={debugSpectorJS:vp.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};var Zf;function qf(e){return e.luma=e.luma||{},e.luma}function Xf(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return vp.warn("webgl-debug not loaded")(),e;const n=qf(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...Zf,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,Kf.bind(null,t),Jf.bind(null,t));for(const e in Zf)e in i||"number"!=typeof Zf[e]||(i[e]=Zf[e]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const o=Object.create(r);return n.realContext=e,n.debugContext=o,o.debug=!0,o}(e,t):function(e){const t=qf(e);return t.realContext?t.realContext:e}(e)}function Yf(e,t){t=Array.from(t).map((e=>void 0===e?"undefined":e));let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function Kf(e,t,n,i){i=Array.from(i).map((e=>void 0===e?"undefined":e));const r=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)})`;vp.error(r)()}function Jf(e,t,n){let i="";vp.level>=1&&(i=Yf(t,n),e.traceWebGL&&vp.log(1,i)());for(const e of n)void 0===e&&(i=i||Yf(t,n))}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(Zf||(Zf={}));const Qf={};function eg(e="id"){return Qf[e]=Qf[e]||1,`${e}-${Qf[e]++}`}class tg extends Ep{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;var i;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=(i=this.props.usage)&Ep.INDEX?34963:i&Ep.VERTEX?34962:i&Ep.UNIFORM?35345:34962,this.glUsage=function(e){return e&Ep.INDEX||e&Ep.VERTEX?35044:e&Ep.UNIFORM?35048:35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,n=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){const n=36663;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function ng(e,t,n,i){if(i?.inlineSource){const i=function(e,t){let n="";for(let i=t-2;i<=t;i++){const r=e[i-1];void 0!==r&&(n+=ig(r,t,undefined))}return n}(t,n);return`\n${i}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}const r="error"===e.type?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function ig(e,t,n){const i=n?.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e){let t="";for(let n=e.length;n<4;++n)t+=" ";return t+e}(String(t))}: ${i}${n?.html?"<br/>":"\n"}`}class rg extends wp{static defaultProps={...wp.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){super(e,{id:og(t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"}),...t},rg.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===e&&0===t?.length||this._displayShaderLog(t)}_displayShaderLog(e){if("undefined"==typeof document||!document?.createElement)return;const t=sg(this.source),n=`${this.stage} ${t}`;let i=function(e,t,n){let i="";const r=t.split(/\r?\n/),o=e.slice().sort(((e,t)=>e.lineNum-t.lineNum));switch(n?.showSourceCode||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=ig(r[e-1],e,n);o.length>t&&o[t].lineNum===e;){const e=o[t++];i+=ng(e,r,e.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const t of e)i+=ng(t,r,t.lineNum,{inlineSource:"no"!==n?.showSourceCode});return i}}(e,this.source,{showSourceCode:"all",html:!0});const r=this.getTranslatedSource();r&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${r}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`\n<h1>Shader Compilation Error in ${n}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${i}\n</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o);const s=document.getElementsByClassName("luma-compiler-log-error");s[0]?.scrollIntoView(),o.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}}function og(e){return sg(e.source)||e.id||xp(`unnamed ${e.stage}-shader`)}function sg(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function ag(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class lg extends rg{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then((()=>this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){const t=e.split(/\r?\n/),n=[];for(const e of t){if(e.length<=1)continue;const t=e.split(":");if(2===t.length){const[e,i]=t;n.push({message:i.trim(),type:ag(e),lineNum:0,linePos:0});continue}const[i,r,o,...s]=t;let a=parseInt(o,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:s.join(":").trim(),type:ag(i),lineNum:a,linePos:l})}return n}(e):[]}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return e?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es\n${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.device.props.debug){if(this.device.features.has("compilation-status-async-webgl"))vp.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),vp.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}class cg extends wp{static defaultProps={...wp.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t=cg.normalizeProps(e,t),cg.defaultProps)}static normalizeProps(e,t){return{...t,...e?.props?._resourceDefaults?.sampler||{}}}}function ug(e,t){return fg(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function hg(e,t){return fg(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function dg(e,t){return fg(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function pg(e,t){return fg(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function fg(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function gg(e){const t={};return e.addressModeU&&(t[10242]=mg(e.addressModeU)),e.addressModeV&&(t[10243]=mg(e.addressModeV)),e.addressModeW&&(t[32882]=mg(e.addressModeW)),e.magFilter&&(t[10240]=_g(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t="none"){if(!t)return _g(e);switch(t){case"none":return _g(e);case"nearest":return"nearest"===e?9984:9986;case"linear":return"nearest"===e?9985:9987}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=ug("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function mg(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function _g(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class yg extends cg{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=gg(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}class vg extends wp{static defaultProps={...wp.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,vg.defaultProps)}}class bg extends vg{device;gl;handle;texture;constructor(e,t){super(e,{...zf.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}function xg(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function wg(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:i=!0}=t,r=_f.get(e);let o;if(r.push(),ff(e,t),i)o=n(e),r.pop();else try{o=n(e)}finally{r.pop()}return o}function Eg(e,t,n,i){const{width:r,height:o}=i,{dimension:s,depth:a=0,mipLevel:l=0}=i,{x:c=0,y:u=0,z:h=0}=i,{glFormat:d,glType:p}=i,f=Tg(i.glTarget,s,a),g=i.flipY?{37440:!0}:{};wg(e,g,(()=>{switch(s){case"2d-array":case"3d":e.bindTexture(f,t),e.texSubImage3D(f,l,c,u,h,r,o,a,d,p,n),e.bindTexture(f,null);break;case"2d":case"cube":e.bindTexture(f,t),e.texSubImage2D(f,l,c,u,r,o,d,p,n),e.bindTexture(f,null);break;default:throw new Error(s)}}))}function Sg(e,t,n){const{dimension:i,width:r,height:o,depth:s=0,mipLevel:a=0,byteOffset:l=0}=n,{x:c=0,y:u=0,z:h=0}=n,{glFormat:d,glType:p,compressed:f}=n,g=Tg(n.glTarget,i,s);switch(i){case"2d-array":case"3d":f?e.compressedTexSubImage3D(g,a,c,u,h,r,o,s,d,t,l):e.texSubImage3D(g,a,c,u,h,r,o,s,d,p,t,l);break;case"2d":case"cube":f?e.compressedTexSubImage2D(g,a,c,u,r,o,d,t,l):e.texSubImage2D(g,a,c,u,r,o,d,p,t,l);break;default:throw new Error(i)}}function Tg(e,t,n){return"cube"===t?34069+n:e}function Cg(e){return e instanceof jf?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Ag(e),deleteFramebuffer:!0}}function Ag(e,t){const{device:n,width:i,height:r,id:o}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:i,height:r,colorAttachments:[e]})}class Pg extends zf{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const n={...this.props};n.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=function(e){switch(e){case"1d":case"cube-array":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}(this.props.dimension);const i=Rf(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=Boolean(this.props.mipmaps),this._initialize(n),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:n}=e;if(!t||!n){const i=zf.getTextureDataSize(e.data);t=i?.width||1,n=i?.height||1}if(this.width=t,this.height=n,this.depth=e.depth,this.setSampler(e.sampler),this.view=new bg(this.device,{...this.props,texture:this}),this.bind(),function(e,t,n){const{dimension:i,width:r,height:o,depth:s=0}=n,{glInternalFormat:a}=n,l=n.glTarget;switch(i){case"2d-array":case"3d":e.texStorage3D(l,t,a,r,o,s);break;default:e.texStorage2D(l,t,a,r,o)}}(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new bg(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof yg?(this.sampler=e,t=e.props):(this.sampler=new yg(this.device,e),t=e);const n=gg(t);this._setSamplerParameters(n)}generateMipmap(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(vp.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),e?.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(e){vp.warn(`Error generating mipmap for ${this}: ${e.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=zf.getExternalImageSize(e.image),n={...zf.defaultCopyExternalImageOptions,...t,...e},{image:i,depth:r,mipLevel:o,x:s,y:a,z:l,flipY:c}=n;let{width:u,height:h}=n;const{dimension:d,glTarget:p,glFormat:f,glInternalFormat:g,glType:m}=this;if(u=Math.min(u,this.width-s),h=Math.min(h,this.height-a),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Eg(this.device.gl,this.handle,i,{dimension:d,mipLevel:o,x:s,y:a,z:l,width:u,height:h,depth:r,glFormat:f,glInternalFormat:g,glType:m,glTarget:p,flipY:c}),{width:n.width,height:n.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const n=zf.normalizeTextureData(e,this);n.length>1&&!1!==this.props.mipmaps&&vp.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let e=0;e<n.length;e++){const i=n[e];this._setMipLevel(t,e,i)}this.unbind()}setTexture3DData(e){if("3d"!==this.props.dimension)throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),Sg(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if("cube"!==this.props.dimension)throw new Error(this.id);for(const t of zf.CubeFaces)this.setTextureCubeFaceData(e[t],t)}setTextureArrayData(e){if("2d-array"!==this.props.dimension)throw new Error(this.id);throw new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,n=0){Array.isArray(e)&&e.length>1&&!1!==this.props.mipmaps&&vp.warn(`${this.id} has mipmap and multiple LODs.`)();const i=zf.CubeFaces.indexOf(t);this.setTexture2DData(e,i)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:o,format:s=6408,type:a=5121}=e,{gl:l}=this,c=r||o;this.bind(),c instanceof Promise?c.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?l.texImage2D(t,0,s,n,i,0,s,a,c):l.texImage2D(t,0,s,s,a,c)}_getImageDataMap(e){for(let t=0;t<zf.CubeFaces.length;++t){const n=zf.CubeFaces[t];e[n]&&(e[34069+t]=e[n],delete e[n])}return e}_setSamplerParameters(e){vp.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,i);break;case 10241:case 10242:case 10243:default:this.gl.texParameteri(this.glTarget,e,i);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,i)}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,n,i=this.glTarget){if(zf.isExternalImage(n))Eg(this.device.gl,this.handle,n,{...this,depth:e,mipLevel:t,glTarget:i,flipY:this.props.flipY});else{if(!zf.isTextureLevelData(n))throw new Error("Texture: invalid image data");Sg(this.device.gl,n.data,{...this,depth:e,mipLevel:t,glTarget:i})}}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}class Ig extends wp{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...wp.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ig.defaultClearColor,clearColors:void 0,clearDepth:Ig.defaultClearDepth,clearStencil:Ig.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t=Ig.normalizeProps(e,t),Ig.defaultProps)}static normalizeProps(e,t){const n=e.props._resourceDefaults?.renderPass;return{...n,...t}}}const Mg=[1,2,4,8];class Rg extends Ig{device;glParameters;constructor(e,t){let n;if(super(e,t),this.device=e,!t?.parameters?.viewport)if(t?.framebuffer){const{width:e,height:i}=t.framebuffer;n=[0,0,e,i]}else{const[t,i]=e.getCanvasContext().getDrawingBufferSize();n=[0,0,t,i]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const i=this.props.framebuffer;if(i?.handle)if(this.props.framebuffer){const e=this.props.framebuffer.colorAttachments.map(((e,t)=>36064+t));this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=Mg.map((t=>Boolean(t&e.colorMask)))),this.glParameters=t,ff(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;t?.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;e?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach(((e,t)=>{e&&this.clearColorBuffer(t,e)})),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&wg(this.device.gl,e,(()=>{this.device.gl.clear(t)}))}clearColorBuffer(e=0,t=[0,0,0,0]){wg(this.device.gl,{framebuffer:this.props.framebuffer},(()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}}))}}class kg extends wp{static defaultProps={...wp.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,kg.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}const Og=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Lg={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Dg(e){const t=Lg[e];if(!t)throw new Error("uniform");const[n,i,,r]=t;return{format:r,components:i,glType:n}}function Fg(e){const t=Lg[e];if(!t)throw new Error("attribute");const[,n,,i,r]=t;return{attributeType:i,vertexFormat:r,components:n}}const Ng={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Bg(e){const t=Ng[e];if(!t)throw new Error("sampler");const[n,i]=t;return{viewDimension:n,sampleType:i}}function zg(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function jg(e,t,n,i){const r=e;let o=i;!0===o&&(o=1),!1===o&&(o=0);const s="number"==typeof o?[o]:o;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:case 35670:return e.uniform1iv(t,s);case 35667:case 35671:return e.uniform2iv(t,s);case 35668:case 35672:return e.uniform3iv(t,s);case 35669:case 35673:return e.uniform4iv(t,s);case 5125:return r.uniform1uiv(t,s,1);case 36294:return r.uniform2uiv(t,s,2);case 36295:return r.uniform3uiv(t,s,3);case 36296:return r.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return r.uniformMatrix2x3fv(t,!1,s);case 35686:return r.uniformMatrix2x4fv(t,!1,s);case 35687:return r.uniformMatrix3x2fv(t,!1,s);case 35688:return r.uniformMatrix3x4fv(t,!1,s);case 35689:return r.uniformMatrix4x2fv(t,!1,s);case 35690:return r.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function Ug(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}class Vg extends kg{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:i=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),vp.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=function(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:o,type:s}=i,a=e.getAttribLocation(t,o);if(a>=0){const{attributeType:e}=Fg(s),t=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:a,stepMode:t,type:e})}}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,35382);for(let o=0;o<r;o++){const r={name:e.getActiveUniformBlockName(t,o)||"",location:n(o,35391),byteLength:n(o,35392),vertex:n(o,35396),fragment:n(o,35398),uniformCount:n(o,35394),uniforms:[]},s=n(o,35395)||[],a=e.getActiveUniforms(t,s,35383),l=e.getActiveUniforms(t,s,35384),c=e.getActiveUniforms(t,s,35387),u=e.getActiveUniforms(t,s,35388);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,s[n]);if(!i)throw new Error("activeInfo");r.uniforms.push({name:i.name,format:Dg(a[n]).format,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}i.push(r)}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);for(const e of i){const t=e.uniforms.map((e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength})));n.bindings.push({type:"uniform",name:e.name,group:0,location:e.location,visibility:(e.vertex?1:0)&(e.fragment?2:0),minBindingSize:e.byteLength,uniforms:t})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,35718);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:o,size:s,type:a}=i,{name:l,isArray:c}=zg(o);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:s,type:a,isArray:c};if(n.push(h),h.size>1)for(let i=0;i<h.size;i++){const r=`${l}[${i}]`;u=e.getUniformLocation(t,r);const o={...h,name:r,location:u};n.push(o)}}return n}(e,t);let o=0;for(const e of r)if(s=e.type,Og.includes(s)){const{viewDimension:t,sampleType:i}=Bg(e.type);n.bindings.push({type:"texture",name:e.name,group:0,location:o,viewDimension:t,sampleType:i}),e.textureUnit=o,o+=1}var s;r.length&&(n.uniforms=r);const a=function(e,t){const n=[],i=e.getProgramParameter(t,35971);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:o,type:s,size:a}=i,{glType:l,components:c}=Dg(s),u={location:r,name:o,type:l,size:a*c};n.push(u)}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);return a?.length&&(n.varyings=a),n}(this.device.gl,this.handle),vp.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=function(e,t){const n={...e,attributes:e.attributes.map((e=>({...e})))};for(const e of t?.attributes||[]){const t=n.attributes.find((t=>t.name===e.name));t?(t.type=e.type||t.type,t.stepMode=e.stepMode||t.stepMode):vp.warn(`shader layout attribute ${e.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[n,i]of Object.entries(e)){const e=this.shaderLayout.bindings.find((e=>e.name===n))||this.shaderLayout.bindings.find((e=>e.name===`${n}Uniforms`));if(e){switch(i||vp.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(i instanceof tg||i.buffer instanceof tg))throw new Error("buffer value");break;case"texture":if(!(i instanceof bg||i instanceof Pg||i instanceof Uf))throw new Error("texture value");break;case"sampler":vp.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=i}else{const e=this.shaderLayout.bindings.map((e=>`"${e.name}"`)).join(", ");t?.disableWarnings||vp.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${e}`,i)()}}}draw(e){const{renderPass:t,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:r,vertexCount:o,instanceCount:s,isInstanced:a=!1,firstVertex:l=0,transformFeedback:c}=e,u=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}(i),h=Boolean(r.indexBuffer),d=r.indexBuffer?.glIndexType;if("success"!==this.linkStatus)return vp.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return vp.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),r.bindBeforeRender(t),c&&c.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const p=t;return function(e,t,n,i){if(function(e){let t=!0;for(const n in e){t=!1;break}return t}(t))return i();const r=e;r.pushState();try{return function(e,t){const n=e,{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029)}if(t.frontFace&&i.frontFace(fg("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(34383),void 0!==t.depthBias&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,i=fg("provokingVertex",t.provokingVertex,{first:36429,last:36430});e?.provokingVertexWEBGL(i)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,i=fg("polygonMode",t.polygonMode,{fill:6914,line:6913});e?.polygonModeWEBGL(1028,i),e?.polygonModeWEBGL(1029,i)}t.polygonOffsetLine&&i.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),void 0!==t.depthWriteEnabled&&i.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?i.enable(2929):i.disable(2929),i.depthFunc(ug("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&vp.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=ug("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,n,0,e),i.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=hg("stencilPassOperation",t.stencilPassOperation),n=hg("stencilFailOperation",t.stencilFailOperation),r=hg("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,n,r,e),i.stencilOpSeparate(1029,n,r,e)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){const e=dg("blendColorOperation",t.blendColorOperation||"add"),n=dg("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=pg("blendColorSrcFactor",t.blendColorSrcFactor||"one"),o=pg("blendColorDstFactor",t.blendColorDstFactor||"zero"),s=pg("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=pg("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,o,s,a)}}(e,t),ff(r.gl,n),i()}finally{r.popState()}}(this.device,n,p.glParameters,(()=>{h&&a?this.device.gl.drawElementsInstanced(u,o||0,d,l,s||0):h?this.device.gl.drawElements(u,o||0,d,l):a?this.device.gl.drawArraysInstanced(u,l,o||0,s||0):this.device.gl.drawArrays(u,l,o||0),c&&c.end()})),r.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=function(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const i=e[n];var r;null!==Ug(r=i)||"number"==typeof r||"boolean"==typeof r?t.uniforms[n]=i:t.bindings[n]=i})),t}(e);Object.keys(t).forEach((e=>{vp.warn(`Unsupported value "${JSON.stringify(t[e])}" used in setUniforms() for key ${e}. Use setBindings() instead?`)()})),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),vp.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),vp.timeEnd(4,`linkProgram for ${this.id}`)(),vp.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}vp.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),vp.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){if("success"!==e){switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then((()=>this.vs.debugShader()))}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then((()=>this.fs.debugShader()))}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(vp.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:o}=i,s=e.getUniformBlockIndex(this.handle,o);if(4294967295===s)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,n,s),r instanceof tg?e.bindBufferBase(35345,n,r.handle):e.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof bg||r instanceof Pg||r instanceof Uf))throw new Error("texture");let a;if(r instanceof bg)a=r.texture;else if(r instanceof Pg)a=r;else{if(!(r instanceof Uf&&r.colorAttachments[0]instanceof bg))throw new Error("No texture");vp.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.glTarget,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:i,textureUnit:r}=e,o=this.uniforms[t]??r;void 0!==o&&jg(this.device.gl,n,i,o)}}}class $g extends wp{static defaultProps={...wp.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,$g.defaultProps)}}class Gg extends wp{static defaultProps={...wp.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Gg.defaultProps)}}class Wg extends Gg{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Hg(this.device,t.options);break;case"copy-buffer-to-texture":Zg(this.device,t.options);break;case"copy-texture-to-buffer":qg(this.device,t.options);break;case"copy-texture-to-texture":Xg(this.device,t.options);break;default:throw new Error(t.name)}}}function Hg(e,t){const n=t.sourceBuffer,i=t.destinationBuffer;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,i.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function Zg(e,t){throw new Error("Not implemented")}function qg(e,t){const{sourceTexture:n,mipLevel:i=0,aspect:r="all",width:o=t.sourceTexture.width,height:s=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==r)throw new Error("aspect not supported in WebGL");if(0!==i||0!==a||h||d)throw new Error("not implemented");const{framebuffer:p,destroyFramebuffer:f}=Yg(n);let g;try{const t=c,n=o||p.width,i=s||p.height,r=Rf(p.colorAttachments[0].texture.props.format),a=r.format,h=r.type;e.gl.bindBuffer(35051,t.handle),g=e.gl.bindFramebuffer(36160,p.handle),e.gl.readPixels(l[0],l[1],n,i,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==g&&e.gl.bindFramebuffer(36160,g),f&&p.destroy()}}function Xg(e,t){const{sourceTexture:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:o=[0,0],destinationTexture:s}=t;let{width:a=t.destinationTexture.width,height:l=t.destinationTexture.height}=t;const{framebuffer:c,destroyFramebuffer:u}=Yg(n),[h,d]=r,[p,f,g]=o,m=e.gl.bindFramebuffer(36160,c.handle);let _,y=null;if(!(s instanceof Pg))throw new Error("invalid destination");switch(y=s,a=Number.isFinite(a)?a:y.width,l=Number.isFinite(l)?l:y.height,y.bind(0),_=y.glTarget,_){case 3553:case 34067:e.gl.copyTexSubImage2D(_,i,p,f,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(_,i,p,f,g,h,d,a,l)}y&&y.unbind(),e.gl.bindFramebuffer(36160,m),u&&c.destroy()}function Yg(e){if(e instanceof zf){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class Kg extends $g{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Wg(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}const Jg={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Qg={f32:4,f16:2,i32:4,u32:4};function em(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),r=n,o=i?parseInt(i):1,s=Sp(r),a={type:r,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function tm(e,t){const n={};for(const i of e.attributes){const r=nm(e,t,i.name);r&&(n[i.name]=r)}return n}function nm(e,t,n){const i=function(e,t){const n=e.attributes.find((e=>e.name===t));return n||vp.warn(`shader layout attribute "${t}" not present in shader`),n||null}(e,n),r=function(e,t){im(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);return n||(n=function(e,t){for(const n of e){let e=n.byteStride;if("number"!=typeof n.byteStride)for(const t of n.attributes||[])e+=em(t.format).byteLength;const i=n.attributes?.find((e=>e.attribute===t));if(i)return{attributeName:i.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:e}}return null}(e,t),n||(vp.warn(`layout for attribute "${t}" not present in buffer layout`),null))}(t,n);if(!i)return null;const o=function(e){const[t,n]=Jg[e],i="i32"===t||"u32"===t,r="u32"!==t,o=Qg[t]*n,s=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:`${n}x${t}`}(t,n);return{dataType:t,components:n,defaultVertexFormat:s,byteLength:o,integer:i,signed:r}}(i.type),s=r?.vertexFormat||o.defaultVertexFormat,a=em(s);return{attributeName:r?.attributeName||i.name,bufferName:r?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:o.integer,stepMode:r?.stepMode||i.stepMode||"vertex",byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function im(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&vp.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}class rm extends wp{static defaultProps={...wp.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,rm.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:i}=t.renderPipeline||{};if(!n||!i)throw new Error("VertexArray");this.attributeInfos=function(e,t,n=16){const i=tm(e,t),r=new Array(n).fill(null);for(const e of Object.values(i))r[e.location]=e;return r}(n,i,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}let om;function sm(e){return(!om||om.byteLength<e)&&(om=new ArrayBuffer(e)),om}class am extends rm{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return"Chrome"==(Qr()?Jr(t)?"Electron":(ao.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node");var t}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:o,offset:s,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,i,r,o,s):this.device.gl.vertexAttribPointer(e,i,r,a,o,s),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=wf(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){const n=am.isConstantAttributeZeroSupported(this.device);(t||n||0!==e)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=(o=t,Array.isArray(o)?new Float32Array(o):o),i=n.byteLength*e,r=n.length*e;var o;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),s){const e=function(e,t){return new e(sm(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,r);!function(e){const{target:t,source:n,start:i=0,count:r=1}=e,o=n.length,s=r*o;let a=0;for(let e=i;a<o;a++)t[e++]=n[a];for(;a<s;)a<s-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+s-a),a=s)}({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class lm extends wp{static defaultProps={...wp.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,lm.defaultProps)}}class cm extends lm{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])}))}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:o}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void vp.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:i,byteLength:r,byteOffset:o},this.bindOnUse||this._bindBuffer(n,i,o,r)}getBuffer(e){if(um(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof tg)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(um(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,i){const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r)}}function um(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class hm extends wp{static defaultProps={...wp.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,hm.defaultProps)}}class dm extends hm{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}}class pm extends Zp{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||eg("webgl-device")});const t=Zp._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=t.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new Vf(this,t),this.lost=new Promise((e=>{this._resolveContextLost=e}));const i={...e.webgl};"premultiplied"===t.alphaMode&&(i.premultipliedAlpha=!0),void 0!==e.powerPreference&&(i.powerPreference=e.powerPreference);const r=this.props._handle||function(e,t,n){let i="";const r={preserveDrawingBuffer:!0,...n};let o=null;if(o||=e.getContext("webgl2",r),r.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),o||n.failIfMajorPerformanceCaveat||(r.failIfMajorPerformanceCaveat=!1,o=e.getContext("webgl2",r),o.luma||={},o.luma.softwareRenderer=!0),o||(o=e.getContext("webgl",{}),o&&(o=null,i||="Your browser only supports WebGL1")),!o)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:s,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",(e=>s(e)),!1),e.addEventListener("webglcontextrestored",(e=>a(e)),!1),o.luma||={},o}(this.canvasContext.canvas,{onContextLost:e=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:e=>console.log("WebGL context restored")},i);if(!r)throw new Error("WebGL context creation failed");if(n=r.device,n){if(e._reuseDevices)return vp.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=r,this.gl=r,this.spectorJS=function(e){if(!(e={...Hf,...e}).debugSpectorJS)return null;if(!Gf&&globalThis.SPECTOR&&!globalThis.luma?.spector){vp.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Gf=new e,globalThis.luma&&(globalThis.luma.spector=Gf)}if(!Gf)return null;if(Wf||(Wf=!0,Gf.spyCanvases(),Gf?.onCaptureStarted.add((e=>vp.info("Spector capture started:",e)())),Gf?.onCapture.add((e=>{vp.info("Spector capture complete:",e)(),Gf?.getResultUI(),Gf?.resultView.display(),Gf?.resultView.addCapture(e)}))),e.gl){const t=e.gl,n=t.device;Gf?.startCapture(e.gl,500),t.device=n,new Promise((e=>setTimeout(e,2e3))).then((e=>{vp.info("Spector capture stopped after 2 seconds")(),Gf?.stopCapture()}))}return Gf}({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=function(e,t){const n=e.getParameter(7936),i=e.getParameter(7937);bf(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,o=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936)||n,s=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937)||i,a=e.getParameter(7938),l=xf(o,s),c=function(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}(o,s),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(xf(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(o,s);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:o,renderer:s,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}(this.gl,this._extensions),this.limits=new Df(this.gl),this.features=new Lf(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),!1!==t.autoResize&&this.canvasContext.resize(),new _f(this.gl,{log:(...e)=>vp.log(1,...e)()}).trackState(this.gl,{copyState:!1});const o=e.debugWebGL||e.debug,s=e.debugWebGL;o&&(this.gl=Xf(this.gl,{debugWebGL:o,traceWebGL:s}),vp.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(vp.level=Math.max(vp.level,1)))}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new tg(this,t)}createTexture(e){return new Pg(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new yg(this,e)}createShader(e){return new lg(this,e)}createFramebuffer(e){return new Uf(this,e)}createVertexArray(e){return new am(this,e)}createTransformFeedback(e){return new cm(this,e)}createQuerySet(e){return new dm(this,e)}createRenderPipeline(e){return new Vg(this,e)}beginRenderPass(e){return new Rg(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new Kg(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return function(e,t){const{sourceX:n=0,sourceY:i=0,sourceAttachment:r=0}=t||{};let{target:o=null,sourceWidth:s,sourceHeight:a,sourceDepth:l,sourceFormat:c,sourceType:u}=t||{};const{framebuffer:h,deleteFramebuffer:d}=Cg(e),{gl:p,handle:f}=h;s||=h.width,a||=h.height;const g=h.colorAttachments[r]?.texture;if(!g)throw new Error(`Invalid framebuffer attachment ${r}`);l=g?.depth||1,c||=g?.glFormat||6408,u||=g?.glType||5121,o=function(e,t,n,i,r){if(e)return e;t||=5121;const o=function(e){const{clamped:t=!0}={clamped:!1}||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}(t);return new o(i*r*xg(n))}(o,u,c,s,a),u=u||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}(o);const m=p.bindFramebuffer(36160,f);return p.readBuffer(36064+r),p.readPixels(n,i,s,a,c,u,o),p.readBuffer(36064),p.bindFramebuffer(36160,m||null),d&&h.destroy(),o}(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=Cg(e);a=a||u.width,l=l||u.height;const d=u;c=c||5121;let p=n;if(!p){const e=s+a*l*xg(o)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(c);p=d.device.createBuffer({byteLength:e})}const f=e.device.createCommandEncoder();return f.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[i,r],destinationBuffer:p,byteOffset:s}),f.destroy(),h&&u.destroy(),p}(e,t)}setParametersWebGL(e){ff(this.gl,e)}getParametersWebGL(e){return gf(this.gl,e)}withParametersWebGL(e,t){return wg(this.gl,e,t)}resetWebGL(){vp.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),ff(this.gl,Qp)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,n){let i=t.create;const r=Mf[t.format];return void 0===r?.gl&&(i=!1),r?.x&&(i=i&&Boolean(bf(e,r.x,n))),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}(this.gl,e,this._extensions)}loseDevice(){let e=!1;const t=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return t&&(e=!0,t.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){_f.get(this.gl).push()}popState(){_f.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const n=Number(e);for(const e in this.gl)if(this.gl[e]===n)return`GL.${e}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce(((e,[n,i])=>(e[`${n}:${this.getGLKey(n,t)}`]=`${i}:${this.getGLKey(i,t)}`,e)),{})}_constants;setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,t)&&vp.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return bf(this.gl,e,this._extensions),this._extensions}}const fm={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},gm=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),mm=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),_m=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});const ym=new class extends Jp{type="webgl";constructor(){super(),Zp.defaultProps={...Zp.defaultProps,...Hf},pm.adapter=this}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}enforceWebGL2(e){!function(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){const e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");const t={...fm,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:gm(e),OES_vertex_array_object:mm(e),ANGLE_instanced_arrays:_m(e)},n=e.getExtension;e.getExtension=function(i){return n.call(e,i)||(i in t?t[i]:null)};const i=e.getSupportedExtensions;e.getSupportedExtensions=function(){const n=i.apply(e)||[];return n?.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}async attach(e){if(e instanceof pm)return e;if(e?.device instanceof Zp)return e.device;if(!function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new pm({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){vp.groupCollapsed(1,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(async function(){Qr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await $f("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.debugSpectorJS&&t.push(async function(e){if(!globalThis.SPECTOR)try{await $f(e.debugSpectorJSUrl||Hf.debugSpectorJSUrl)}catch(e){vp.warn(String(e))}}(e));const n=await Promise.allSettled(t);for(const e of n)"rejected"===e.status&&vp.error(`Failed to initialize debug libraries ${e.reason}`)();const i=new pm(e),r=`${i._reused?"Reusing":"Created"} device with WebGL2 ${i.debug?"debug ":""}context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return vp.probe(1,r)(),vp.table(1,i.info)(),vp.groupEnd(1)(),i}};let vm=0;const bm={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Kp.stats.get("animation-loop-"+vm++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class xm{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...bm,...e},!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Xc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){this.props.onError(e),this._error=Error();const t=this.device?.canvasContext?.canvas;if(t instanceof HTMLCanvasElement){const t=document.createElement("h1");t.innerHTML=e.message,t.style.position="absolute",t.style.top="20%",t.style.left="10px",t.style.color="black",t.style.backgroundColor="red",document.body.appendChild(t)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function wm(){}const Em={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:wm,onWebGLInitialized:wm,onResize:wm,onViewStateChange:wm,onInteractionStateChange:wm,onBeforeRender:wm,onAfterRender:wm,onLoad:wm,onError:e=>vo.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Sm{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Xc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=$a[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=r,s=o&&(o[t]||o.props[t]),a=this.props[t];let l=!1;s&&(l=s.call(o,r,e)),l||(a?.(r,e),this.widgetManager.onEvent(r,e))},this._onPointerDown=e=>{if("webgpu"===this.device?.type)return;const t=e.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo},this.props={...Em,...e},(e=this.props).viewState&&e.initialViewState&&vo.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&vo.error("WebGL1 context not supported.")(),t=ym.attach(e.gl)),t||(t=Kp.createDevice({type:"best-available",_reuseDevices:!0,adapters:[ym],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&bo.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&vo.removed("onLayerHover","onHover")(),"onLayerClick"in e&&vo.removed("onLayerClick","onClick")(),e.initialViewState&&!Xr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return sl(this.viewManager),this.viewManager.views}getViewports(e){return sl(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,n){sl(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),sl(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:n}=e;if(t||0===t){const e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(n||0===n){const t=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;t===this.width&&n===this.height||(this.width=t,this.height=n,this.viewManager?.setProps({width:t,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:r}=t;return new xm({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Wh({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if("webgpu"===this.device?.type)return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=n,r=!1;for(const n of t)i=n,r=n.layer?.onHover(n,e.event)||r;r||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);const t=new Hl;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new za(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Ga).map((e=>{const[t,n,i,r]=Ga[e],o=this.props.eventRecognizerOptions?.[e];return{recognizer:new t({...n,...o,event:e}),recognizeWith:i,requestFailure:r}})),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const e in $a)this.eventManager.on(e,this._onEvent);this.viewManager=new vh({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new yh(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new Ld({deck:this,device:this.device}),this.deckRenderer=new zd(this.device),this.deckPicker=new Wd(this.device),this.widgetManager=new Xd({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Kd),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(r),"screen"===r.pass&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),vo.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),"webgpu"!==this.device?.type&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Kp.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Sm.defaultProps=Em,Sm.VERSION=_p;const Tm=Sm,Cm="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;function Am(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}function Pm(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function Im(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function Mm(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const i=t;let r=Pm(e);if("uint8"===r&&n&&1===i)return"unorm8-webgl";if("uint8"===r&&n&&3===i)return"unorm8x3-webgl";if("uint8"===r||"sint8"===r){if(1===i||3===i)throw new Error(`size: ${t}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}if("uint16"===r||"sint16"===r){if(1===i||3===i)throw new Error(`size: ${t}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}return 1===i?r:`${r}x${i}`}const Rm=Pm;function km(e,t,n){const i="webgpu"===n&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function Om(e){return e.stride||e.size*e.bytesPerElement}function Lm(e,t){t.offset&&vo.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Om(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:n}}class Dm{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,r="float64"===i;let o,{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0),o=r?"float32":!i&&t.isIndexed?"uint32":i||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Im(e)}}(i||o);this.doublePrecision=r,r&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:s,logicalType:i,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Om(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),bo.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const r=Lm(this.getAccessor(),t),o=r.offset/i.BYTES_PER_ELEMENT,s=r.size||this.size;n[e]=i.subarray(o,o+s)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],r={name:this.id,byteStride:Om(n),attributes:i};if(this.doublePrecision){const r=function(e,t){const n=Lm(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});i.push(km(e,{...n,...r.high},this.device.type),km(`${e}64Low`,{...n,...r.low},this.device.type))}else if(t){const r=Lm(n,t);i.push(km(e,{...n,...r},this.device.type))}else i.push(km(e,n,this.device.type));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,r=n*i;if(t&&r&&t.length>=r){const n=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<i;r++){const i=t[e++];i<n[r]&&(n[r]=i),i>o[r]&&(o[r]=i)}e=[n,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof Ep?{buffer:e}:e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const e=Rm(n.value);i.type=i.normalized?e.replace("int","norm"):e}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Om(i)}if(t.bounds=null,n.constant){let e=n.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),t.constant&&this._areValuesEqual(e,this.value))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:r}=this;const o=Om(i),s=(i.vertexOffset||0)*o;if(this.doublePrecision&&e instanceof Float64Array&&(e=Ho(e,i)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+s+2*o;(!r||r.byteLength<a)&&(r=this._createBuffer(a)),r.write(e,s)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Ho(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,r=bo.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:o}=this;let{buffer:s}=this;return(!s||s.byteLength<r.byteLength+o)&&(s=this._createBuffer(r.byteLength+o),t&&i&&s.write(i instanceof Float64Array?Ho(i,this):i,o)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||vo.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map((e=>(e+128)/255*2-1));case"snorm16":return new Float32Array(e).map((e=>(e+32768)/65535*2-1));case"unorm8":return new Float32Array(e).map((e=>e/255));case"unorm16":return new Float32Array(e).map((e=>e/65535));default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=r;for(;--e>=0;)t[n+e]=i[e];return t}switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=r;for(;--o>=0;)t[n+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Ep.INDEX:Ep.VERTEX)|Ep.COPY_DST,indexType:t?n:void 0,byteLength:e}),this._buffer}}const Fm=[],Nm=[];function Bm(e,t=0,n=1/0){let i=Fm;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(Nm.length=e.length,i=Nm):i=Fm,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}function zm(e){return e&&e[Symbol.asyncIterator]}function jm(e,t){const{size:n,stride:i,offset:r,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((e.length-c)/l);return(t,{index:i,target:r})=>{if(!o){const t=i*l+c;for(let i=0;i<n;i++)r[i]=e[t+i];return r}const a=o[i],h=o[i+1]||u;let d;if(s){d=new Array(h-a);for(let t=a;t<h;t++){const i=t*l+c;r=new Array(n);for(let t=0;t<n;t++)r[t]=e[i+t];d[t-a]=r}}else if(l===n)d=e.subarray(a*n+c,h*n+c);else{d=new e.constructor((h-a)*n);let t=0;for(let i=a;i<h;i++){const r=i*l+c;for(let i=0;i<n;i++)d[t++]=e[r+i]}}return d}}const Um=[],Vm=[[0,1/0]],$m={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Gm(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...$m[n],...t,...e,type:n}}class Wm extends Dm{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Vm}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n,i;(t=this.state).layoutChanged||(t.layoutChanged=(n=e,i=this.getAccessor(),!(n.type===i.type&&n.size===i.size&&Om(n)===Om(i)&&(n.offset||0)===(i.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find((t=>e[t]))]:e[t];return Gm(i,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===Vm)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let o=0;o<i;o++){const i=e[o];i[1]<t[0]?(n.push(i),r=o+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=Vm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Um}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&!!n.update&&(super.allocate(e,t.updateRanges!==Vm),!0)}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:s}}=this;let a=!0;if(o){for(const[s,a]of r)o.call(i,this,{data:t,startRow:s,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){return"webgpu"!==this.device.type&&void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const r=e;sl(ArrayBuffer.isView(r.value),`invalid ${i.accessor}`);const o=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=jm(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(n.stepMode="dynamic"===i?e?e.isInstanced?"instance":"vertex":"instance":i??"vertex",!t)return n;for(const e in t){const i=super._getBufferLayout(e,t[e]);n.attributes.push(...i.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:r,numInstances:o}){if(e.constant&&"webgpu"!==this.context.device.type)return;const{settings:s,state:a,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=s;let p=a.binaryAccessor||("function"==typeof h?h:r[h]);"function"!=typeof p&&(p=()=>p),sl("function"==typeof p,`accessor "${h}" is not a function`);let f=e.getVertexOffset(n);const{iterable:g,objectInfo:m}=Bm(t,n,i);for(const t of g){m.index++;let n=p(t,m);if(d&&(n=d.call(this,n)),u){const t=(m.index<u.length-1?u[m.index+1]:o)-u[m.index];if(n&&Array.isArray(n[0])){let t=f;for(const i of n)e._normalizeValue(i,l,t),t+=c}else n&&n.length>c?l.set(n,f):(e._normalizeValue(n,m.target,0),Hc({target:l,source:m.target,start:f,count:t}));f+=t*c}else e._normalizeValue(n,l,f),f+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Hm(e){const{input:t,inputChannels:n,output:i}=e||{};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${i};\nvoid main() {\n  ${i} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}class Zm{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find((t=>t.name===e))||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map((e=>e.attribute)):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const e of t){const t=n.findIndex((t=>t.name===e.name));t<0?n.push(e):n[t]=e}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex((t=>t.name===e));return-1===t&&vp.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function qm(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class Xm{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find((t=>"uniform"===t.type&&t.name===e?.name));if(!t)throw new Error(e?.name);const n=t;for(const e of n.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t){if(e!==t)return!1;const n=e,i=t;if(!qm(n))return!1;if(qm(i)&&n.length===i.length)for(let e=0;e<n.length;++e)if(i[e]!==n[e])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){return qm(e)?e.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}const Ym={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Km(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}class Jm{layout={};byteLength;constructor(e){let t=0;for(const[n,i]of Object.entries(e)){const e=Ym[i],{type:r,components:o}=e;t=Km(t,o);const s=t;t+=o,this.layout[n]={type:r,size:o,offset:s}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=sm(Math.max(this.byteLength,1024)),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[t,i]of Object.entries(e)){const e=this.layout[t];if(!e){vp.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}const{type:r,size:o,offset:s}=e,a=n[r];if(1===o){if("number"!=typeof i&&"boolean"!=typeof i){vp.warn(`Supplied value for single component uniform ${t} is not a number: ${i}`)();continue}a[s]=Number(i)}else{if(!qm(i)){vp.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${i}`)();continue}a.set(i,s)}}return new Uint8Array(t)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class Qm{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,n]of Object.entries(e)){const e=t,i=new Jm(n.uniformTypes||{});this.uniformBufferLayouts.set(e,i);const r=new Xm({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:Ep.UNIFORM|Ep.COPY_DST,byteLength:i}),o=this.getUniformBufferData(t);return r.write(o),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:Ep.UNIFORM|Ep.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||=n}return e&&vp.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&t?.needsRedraw){i||=t.needsRedraw;const r=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(r);const o=this.uniformBlocks.get(e)?.getAllUniforms();vp.log(4,`Writing to uniform buffer ${String(e)}`,r,o)()}return i}}class e_{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class t_{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class n_ extends e_{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class i_ extends e_{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class r_ extends e_{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class o_ extends e_{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}var s_,a_;(a_=s_||(s_={}))[a_.Uniform=0]="Uniform",a_[a_.Storage=1]="Storage",a_[a_.Texture=2]="Texture",a_[a_.Sampler=3]="Sampler",a_[a_.StorageTexture=4]="StorageTexture";class l_{constructor(e,t,n,i,r,o,s){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=o,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class c_{constructor(e,t){this.name=e,this.type=t}}class u_{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class h_{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class d_{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class p_{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class f_{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class g_{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function m_(e){var t=(32768&e)>>15,n=(31744&e)>>10,i=1023&e;return 0==n?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==n?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+i/Math.pow(2,10))}const __=new Float32Array(1),y_=new Int32Array(__.buffer),v_=new Uint16Array(1);function b_(e){__[0]=e;const t=y_[0],n=t>>31&1;let i=t>>23&255,r=8388607&t;if(255===i)return v_[0]=n<<15|31744|(0!==r?512:0),v_[0];if(0===i){if(0===r)return v_[0]=n<<15,v_[0];r|=8388608;let e=113;for(;!(8388608&r);)r<<=1,e--;return i=127-e,r&=8388607,i>0?(r=(r>>126-i)+(r>>127-i&1),v_[0]=n<<15|i<<10|r>>13,v_[0]):(v_[0]=n<<15,v_[0])}return i=i-127+15,i>=31?(v_[0]=n<<15|31744,v_[0]):i<=0?i<-10?(v_[0]=n<<15,v_[0]):(r=(8388608|r)>>1-i,v_[0]=n<<15|r>>13,v_[0]):(r>>=13,v_[0]=n<<15|i<<10|r,v_[0])}const x_=new Uint32Array(1),w_=new Float32Array(x_.buffer,0,1);function E_(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return x_[0]=t,w_[0]}function S_(e,t,n,i){const r=[0,0,0,0];for(let o=0;o<i;++o)switch(n){case"8unorm":r[o]=e[t]/255,t++;break;case"8snorm":r[o]=e[t]/255*2-1,t++;break;case"8uint":r[o]=e[t],t++;break;case"8sint":r[o]=e[t]-127,t++;break;case"16uint":r[o]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[o]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[o]=m_(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":r[o]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[o]=new Float32Array(e.buffer,t,1)[0],t+=4}return r}function T_(e,t,n,i,r){for(let o=0;o<i;++o)switch(n){case"8unorm":e[t]=255*r[o],t++;break;case"8snorm":e[t]=.5*(r[o]+1)*255,t++;break;case"8uint":e[t]=r[o],t++;break;case"8sint":e[t]=r[o]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[o],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[o],t+=2;break;case"16float":{const n=b_(r[o]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[o],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[o],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[o],t+=4}return r}const C_={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class A_{constructor(){this.id=A_._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(P_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(I_.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}A_._id=0;class P_ extends A_{}P_.instance=new P_;class I_ extends A_{}I_.instance=new I_;const M_=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class R_ extends A_{constructor(){super()}}class k_ extends R_{constructor(e,t,n,i,r,o){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=r,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class O_ extends R_{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class L_ extends R_{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class D_ extends R_{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class F_ extends R_{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(i=this.increment)||void 0===i||i.search(e),this.searchBlock(this.body,e)}}class N_ extends R_{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class B_ extends R_{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class z_ extends R_{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class j_ extends R_{constructor(e,t,n,i,r){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var U_,V_,$_,G_;(e=>{e.increment="++",e.decrement="--"})(U_||(U_={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(U_||(U_={}));class W_ extends R_{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(V_||(V_={})),(e=>{e.parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t}})(V_||(V_={}));class H_ extends R_{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Z_ extends R_{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return M_.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class q_ extends R_{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null===(t=this.continuing)||void 0===t||t.search(e)}}class X_ extends R_{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class Y_ extends R_{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class K_ extends R_{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class J_ extends R_{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Q_ extends R_{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ey extends R_{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class ty extends R_{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ny extends R_{constructor(){super()}get astNodeType(){return"discard"}}class iy extends R_{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class ry extends R_{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class oy extends R_{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=oy._priority.get(t.name);oy._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?oy.i32:t}getTypeName(){return this.name}}oy.x32=new oy("x32"),oy.f32=new oy("f32"),oy.i32=new oy("i32"),oy.u32=new oy("u32"),oy.f16=new oy("f16"),oy.bool=new oy("bool"),oy.void=new oy("void"),oy._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class sy extends oy{constructor(e){super(e)}}class ay extends oy{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class ly extends oy{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}ly.vec2f=new ly("vec2",oy.f32,null),ly.vec3f=new ly("vec3",oy.f32,null),ly.vec4f=new ly("vec4",oy.f32,null),ly.vec2i=new ly("vec2",oy.i32,null),ly.vec3i=new ly("vec3",oy.i32,null),ly.vec4i=new ly("vec4",oy.i32,null),ly.vec2u=new ly("vec2",oy.u32,null),ly.vec3u=new ly("vec3",oy.u32,null),ly.vec4u=new ly("vec4",oy.u32,null),ly.vec2h=new ly("vec2",oy.f16,null),ly.vec3h=new ly("vec3",oy.f16,null),ly.vec4h=new ly("vec4",oy.f16,null),ly.vec2b=new ly("vec2",oy.bool,null),ly.vec3b=new ly("vec3",oy.bool,null),ly.vec4b=new ly("vec4",oy.bool,null),ly.mat2x2f=new ly("mat2x2",oy.f32,null),ly.mat2x3f=new ly("mat2x3",oy.f32,null),ly.mat2x4f=new ly("mat2x4",oy.f32,null),ly.mat3x2f=new ly("mat3x2",oy.f32,null),ly.mat3x3f=new ly("mat3x3",oy.f32,null),ly.mat3x4f=new ly("mat3x4",oy.f32,null),ly.mat4x2f=new ly("mat4x2",oy.f32,null),ly.mat4x3f=new ly("mat4x3",oy.f32,null),ly.mat4x4f=new ly("mat4x4",oy.f32,null),ly.mat2x2h=new ly("mat2x2",oy.f16,null),ly.mat2x3h=new ly("mat2x3",oy.f16,null),ly.mat2x4h=new ly("mat2x4",oy.f16,null),ly.mat3x2h=new ly("mat3x2",oy.f16,null),ly.mat3x3h=new ly("mat3x3",oy.f16,null),ly.mat3x4h=new ly("mat3x4",oy.f16,null),ly.mat4x2h=new ly("mat4x2",oy.f16,null),ly.mat4x3h=new ly("mat4x3",oy.f16,null),ly.mat4x4h=new ly("mat4x4",oy.f16,null),ly.mat2x2i=new ly("mat2x2",oy.i32,null),ly.mat2x3i=new ly("mat2x3",oy.i32,null),ly.mat2x4i=new ly("mat2x4",oy.i32,null),ly.mat3x2i=new ly("mat3x2",oy.i32,null),ly.mat3x3i=new ly("mat3x3",oy.i32,null),ly.mat3x4i=new ly("mat3x4",oy.i32,null),ly.mat4x2i=new ly("mat4x2",oy.i32,null),ly.mat4x3i=new ly("mat4x3",oy.i32,null),ly.mat4x4i=new ly("mat4x4",oy.i32,null),ly.mat2x2u=new ly("mat2x2",oy.u32,null),ly.mat2x3u=new ly("mat2x3",oy.u32,null),ly.mat2x4u=new ly("mat2x4",oy.u32,null),ly.mat3x2u=new ly("mat3x2",oy.u32,null),ly.mat3x3u=new ly("mat3x3",oy.u32,null),ly.mat3x4u=new ly("mat3x4",oy.u32,null),ly.mat4x2u=new ly("mat4x2",oy.u32,null),ly.mat4x3u=new ly("mat4x3",oy.u32,null),ly.mat4x4u=new ly("mat4x4",oy.u32,null);class cy extends oy{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class uy extends oy{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class hy extends oy{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class dy extends A_{constructor(){super(),this.postfix=null}}class py extends dy{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class fy extends dy{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class gy extends dy{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return M_.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class my extends dy{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class _y extends dy{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class yy extends dy{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Dy}get isVector(){return this.value instanceof Ny||this.value instanceof By}get scalarValue(){return this.value instanceof Dy?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ny||this.value instanceof By?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class vy extends dy{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class by extends dy{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class xy extends dy{constructor(){super()}}class wy extends xy{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Ey extends xy{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?oy.f32:"u32"===e.name||"u32"===t.name?oy.u32:oy.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Sy extends A_{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Ty extends dy{constructor(){super()}get astNodeType(){return"default"}}class Cy extends Sy{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Ay extends Sy{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Py extends A_{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class Iy extends A_{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class My extends A_{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Ry extends A_{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ky{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ky._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}ky._id=0;class Oy extends ky{constructor(){super(new e_("void",null),null)}toString(){return"void"}}Oy.void=new Oy;class Ly extends ky{constructor(e){super(new r_("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class Dy extends ky{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Dy(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Dy(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Dy(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof Dy))return void console.error("SetDataValue: Invalid value",t);let r=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?r=Math.floor(r):"bool"===this.typeInfo.name&&(r=r?1:0),this.data[0]=r}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function Fy(e,t,n){const i=t.length;return 2===i?"f32"===n?new Ny(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new Ny(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new Ny(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new Ny(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):3===i?"f32"===n?new Ny(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new Ny(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new Ny(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new Ny(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):4===i?"f32"===n?new Ny(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new Ny(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new Ny(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new Ny(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class Ny extends ky{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new Ny(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ny(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ny(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,i){n instanceof py?console.error("TODO: Set vector postfix"):t instanceof Ny?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof o_)i=this.typeInfo.format||i;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?i=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?i=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?i=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?i=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let r=this;for(;null!==t&&null!==r;){if(t instanceof by){const o=t.index;let s=-1;if(o instanceof yy){if(!(o.value instanceof Dy))return console.error(`GetSubData: Invalid array index ${o.value}`),null;s=o.value.value}else{const t=e.evalExpression(o,n);if(!(t instanceof Dy))return console.error("GetSubData: Unknown index type",o),null;s=t.value}if(s<0||s>=r.data.length)return console.error("GetSubData: Index out of range",s),null;if(r.data instanceof Float32Array){const e=new Float32Array(r.data.buffer,r.data.byteOffset+4*s,1);return new Dy(e,i)}if(r.data instanceof Int32Array){const e=new Int32Array(r.data.buffer,r.data.byteOffset+4*s,1);return new Dy(e,i)}if(r.data instanceof Uint32Array){const e=new Uint32Array(r.data.buffer,r.data.byteOffset+4*s,1);return new Dy(e,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof py))return console.error("GetSubData: Unknown postfix",t),null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return console.error(`GetSubData: Unknown member ${n}`),null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Dy(t,i,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Dy(t,i,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Dy(t,i,this)}}const o=[];for(const e of n)"x"===e||"r"===e?o.push(this.data[0]):"y"===e||"g"===e?o.push(this.data[1]):"z"===e||"b"===e?o.push(this.data[2]):"w"===e||"a"===e?o.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);r=Fy(e,o,i.name)}t=t.postfix}return r}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class By extends ky{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new By(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,i){n instanceof py?console.error("TODO: Set matrix postfix"):t instanceof By?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof o_)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof by){const r=t.index;let o=-1;if(r instanceof yy){if(!(r.value instanceof Dy))return console.error(`GetDataValue: Invalid array index ${r.value}`),null;o=r.value.value}else{const t=e.evalExpression(r,n);if(!(t instanceof Dy))return console.error("GetDataValue: Unknown index type",r),null;o=t.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const s=i.endsWith("h")?"h":"f";let a;if("mat2x2"===i||"mat2x2f"===i||"mat2x2h"===i||"mat3x2"===i||"mat3x2f"===i||"mat3x2h"===i||"mat4x2"===i||"mat4x2f"===i||"mat4x2h"===i)a=new Ny(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${s}`));else if("mat2x3"===i||"mat2x3f"===i||"mat2x3h"===i||"mat3x3"===i||"mat3x3f"===i||"mat3x3h"===i||"mat4x3"===i||"mat4x3f"===i||"mat4x3h"===i)a=new Ny(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${s}`));else{if("mat2x4"!==i&&"mat2x4f"!==i&&"mat2x4h"!==i&&"mat3x4"!==i&&"mat3x4f"!==i&&"mat3x4h"!==i&&"mat4x4"!==i&&"mat4x4f"!==i&&"mat4x4h"!==i)return console.error(`GetDataValue: Unknown type ${i}`),null;a=new Ny(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${s}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class zy extends ky{constructor(e,t,n=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new zy(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(null===t)return void console.log("setDataValue: NULL data.");let r=this.offset,o=this.typeInfo;for(;n;){if(n instanceof by)if(o instanceof i_){const t=n.index;if(t instanceof yy){if(!(t.value instanceof Dy))return void console.error(`SetDataValue: Invalid index type ${t.value}`);r+=t.value.value*o.stride}else{const n=e.evalExpression(t,i);if(!(n instanceof Dy))return void console.error("SetDataValue: Unknown index type",t);r+=n.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(n instanceof py))return void console.error("SetDataValue: Unknown postfix type",n);{const e=n.value;if(o instanceof n_){let t=!1;for(const n of o.members)if(n.name===e){r+=n.offset,o=n.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(o instanceof e_){const n=o.getTypeName();let i=0;if("x"===e||"r"===e)i=0;else if("y"===e||"g"===e)i=1;else if("z"===e||"b"===e)i=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);i=3}if(!(t instanceof Dy))return void console.error("SetDataValue: Invalid value",t);const s=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,r,2)[i]=s):"vec3f"===n?void(new Float32Array(this.buffer,r,3)[i]=s):"vec4f"===n?void(new Float32Array(this.buffer,r,4)[i]=s):"vec2i"===n?void(new Int32Array(this.buffer,r,2)[i]=s):"vec3i"===n?void(new Int32Array(this.buffer,r,3)[i]=s):"vec4i"===n?void(new Int32Array(this.buffer,r,4)[i]=s):"vec2u"===n?void(new Uint32Array(this.buffer,r,2)[i]=s):"vec3u"===n?void(new Uint32Array(this.buffer,r,3)[i]=s):"vec4u"===n?void(new Uint32Array(this.buffer,r,4)[i]=s):void console.error(`SetDataValue: Type ${n} is not a struct`)}}}n=n.postfix}this.setData(e,t,o,r,i)}setData(e,t,n,i,r){const o=n.getTypeName();if("f32"!==o&&"f16"!==o)if("i32"!==o&&"atomic<i32>"!==o&&"x32"!==o)if("u32"!==o&&"atomic<u32>"!==o)if("bool"!==o){if("vec2f"===o||"vec2h"===o){const e=new Float32Array(this.buffer,i,2);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===o||"vec3h"===o){const e=new Float32Array(this.buffer,i,3);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===o||"vec4h"===o){const e=new Float32Array(this.buffer,i,4);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===o){const e=new Int32Array(this.buffer,i,2);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===o){const e=new Int32Array(this.buffer,i,3);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===o){const e=new Int32Array(this.buffer,i,4);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===o){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===o){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===o){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===o){const e=new Uint32Array(this.buffer,i,2);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===o){const e=new Uint32Array(this.buffer,i,3);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===o){const e=new Uint32Array(this.buffer,i,4);return void(t instanceof Ny?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===o||"mat2x2h"===o){const e=new Float32Array(this.buffer,i,4);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===o||"mat2x3h"===o){const e=new Float32Array(this.buffer,i,6);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===o||"mat2x4h"===o){const e=new Float32Array(this.buffer,i,8);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===o||"mat3x2h"===o){const e=new Float32Array(this.buffer,i,6);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===o||"mat3x3h"===o){const e=new Float32Array(this.buffer,i,9);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===o||"mat3x4h"===o){const e=new Float32Array(this.buffer,i,12);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===o||"mat4x2h"===o){const e=new Float32Array(this.buffer,i,8);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===o||"mat4x3h"===o){const e=new Float32Array(this.buffer,i,12);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===o||"mat4x4h"===o){const e=new Float32Array(this.buffer,i,16);return void(t instanceof By?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof zy){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",o,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else t instanceof Dy&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Dy&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof Dy&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof Dy&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,r,o;if(null===t)return this;let s=this.offset,a=this.typeInfo;for(;t;){if(t instanceof by){const i=t.index,r=i instanceof dy?e.evalExpression(i,n):i;let o=0;if(r instanceof Dy?o=r.value:"number"==typeof r?o=r:console.error("GetDataValue: Invalid index type",i),a instanceof i_)s+=o*a.stride,a=a.format;else{const t=a.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(s+=16*o,a=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${a.getTypeName()} is not an array`)}}else{if(!(t instanceof py))return console.error("GetDataValue: Unknown postfix type",t),null;{const n=t.value;if(a instanceof n_){let e=!1;for(const t of a.members)if(t.name===n){s+=t.offset,a=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${n} not found`),null}else if(a instanceof e_){const t=a.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let i="f";const r=[];for(let o=0;o<n.length;++o){const a=n[o].toLowerCase();let l=0;if("x"===a||"r"===a)l=0;else if("y"===a||"g"===a)l=1;else if("z"===a||"b"===a)l=2;else{if("w"!==a&&"a"!==a)return console.error(`Unknown member ${n}`),null;l=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*l+4?(console.log("Insufficient buffer data"),null):new Dy(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new Dy(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new Dy(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new Dy(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new Dy(new Uint32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)r.push(new Float32Array(this.buffer,s,2)[l]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const e=new Float32Array(this.buffer,s,3);r.push(e[l])}else if("vec4f"===t)r.push(new Float32Array(this.buffer,s,4)[l]);else if("vec2i"===t)i="i",r.push(new Int32Array(this.buffer,s,2)[l]);else if("vec3i"===t)i="i",r.push(new Int32Array(this.buffer,s,3)[l]);else if("vec4i"===t)i="i",r.push(new Int32Array(this.buffer,s,4)[l]);else if("vec2u"===t){i="u";const e=new Uint32Array(this.buffer,s,2);r.push(e[l])}else"vec3u"===t?(i="u",r.push(new Uint32Array(this.buffer,s,3)[l])):"vec4u"===t&&(i="u",r.push(new Uint32Array(this.buffer,s,4)[l]))}return 2===r.length?a=e.getTypeInfo(`vec2${i}`):3===r.length?a=e.getTypeInfo(`vec3${i}`):4===r.length?a=e.getTypeInfo(`vec4${i}`):console.error(`GetDataValue: Invalid vector length ${r.length}`),new Ny(r,a,null)}return console.error(`GetDataValue: Unknown member ${n}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}const l=a.getTypeName();return"f32"===l?new Dy(new Float32Array(this.buffer,s,1),a,this):"i32"===l?new Dy(new Int32Array(this.buffer,s,1),a,this):"u32"===l?new Dy(new Uint32Array(this.buffer,s,1),a,this):"vec2f"===l?new Ny(new Float32Array(this.buffer,s,2),a,this):"vec3f"===l?new Ny(new Float32Array(this.buffer,s,3),a,this):"vec4f"===l?new Ny(new Float32Array(this.buffer,s,4),a,this):"vec2i"===l?new Ny(new Int32Array(this.buffer,s,2),a,this):"vec3i"===l?new Ny(new Int32Array(this.buffer,s,3),a,this):"vec4i"===l?new Ny(new Int32Array(this.buffer,s,4),a,this):"vec2u"===l?new Ny(new Uint32Array(this.buffer,s,2),a,this):"vec3u"===l?new Ny(new Uint32Array(this.buffer,s,3),a,this):"vec4u"===l?new Ny(new Uint32Array(this.buffer,s,4),a,this):a instanceof o_&&"atomic"===a.name?"u32"===(null===(i=a.format)||void 0===i?void 0:i.name)?new Dy(new Uint32Array(this.buffer,s,1)[0],a.format,this):"i32"===(null===(r=a.format)||void 0===r?void 0:r.name)?new Dy(new Int32Array(this.buffer,s,1)[0],a.format,this):(console.error(`GetDataValue: Invalid atomic format ${null===(o=a.format)||void 0===o?void 0:o.name}`),null):new zy(this.buffer,a,s,this)}toString(){let e="";if(this.typeInfo instanceof i_)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof n_?e+="{...}":e="[...]";return e}}class jy extends ky{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new jy(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=C_[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=C_[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=C_[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,r=this.depthOrArrayLayers,o=this.dimension;return n/t.blockWidth*("1d"===o?1:i/t.blockHeight)*t.bytesPerBlock*r}getPixel(e,t,n=0,i=0){const r=this.texelByteSize,o=this.bytesPerRow,s=this.height,a=this.data[i];return function(e,t,n,i,r,o,s,a,l){const c=i*(s>>=r)*(o>>=r)+n*s+t*a;switch(l){case"r8unorm":return[S_(e,c,"8unorm",1)[0]];case"r8snorm":return[S_(e,c,"8snorm",1)[0]];case"r8uint":return[S_(e,c,"8uint",1)[0]];case"r8sint":return[S_(e,c,"8sint",1)[0]];case"rg8unorm":{const t=S_(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=S_(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=S_(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=S_(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=S_(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=S_(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=S_(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=S_(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=S_(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[S_(e,c,"16uint",1)[0]];case"r16sint":return[S_(e,c,"16sint",1)[0]];case"r16float":return[S_(e,c,"16float",1)[0]];case"rg16uint":{const t=S_(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=S_(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=S_(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=S_(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=S_(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=S_(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[S_(e,c,"32uint",1)[0]];case"r32sint":return[S_(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[S_(e,c,"32float",1)[0]];case"rg32uint":{const t=S_(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=S_(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=S_(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=S_(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=S_(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=S_(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,i=(4290772992&t)>>22;return[E_(2047&t),E_(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return x_[0]=t,w_[0]}(i),1]}}return null}(new Uint8Array(a),e,t,n,i,s,o,r,this.format)}setPixel(e,t,n,i,r){const o=this.texelByteSize,s=this.bytesPerRow,a=this.height,l=this.data[i];!function(e,t,n,i,r,o,s,a,l,c){const u=i*(s>>=r)*(o>>=r)+n*s+t*a;switch(l){case"r8unorm":return void T_(e,u,"8unorm",1,c);case"r8snorm":return void T_(e,u,"8snorm",1,c);case"r8uint":return void T_(e,u,"8uint",1,c);case"r8sint":return void T_(e,u,"8sint",1,c);case"rg8unorm":return void T_(e,u,"8unorm",2,c);case"rg8snorm":return void T_(e,u,"8snorm",2,c);case"rg8uint":return void T_(e,u,"8uint",2,c);case"rg8sint":return void T_(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void T_(e,u,"8unorm",4,c);case"rgba8snorm":return void T_(e,u,"8snorm",4,c);case"rgba8uint":return void T_(e,u,"8uint",4,c);case"rgba8sint":return void T_(e,u,"8sint",4,c);case"r16uint":return void T_(e,u,"16uint",1,c);case"r16sint":return void T_(e,u,"16sint",1,c);case"r16float":return void T_(e,u,"16float",1,c);case"rg16uint":return void T_(e,u,"16uint",2,c);case"rg16sint":return void T_(e,u,"16sint",2,c);case"rg16float":return void T_(e,u,"16float",2,c);case"rgba16uint":return void T_(e,u,"16uint",4,c);case"rgba16sint":return void T_(e,u,"16sint",4,c);case"rgba16float":return void T_(e,u,"16float",4,c);case"r32uint":return void T_(e,u,"32uint",1,c);case"r32sint":return void T_(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void T_(e,u,"32float",1,c);case"rg32uint":return void T_(e,u,"32uint",2,c);case"rg32sint":return void T_(e,u,"32sint",2,c);case"rg32float":return void T_(e,u,"32float",2,c);case"rgba32uint":return void T_(e,u,"32uint",4,c);case"rgba32sint":return void T_(e,u,"32sint",4,c);case"rgba32float":return void T_(e,u,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(l),e,t,n,i,a,s,o,this.format,r)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(G_||(G_={}));class Uy{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Vy{}$_=Vy,Vy.none=new Uy("",G_.reserved,""),Vy.eof=new Uy("EOF",G_.token,""),Vy.reserved={asm:new Uy("asm",G_.reserved,"asm"),bf16:new Uy("bf16",G_.reserved,"bf16"),do:new Uy("do",G_.reserved,"do"),enum:new Uy("enum",G_.reserved,"enum"),f16:new Uy("f16",G_.reserved,"f16"),f64:new Uy("f64",G_.reserved,"f64"),handle:new Uy("handle",G_.reserved,"handle"),i8:new Uy("i8",G_.reserved,"i8"),i16:new Uy("i16",G_.reserved,"i16"),i64:new Uy("i64",G_.reserved,"i64"),mat:new Uy("mat",G_.reserved,"mat"),premerge:new Uy("premerge",G_.reserved,"premerge"),regardless:new Uy("regardless",G_.reserved,"regardless"),typedef:new Uy("typedef",G_.reserved,"typedef"),u8:new Uy("u8",G_.reserved,"u8"),u16:new Uy("u16",G_.reserved,"u16"),u64:new Uy("u64",G_.reserved,"u64"),unless:new Uy("unless",G_.reserved,"unless"),using:new Uy("using",G_.reserved,"using"),vec:new Uy("vec",G_.reserved,"vec"),void:new Uy("void",G_.reserved,"void")},Vy.keywords={array:new Uy("array",G_.keyword,"array"),atomic:new Uy("atomic",G_.keyword,"atomic"),bool:new Uy("bool",G_.keyword,"bool"),f32:new Uy("f32",G_.keyword,"f32"),i32:new Uy("i32",G_.keyword,"i32"),mat2x2:new Uy("mat2x2",G_.keyword,"mat2x2"),mat2x3:new Uy("mat2x3",G_.keyword,"mat2x3"),mat2x4:new Uy("mat2x4",G_.keyword,"mat2x4"),mat3x2:new Uy("mat3x2",G_.keyword,"mat3x2"),mat3x3:new Uy("mat3x3",G_.keyword,"mat3x3"),mat3x4:new Uy("mat3x4",G_.keyword,"mat3x4"),mat4x2:new Uy("mat4x2",G_.keyword,"mat4x2"),mat4x3:new Uy("mat4x3",G_.keyword,"mat4x3"),mat4x4:new Uy("mat4x4",G_.keyword,"mat4x4"),ptr:new Uy("ptr",G_.keyword,"ptr"),sampler:new Uy("sampler",G_.keyword,"sampler"),sampler_comparison:new Uy("sampler_comparison",G_.keyword,"sampler_comparison"),struct:new Uy("struct",G_.keyword,"struct"),texture_1d:new Uy("texture_1d",G_.keyword,"texture_1d"),texture_2d:new Uy("texture_2d",G_.keyword,"texture_2d"),texture_2d_array:new Uy("texture_2d_array",G_.keyword,"texture_2d_array"),texture_3d:new Uy("texture_3d",G_.keyword,"texture_3d"),texture_cube:new Uy("texture_cube",G_.keyword,"texture_cube"),texture_cube_array:new Uy("texture_cube_array",G_.keyword,"texture_cube_array"),texture_multisampled_2d:new Uy("texture_multisampled_2d",G_.keyword,"texture_multisampled_2d"),texture_storage_1d:new Uy("texture_storage_1d",G_.keyword,"texture_storage_1d"),texture_storage_2d:new Uy("texture_storage_2d",G_.keyword,"texture_storage_2d"),texture_storage_2d_array:new Uy("texture_storage_2d_array",G_.keyword,"texture_storage_2d_array"),texture_storage_3d:new Uy("texture_storage_3d",G_.keyword,"texture_storage_3d"),texture_depth_2d:new Uy("texture_depth_2d",G_.keyword,"texture_depth_2d"),texture_depth_2d_array:new Uy("texture_depth_2d_array",G_.keyword,"texture_depth_2d_array"),texture_depth_cube:new Uy("texture_depth_cube",G_.keyword,"texture_depth_cube"),texture_depth_cube_array:new Uy("texture_depth_cube_array",G_.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Uy("texture_depth_multisampled_2d",G_.keyword,"texture_depth_multisampled_2d"),texture_external:new Uy("texture_external",G_.keyword,"texture_external"),u32:new Uy("u32",G_.keyword,"u32"),vec2:new Uy("vec2",G_.keyword,"vec2"),vec3:new Uy("vec3",G_.keyword,"vec3"),vec4:new Uy("vec4",G_.keyword,"vec4"),bitcast:new Uy("bitcast",G_.keyword,"bitcast"),block:new Uy("block",G_.keyword,"block"),break:new Uy("break",G_.keyword,"break"),case:new Uy("case",G_.keyword,"case"),continue:new Uy("continue",G_.keyword,"continue"),continuing:new Uy("continuing",G_.keyword,"continuing"),default:new Uy("default",G_.keyword,"default"),diagnostic:new Uy("diagnostic",G_.keyword,"diagnostic"),discard:new Uy("discard",G_.keyword,"discard"),else:new Uy("else",G_.keyword,"else"),enable:new Uy("enable",G_.keyword,"enable"),fallthrough:new Uy("fallthrough",G_.keyword,"fallthrough"),false:new Uy("false",G_.keyword,"false"),fn:new Uy("fn",G_.keyword,"fn"),for:new Uy("for",G_.keyword,"for"),function:new Uy("function",G_.keyword,"function"),if:new Uy("if",G_.keyword,"if"),let:new Uy("let",G_.keyword,"let"),const:new Uy("const",G_.keyword,"const"),loop:new Uy("loop",G_.keyword,"loop"),while:new Uy("while",G_.keyword,"while"),private:new Uy("private",G_.keyword,"private"),read:new Uy("read",G_.keyword,"read"),read_write:new Uy("read_write",G_.keyword,"read_write"),return:new Uy("return",G_.keyword,"return"),requires:new Uy("requires",G_.keyword,"requires"),storage:new Uy("storage",G_.keyword,"storage"),switch:new Uy("switch",G_.keyword,"switch"),true:new Uy("true",G_.keyword,"true"),alias:new Uy("alias",G_.keyword,"alias"),type:new Uy("type",G_.keyword,"type"),uniform:new Uy("uniform",G_.keyword,"uniform"),var:new Uy("var",G_.keyword,"var"),override:new Uy("override",G_.keyword,"override"),workgroup:new Uy("workgroup",G_.keyword,"workgroup"),write:new Uy("write",G_.keyword,"write"),r8unorm:new Uy("r8unorm",G_.keyword,"r8unorm"),r8snorm:new Uy("r8snorm",G_.keyword,"r8snorm"),r8uint:new Uy("r8uint",G_.keyword,"r8uint"),r8sint:new Uy("r8sint",G_.keyword,"r8sint"),r16uint:new Uy("r16uint",G_.keyword,"r16uint"),r16sint:new Uy("r16sint",G_.keyword,"r16sint"),r16float:new Uy("r16float",G_.keyword,"r16float"),rg8unorm:new Uy("rg8unorm",G_.keyword,"rg8unorm"),rg8snorm:new Uy("rg8snorm",G_.keyword,"rg8snorm"),rg8uint:new Uy("rg8uint",G_.keyword,"rg8uint"),rg8sint:new Uy("rg8sint",G_.keyword,"rg8sint"),r32uint:new Uy("r32uint",G_.keyword,"r32uint"),r32sint:new Uy("r32sint",G_.keyword,"r32sint"),r32float:new Uy("r32float",G_.keyword,"r32float"),rg16uint:new Uy("rg16uint",G_.keyword,"rg16uint"),rg16sint:new Uy("rg16sint",G_.keyword,"rg16sint"),rg16float:new Uy("rg16float",G_.keyword,"rg16float"),rgba8unorm:new Uy("rgba8unorm",G_.keyword,"rgba8unorm"),rgba8unorm_srgb:new Uy("rgba8unorm_srgb",G_.keyword,"rgba8unorm_srgb"),rgba8snorm:new Uy("rgba8snorm",G_.keyword,"rgba8snorm"),rgba8uint:new Uy("rgba8uint",G_.keyword,"rgba8uint"),rgba8sint:new Uy("rgba8sint",G_.keyword,"rgba8sint"),bgra8unorm:new Uy("bgra8unorm",G_.keyword,"bgra8unorm"),bgra8unorm_srgb:new Uy("bgra8unorm_srgb",G_.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Uy("rgb10a2unorm",G_.keyword,"rgb10a2unorm"),rg11b10float:new Uy("rg11b10float",G_.keyword,"rg11b10float"),rg32uint:new Uy("rg32uint",G_.keyword,"rg32uint"),rg32sint:new Uy("rg32sint",G_.keyword,"rg32sint"),rg32float:new Uy("rg32float",G_.keyword,"rg32float"),rgba16uint:new Uy("rgba16uint",G_.keyword,"rgba16uint"),rgba16sint:new Uy("rgba16sint",G_.keyword,"rgba16sint"),rgba16float:new Uy("rgba16float",G_.keyword,"rgba16float"),rgba32uint:new Uy("rgba32uint",G_.keyword,"rgba32uint"),rgba32sint:new Uy("rgba32sint",G_.keyword,"rgba32sint"),rgba32float:new Uy("rgba32float",G_.keyword,"rgba32float"),static_assert:new Uy("static_assert",G_.keyword,"static_assert")},Vy.tokens={decimal_float_literal:new Uy("decimal_float_literal",G_.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Uy("hex_float_literal",G_.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Uy("int_literal",G_.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Uy("uint_literal",G_.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Uy("name",G_.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Uy("ident",G_.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Uy("and",G_.token,"&"),and_and:new Uy("and_and",G_.token,"&&"),arrow:new Uy("arrow ",G_.token,"->"),attr:new Uy("attr",G_.token,"@"),forward_slash:new Uy("forward_slash",G_.token,"/"),bang:new Uy("bang",G_.token,"!"),bracket_left:new Uy("bracket_left",G_.token,"["),bracket_right:new Uy("bracket_right",G_.token,"]"),brace_left:new Uy("brace_left",G_.token,"{"),brace_right:new Uy("brace_right",G_.token,"}"),colon:new Uy("colon",G_.token,":"),comma:new Uy("comma",G_.token,","),equal:new Uy("equal",G_.token,"="),equal_equal:new Uy("equal_equal",G_.token,"=="),not_equal:new Uy("not_equal",G_.token,"!="),greater_than:new Uy("greater_than",G_.token,">"),greater_than_equal:new Uy("greater_than_equal",G_.token,">="),shift_right:new Uy("shift_right",G_.token,">>"),less_than:new Uy("less_than",G_.token,"<"),less_than_equal:new Uy("less_than_equal",G_.token,"<="),shift_left:new Uy("shift_left",G_.token,"<<"),modulo:new Uy("modulo",G_.token,"%"),minus:new Uy("minus",G_.token,"-"),minus_minus:new Uy("minus_minus",G_.token,"--"),period:new Uy("period",G_.token,"."),plus:new Uy("plus",G_.token,"+"),plus_plus:new Uy("plus_plus",G_.token,"++"),or:new Uy("or",G_.token,"|"),or_or:new Uy("or_or",G_.token,"||"),paren_left:new Uy("paren_left",G_.token,"("),paren_right:new Uy("paren_right",G_.token,")"),semicolon:new Uy("semicolon",G_.token,";"),star:new Uy("star",G_.token,"*"),tilde:new Uy("tilde",G_.token,"~"),underscore:new Uy("underscore",G_.token,"_"),xor:new Uy("xor",G_.token,"^"),plus_equal:new Uy("plus_equal",G_.token,"+="),minus_equal:new Uy("minus_equal",G_.token,"-="),times_equal:new Uy("times_equal",G_.token,"*="),division_equal:new Uy("division_equal",G_.token,"/="),modulo_equal:new Uy("modulo_equal",G_.token,"%="),and_equal:new Uy("and_equal",G_.token,"&="),or_equal:new Uy("or_equal",G_.token,"|="),xor_equal:new Uy("xor_equal",G_.token,"^="),shift_right_equal:new Uy("shift_right_equal",G_.token,">>="),shift_left_equal:new Uy("shift_left_equal",G_.token,"<<=")},Vy.simpleTokens={"@":$_.tokens.attr,"{":$_.tokens.brace_left,"}":$_.tokens.brace_right,":":$_.tokens.colon,",":$_.tokens.comma,"(":$_.tokens.paren_left,")":$_.tokens.paren_right,";":$_.tokens.semicolon},Vy.literalTokens={"&":$_.tokens.and,"&&":$_.tokens.and_and,"->":$_.tokens.arrow,"/":$_.tokens.forward_slash,"!":$_.tokens.bang,"[":$_.tokens.bracket_left,"]":$_.tokens.bracket_right,"=":$_.tokens.equal,"==":$_.tokens.equal_equal,"!=":$_.tokens.not_equal,">":$_.tokens.greater_than,">=":$_.tokens.greater_than_equal,">>":$_.tokens.shift_right,"<":$_.tokens.less_than,"<=":$_.tokens.less_than_equal,"<<":$_.tokens.shift_left,"%":$_.tokens.modulo,"-":$_.tokens.minus,"--":$_.tokens.minus_minus,".":$_.tokens.period,"+":$_.tokens.plus,"++":$_.tokens.plus_plus,"|":$_.tokens.or,"||":$_.tokens.or_or,"*":$_.tokens.star,"~":$_.tokens.tilde,_:$_.tokens.underscore,"^":$_.tokens.xor,"+=":$_.tokens.plus_equal,"-=":$_.tokens.minus_equal,"*=":$_.tokens.times_equal,"/=":$_.tokens.division_equal,"%=":$_.tokens.modulo_equal,"&=":$_.tokens.and_equal,"|=":$_.tokens.or_equal,"^=":$_.tokens.xor_equal,">>=":$_.tokens.shift_right_equal,"<<=":$_.tokens.shift_left_equal},Vy.regexTokens={decimal_float_literal:$_.tokens.decimal_float_literal,hex_float_literal:$_.tokens.hex_float_literal,int_literal:$_.tokens.int_literal,uint_literal:$_.tokens.uint_literal,ident:$_.tokens.ident},Vy.storage_class=[$_.keywords.function,$_.keywords.private,$_.keywords.workgroup,$_.keywords.uniform,$_.keywords.storage],Vy.access_mode=[$_.keywords.read,$_.keywords.write,$_.keywords.read_write],Vy.sampler_type=[$_.keywords.sampler,$_.keywords.sampler_comparison],Vy.sampled_texture_type=[$_.keywords.texture_1d,$_.keywords.texture_2d,$_.keywords.texture_2d_array,$_.keywords.texture_3d,$_.keywords.texture_cube,$_.keywords.texture_cube_array],Vy.multisampled_texture_type=[$_.keywords.texture_multisampled_2d],Vy.storage_texture_type=[$_.keywords.texture_storage_1d,$_.keywords.texture_storage_2d,$_.keywords.texture_storage_2d_array,$_.keywords.texture_storage_3d],Vy.depth_texture_type=[$_.keywords.texture_depth_2d,$_.keywords.texture_depth_2d_array,$_.keywords.texture_depth_cube,$_.keywords.texture_depth_cube_array,$_.keywords.texture_depth_multisampled_2d],Vy.texture_external_type=[$_.keywords.texture_external],Vy.any_texture_type=[...$_.sampled_texture_type,...$_.multisampled_texture_type,...$_.storage_texture_type,...$_.depth_texture_type,...$_.texture_external_type],Vy.texel_format=[$_.keywords.r8unorm,$_.keywords.r8snorm,$_.keywords.r8uint,$_.keywords.r8sint,$_.keywords.r16uint,$_.keywords.r16sint,$_.keywords.r16float,$_.keywords.rg8unorm,$_.keywords.rg8snorm,$_.keywords.rg8uint,$_.keywords.rg8sint,$_.keywords.r32uint,$_.keywords.r32sint,$_.keywords.r32float,$_.keywords.rg16uint,$_.keywords.rg16sint,$_.keywords.rg16float,$_.keywords.rgba8unorm,$_.keywords.rgba8unorm_srgb,$_.keywords.rgba8snorm,$_.keywords.rgba8uint,$_.keywords.rgba8sint,$_.keywords.bgra8unorm,$_.keywords.bgra8unorm_srgb,$_.keywords.rgb10a2unorm,$_.keywords.rg11b10float,$_.keywords.rg32uint,$_.keywords.rg32sint,$_.keywords.rg32float,$_.keywords.rgba16uint,$_.keywords.rgba16sint,$_.keywords.rgba16float,$_.keywords.rgba32uint,$_.keywords.rgba32sint,$_.keywords.rgba32float],Vy.const_literal=[$_.tokens.int_literal,$_.tokens.uint_literal,$_.tokens.decimal_float_literal,$_.tokens.hex_float_literal,$_.keywords.true,$_.keywords.false],Vy.literal_or_ident=[$_.tokens.ident,$_.tokens.int_literal,$_.tokens.uint_literal,$_.tokens.decimal_float_literal,$_.tokens.hex_float_literal,$_.tokens.name],Vy.element_count_expression=[$_.tokens.int_literal,$_.tokens.uint_literal,$_.tokens.ident],Vy.template_types=[$_.keywords.vec2,$_.keywords.vec3,$_.keywords.vec4,$_.keywords.mat2x2,$_.keywords.mat2x3,$_.keywords.mat2x4,$_.keywords.mat3x2,$_.keywords.mat3x3,$_.keywords.mat3x4,$_.keywords.mat4x2,$_.keywords.mat4x3,$_.keywords.mat4x4,$_.keywords.atomic,$_.keywords.bitcast,...$_.any_texture_type],Vy.attribute_name=[$_.tokens.ident,$_.keywords.block,$_.keywords.diagnostic],Vy.assignment_operators=[$_.tokens.equal,$_.tokens.plus_equal,$_.tokens.minus_equal,$_.tokens.times_equal,$_.tokens.division_equal,$_.tokens.modulo_equal,$_.tokens.and_equal,$_.tokens.or_equal,$_.tokens.xor_equal,$_.tokens.shift_right_equal,$_.tokens.shift_left_equal],Vy.increment_operators=[$_.tokens.plus_plus,$_.tokens.minus_minus];class $y{constructor(e,t,n,i,r){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=r}toString(){return this.lexeme}isTemplateType(){return-1!=Vy.template_types.indexOf(this.type)}isArrayType(){return this.type==Vy.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Gy{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new $y(Vy.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=Vy.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Vy.none;const i=this._isAlpha(e),r="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(i){const t=Vy.keywords[e];if(t)return this._addToken(t),!0}if(i||r)return this._addToken(Vy.tokens.ident),!0;for(;;){let t=this._findType(e);const i=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==i)return this._current++,e+=i,this._addToken(Vy.tokens.minus_equal),!0;if("-"==i)return this._current++,e+=i,this._addToken(Vy.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=Vy.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==Vy.tokens.paren_right)&&">"!=i)return this._addToken(t),!0}if(">"==e&&(">"==i||"="==i)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===Vy.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===Vy.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===Vy.none){let i=e,r=0;const o=2;for(let e=0;e<o;++e)if(i+=this._peekAhead(e),t=this._findType(i),t!==Vy.none){r=e;break}if(t===Vy.none)return n!==Vy.none&&(this._current--,this._addToken(n),!0);e=i,this._current+=r+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==Vy.none&&(this._addToken(n),!0)}_findType(e){for(const t in Vy.regexTokens){const n=Vy.regexTokens[t];if(this._match(e,n.rule))return n}return Vy.literalTokens[e]||Vy.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new $y(e,t,this._line,this._start,this._current))}}function Wy(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const Hy=new Float32Array(1),Zy=new Uint32Array(Hy.buffer),qy=new Uint32Array(Hy.buffer),Xy=new Int32Array(1),Yy=new Float32Array(Xy.buffer),Ky=new Uint32Array(Xy.buffer),Jy=new Uint32Array(1),Qy=new Float32Array(Jy.buffer),ev=new Int32Array(Jy.buffer);function tv(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return Hy[0]=e,Zy[0];if("u32"===n)return Hy[0]=e,qy[0]}else if("i32"===t||"x32"===t){if("f32"===n)return Xy[0]=e,Yy[0];if("u32"===n)return Xy[0]=e,Ky[0]}else if("u32"===t){if("f32"===n)return Jy[0]=e,Qy[0];if("i32"===n||"x32"===n)return Jy[0]=e,ev[0]}return console.error(`Unsupported cast from ${t} to ${n}`),e}class nv{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class iv{constructor(e,t){this.align=e,this.size=t}}class rv{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new g_,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof k_&&this._functions.set(t.name,new nv(t));for(const t of e)if(t instanceof ay){const e=this.getTypeInfo(t,null);e instanceof n_&&this.structs.push(e)}for(const t of e)if(t instanceof ty)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof B_){const e=t,n=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new d_(e.name,i,e.attributes,n));continue}if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=new l_(e.name,r,n,i,e.attributes,s_.Uniform,e.access);o.access||(o.access="read"),this.uniforms.push(o);continue}if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=this._isStorageTexture(r),s=new l_(e.name,r,n,i,e.attributes,o?s_.StorageTexture:s_.Storage,e.access);s.access||(s.access="read"),this.storage.push(s);continue}if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=this._isStorageTexture(r),s=new l_(e.name,r,n,i,e.attributes,o?s_.StorageTexture:s_.Texture,e.access);s.access||(s.access="read"),o?this.storage.push(s):this.textures.push(s);continue}if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this.getTypeInfo(e.type,e.attributes),o=new l_(e.name,r,n,i,e.attributes,s_.Sampler,e.access);this.samplers.push(o);continue}}for(const t of e)if(t instanceof k_){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),r=e||n||i,o=new f_(t.name,null==r?void 0:r.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,r&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!r),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[r.name].push(o)),o.arguments=t.args.map((e=>new p_(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes))),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(const e of this._functions.values())e.node.search((t=>{var n,i,r;if(t instanceof Ry){if(t.value)if(Wy(t.value))for(const i of t.value)for(const t of this.overrides)i===t.name&&(null===(n=e.info)||void 0===n||n.overrides.push(t));else for(const n of this.overrides)t.value===n.name&&(null===(i=e.info)||void 0===i||i.overrides.push(n))}else if(t instanceof my)for(const n of this.overrides)t.name===n.name&&(null===(r=e.info)||void 0===r||r.overrides.push(n))}));for(const e of this.uniforms)this._markStructsInUse(e.type);for(const e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const e=null===(n=this._functions.get(i.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.vertex)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n;for(const i of this.entry.fragment)if(i.name===n)for(const n of i.resources)if(n.group==e&&n.binding==t)return n}for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,r=[];return e.search((o=>{if(o instanceof P_)r.push({});else if(o instanceof I_)r.pop();else if(o instanceof N_){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(o instanceof fy){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(o instanceof z_){const e=o;t&&null!==e.type&&this._markStructsFromAST(e.type),r.length>0&&(r[r.length-1][e.name]=e)}else if(o instanceof my){const e=o;if(r.length>0&&r[r.length-1][e.name])return;const t=i._findResource(e.name);t&&n.push(t)}else if(o instanceof gy){const r=o,s=i._functions.get(r.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=i._findResources(s.node,t)),n.push(...s.resources))}else if(o instanceof Z_){const r=o,s=i._functions.get(r.name);s&&(t&&(s.inUse=!0),e.calls.add(s.node),null===s.resources&&(s.resources=i._findResources(s.node,t)),n.push(...s.resources))}})),[...new Map(n.map((e=>[e.name,e]))).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof ay)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ay)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this.getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),o=new h_(n.name,i,e.name,r);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new h_("",n,t.name,i)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof ay)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ay)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),o=new u_(e.name,i,t.name,r);return null!==n&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new c_(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof cy){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new r_(e.name,n,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof uy){const n=e,i=n.format?this.getTypeInfo(n.format,n.attributes):null,r=new i_(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof ay){const n=e,i=new n_(n.name,t);i.startLine=n.startLine,i.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);i.members.push(new t_(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof hy){const n=e,i=n.format instanceof oy,r=n.format?i?this.getTypeInfo(n.format,null):new e_(n.format,null):null,o=new o_(n.name,r,t,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ly){const n=e,i=n.format?this.getTypeInfo(n.format,null):null,r=new o_(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new e_(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const r=this._getTypeSize(e);if(e.size=null!==(t=null==r?void 0:r.size)&&void 0!==t?t:0,e instanceof i_&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(i=null==t?void 0:t.align)&&void 0!==i?i:0),this._updateTypeInfo(e.format)}e instanceof r_&&this._updateTypeInfo(e.format),e instanceof n_&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,o=0;for(let s=0,a=e.members.length;s<a;++s){const a=e.members[s],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,r=n,o=Math.max(o,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(o,r+i),e.align=o}_getTypeSize(e){var t,n;if(null==e)return null;const i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof t_&&(e=e.type),e instanceof e_){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=rv._typeInfo[e.name];if(void 0!==n){const o="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new iv(Math.max(r,n.align/o),Math.max(i,n.size/o))}}{const t=rv._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new iv(Math.max(r,t.align/n),Math.max(i,t.size/n))}}if(e instanceof i_){let t=e,o=8,s=8;const a=this._getTypeSize(t.format);return null!==a&&(s=a.size,o=a.align),s=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(o,s)),i&&(s=i),new iv(Math.max(r,o),Math.max(i,s))}if(e instanceof n_){let t=0,n=0,o=0,s=0,a=0;for(const n of e.members){const e=this._getTypeSize(n.type);null!==e&&(t=Math.max(e.align,t),o=this._roundUp(e.align,o+s),s=e.size,a=o)}return n=this._roundUp(t,a+s),new iv(Math.max(r,t),Math.max(i,n))}return null}_isUniformVar(e){return e instanceof N_&&"uniform"==e.storage}_isStorageVar(e){return e instanceof N_&&"storage"==e.storage}_isTextureVar(e){return e instanceof N_&&null!==e.type&&-1!=rv._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof N_&&null!==e.type&&-1!=rv._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let e of i)if(e.name==t)return e;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}rv._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},rv._textureTypes=Vy.any_texture_type.map((e=>e.name)),rv._samplerTypes=Vy.sampler_type.map((e=>e.name));let ov=0;class sv{constructor(e,t,n){this.id=ov++,this.name=e,this.value=t,this.node=n}clone(){return new sv(this.name,this.value,this.node)}}class av{constructor(e){this.id=ov++,this.name=e.name,this.node=e}clone(){return new av(this.node)}}class lv{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=ov++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new sv(e,t,null!=n?n:null))}setVariable(e,t,n){const i=this.getVariable(e);null!==i?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new lv(this)}}class cv{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class uv{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof Ny)return n.data.forEach((e=>{e||(i=!1)})),new Dy(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny){const e=n.data.some((e=>e));return new Dy(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Dy))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof zy&&0===i.typeInfo.size){const e=i.typeInfo,t=i.buffer.byteLength/e.stride;return new Dy(t,this.getTypeInfo("u32"))}return new Dy(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.abs(e))),n.typeInfo);const i=n;return new Dy(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.acos(e))),n.typeInfo);const i=n;return new Dy(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.acosh(e))),n.typeInfo);const i=n;return new Dy(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.asin(e))),n.typeInfo);const i=n;return new Dy(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.asinh(e))),n.typeInfo);const i=n;return new Dy(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.atan(e))),n.typeInfo);const i=n;return new Dy(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.atanh(e))),n.typeInfo);const i=n;return new Dy(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny)return new Ny(n.data.map(((e,t)=>Math.atan2(e,i.data[t]))),n.typeInfo);const r=n,o=i;return new Dy(Math.atan2(r.value,o.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.ceil(e))),n.typeInfo);const i=n;return new Dy(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Ny&&i instanceof Ny&&r instanceof Ny)return new Ny(n.data.map(((e,t)=>this._clamp(e,i.data[t],r.data[t]))),n.typeInfo);const o=n,s=i,a=r;return new Dy(this._clamp(o.value,s.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.cos(e))),n.typeInfo);const i=n;return new Dy(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.cosh(e))),n.typeInfo);const i=n;return new Dy(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.clz32(e))),n.typeInfo);const i=n;return new Dy(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>this._countOneBits(e))),n.typeInfo);const i=n;return new Dy(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>this._countTrailingZeros(e))),n.typeInfo);const i=n;return new Dy(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny){if(3!==n.data.length||3!==i.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const t=n.data,r=i.data;return new Ny([t[1]*r[2]-r[1]*t[2],t[2]*r[0]-r[2]*t[0],t[0]*r[1]-r[0]*t[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof Ny?new Ny(n.data.map((e=>e*i)),n.typeInfo):new Dy(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof By){const e=n.data,t=n.typeInfo.getTypeName(),i=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new Dy(e[0]*e[3]-e[1]*e[2],i);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new Dy(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new Dy(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),i);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-i.data[t])*(n.data[t]-i.data[t]);return new Dy(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n,o=i;return new Dy(Math.abs(r.value-o.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof Ny&&i instanceof Ny?new Dy(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.exp(e))),n.typeInfo);const i=n;return new Dy(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.pow(2,e))),n.typeInfo);const i=n;return new Dy(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if("u32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,s=r.value;if(n instanceof Ny)return new Ny(n.data.map((e=>e>>o&(1<<s)-1)),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const a=n.value;return new Dy(a>>o&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Ny&&i instanceof Ny&&r instanceof Ny){const e=this._dot(i.data,r.data);return new Ny(e<0?Array.from(n.data):n.data.map((e=>-e)),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>this._firstLeadingBit(e))),n.typeInfo);const i=n;return new Dy(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>this._firstTrailingBit(e))),n.typeInfo);const i=n;return new Dy(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.floor(e))),n.typeInfo);const i=n;return new Dy(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Ny&&i instanceof Ny&&r instanceof Ny)return n.data.length!==i.data.length||n.data.length!==r.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Ny(n.data.map(((e,t)=>e*i.data[t]+r.data[t])),n.typeInfo);const o=n,s=i,a=r;return new Dy(o.value*s.value+a.value,o.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>e-Math.floor(e))),n.typeInfo);const i=n;return new Dy(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t),o=this.exec.evalExpression(e.args[3],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const s=r.value,a=(1<<o.value)-1<<s,l=~a;if(n instanceof Ny&&i instanceof Ny)return new Ny(n.data.map(((e,t)=>e&l|i.data[t]<<s&a)),n.typeInfo);const c=n.value,u=i.value;return new Dy(c&l|u<<s&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>1/Math.sqrt(e))),n.typeInfo);const i=n;return new Dy(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny){let e=0;return n.data.forEach((t=>{e+=t*t})),new Dy(Math.sqrt(e),this.getTypeInfo("f32"))}const i=n;return new Dy(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.log(e))),n.typeInfo);const i=n;return new Dy(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.log2(e))),n.typeInfo);const i=n;return new Dy(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny)return new Ny(n.data.map(((e,t)=>Math.max(e,i.data[t]))),n.typeInfo);const r=n,o=i;return new Dy(Math.max(r.value,o.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny)return new Ny(n.data.map(((e,t)=>Math.min(e,i.data[t]))),n.typeInfo);const r=n,o=i;return new Dy(Math.min(r.value,o.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Ny&&i instanceof Ny&&r instanceof Ny)return new Ny(n.data.map(((e,t)=>n.data[t]*(1-r.data[t])+i.data[t]*r.data[t])),n.typeInfo);const o=i,s=r;return new Dy(n.value*(1-s.value)+o.value*s.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny)return new Ny(n.data.map(((e,t)=>e%i.data[t])),n.typeInfo);const r=i;return new Dy(n.value%r.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny){const i=this.Length(e,t).value;return new Ny(n.data.map((e=>e/i)),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny)return new Ny(n.data.map(((e,t)=>Math.pow(e,i.data[t]))),n.typeInfo);const r=n,o=i;return new Dy(Math.pow(r.value,o.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ny?new Ny(n.data.map((e=>e)),n.typeInfo):new Dy(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Ny?new Ny(n.data.map((e=>e*Math.PI/180)),n.typeInfo):new Dy(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof Ny&&i instanceof Ny){const e=this._dot(n.data,i.data);return new Ny(n.data.map(((t,n)=>t-2*e*i.data[n])),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(n instanceof Ny&&i instanceof Ny&&r instanceof Dy){const e=this._dot(i.data,n.data);return new Ny(n.data.map(((t,n)=>{const o=1-r.value*r.value*(1-e*e);if(o<0)return 0;const s=Math.sqrt(o);return r.value*t-(r.value*e+s)*i.data[n]})),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.round(e))),n.typeInfo);const i=n;return new Dy(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.min(Math.max(e,0),1))),n.typeInfo);const i=n;return new Dy(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.sign(e))),n.typeInfo);const i=n;return new Dy(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.sin(e))),n.typeInfo);const i=n;return new Dy(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.sinh(e))),n.typeInfo);const i=n;return new Dy(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),r=this.exec.evalExpression(e.args[2],t);if(r instanceof Ny&&n instanceof Ny&&i instanceof Ny)return new Ny(r.data.map(((e,t)=>this._smoothstep(n.data[t],i.data[t],e))),r.typeInfo);const o=n,s=i,a=r;return new Dy(this._smoothstep(o.value,s.value,a.value),r.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.sqrt(e))),n.typeInfo);const i=n;return new Dy(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof Ny&&n instanceof Ny)return new Ny(i.data.map(((e,t)=>e<n.data[t]?0:1)),i.typeInfo);const r=n;return new Dy(i.value<r.value?0:1,r.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.tan(e))),n.typeInfo);const i=n;return new Dy(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.tanh(e))),n.typeInfo);const i=n;return new Dy(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof By))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[2],e[1],e[3]],i)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[3],e[6],e[1],e[4],e[7]],i)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],i)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[3],e[1],e[4],e[2],e[5]],i)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],i)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],i)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[4],e[1],e[5],e[2],e[6]],i)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],i)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new By([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Ny)return new Ny(n.data.map((e=>Math.trunc(e))),n.typeInfo);const i=n;return new Dy(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof my){const r=n.name,o=t.getVariableValue(r);if(o instanceof jy){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const t=o.getMipLevelSize(i),n=o.dimension;return"1d"===n?new Dy(t[0],this.getTypeInfo("u32")):"3d"===n?new Ny(t,this.getTypeInfo("vec3u")):"2d"===n?new Ny(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${n} not found. Line ${e.line}`),null)}return console.error(`Texture ${r} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof Ny)||2!==i.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof my){const o=n.name,s=t.getVariableValue(o);if(s instanceof jy){const t=Math.floor(i.data[0]),n=Math.floor(i.data[1]);if(t<0||t>=s.width||n<0||n>=s.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const a=s.getPixel(t,n,0,r);return null===a?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Ny(a,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof my){const i=n.name,r=t.getVariableValue(i);return r instanceof jy?new Dy(r.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof my){const i=n.name,r=t.getVariableValue(i);return r instanceof jy?new Dy(r.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof my){const i=n.name,r=t.getVariableValue(i);return r instanceof jy?new Dy(r.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),r=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,o=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==o.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Ny)||2!==i.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof my){const s=n.name,a=t.getVariableValue(s);if(a instanceof jy){const t=a.getMipLevelSize(0),n=Math.floor(i.data[0]),l=Math.floor(i.data[1]);return n<0||n>=t[0]||l<0||l>=t[1]?(console.error(`Texture ${s} out of bounds. Line ${e.line}`),null):(a.setPixel(n,l,0,r,Array.from(o)),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t);return a instanceof Dy&&s instanceof Dy&&(a.value=s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value+=s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicSub(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value-=s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMax(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value=Math.max(a.value,s.value)),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicMin(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value=Math.min(a.value,s.value)),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicAnd(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value=a.value&s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicOr(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value=a.value|s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicXor(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value=a.value^s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicExchange(e,t){let n=e.args[0];n instanceof wy&&(n=n.right);const i=this.exec.getVariableName(n,t),r=t.getVariable(i);let o=e.args[1];const s=this.exec.evalExpression(o,t),a=r.value.getSubData(this.exec,n.postfix,t),l=new Dy(a.value,a.typeInfo);return a instanceof Dy&&s instanceof Dy&&(a.value=s.value),r.value instanceof zy&&r.value.setDataValue(this.exec,a,n.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const hv={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},dv={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class pv extends cv{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new rv,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new lv,this.builtins=new uv(this),this.typeInfo={bool:this.getTypeInfo(oy.bool),i32:this.getTypeInfo(oy.i32),u32:this.getTypeInfo(oy.u32),f32:this.getTypeInfo(oy.f32),f16:this.getTypeInfo(oy.f16),vec2f:this.getTypeInfo(ly.vec2f),vec2u:this.getTypeInfo(ly.vec2u),vec2i:this.getTypeInfo(ly.vec2i),vec2h:this.getTypeInfo(ly.vec2h),vec3f:this.getTypeInfo(ly.vec3f),vec3u:this.getTypeInfo(ly.vec3u),vec3i:this.getTypeInfo(ly.vec3i),vec3h:this.getTypeInfo(ly.vec3h),vec4f:this.getTypeInfo(ly.vec4f),vec4u:this.getTypeInfo(ly.vec4u),vec4i:this.getTypeInfo(ly.vec4i),vec4h:this.getTypeInfo(ly.vec4h),mat2x2f:this.getTypeInfo(ly.mat2x2f),mat2x3f:this.getTypeInfo(ly.mat2x3f),mat2x4f:this.getTypeInfo(ly.mat2x4f),mat3x2f:this.getTypeInfo(ly.mat3x2f),mat3x3f:this.getTypeInfo(ly.mat3x3f),mat3x4f:this.getTypeInfo(ly.mat3x4f),mat4x2f:this.getTypeInfo(ly.mat4x2f),mat4x3f:this.getTypeInfo(ly.mat4x3f),mat4x4f:this.getTypeInfo(ly.mat4x4f)}}getVariableValue(e){var t,n;const i=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===i)return null;if(i instanceof Dy)return i.value;if(i instanceof Ny)return Array.from(i.data);if(i instanceof By)return Array.from(i.data);if(i instanceof zy&&i.typeInfo instanceof i_){if("u32"===i.typeInfo.format.name)return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if("i32"===i.typeInfo.format.name)return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if("f32"===i.typeInfo.format.name)return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const r=this.context.clone();(i=null!=i?i:{}).constants&&this._setOverrides(i.constants,r),this._execStatements(this.ast,r);const o=r.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const s=t[0],a=t[1],l=t[2],c=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new Ny(t,c));const u=this.reflection.getFunctionInfo(e);null===u&&console.error(`Function ${e} not found in reflection data`);for(const e in n)for(const t in n[e]){const i=n[e][t];r.variables.forEach((n=>{var r;const o=n.node;if(null==o?void 0:o.attributes){let s=null,a=null;for(const e of o.attributes)"binding"===e.name?s=e.value:"group"===e.name&&(a=e.value);if(t==s&&e==a){let s=!1;for(const i of u.resources)if(i.name===n.name&&i.group===parseInt(e)&&i.binding===parseInt(t)){s=!0;break}if(s)if(void 0!==i.texture&&void 0!==i.descriptor){const e=new jy(i.texture,this.getTypeInfo(o.type),i.descriptor,null!==(r=i.texture.view)&&void 0!==r?r:null);n.value=e}else void 0!==i.uniform?n.value=new zy(i.uniform,this.getTypeInfo(o.type)):n.value=new zy(i,this.getTypeInfo(o.type))}}}))}for(let e=0;e<l;++e)for(let t=0;t<a;++t)for(let n=0;n<s;++n)r.setVariable("@workgroup_id",new Ny([n,t,e],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[n,t,e],r)}execStatement(e,t){if(e instanceof K_)return this.evalExpression(e.value,t);if(e instanceof iy){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Dy))throw new Error("Invalid break-if condition");if(!n.value)return null}return pv._breakObj}if(e instanceof ry)return pv._continueObj;if(e instanceof z_)this._let(e,t);else if(e instanceof N_)this._var(e,t);else if(e instanceof j_)this._const(e,t);else if(e instanceof k_)this._function(e,t);else{if(e instanceof Y_)return this._if(e,t);if(e instanceof X_)return this._switch(e,t);if(e instanceof F_)return this._for(e,t);if(e instanceof L_)return this._while(e,t);if(e instanceof q_)return this._loop(e,t);if(e instanceof D_){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof H_)this._assign(e,t);else if(e instanceof W_)this._increment(e,t);else{if(e instanceof ay)return null;if(e instanceof B_){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new Dy(0,this.getTypeInfo("u32")))}else if(e instanceof Z_)this._call(e,t);else{if(e instanceof ey)return null;if(e instanceof ty)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Ey?this._evalBinaryOp(e,t):e instanceof yy?this._evalLiteral(e,t):e instanceof my?this._evalVariable(e,t):e instanceof gy?this._evalCall(e,t):e instanceof fy?this._evalCreate(e,t):e instanceof _y?this._evalConst(e,t):e instanceof vy?this._evalBitcast(e,t):e instanceof wy?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof oy){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],r=this.reflection.getOverrideInfo(n);null!==r?(null===r.type&&(r.type=this.getTypeInfo("u32")),"u32"===r.type.name||"i32"===r.type.name||"f32"===r.type.name||"f16"===r.type.name?t.setVariable(n,new Dy(i,r.type)):"bool"===r.type.name?t.setVariable(n,new Dy(i?1:0,r.type)):"vec2"===r.type.name||"vec3"===r.type.name||"vec4"===r.type.name||"vec2f"===r.type.name||"vec3f"===r.type.name||"vec4f"===r.type.name||"vec2i"===r.type.name||"vec3i"===r.type.name||"vec4i"===r.type.name||"vec2u"===r.type.name||"vec3u"===r.type.name||"vec4u"===r.type.name||"vec2h"===r.type.name||"vec3h"===r.type.name||"vec4h"===r.type.name?t.setVariable(n,new Ny(i,r.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const t of e.node.attributes)if("workgroup_size"===t.name){if(t.value.length>0){const e=n.getVariableValue(t.value[0]);i[0]=e instanceof Dy?e.value:parseInt(t.value[0])}if(t.value.length>1){const e=n.getVariableValue(t.value[1]);i[1]=e instanceof Dy?e.value:parseInt(t.value[1])}if(t.value.length>2){const e=n.getVariableValue(t.value[2]);i[2]=e instanceof Dy?e.value:parseInt(t.value[2])}}const r=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ny(i,r));const s=i[0],a=i[1],l=i[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<a;++l)for(let a=0;a<s;++a,++u){const s=[a,l,c],h=[a+t[0]*i[0],l+t[1]*i[1],c+t[2]*i[2]];n.setVariable("@local_invocation_id",new Ny(s,r)),n.setVariable("@global_invocation_id",new Ny(h,r)),n.setVariable("@local_invocation_index",new Dy(u,o)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const i=`@${e.value}`,r=t.getVariable(i);void 0!==r&&t.variables.set(n.name,r)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof wy;)e=e.right;return e instanceof my?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),i=this._execStatements(n,e);if(i)return i;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let t=0;t<i.node.args.length;++t){const r=i.node.args[t],o=this.evalExpression(e.args[t],n);n.setVariable(r.name,o,r)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?"++"===e.operator?i.value instanceof Dy?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):"--"===e.operator?i.value instanceof Dy?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof my){const n=this.getVariableName(e,t),i=t.getVariable(n);return null===i?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof wy){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof Ly?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new Ly(n)}}return null}_assign(e,t){let n=null,i="<var>",r=null;if(e.variable instanceof wy){const n=this._getVariableData(e.variable,t),i=this.evalExpression(e.value,t),r=e.operator;if("="===r){if(n instanceof Dy||n instanceof Ny||n instanceof By){if(i instanceof Dy||i instanceof Ny||i instanceof By&&n.data.length===i.data.length)return void n.data.set(i.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(n instanceof zy&&i instanceof zy&&n.buffer.byteLength-n.offset>=i.buffer.byteLength-i.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(i.buffer,i.offset,i.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===r)return n instanceof Dy||n instanceof Ny||n instanceof By?i instanceof Dy||i instanceof Ny||i instanceof By?void n.data.set(i.data.map(((e,t)=>n.data[t]+e))):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===r)return(n instanceof Dy||n instanceof Ny||n instanceof By)&&(i instanceof Dy||i instanceof Ny||i instanceof By)?void n.data.set(i.data.map(((e,t)=>n.data[t]-e))):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof wy){if("*"===e.variable.operator){i=this.getVariableName(e.variable.right,t);const r=t.getVariable(i);if(!(r&&r.value instanceof Ly))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=r.value.reference;let o=e.variable.postfix;if(!o){let t=e.variable.right;for(;t instanceof wy;){if(t.postfix){o=t.postfix;break}t=t.right}}o&&(n=n.getSubData(this,o,t))}}else{r=e.variable.postfix,i=this.getVariableName(e.variable,t);const o=t.getVariable(i);if(null===o)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=o.value}if(n instanceof Ly&&(n=n.reference),null===n)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,t),s=e.operator;if("="===s)if(n instanceof zy)n.setDataValue(this,o,r,t);else if(r){if(!(n instanceof Ny||n instanceof By))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(r instanceof by){const s=this.evalExpression(r.index,t).value;if(n instanceof Ny){if(!(o instanceof Dy))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[s]=o.value}else{if(!(n instanceof By))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const s=this.evalExpression(r.index,t).value;if(s<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof Ny))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(s<2&&2===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(s<2&&3===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(s<2&&4===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(s<3&&2===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(s<3&&3===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(s<3&&4===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(s<4&&2===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*s]=o.data[0],n.data[2*s+1]=o.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(s<4&&3===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*s]=o.data[0],n.data[3*s+1]=o.data[1],n.data[3*s+2]=o.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(s<4&&4===o.data.length))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*s]=o.data[0],n.data[4*s+1]=o.data[1],n.data[4*s+2]=o.data[2],n.data[4*s+3]=o.data[3]}}}}}else if(r instanceof py){const t=r.value;if(!(n instanceof Ny))return void console.error(`Invalid assignment to ${t}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof Dy){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);if("x"===t)n.data[0]=o.value;else if("y"===t){if(n.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);n.data[1]=o.value}else if("z"===t){if(n.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);n.data[2]=o.value}else if("w"===t){if(n.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);n.data[3]=o.value}}else{if(!(o instanceof Ny))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(t.length!==o.data.length)return void console.error(`Invalid assignment to ${t} for variable ${i}. Line ${e.line}`);for(let r=0;r<t.length;++r){const s=t[r];if("x"===s||"r"===s)n.data[0]=o.data[r];else if("y"===s||"g"===s){if(o.data.length<2)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);n.data[1]=o.data[r]}else if("z"===s||"b"===s){if(o.data.length<3)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);n.data[2]=o.data[r]}else{if("w"!==s&&"a"!==s)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${s} for variable ${i}. Line ${e.line}`);n.data[3]=o.data[r]}}}}}else n instanceof Dy&&o instanceof Dy?n.value=o.value:n instanceof Ny&&o instanceof Ny||n instanceof By&&o instanceof By?n.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const i=n.getSubData(this,r,t);if(i instanceof Ny&&o instanceof Dy){const t=i.data,n=o.value;if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(i instanceof Ny&&o instanceof Ny){const t=i.data,n=o.data;if(t.length!==n.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===s)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=n[e];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(i instanceof Dy&&o instanceof Dy))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===s?i.value+=o.value:"-="===s?i.value-=o.value:"*="===s?i.value*=o.value:"/="===s?i.value/=o.value:"%="===s?i.value%=o.value:"&="===s?i.value&=o.value:"|="===s?i.value|=o.value:"^="===s?i.value^=o.value:"<<="===s?i.value<<=o.value:">>="===s?i.value>>=o.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}n instanceof zy&&n.setDataValue(this,i,r,t)}}_function(e,t){const n=new av(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof wy||(n=n.clone())}else{const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||"array"===i){const i=new fy(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof wy||(n=n.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if("f32"===i||"i32"===i||"u32"===i||"bool"===i||"f16"===i||"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2b"===i||"vec3b"===i||"vec4b"===i||"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i||e.type instanceof uy||e.type instanceof ay||e.type instanceof ly){const i=new fy(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Dy))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const r of e.cases)if(r instanceof Cy)for(const o of r.selectors){if(o instanceof Ty){i=r;continue}const s=this.evalExpression(o,t);if(!(s instanceof Dy))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===n.value)return this._execStatements(r.body,t)}else r instanceof Ay&&(i=r);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Dy))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const n of e.elseif){const i=this.evalExpression(n.condition,t);if(!(i instanceof Dy))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(n.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Dy?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===pv._breakObj)break;if(null!==n&&n!==pv._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===pv._breakObj)break;if(n===pv._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===pv._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===pv._breakObj)break;if(n!==pv._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof Dy){const e=tv(n.value,n.typeInfo.name,i.name);return new Dy(e,this.getTypeInfo(i))}if(n instanceof Ny){const t=n.typeInfo.getTypeName();let r="";if(t.endsWith("f"))r="f32";else if(t.endsWith("i"))r="i32";else if(t.endsWith("u"))r="u32";else if(t.endsWith("b"))r="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;r="f16"}const o=i.getTypeName();let s="";if(o.endsWith("f"))s="f32";else if(o.endsWith("i"))s="i32";else if(o.endsWith("u"))s="u32";else if(o.endsWith("b"))s="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;s="f16"}const a=function(e,t,n){if(t===n)return e;const i=new Array(e.length);for(let r=0;r<e.length;r++)i[r]=tv(e[r],t,n);return i}(Array.from(n.data),r,s);return new Ny(a,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof fy){if(null===e.type)return Oy.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof fy?e.type.name:e.name,r=e instanceof fy?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===r)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(0===r.size)return null;const o=new zy(new ArrayBuffer(r.size),r,0);if(r instanceof n_){if(e.args)for(let n=0;n<e.args.length;++n){const i=r.members[n],s=e.args[n],a=this.evalExpression(s,t);o.setData(this,a,i.type,i.offset,t)}}else if(r instanceof i_){let i=0;if(e.args)for(let s=0;s<e.args.length;++s){const a=e.args[s],l=this.evalExpression(a,t);null===r.format&&("x32"===(null===(n=l.typeInfo)||void 0===n?void 0:n.name)?r.format=this.getTypeInfo("i32"):r.format=l.typeInfo),o.setData(this,l,r.format,i,t),i+=r.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof fy?o.getSubData(this,e.postfix,t):o}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return"x32"===i||"u32"===i||"f32"===i||"f16"===i||"i32"===i||"bool"===i?new Dy(e.scalarValue,n):"vec2"===i||"vec3"===i||"vec4"===i||"vec2f"===i||"vec3f"===i||"vec4f"===i||"vec2h"===i||"vec3h"===i||"vec4h"===i||"vec2i"===i||"vec3i"===i||"vec4i"===i||"vec2u"===i||"vec3u"===i||"vec4u"===i?this._callConstructorVec(e,t):"mat2x2"===i||"mat2x3"===i||"mat2x4"===i||"mat3x2"===i||"mat3x3"===i||"mat3x4"===i||"mat4x2"===i||"mat4x3"===i||"mat4x4"===i||"mat2x2f"===i||"mat2x3f"===i||"mat2x4f"===i||"mat3x2f"===i||"mat3x3f"===i||"mat3x4f"===i||"mat4x2f"===i||"mat4x3f"===i||"mat4x4f"===i||"mat2x2h"===i||"mat2x3h"===i||"mat2x4h"===i||"mat3x2h"===i||"mat3x3h"===i||"mat3x4h"===i||"mat4x2h"===i||"mat4x3h"===i||"mat4x4h"===i?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const i=pv._priority.get(t.name);pv._priority.get(e[n].name)<i&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new Ly(n);if("*"===e.operator)return n instanceof Ly?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof Dy?n.value:n instanceof Ny?Array.from(n.data):null;switch(e.operator){case"+":{if(Wy(i)){const e=i.map(((e,t)=>+e));return new Ny(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Dy(+e,t)}case"-":{if(Wy(i)){const e=i.map(((e,t)=>-e));return new Ny(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Dy(-e,t)}case"!":{if(Wy(i)){const e=i.map(((e,t)=>e?0:1));return new Ny(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Dy(e?0:1,t)}case"~":{if(Wy(i)){const e=i.map(((e,t)=>~e));return new Ny(e,n.typeInfo)}const e=i,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Dy(~e,t)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),r=n instanceof Dy?n.value:n instanceof Ny||n instanceof By?Array.from(n.data):null,o=i instanceof Dy?i.value:i instanceof Ny||i instanceof By?Array.from(i.data):null;switch(e.operator){case"+":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e+i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t+e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e+t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t+s,a)}case"-":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e-i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t-e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e-t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t-s,a)}case"*":{if(Wy(r)&&Wy(o)){const t=r,s=o;if(n instanceof By&&i instanceof By){const r=function(e,t,n,i){if(void 0===dv[t.name]||void 0===dv[i.name])return null;const r=dv[t.name][0],o=dv[t.name][1],s=dv[i.name][0];if(r!==dv[i.name][1])return null;const a=new Array(s*o);for(let t=0;t<o;t++)for(let i=0;i<s;i++){let l=0;for(let s=0;s<r;s++)l+=e[s*o+t]*n[i*r+s];a[t*s+i]=l}return a}(t,n.typeInfo,s,i.typeInfo);if(null===r)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const o=dv[i.typeInfo.name][0],a=dv[n.typeInfo.name][1],l=this.getTypeInfo(`mat${o}x${a}f`);return new By(r,l)}if(n instanceof By&&i instanceof Ny){const r=function(e,t,n,i){if(void 0===dv[t.name]||void 0===hv[i.name])return null;const r=dv[t.name][0],o=dv[t.name][1];if(r!==n.length)return null;const s=new Array(o);for(let t=0;t<o;t++){let i=0;for(let s=0;s<r;s++)i+=e[s*o+t]*n[s];s[t]=i}return s}(t,n.typeInfo,s,i.typeInfo);return null===r?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ny(r,i.typeInfo)}if(n instanceof Ny&&i instanceof By){const r=function(e,t,n,i){if(void 0===hv[t.name]||void 0===dv[i.name])return null;const r=dv[i.name][0],o=dv[i.name][1];if(o!==e.length)return null;const s=[];for(let t=0;t<r;t++){let i=0;for(let s=0;s<o;s++)i+=e[s]*n[s*r+t];s[t]=i}return s}(t,n.typeInfo,s,i.typeInfo);return null===r?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Ny(r,n.typeInfo)}{if(t.length!==s.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const i=t.map(((e,t)=>e*s[t]));return new Ny(i,n.typeInfo)}}if(Wy(r)){const e=o,t=r.map(((t,n)=>t*e));return n instanceof By?new By(t,n.typeInfo):new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e*t));return i instanceof By?new By(t,i.typeInfo):new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t*s,a)}case"%":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e%i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t%e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e%t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t%s,a)}case"/":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e/i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t/e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e/t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t/s,a)}case"&":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e&i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t&e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e&t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t&s,a)}case"|":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e|i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t|e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e|t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t|s,a)}case"^":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e^i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t^e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e^t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t^s,a)}case"<<":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e<<i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t<<e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e<<t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t<<s,a)}case">>":{if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e>>i[t]));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t>>e));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e>>t));return new Ny(t,i.typeInfo)}const t=r,s=o,a=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new Dy(t>>s,a)}case">":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e>i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t>e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e>t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r>o?1:0,this.getTypeInfo("bool"));case"<":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e<i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t<e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e<t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r<o?1:0,this.getTypeInfo("bool"));case"==":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e===i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t==e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e==t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r===o?1:0,this.getTypeInfo("bool"));case"!=":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e!==i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t!==e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e!==t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r!==o?1:0,this.getTypeInfo("bool"));case">=":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e>=i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t>=e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e>=t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e<=i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t<=e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e<=t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e&&i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t&&e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e&&t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r&&o?1:0,this.getTypeInfo("bool"));case"||":if(Wy(r)&&Wy(o)){const t=r,i=o;if(t.length!==i.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const s=t.map(((e,t)=>e||i[t]?1:0));return new Ny(s,n.typeInfo)}if(Wy(r)){const e=o,t=r.map(((t,n)=>t||e?1:0));return new Ny(t,n.typeInfo)}if(Wy(o)){const e=r,t=o.map(((t,n)=>e||t?1:0));return new Ny(t,i.typeInfo)}return new Dy(r||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let t=0;t<i.node.args.length;++t){const r=i.node.args[t],o=this.evalExpression(e.args[t],n);n.createVariable(r.name,o,r)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let t=0;t<n.node.args.length;++t){const r=n.node.args[t],o=this.evalExpression(e.args[t],i);i.setVariable(r.name,o,r)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new Dy(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=hv[i];if(void 0===r)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof yy)if(e.isVector){const t=e.vectorValue;for(const e of t)o.push(e)}else o.push(e.scalarValue);else if(e.args)for(const n of e.args){const e=this.evalExpression(n,t);if(e instanceof Ny){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];o.push(n)}}else if(e instanceof Dy){let t=e.value;o.push(t)}}if(e.type instanceof ly&&null===e.type.format&&(e.type.format=ly.f32),0===o.length){const i=new Array(r).fill(0);return new Ny(i,n).getSubData(this,e.postfix,t)}if(1===o.length)for(;o.length<r;)o.push(o[0]);return o.length<r?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Ny(o.length>r?o.slice(0,r):o,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),r=dv[i];if(void 0===r)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof yy)if(e.isVector){const t=e.vectorValue;for(const e of t)o.push(e)}else o.push(e.scalarValue);else if(e.args)for(const n of e.args){const e=this.evalExpression(n,t);e instanceof Ny?o.push(...e.data):e instanceof Dy?o.push(e.value):e instanceof By&&o.push(...e.data)}if(n instanceof o_&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===o.length){const i=new Array(r[2]).fill(0);return new By(i,n).getSubData(this,e.postfix,t)}return o.length!==r[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new By(o,n).getSubData(this,e.postfix,t)}}pv._breakObj=new ky(new e_("BREAK",null),null),pv._continueObj=new ky(new e_("CONTINUE",null),null),pv._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class fv{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class gv{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new fv,this._exec=new pv,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const t of this._deferArrayCountEval){const n=t.arrayType,i=t.countNode;if(i instanceof my){const t=i.name,r=this._context.constants.get(t);if(r)try{const e=r.constEvaluate(this._exec);n.count=e}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const e of t)e.search((e=>{e instanceof My||e instanceof cy?e.type=this._forwardType(e.type):e instanceof uy?e.format=this._forwardType(e.format):e instanceof N_||e instanceof z_||e instanceof j_?e.type=this._forwardType(e.type):e instanceof k_?e.returnType=this._forwardType(e.returnType):e instanceof Py&&(e.type=this._forwardType(e.type))}));return t}_forwardType(e){if(e instanceof sy){const t=this._getType(e.name);if(t)return t}else e instanceof cy?e.type=this._forwardType(e.type):e instanceof uy&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new Gy(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Vy.eof}_match(e){if(e instanceof Uy)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const t of e){if(n===t)return!0;t===Vy.tokens.name&&(i=!0)}if(i){const e=Vy.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Vy.tokens.name){const e=Vy.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Vy.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Vy.keywords.alias)){const e=this._type_alias();return this._consume(Vy.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Vy.keywords.diagnostic)){const e=this._diagnostic();return this._consume(Vy.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Vy.keywords.requires)){const e=this._requires_directive();return this._consume(Vy.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(Vy.keywords.enable)){const e=this._enable_directive();return this._consume(Vy.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(Vy.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Vy.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Vy.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Vy.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Vy.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Vy.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Vy.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Vy.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Vy.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Vy.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Vy.keywords.fn))return null;const e=this._currentLine,t=this._consume(Vy.tokens.ident,"Expected function name.").toString();this._consume(Vy.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Vy.tokens.paren_right))do{if(this._check(Vy.tokens.paren_right))break;const e=this._attribute(),t=this._consume(Vy.tokens.name,"Expected argument name.").toString();this._consume(Vy.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,n.push(this._updateNode(new Py(t,r,e))))}while(this._match(Vy.tokens.comma));this._consume(Vy.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Vy.tokens.arrow)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}const r=this._compound_statement(),o=this._currentLine;return this._updateNode(new k_(t,n,i,r,e,o),e)}_compound_statement(){const e=[];for(this._consume(Vy.tokens.brace_left,"Expected '{' for block.");!this._check(Vy.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Vy.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Vy.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Vy.tokens.attr)&&this._attribute(),this._check(Vy.keywords.if))return this._if_statement();if(this._check(Vy.keywords.switch))return this._switch_statement();if(this._check(Vy.keywords.loop))return this._loop_statement();if(this._check(Vy.keywords.for))return this._for_statement();if(this._check(Vy.keywords.while))return this._while_statement();if(this._check(Vy.keywords.continuing))return this._continuing_statement();if(this._check(Vy.keywords.static_assert))return this._static_assert_statement();if(this._check(Vy.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Vy.keywords.return))e=this._return_statement();else if(this._check([Vy.keywords.var,Vy.keywords.let,Vy.keywords.const]))e=this._variable_statement();else if(this._match(Vy.keywords.discard))e=this._updateNode(new ny);else if(this._match(Vy.keywords.break)){const t=this._updateNode(new iy);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(Vy.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Vy.keywords.continue)){const t=this._updateNode(new ry);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(Vy.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Vy.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new O_(t),e)}_while_statement(){if(!this._match(Vy.keywords.while))return null;const e=this._updateNode(new L_(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Vy.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Vy.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new D_(n,e),t)}_for_statement(){if(!this._match(Vy.keywords.for))return null;this._consume(Vy.tokens.paren_left,"Expected '('.");const e=this._updateNode(new F_(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Vy.tokens.semicolon)?null:this._for_init(),this._consume(Vy.tokens.semicolon,"Expected ';'."),e.condition=this._check(Vy.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Vy.tokens.semicolon,"Expected ';'."),e.increment=this._check(Vy.tokens.paren_right)?null:this._for_increment(),this._consume(Vy.tokens.paren_right,"Expected ')'."),this._check(Vy.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Vy.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Vy.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new N_(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Vy.keywords.let)){const e=this._currentLine,t=this._consume(Vy.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Vy.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Vy.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new z_(t,n,null,null,i),e)}if(this._match(Vy.keywords.const)){const e=this._currentLine,t=this._consume(Vy.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Vy.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(Vy.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return null===n&&i instanceof yy&&(n=i.type),this._updateNode(new j_(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Vy.increment_operators))return this._current=e,null;const n=this._consume(Vy.increment_operators,"Expected increment operator");return this._updateNode(new W_(n.type===Vy.tokens.plus_plus?U_.increment:U_.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Vy.tokens.brace_right))return null;let n=this._match(Vy.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const i=this._consume(Vy.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new H_(V_.parse(i.lexeme),e,r),t)}_func_call_statement(){if(!this._check(Vy.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Vy.tokens.ident,"Expected function name."),i=this._argument_expression_list();return null===i?(this._current=t,null):this._updateNode(new Z_(n.lexeme,i),e)}_loop_statement(){if(!this._match(Vy.keywords.loop))return null;this._check(Vy.tokens.attr)&&this._attribute(),this._consume(Vy.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new q_([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof D_){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Vy.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Vy.keywords.switch))return null;const e=this._updateNode(new X_(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Vy.tokens.attr)&&this._attribute(),this._consume(Vy.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Vy.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Vy.keywords.default,Vy.keywords.case]);){if(this._match(Vy.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof Ty){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Vy.tokens.colon),this._check(Vy.tokens.attr)&&this._attribute(),this._consume(Vy.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Vy.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Cy(n,i)))}if(this._match(Vy.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Vy.tokens.colon),this._check(Vy.tokens.attr)&&this._attribute(),this._consume(Vy.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Vy.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new Ay(n)))}}return e}_case_selectors(){const e=[];for(this._match(Vy.keywords.default)?e.push(this._updateNode(new Ty)):e.push(this._shift_expression());this._match(Vy.tokens.comma);)this._match(Vy.keywords.default)?e.push(this._updateNode(new Ty)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Vy.keywords.fallthrough))return this._consume(Vy.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Vy.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Vy.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Vy.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let r=null;return this._match(Vy.keywords.else)&&(this._check(Vy.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new Y_(t,n,i,r),e)}_match_elseif(){return this._tokens[this._current].type===Vy.keywords.else&&this._tokens[this._current+1].type===Vy.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Iy(t,n))),this._match_elseif()&&(this._check(Vy.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Vy.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new K_(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Vy.tokens.or_or);)e=this._updateNode(new Ey(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Vy.tokens.and_and);)e=this._updateNode(new Ey(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Vy.tokens.or);)e=this._updateNode(new Ey(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Vy.tokens.xor);)e=this._updateNode(new Ey(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Vy.tokens.and);)e=this._updateNode(new Ey(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Vy.tokens.equal_equal,Vy.tokens.not_equal])?this._updateNode(new Ey(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Vy.tokens.less_than,Vy.tokens.greater_than,Vy.tokens.less_than_equal,Vy.tokens.greater_than_equal]);)e=this._updateNode(new Ey(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Vy.tokens.shift_left,Vy.tokens.shift_right]);)e=this._updateNode(new Ey(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Vy.tokens.plus,Vy.tokens.minus]);)e=this._updateNode(new Ey(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Vy.tokens.star,Vy.tokens.forward_slash,Vy.tokens.modulo]);)e=this._updateNode(new Ey(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Vy.tokens.minus,Vy.tokens.bang,Vy.tokens.tilde,Vy.tokens.star,Vy.tokens.and])?this._updateNode(new wy(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Vy.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Vy.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new by(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Vy.tokens.period)){const e=this._consume(Vy.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new py(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return oy.void;case"bool":return oy.bool;case"i32":return oy.i32;case"u32":return oy.u32;case"f32":return oy.f32;case"f16":return oy.f16;case"vec2f":return ly.vec2f;case"vec3f":return ly.vec3f;case"vec4f":return ly.vec4f;case"vec2i":return ly.vec2i;case"vec3i":return ly.vec3i;case"vec4i":return ly.vec4i;case"vec2u":return ly.vec2u;case"vec3u":return ly.vec3u;case"vec4u":return ly.vec4u;case"vec2h":return ly.vec2h;case"vec3h":return ly.vec3h;case"vec4h":return ly.vec4h;case"mat2x2f":return ly.mat2x2f;case"mat2x3f":return ly.mat2x3f;case"mat2x4f":return ly.mat2x4f;case"mat3x2f":return ly.mat3x2f;case"mat3x3f":return ly.mat3x3f;case"mat3x4f":return ly.mat3x4f;case"mat4x2f":return ly.mat4x2f;case"mat4x3f":return ly.mat4x3f;case"mat4x4f":return ly.mat4x4f;case"mat2x2h":return ly.mat2x2h;case"mat2x3h":return ly.mat2x3h;case"mat2x4h":return ly.mat2x4h;case"mat3x2h":return ly.mat3x2h;case"mat3x3h":return ly.mat3x3h;case"mat3x4h":return ly.mat3x4h;case"mat4x2h":return ly.mat4x2h;case"mat4x3h":return ly.mat4x3h;case"mat4x4h":return ly.mat4x4h;case"mat2x2i":return ly.mat2x2i;case"mat2x3i":return ly.mat2x3i;case"mat2x4i":return ly.mat2x4i;case"mat3x2i":return ly.mat3x2i;case"mat3x3i":return ly.mat3x3i;case"mat3x4i":return ly.mat3x4i;case"mat4x2i":return ly.mat4x2i;case"mat4x3i":return ly.mat4x3i;case"mat4x4i":return ly.mat4x4i;case"mat2x2u":return ly.mat2x2u;case"mat2x3u":return ly.mat2x3u;case"mat2x4u":return ly.mat2x4u;case"mat3x2u":return ly.mat3x2u;case"mat3x3u":return ly.mat3x3u;case"mat3x4u":return ly.mat3x4u;case"mat4x2u":return ly.mat4x2u;case"mat4x3u":return ly.mat4x3u;case"mat4x4u":return ly.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Vy.tokens.ident)){const e=this._previous().toString();if(this._check(Vy.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new fy(n,t)):this._updateNode(new gy(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new _y(e,t.value))}return this._updateNode(new my(e))}if(this._match(Vy.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?oy.i32:e.endsWith("u")||e.endsWith("U")?oy.u32:oy.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new yy(new Dy(n,this._exec.getTypeInfo(t)),t))}if(this._match(Vy.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,oy.u32),this._updateNode(new yy(new Dy(e,this._exec.getTypeInfo(oy.u32)),oy.u32))}if(this._match([Vy.tokens.decimal_float_literal,Vy.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?oy.f16:oy.f32);const i=t?oy.f16:oy.f32;return this._updateNode(new yy(new Dy(n,this._exec.getTypeInfo(i)),i))}if(this._match([Vy.keywords.true,Vy.keywords.false])){let e=this._previous().toString()===Vy.keywords.true.rule;return this._updateNode(new yy(new Dy(e?1:0,this._exec.getTypeInfo(oy.bool)),oy.bool))}if(this._check(Vy.tokens.paren_left))return this._paren_expression();if(this._match(Vy.keywords.bitcast)){this._consume(Vy.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Vy.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new vy(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new fy(e,t))}_argument_expression_list(){if(!this._match(Vy.tokens.paren_left))return null;const e=[];do{if(this._check(Vy.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Vy.tokens.comma));return this._consume(Vy.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Vy.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Vy.tokens.paren_right),e}_paren_expression(){this._consume(Vy.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Vy.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Vy.keywords.struct))return null;const e=this._currentLine,t=this._consume(Vy.tokens.ident,"Expected name for struct.").toString();this._consume(Vy.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Vy.tokens.brace_right);){const e=this._attribute(),t=this._consume(Vy.tokens.name,"Expected variable name.").toString();this._consume(Vy.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(Vy.tokens.brace_right)?this._match(Vy.tokens.comma):this._consume(Vy.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new My(t,r,e)))}this._consume(Vy.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,r=this._updateNode(new ay(t,n,e,i),e);return this._context.structs.set(t,r),r}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Vy.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof yy){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof yy&&(e.type="x32"===e.value.type.name?oy.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Vy.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Vy.keywords.const))return null;const t=this._consume(Vy.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(Vy.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}let r=null;this._consume(Vy.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let e=[oy.f32],n=o.constEvaluate(this._exec,e);n instanceof Dy&&this._validateTypeRange(n.value,e[0]),e[0]instanceof ly&&null===e[0].format&&n.typeInfo instanceof o_&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=oy.f16:"f32"===n.typeInfo.format.name?e[0].format=oy.f32:"i32"===n.typeInfo.format.name?e[0].format=oy.i32:"u32"===n.typeInfo.format.name?e[0].format=oy.u32:"bool"===n.typeInfo.format.name?e[0].format=oy.bool:console.error(`TODO: impelement template format type ${n.typeInfo.format.name}`)),r=this._updateNode(new yy(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(e){r=o}if(null!==i&&r instanceof yy){if("x32"!==r.type.name&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else null===i&&r instanceof yy&&(i=null!==(e=null==r?void 0:r.type)&&void 0!==e?e:oy.f32,i===oy.x32&&(i=oy.i32));const s=this._updateNode(new j_(t.toString(),i,"","",r),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(Vy.keywords.let))return null;const e=this._currentLine,t=this._consume(Vy.tokens.name,"Expected variable name");let n=null;if(this._match(Vy.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let i=null;if(this._match(Vy.tokens.equal)&&(i=this._const_expression()),null!==n&&i instanceof yy){if("x32"!==i.type.name&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else null===n&&i instanceof yy&&(n="x32"===i.type.name?oy.i32:i.type);return i instanceof yy&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new z_(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Vy.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Vy.tokens.less_than)&&(t=this._consume(Vy.storage_class,"Expected storage_class.").toString(),this._match(Vy.tokens.comma)&&(n=this._consume(Vy.access_mode,"Expected access_mode.").toString()),this._consume(Vy.tokens.greater_than,"Expected '>'."));const i=this._consume(Vy.tokens.name,"Expected variable name");let r=null;if(this._match(Vy.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return this._updateNode(new N_(i.toString(),r,t,n,null),e)}_override_decl(){if(!this._match(Vy.keywords.override))return null;const e=this._consume(Vy.tokens.name,"Expected variable name");let t=null;if(this._match(Vy.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new B_(e.toString(),t,null))}_diagnostic(){this._consume(Vy.tokens.paren_left,"Expected '('");const e=this._consume(Vy.tokens.ident,"Expected severity control name.");this._consume(Vy.tokens.comma,"Expected ','");let t=this._consume(Vy.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Vy.tokens.period)&&(t+=`.${this._consume(Vy.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Vy.tokens.paren_right,"Expected ')'"),this._updateNode(new ey(e.toString(),t))}_enable_directive(){const e=this._consume(Vy.tokens.ident,"identity expected.");return this._updateNode(new J_(e.toString()))}_requires_directive(){const e=[this._consume(Vy.tokens.ident,"identity expected.").toString()];for(;this._match(Vy.tokens.comma);){const t=this._consume(Vy.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Q_(e))}_type_alias(){const e=this._consume(Vy.tokens.ident,"identity expected.");this._consume(Vy.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new ty(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Vy.tokens.ident,...Vy.texel_format,Vy.keywords.bool,Vy.keywords.f32,Vy.keywords.i32,Vy.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new sy(e));return this._forwardTypeCount++,t}return this._updateNode(new oy(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Vy.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Vy.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Vy.tokens.comma)&&(n=this._consume(Vy.access_mode,"Expected access_mode for pointer").toString()),this._consume(Vy.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ly(e,t,n))}if(this._match(Vy.keywords.ptr)){let e=this._previous().toString();this._consume(Vy.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Vy.storage_class,"Expected storage_class for pointer");this._consume(Vy.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(Vy.tokens.comma)&&(i=this._consume(Vy.access_mode,"Expected access_mode for pointer").toString()),this._consume(Vy.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new cy(e,t.toString(),n,i))}const t=this._attribute();if(this._match(Vy.keywords.array)){let n=null,i=-1;const r=this._previous();let o=null;if(this._match(Vy.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let t="";if(this._match(Vy.tokens.comma)){o=this._shift_expression();try{t=o.constEvaluate(this._exec).toString(),o=null}catch(e){t="1"}}this._consume(Vy.tokens.greater_than,"Expected '>' for array."),i=t?parseInt(t):0}const s=this._updateNode(new uy(r.toString(),t,n,i));return o&&this._deferArrayCountEval.push({arrayType:s,countNode:o}),s}return null}_texture_sampler_types(){if(this._match(Vy.sampler_type))return this._updateNode(new hy(this._previous().toString(),null,null));if(this._match(Vy.depth_texture_type))return this._updateNode(new hy(this._previous().toString(),null,null));if(this._match(Vy.sampled_texture_type)||this._match(Vy.multisampled_texture_type)){const e=this._previous();this._consume(Vy.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Vy.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new hy(e.toString(),t,null))}if(this._match(Vy.storage_texture_type)){const e=this._previous();this._consume(Vy.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Vy.texel_format,"Invalid texel format.").toString();this._consume(Vy.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Vy.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Vy.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new hy(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Vy.tokens.attr);){const t=this._consume(Vy.attribute_name,"Expected attribute name"),n=this._updateNode(new Ry(t.toString(),null));if(this._match(Vy.tokens.paren_left)){if(n.value=this._consume(Vy.literal_or_ident,"Expected attribute value").toString(),this._check(Vy.tokens.comma)){this._advance();do{const e=this._consume(Vy.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Vy.tokens.comma))}this._consume(Vy.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class mv extends rv{constructor(e){super(),e&&this.update(e)}update(e){const t=(new gv).parse(e);this.updateAST(t)}}function _v(e){return e.format?`${e.name}<${e.format.name}>`:e.name}const yv={};function vv(e="id"){return yv[e]=yv[e]||1,`${e}-${yv[e]++}`}class bv{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||vv("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ep.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}class xv extends wp{static defaultProps={...wp.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,xv.defaultProps),this.shaderLayout=t.shaderLayout}}class wv{static defaultProps={...kg.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new wv(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...kg.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const e=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=n,this._renderPipelineCache[n]={pipeline:e,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...xv.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const e=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=n,this._computePipelineCache[n]={pipeline:e,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof xv?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,0===n[t].useCount&&"unused"===this.destroyPolicy&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout));if("webgl"===this.device.type)return`${t}/${n}V-BL${i}`;{const r=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V-T${e.topology}P${r}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Ev{static defaultProps={...rg.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Ev(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,0===n.useCount&&"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}let Sv=null,Tv=null;function Cv(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Cv(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i){if(!t.hasOwnProperty(r))return!1;if(!Cv(e[r],t[r],n-1))return!1}return!0}return!1}function Av(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const i=e[n];var r;Ug(r=i)||"number"==typeof r||"boolean"==typeof r?t.uniforms[n]=i:t.bindings[n]=i})),t}class Pv{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const n=ac(Object.values(e).filter((e=>e.dependencies)));for(const t of n)e[t.name]=t;vp.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[t,n]of Object.entries(e))this._addModule(n),n.name&&t!==n.name&&!this.options.disableWarnings&&vp.warn(`Module name: ${t} vs ${n.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,i=e[n]||{},r=this.modules[n];if(!r){this.options.disableWarnings||vp.warn(`Module ${t} not found`)();continue}const o=this.moduleUniforms[n],s=this.moduleBindings[n],a=r.getUniforms?.(i,o)||i,{uniforms:l,bindings:c}=Av(a);this.moduleUniforms[n]={...o,...l},this.moduleBindings[n]={...s,...c}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,n]of Object.entries(this.moduleUniforms))for(const[i,r]of Object.entries(n))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(r)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}async function Iv(e,t){const n=new Image;return n.crossOrigin=t?.crossOrigin||"anonymous",n.src=e.startsWith("http")?e:""+e,await n.decode(),t?await createImageBitmap(n,t):await createImageBitmap(n)}class Mv{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||vv("async-texture"),"string"==typeof t?.data&&"2d"===t.dimension&&(t={...t,data:Iv(t.data)}),this.ready=new Promise(((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t})),this.initAsync(t)}async initAsync(e){const t=e.data;let n;try{n=await Rv(t)}catch(e){this.rejectReady(e)}if(this.destroyed)return;const i={...e,data:n};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function Rv(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(Rv));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),i=Object.keys(t),r={};for(let e=0;e<i.length;e++)r[i[e]]=n[e];return r}return e}class kv{static defaultProps={...kg.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Cc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...kv.defaultProps,...t},t=this.props,this.id=t.id||vv("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(this.props.modules?.map((e=>[e.name,e]))||[]),i=t.shaderInputs||new Pv(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const r=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:r,...this.props,modules:o});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=function(e){const t={attributes:[],bindings:[]};let n;try{n=function(e){try{return new mv(e)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw"object"==typeof e&&e?.message&&(t+=`: ${e.message} `),"object"==typeof e&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}(e)}catch(e){return vp.error(e.message)(),t}for(const e of n.uniforms){const n=[];for(const t of e.type?.members||[])n.push({name:t.name,type:_v(t.type)});t.bindings.push({type:"uniform",name:e.name,group:e.group,location:e.binding,members:n})}for(const e of n.textures)t.bindings.push({type:"texture",name:e.name,group:e.group,location:e.binding});for(const e of n.samplers)t.bindings.push({type:"sampler",name:e.name,group:e.group,location:e.binding});const i=n.entry.vertex[0],r=i?.inputs.length||0;for(let e=0;e<r;e++){const n=i.inputs[e];if("location"===n.locationType){const e=_v(n.type);t.attributes.push({name:n.name,location:Number(n.location),type:e})}}return t}(this.source)}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:r,...this.props,modules:o});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||wv.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Ev.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return vp.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings}),Lv(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,r=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&function(e,t){if(t instanceof bv)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:Ep.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[r,o]of Object.entries(t.attributes)){let t=r;switch(r){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(o){i[t]=e.createBuffer({data:o.value,id:`${r}-buffer`});const{value:s,size:a,normalized:l}=o;n.push({name:t,format:Mm(s,a,l)})}}return{attributes:i,bufferLayout:n,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new bv({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const e=new Zm(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Zm(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Cv(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Qm(this.shaderInputs.modules);for(const[e,t]of Object.entries(this.shaderInputs.modules))if(Ov(t)){const t=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=t}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=t?.disableWarnings??this.props.disableWarnings;e.indices&&vp.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map((e=>[e.name,e.location]))),i=t.slice();return i.sort(((e,t)=>{const i=e.attributes?e.attributes.map((e=>e.attribute)):[e.name],r=t.attributes?t.attributes.map((e=>e.attribute)):[t.name];return Math.min(...i.map((e=>n[e])))-Math.min(...r.map((e=>n[e])))})),i}(this.pipeline.shaderLayout,this.bufferLayout);const i=new Zm(this.bufferLayout);for(const[t,r]of Object.entries(e)){const e=i.getBufferLayout(t);if(!e){n||vp.warn(`Model(${this.id}): Missing layout for buffer "${t}".`)();continue}const o=i.getAttributeNamesForBuffer(e);let s=!1;for(const e of o){const t=this._attributeInfos[e];if(t){const e="webgpu"===this.device.type?i.getBufferIndex(t.bufferName):t.location;this.vertexArray.setBuffer(e,r),s=!0}}s||n||vp.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${t}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,i):(t?.disableWarnings??this.props.disableWarnings)||vp.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Lv(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:n}=Av(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Mv&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Mv?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof vg?e=Math.max(e,t.texture.updateTimestamp):t instanceof Ep||t instanceof zf?e=Math.max(e,t.updateTimestamp):t instanceof Mv?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof cg||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[e]of Object.entries(t))this.pipeline.shaderLayout.attributes.find((t=>t.name===e))||"positions"===e||delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(vp.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=tm(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=vp.level>3?0:1e4;vp.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,vp.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:vp.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){const t={},n="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const i of e.attributes)i&&(t[`in ${i.location} ${i.name}: ${i.type}`]={[n]:i.stepMode||"vertex"});for(const i of e.varyings||[])t[`out ${i.location} ${i.name}`]={[n]:JSON.stringify(i)};return t}(this.pipeline.shaderLayout,this.id);vp.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[e,n]of Object.entries(this.uniforms))t[e]={value:n};vp.table(2,t)();const n=this._getAttributeDebugTable();vp.table(2,this._attributeInfos)(),vp.table(2,n)(),vp.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:i,top:r="0",left:o="0",rgbaScale:s=1}){Sv||(Sv=document.createElement("canvas"),Sv.id=t,Sv.title=t,Sv.style.zIndex="100",Sv.style.position="absolute",Sv.style.top=r,Sv.style.left=o,Sv.style.border="blue 5px solid",Sv.style.transform="scaleY(-1)",document.body.appendChild(Sv),Tv=Sv.getContext("2d")),Sv.width===e.width&&Sv.height===e.height||(Sv.width=e.width/2,Sv.height=e.height/2,Sv.style.width="400px",Sv.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),l=Tv?.createImageData(e.width,e.height);if(l){const e=0;for(let t=0;t<a.length;t+=4)l.data[e+t+0]=a[t+0]*s,l.data[e+t+1]=a[t+1]*s,l.data[e+t+2]=a[t+2]*s,l.data[e+t+3]=i?255:a[t+3]*s;Tv?.putImageData(l,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=Im(t);return(e instanceof Ep?new n(e.debugData):e).toString()}}function Ov(e){return Boolean(e.uniformTypes&&!Lv(e.uniformTypes))}function Lv(e){for(const t in e)return!1;return!0}class Dv{device;model;transformFeedback;static defaultProps={...kv.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return"webgl"===e?.info?.type}constructor(e,t=Dv.defaultProps){if(!Dv.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new kv(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Hm(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Ep)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:r=n.byteLength}=t;return n.readAsync(i,r)}}function Fv(e,t=[],n=0){const i=Math.fround(e),r=e-i;return t[n]=i,t[n+1]=r,t}const Nv={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:Fv,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;Fv(e[4*i+n],t,2*r)}return t}};function Bv(e){const{source:t,target:n,start:i=0,size:r,getData:o}=e,s=e.end||n.length,a=t.length,l=s-i;if(a>l)return void n.set(t.subarray(0,l),i);if(n.set(t,i),!o)return;let c=a;for(;c<l;){const e=o(c,t);for(let t=0;t<r;t++)n[i+c]=e[t]||0,c++}}function zv(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function jv(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Uv(e){e.push(e.shift())}function Vv({device:e,source:t,target:n}){return(!n||n.byteLength<t.byteLength)&&(n?.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function $v({device:e,buffer:t,attribute:n,fromLength:i,toLength:r,fromStartIndices:o,getData:s=e=>e}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,d=o&&h,p=n.isConstant;if(!d&&t&&i>=r)return t;const f=n.value instanceof Float64Array?Float32Array:n.value.constructor,g=p?n.value:new f(n.getBuffer().readSyncWebGL(c,r*f.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!p){const e=s;s=(t,i)=>n.normalizeConstant(e(t,i))}const m=p?(e,t)=>s(g,t):(e,t)=>s(g.subarray(e+c,e+c+l),t),_=t?new Float32Array(t.readSyncWebGL(u,4*i).buffer):new Float32Array(0),y=new Float32Array(r);return function({source:e,target:t,size:n,getData:i,sourceStartIndices:r,targetStartIndices:o}){if(!r||!o)return Bv({source:e,target:t,size:n,getData:i}),t;let s=0,a=0;const l=i&&((e,t)=>i(e+a,t)),c=Math.min(r.length,o.length);for(let i=1;i<c;i++){const c=r[i]*n,u=o[i]*n;Bv({source:e.subarray(s,c),target:t,start:a,end:u,size:n,getData:l}),s=c,a=u}a<t.length&&Bv({source:[],target:t,start:a,size:n,getData:l})}({source:_,target:y,sourceStartIndices:o,targetStartIndices:h,size:l,getData:m}),(!t||t.byteLength<y.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}class Gv{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Sh(n),this.attribute=t,this.attributeInTransition=function(e){const{device:t,settings:n,value:i}=e,r=new Wm(t,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:i,value:r,size:o}=e,s=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const e of Object.values(l))a=Math.max(a,e.vertexOffset??0);return(i.noAlloc?r.length:(t+a)*o)*s}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const Wv={name:"interpolation",vs:"uniform interpolationUniforms {\n  float time;\n} interpolation;\n",uniformTypes:{time:"f32"}};function Hv(e){return e.doublePrecision&&e.value instanceof Float64Array}const Zv={name:"spring",vs:"uniform springUniforms {\n  float damping;\n  float stiffness;\n} spring;\n",uniformTypes:{damping:"f32",stiffness:"f32"}},qv={interpolation:class extends Gv{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=function(e,t){const n=t.size,i=zv(n),r=jv(n),o=t.getBufferLayout();return Hv(t)?new Dv(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[Nv,Wv],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Dv(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, interpolation.time);\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:o.attributes[0].format}],modules:[Wv],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:r,attribute:o}=this;Uv(r),r[0]=$v({device:this.device,buffer:r[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),r[1]=Vv({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:s}=this,a=s.model;let l=Math.floor(this.currentLength/o.size);Hv(o)&&(l/=2),a.setVertexCount(l),o.isConstant?(a.setAttributes({aFrom:r[0]}),a.setConstantAttributes({aTo:o.value})):a.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:r}=this.transform,o={time:i};r.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends Gv{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){const n=zv(t.size),i=jv(t.size);return new Dv(e,{vs:"#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE force = delta * spring.stiffness;\n  ATTRIBUTE_TYPE resistance = velocity * spring.damping;\n  return force - resistance + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}",bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Zv],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:o}=this;for(let t=0;t<2;t++)r[t]=$v({device:this.device,buffer:r[t],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});r[2]=Vv({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?s.setConstantAttributes({aTo:o.value}):s.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:r.stiffness,damping:r.damping};t.model.shaderInputs.setProps({spring:o}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Uv(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class Xv{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const n in e){const i=e[n],r=i.getTransitionSetting(t);r&&this._updateAttribute(n,i,r)}for(const n in this.transitions){const i=e[n];i&&i.getTransitionSetting(t)||this._removeTransition(n)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){i&&this._removeTransition(e);const o=qv[n.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(vo.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Yv="attributeManager.invalidate";class Kv{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=ad(Zo),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Xv(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);$c(Yv,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);$c(Yv,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:r={},buffers:o={},context:s={}}){let a=!1;$c("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const i in this.attributes){const l=this.attributes[i],c=l.settings.accessor;l.startIndices=n,l.numInstances=t,r[i]&&vo.removed(`props.${i}`,`data.attributes.${i}`)(),l.setExternalBuffer(o[i])||l.setBinaryValue("string"==typeof c?o[c]:void 0,e.startIndices)||"string"==typeof c&&!o[c]&&l.setConstantValue(r[c])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:r,context:s})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}a&&$c("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map((e=>this.attributes[e]?.getBounds()));return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in t){const o=t[r];o.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map((t=>t.getBufferLayout(e)))}_add(e,t){for(const n in e){const i=e[n],r={...i,id:n,size:(i.isIndexed?1:i.size)||1,...t};this.attributes[n]=new Wm(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach((n=>{e[n]||(e[n]=[]),e[n].push(t)}));this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach((e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)})),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;$c("attribute.updateStart",t),t.constant?t.setConstantValue(t.value):(t.allocate(n)&&$c("attribute.allocate",t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,$c("attribute.updateEnd",t,n)))}}const Jv=1e-5;function Qv(e,t,n,i,r){const o=t-e;return(n-t)*r+-o*i+o+t}function eb(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const tb={interpolation:class extends Sh{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,o=r(e/i);this._value=To(t,n,o)}},spring:class extends Sh{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let s=function(e,t,n,i,r){if(Array.isArray(n)){const o=[];for(let s=0;s<n.length;s++)o[s]=Qv(e[s],t[s],n[s],i,r);return o}return Qv(e,t,n,i,r)}(r,o,t,n,i);const a=eb(s,t),l=eb(s,o);a<Jv&&l<Jv&&(s=t,this.end()),this._prevValue=o,this._currValue=s}}};class nb{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=Gm(i)))return;const o=tb[i.type];if(!o)return void vo.error(`unsupported transition type '${i.type}'`)();const s=new o(this.timeline);s.start({...i,fromValue:t,toValue:n}),r.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ib(e,t){if(!e.transitions)return!1;const n={},i=e[Fc];let r=!1;for(const o in e.transitions){const s=i[o],a=s&&s.type;("number"===a||"color"===a||"array"===a)&&ob(e[o],t[o],s)&&(n[o]=!0,r=!0)}return!!r&&n}function rb({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${r} changed shallowly`;if("object"!=typeof t||null===t)return`${r} changed shallowly`;for(const o of Object.keys(e))if(!(o in n)){if(!(o in t))return`${r}.${o} added`;const n=ob(e[o],t[o],i[o]);if(n)return`${r}.${o} ${n}`}for(const o of Object.keys(t))if(!(o in n)){if(!(o in e))return`${r}.${o} dropped`;if(!Object.hasOwnProperty.call(e,o)){const n=ob(e[o],t[o],i[o]);if(n)return`${r}.${o} ${n}`}}return!1}function ob(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function sb(e,t){if(null===t)return!0;const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(n[e]))return!0;return!1}function ab(e,t,n){let i=e.updateTriggers[n];i=null==i?{}:i;let r=t.updateTriggers[n];return r=null==r?{}:r,rb({oldProps:r,newProps:i,triggerName:n})}function lb(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some((e=>"project64"===e.name)))){const e=n.modules.findIndex((e=>"project32"===e.name));e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i={...e.inject};for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}const cb=[0,0,0];function ub(e,t,n=!1){const i=t.projectPosition(e);if(n&&t instanceof Ja){const[n,r,o=0]=e,s=t.getDistanceScales([n,r]);i[2]=o*s.unitsPerMeter[2]}return i}function hb(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:o}){let[s,a,l=0]=e;switch(n&&([s,a,l]=rs([],[s,a,l,1],n)),i){case ja.LNGLAT:return ub([s,a,l],t,o);case ja.LNGLAT_OFFSETS:return ub([s+r[0],a+r[1],l+(r[2]||0)],t,o);case ja.METER_OFFSETS:return ub(Os(r,[s,a,l]),t,o);default:return t.isGeospatial?[s+r[0],a+r[1],l+r[2]]:t.projectPosition([s,a,l])}}const db={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},pb={},fb={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||_b(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>Xr(e,t,1)},accessor:{validate(e,t){const n=yb(e);return"function"===n||n===yb(t.value)},equal:(e,t,n)=>"function"==typeof t||Xr(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||_b(e),equal(e,t,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Xr(e,t,r):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Xr(e,t,r):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:i}=n.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const i=n.context;return i&&i.device?function(e,t,n,i){if(n instanceof zf)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const o=t.createTexture({...n,sampler:{...db,...r,...i},mipmaps:!0});return pb[o.id]=e,o}(n.id,i.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var i,r;i=n.id,(r=e)&&r instanceof zf&&pb[r.id]===i&&(r.delete(),delete pb[r.id])}}};function gb(e,t){switch(yb(t)){case"object":return mb(e,t);case"array":return mb(e,{type:"array",value:t,compare:!1});case"boolean":return mb(e,{type:"boolean",value:t});case"number":return mb(e,{type:"number",value:t});case"function":return mb(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function mb(e,t){return"type"in t?{name:e,...fb[t.type],...t}:"value"in t?{name:e,type:yb(t.value),...t}:{name:e,type:"object",value:t}}function _b(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function yb(e){return _b(e)?"array":null===e?"null":typeof e}function vb(e,t){if(!(e instanceof Tb.constructor))return{};let n="_mergedDefaultProps";if(t)for(const e of t){const t=e.constructor;t&&(n+=`:${t.extensionName||t.name}`)}return wb(e,n)||(e[n]=function(e,t){if(!e.prototype)return null;const n=vb(Object.getPrototypeOf(e)),i=function(e){const t={},n={},i={};for(const[r,o]of Object.entries(e)){const e=o?.deprecatedFor;if(e)i[r]=Array.isArray(e)?e:[e];else{const e=gb(r,o);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(wb(e,"defaultProps")||{}),r=Object.assign(Object.create(null),n,i.defaultProps),o=Object.assign(Object.create(null),n?.[Fc],i.propTypes),s=Object.assign(Object.create(null),n?.[Nc],i.deprecatedProps);for(const e of t){const t=vb(e.constructor);t&&(Object.assign(r,t),Object.assign(o,t[Fc]),Object.assign(s,t[Nc]))}return function(e,t){const n=function(e){const t=e.componentName;return t||vo.warn(`${e.name}.componentName not specified`)(),t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})}(r,e),function(e,t){const n={},i={};for(const e in t){const r=t[e],{name:o,value:s}=r;r.async&&(n[o]=s,i[o]=bb(o))}e[Bc]=n,e[zc]={},Object.defineProperties(e,i)}(r,o),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i=`${this.id}: ${n}`;for(const i of t[n])xb(this,i)||(this[i]=e);vo.deprecated(i,t[n].join("/"))()}})}(r,s),r[Fc]=o,r[Nc]=s,0!==t.length||xb(e,"_propTypes")||(e._propTypes=o),r}(e,t||[]))}function bb(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||zm(t)?this[zc][e]=t:this[jc][e]=t},get(){if(this[jc]){if(e in this[jc])return this[jc][e]||this[Bc][e];if(e in this[zc]){const t=this[Dc]&&this[Dc].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Bc][e]}}return this[Bc][e]}}}function xb(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function wb(e,t){return xb(e,t)&&e[t]}let Eb=0;class Sb{constructor(...e){this.props=function(e,t){let n;for(let e=t.length-1;e>=0;e--){const i=t[e];"extensions"in i&&(n=i.extensions)}const i=vb(e.constructor,n),r=Object.create(i);r[Dc]=e,r[zc]={},r[jc]={};for(let e=0;e<t.length;++e){const n=t[e];for(const e in n)r[e]=n[e]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=Eb++}clone(e){const{props:t}=this,n={};for(const e in t[Bc])e in t[jc]?n[e]=t[jc][e]:e in t[zc]&&(n[e]=t[zc][e]);return new this.constructor({...t,...n,...e})}}Sb.componentName="Component",Sb.defaultProps={};const Tb=Sb,Cb=Object.freeze({});class Ab{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Cb}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Dc]||this.component;const t=e[jc]||{},n=e[zc]||e,i=e[Bc]||{};for(const e in t){const n=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,n),t[e]=this.getAsyncProp(e)}for(const e in n){const t=n[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):zm(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then((t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))})).catch((t=>{this._onError(e,t)}))}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],o=0;for await(const n of t){if(!this.component)return;const{dataTransform:t}=this.component.props;r=t?t(n,r):r.concat(n),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(e,r,i)}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Fc];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Pb extends Ab{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n?.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const Ib=2**24-1,Mb=Object.freeze([]),Rb=ad((({oldViewport:e,viewport:t})=>e.equals(t)));let kb=new Uint8ClampedArray(0);const Ob={data:{type:"data",value:Mb,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:i,loadOptions:r,signal:o})=>{const{resourceManager:s}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,o&&(r={...r,fetch:{...r?.fetch,signal:o}});let a=s.contains(e);return a||r||(s.add({resourceId:e,data:gh(e,i),persistent:!1}),a=!0),a?s.subscribe({resourceId:e,onChange:e=>n.internalState?.reloadAsyncProp(t,e),consumerId:n.id,requestId:t}):gh(e,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ja.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Lb extends Tb{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){sl(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=hb(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,o]=Fs(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,o]}unproject(e){return sl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return sl(this.internalState),function(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:i}=e;let{coordinateSystem:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return r===ja.DEFAULT&&(r=t.isGeospatial?ja.LNGLAT:ja.CARTESIAN),void 0===o&&(o=r),void 0===s&&(s=i),{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:o,fromCoordinateOrigin:s}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=cb,shaderCoordinateOrigin:u=cb,offsetMode:h=!1}=l?fd(n,i,r):{},d=hb(e,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);Do(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ja.DEFAULT||e===ja.LNGLAT||e===ja.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){sl(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=lb(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=lb(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const e of n)t.invalidateAll(e);else t.invalidateAll();if(t){const{props:n}=e,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some((e=>e.getNeedsPickingBuffer.call(this,e)));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:e,instancePickingColors:n}=t.attributes,i=e||n;i&&(r&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(const e of this.getModels())e.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&Rb({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(kb.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>Ib&&vo.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),kb=bo.allocate(kb,t,{size:4,copy:!0,maxCount:Math.max(t,Ib)});const e=Math.floor(kb.length/4),i=[0,0,0];for(let t=n;t<e;t++)this.encodePickingColor(t,i),kb[4*t+0]=i[0],kb[4*t+1]=i[1],kb[4*t+2]=i[2],kb[4*t+3]=0}e.value=kb.subarray(0,4*t)}_setModelAttributes(e,t,n=!1){if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const i=e.userData?.excludeAttributes||{},r={},o={};for(const n in t){if(i[n])continue;const s=t[n].getValue();for(const i in s){const a=s[i];a instanceof Ep?t[n].settings.isIndexed?e.setIndexBuffer(a):r[i]=a:a&&(o[i]=a)}}e.setAttributes(r),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,o=r&&t.attributes&&t.attributes[r.id];if(o&&o.value){const n=o.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=r.getVertexOffset(e);n[t]===i[0]&&n[t+1]===i[1]&&n[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const r=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==kb.buffer&&(n.value=kb.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){sl(!this.internalState),sl(Number.isFinite(this.props.coordinateSystem)),$c("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Pb({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(vo.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new nb(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){$c("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if($c("layer.update",this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,r=n.viewport,o=this._updateUniformTransition();i.propsInTransition=o,n.viewport=i.viewport||r,this.props=o;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(e){}for(const t of this.props.extensions)t.updateState.call(this,e,t);this.setNeedsRedraw(),this._updateAttributes();const i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{n.viewport=r,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){$c("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:r}=this.props,s=r&&r(n)||[0,0];o.device instanceof pm&&o.device.setParametersWebGL({polygonOffset:s});for(const e of this.getModels())"webgpu"===e.device.type?e.setParameters({...e.parameters,...i}):e.setParameters(i);if(o.device instanceof pm)o.device.withParametersWebGL(i,(()=>{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:o};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)}));else{const r={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:o};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)}}finally{this.props=r}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let i=!1;if("dataChanged"===n){const r=e[n],o=t[n];r&&Array.isArray(o)&&(t.dataChanged=Array.isArray(r)?o.concat(r):r,i=!0)}t[n]||(t[n]=e[n],i=!0),i&&$c("layer.changeFlag",this,n,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const n=function(e,t){const n=rb({newProps:e,oldProps:t,propTypes:e[Fc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=e;return i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied"),n&&r&&(n=r(e.data,t.data)||n),n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers&&ab(e,t,"all"))return{all:!0};const n={};let i=!1;for(const r in e.updateTriggers)"all"!==r&&ab(e,t,r)&&(n[r]=!0,i=!0);return!!i&&n}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:sb(e,t),transitionsChanged:ib(e,t)}}(e,t);if(n.updateTriggersChanged)for(const e in n.updateTriggersChanged)n.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){!function(e){const t=e[Fc];for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Kv(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,r=this.state.model;r?.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:s,highlightColor:a}=n;if(t||i.autoHighlight!==o||i.highlightedObjectIndex!==s||i.highlightColor!==a){const e={};Array.isArray(a)&&(e.highlightColor=a),(t||i.autoHighlight!==o||s!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(e);if(t=t||i,t)for(const e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Lb.defaultProps=Ob,Lb.layerName="Layer";const Db=Lb,Fb={position:"absolute",zIndex:-1};function Nb(e,t){if("function"==typeof e)return e(t);if(Array.isArray(e))return e.map((e=>Nb(e,t)));if(Bb(e)){if(n=e,n.props?.mapStyle)return t.style=Fb,(0,r.cloneElement)(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return(0,r.cloneElement)(e,t)}var n;return e}function Bb(e){return e&&"object"==typeof e&&"type"in e||!1}function zb(e){if("function"==typeof e)return(0,r.createElement)(Eh,{},e);if(Array.isArray(e))return e.map(zb);if(Bb(e)){if(e.type===r.Fragment)return zb(e.props.children);if(Am(e.type,Eh))return e}return e}const jb=(0,r.createContext)(),Ub={mixBlendMode:null};function Vb(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const $b=r.forwardRef((function(e,t){const[n,i]=(0,r.useState)(0),o=(0,r.useRef)({control:null,version:n,forceUpdate:()=>i((e=>e+1))}),s=o.current,a=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useMemo)((()=>function({children:e,layers:t=[],views:n=null}){const i=[],o=[],s={};return r.Children.forEach(zb(e),(e=>{if(Bb(e)){const t=e.type;if(Am(t,Db)){const n=function(e,t){const n={},i=e.defaultProps||{};for(const e in t)i[e]!==t[e]&&(n[e]=t[e]);return new e(n)}(t,e.props);o.push(n)}else i.push(e);if(Am(t,Eh)&&t!==Eh&&e.props.id){const n=new t(e.props);s[n.id]=n}}else e&&i.push(e)})),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach((e=>{s[e.id]=e})):n&&(s[n.id]=n),n=Object.values(s)),{layers:t=o.length>0?[...o,...t]:t,children:i,views:n}}(e)),[e.layers,e.views,e.children]);let u=!0;const h=t=>u&&e.viewState?(s.viewStateUpdateRequested=t,null):(s.viewStateUpdateRequested=null,e.onViewStateChange?.(t)),d=t=>{u?s.interactionStateUpdateRequested=t:(s.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(t))},p=(0,r.useMemo)((()=>{const t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:a.current,canvas:l.current,layers:c.layers,views:c.views,onViewStateChange:h,onInteractionStateChange:d};return delete t._customRender,s.deck&&s.deck.setProps(t),t}),[e]);(0,r.useEffect)((()=>{const t=e.Deck||Tm;return s.deck=function(e,t,n){const i=new t({...n,_customRender:"webgpu"===n.deviceProps?.adapters?.[0]?.type?void 0:t=>{e.redrawReason=t;const n=i.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():Vb(e)}});return i}(s,t,{...p,parent:a.current,canvas:l.current}),()=>s.deck?.finalize()}),[]),Cm((()=>{Vb(s);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=s;e&&h(e),t&&d(t)})),(0,r.useImperativeHandle)(t,(()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(s)),[]);const f=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:g,width:m="100%",height:_="100%",id:y,style:v}=e,{containerStyle:b,canvasStyle:x}=(0,r.useMemo)((()=>function({width:e,height:t,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(n)for(const e in n)e in Ub?r[e]=n[e]:i[e]=n[e];return{containerStyle:i,canvasStyle:r}}({width:m,height:_,style:v})),[m,_,v]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===f||s.version!==n){s.lastRenderedViewports=f,s.version=n;const e=function({children:e,deck:t,ContextProvider:n=jb.Provider}){const{viewManager:i}=t||{};if(!i||!i.views.length)return[];const o={},s=i.views[0].id;for(const t of e){let e=s,n=t;Bb(t)&&Am(t.type,Eh)&&(e=t.props.id||s,n=t.props.children);const r=i.getViewport(e),a=i.getViewState(e);if(r){a.padding=r.padding;const{x:t,y:i,width:s,height:l}=r;n=Nb(n,{x:t,y:i,width:s,height:l,viewport:r,viewState:a}),o[e]||(o[e]={viewport:r,children:[]}),o[e].children.push(n)}}return Object.keys(o).map((e=>{const{viewport:i,children:s}=o[e],{x:a,y:l,width:c,height:u}=i,h={position:"absolute",left:a,top:l,width:c,height:u},d=`view-${e}`,p=(0,r.createElement)("div",{key:d,id:d,style:h},...s),f={deck:t,viewport:i,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:n=>{n.viewId=e,t._onViewStateChange(n)},widgets:[]},g=`view-${e}-context`;return(0,r.createElement)(n,{key:g,value:f},p)}))}({children:c.children,deck:s.deck,ContextProvider:g}),t=(0,r.createElement)("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:l,style:x});s.control=(0,r.createElement)("div",{id:`${y||"deckgl"}-wrapper`,ref:a,style:b},[t,e])}return u=!1,s.control})),Gb=$b,Wb=r.createContext(null);function Hb(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Hb(e[n],t[n]))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const i of n){if(!t.hasOwnProperty(i))return!1;if(!Hb(e[i],t[i]))return!1}return!0}return!1}function Zb(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function qb(e,t){const n=t.viewState||t,i={};if("longitude"in n&&"latitude"in n&&(n.longitude!==e.center.lng||n.latitude!==e.center.lat)){const t=e.center.constructor;i.center=new t(n.longitude,n.latitude)}return"zoom"in n&&n.zoom!==e.zoom&&(i.zoom=n.zoom),"bearing"in n&&n.bearing!==e.bearing&&(i.bearing=n.bearing),"pitch"in n&&n.pitch!==e.pitch&&(i.pitch=n.pitch),n.padding&&e.padding&&!Hb(n.padding,e.padding)&&(i.padding=n.padding),i}const Xb=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Yb(e){if(!e)return null;if("string"==typeof e)return e;if("toJS"in e&&(e=e.toJS()),!e.layers)return e;const t={};for(const n of e.layers)t[n.id]=n;const n=e.layers.map((e=>{let n=null;"interactive"in e&&(n=Object.assign({},e),delete n.interactive);const i=t[e.ref];if(i){n=n||Object.assign({},e),delete n.ref;for(const e of Xb)e in i&&(n[e]=i[e])}return n||e}));return{...e,layers:n}}const Kb={version:8,sources:{},layers:[]},Jb={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Qb={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},ex={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},tx=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],nx=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class ix{constructor(e,t,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=e=>{const t=this.props[ex[e.type]];t?t(e):"error"===e.type&&console.error(e.error)},this._onCameraEvent=e=>{if(this._internalUpdate)return;e.viewState=this._propsedCameraUpdate||Zb(this._map.transform);const t=this.props[Qb[e.type]];t&&t(e)},this._onCameraUpdate=e=>this._internalUpdate?e:(this._propsedCameraUpdate=Zb(e),qb(e,this.props)),this._onPointerEvent=e=>{"mousemove"!==e.type&&"mouseout"!==e.type||this._updateHover(e);const t=this.props[Jb[e.type]];t&&(this.props.interactiveLayerIds&&"mouseover"!==e.type&&"mouseout"!==e.type&&(e.features=this._hoveredFeatures||this._queryRenderedFeatures(e.point)),t(e),delete e.features)},this._MapClass=e,this.props=t,this._initialize(n)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const n=this._updateSettings(e,t),i=this._updateSize(e),r=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(n||i||r&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const n=ix.savedMaps.pop();if(!n)return null;const i=n.map,r=i.getContainer();for(t.className=r.className;r.childNodes.length>0;)t.appendChild(r.childNodes[0]);i._container=t;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(t)),n.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:s}=e;return s&&(s.bounds?i.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):n._updateViewState(s)),i.isStyleLoaded()?i.fire("load"):i.once("style.load",(()=>i.fire("load"))),i._update(),n}_initialize(e){const{props:t}=this,{mapStyle:n=Kb}=t,i={...t,...t.initialViewState,container:e,style:Yb(n)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),t.gl){const e=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=e,t.gl)}const o=new this._MapClass(i);r.padding&&o.setPadding(r.padding),t.cursor&&(o.getCanvas().style.cursor=t.cursor),o.transformCameraUpdate=this._onCameraUpdate,o.on("style.load",(()=>{this._styleComponents={light:o.getLight(),sky:o.getSky(),projection:o.getProjection?.(),terrain:o.getTerrain()},this._updateStyleComponents(this.props)})),o.on("sourcedata",(()=>{this._updateStyleComponents(this.props)}));for(const e in Jb)o.on(e,this._onPointerEvent);for(const e in Qb)o.on(e,this._onCameraEvent);for(const e in ex)o.on(e,this._onEvent);this._map=o}recycle(){const e=this.map.getContainer().querySelector("[mapboxgl-children]");e?.remove(),ix.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const e=this._map;if(t.width!==e.transform.width||t.height!==e.transform.height)return e.resize(),!0}return!1}_updateViewState(e){const t=this._map,n=t.transform;if(!t.isMoving()){const i=qb(n,e);if(Object.keys(i).length>0)return this._internalUpdate=!0,t.jumpTo(i),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const n=this._map;let i=!1;for(const r of tx)if(r in e&&!Hb(e[r],t[r])){i=!0;const t=n[`set${r[0].toUpperCase()}${r.slice(1)}`];t?.call(n,e[r])}return i}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:t=Kb,styleDiffing:n=!0}=e,i={diff:n};"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Yb(t),i)}}_updateStyleComponents({light:e,projection:t,sky:n,terrain:i}){const r=this._map,o=this._styleComponents;r.style._loaded&&(e&&!Hb(e,o.light)&&(o.light=e,r.setLight(e)),t&&!Hb(t,o.projection)&&t!==o.projection?.type&&(o.projection="string"==typeof t?{type:t}:t,r.setProjection?.(o.projection)),n&&!Hb(n,o.sky)&&(o.sky=n,r.setSky(n)),void 0===i||Hb(i,o.terrain)||i&&!r.getSource(i.source)||(o.terrain=i,r.setTerrain(i)))}_updateHandlers(e,t){const n=this._map;for(const i of nx){const r=e[i]??!0;Hb(r,t[i]??!0)||(r?n[i].enable(r):n[i].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:n=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:n.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const t=e.type,n=this._hoveredFeatures?.length>0,i=this._queryRenderedFeatures(e.point),r=i.length>0;!r&&n&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=i,r&&!n&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=t}else this._hoveredFeatures=null}}ix.savedMaps=[];const rx=ix,ox=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];const sx="undefined"!=typeof document?r.useLayoutEffect:r.useEffect,ax=r.createContext(null),lx=r.forwardRef((function(e,t){const n=(0,r.useContext)(Wb),[i,o]=(0,r.useState)(null),s=(0,r.useRef)(),{current:a}=(0,r.useRef)({mapLib:null,map:null});(0,r.useEffect)((()=>{const t=e.mapLib;let i,r=!0;return Promise.resolve(t||Promise.resolve().then(d.t.bind(d,6505,19))).then((t=>{if(!r)return;if(!t)throw new Error("Invalid mapLib");const l="Map"in t?t:t.default;if(!l.Map)throw new Error("Invalid mapLib");!function(e,t){const{RTLTextPlugin:n,maxParallelImageRequests:i,workerCount:r,workerUrl:o}=t;if(n&&e.getRTLTextPluginStatus&&"unavailable"===e.getRTLTextPluginStatus()){const{pluginUrl:t,lazy:i=!0}="string"==typeof n?{pluginUrl:n}:n;e.setRTLTextPlugin(t,(e=>{e&&console.error(e)}),i)}void 0!==i&&e.setMaxParallelImageRequests(i),void 0!==r&&e.setWorkerCount(r),void 0!==o&&e.setWorkerUrl(o)}(l,e),e.reuseMaps&&(i=rx.reuse(e,s.current)),i||(i=new rx(l.Map,e,s.current)),a.map=function(e){if(!e)return null;const t=e.map,n={getMap:()=>t};for(const e of function(e){const t=new Set;let n=e;for(;n;){for(const i of Object.getOwnPropertyNames(n))"_"!==i[0]&&"function"==typeof e[i]&&"fire"!==i&&"setEventedParent"!==i&&t.add(i);n=Object.getPrototypeOf(n)}return Array.from(t)}(t))e in n||ox.includes(e)||(n[e]=t[e].bind(t));return n}(i),a.mapLib=l,o(i),n?.onMapMount(a.map,e.id)})).catch((t=>{const{onError:n}=e;n?n({type:"error",target:null,originalEvent:null,error:t}):console.error(t)})),()=>{r=!1,i&&(n?.onMapUnmount(e.id),e.reuseMaps?i.recycle():i.destroy())}}),[]),sx((()=>{i&&i.setProps(e)})),(0,r.useImperativeHandle)(t,(()=>a.map),[i]);const l=(0,r.useMemo)((()=>({position:"relative",width:"100%",height:"100%",...e.style})),[e.style]);return r.createElement("div",{id:e.id,ref:s,style:l},i&&r.createElement(ax.Provider,{value:a},r.createElement("div",{"mapboxgl-children":"",style:{height:"100%"}},e.children)))})),cx=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ux(e,t){if(!e||!t)return;const n=e.style;for(const e in t){const i=t[e];Number.isFinite(i)&&!cx.test(e)?n[e]=`${i}px`:n[e]=i}}function hx(e,t){if(e===t)return null;const n=dx(e),i=dx(t),r=[];for(const e of i)n.has(e)||r.push(e);for(const e of n)i.has(e)||r.push(e);return 0===r.length?null:r}function dx(e){return new Set(e?e.trim().split(/\s+/):[])}function px(e,t,n,i){const o=(0,r.useContext)(ax),s=(0,r.useMemo)((()=>e(o)),[]);return(0,r.useEffect)((()=>{const e=i||n||t,r="function"==typeof t&&"function"==typeof n?t:null,a="function"==typeof n?n:"function"==typeof t?t:null,{map:l}=o;return l.hasControl(s)||(l.addControl(s,e?.position),r&&r(o)),()=>{a&&a(o),l.hasControl(s)&&l.removeControl(s)}}),[]),s}(0,r.memo)((0,r.forwardRef)(((e,t)=>{const{map:n,mapLib:i}=(0,r.useContext)(ax),o=(0,r.useRef)({props:e}),s=(0,r.useMemo)((()=>{let t=!1;r.Children.forEach(e.children,(e=>{e&&(t=!0)}));const n={...e,element:t?document.createElement("div"):void 0},a=new i.Marker(n);return a.setLngLat([e.longitude,e.latitude]),a.getElement().addEventListener("click",(e=>{o.current.props.onClick?.({type:"click",target:a,originalEvent:e})})),a.on("dragstart",(e=>{const t=e;t.lngLat=s.getLngLat(),o.current.props.onDragStart?.(t)})),a.on("drag",(e=>{const t=e;t.lngLat=s.getLngLat(),o.current.props.onDrag?.(t)})),a.on("dragend",(e=>{const t=e;t.lngLat=s.getLngLat(),o.current.props.onDragEnd?.(t)})),a}),[]);(0,r.useEffect)((()=>(s.addTo(n.getMap()),()=>{s.remove()})),[]);const{longitude:a,latitude:l,offset:c,style:u,draggable:h=!1,popup:d=null,rotation:p=0,rotationAlignment:f="auto",pitchAlignment:g="auto"}=e;(0,r.useEffect)((()=>{ux(s.getElement(),u)}),[u]),(0,r.useImperativeHandle)(t,(()=>s),[]);const m=o.current.props;s.getLngLat().lng===a&&s.getLngLat().lat===l||s.setLngLat([a,l]),c&&!function(e,t){const n=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0,r=Array.isArray(t)?t[0]:t?t.x:0,o=Array.isArray(t)?t[1]:t?t.y:0;return n===r&&i===o}(s.getOffset(),c)&&s.setOffset(c),s.isDraggable()!==h&&s.setDraggable(h),s.getRotation()!==p&&s.setRotation(p),s.getRotationAlignment()!==f&&s.setRotationAlignment(f),s.getPitchAlignment()!==g&&s.setPitchAlignment(g),s.getPopup()!==d&&s.setPopup(d);const _=hx(m.className,e.className);if(_)for(const e of _)s.toggleClassName(e);return o.current.props=e,(0,Il.createPortal)(e.children,s.getElement())}))),(0,r.memo)((0,r.forwardRef)(((e,t)=>{const{map:n,mapLib:i}=(0,r.useContext)(ax),o=(0,r.useMemo)((()=>document.createElement("div")),[]),s=(0,r.useRef)({props:e}),a=(0,r.useMemo)((()=>{const t={...e},n=new i.Popup(t);return n.setLngLat([e.longitude,e.latitude]),n.once("open",(e=>{s.current.props.onOpen?.(e)})),n}),[]);if((0,r.useEffect)((()=>{const e=e=>{s.current.props.onClose?.(e)};return a.on("close",e),a.setDOMContent(o).addTo(n.getMap()),()=>{a.off("close",e),a.isOpen()&&a.remove()}}),[]),(0,r.useEffect)((()=>{ux(a.getElement(),e.style)}),[e.style]),(0,r.useImperativeHandle)(t,(()=>a),[]),a.isOpen()){const t=s.current.props;a.getLngLat().lng===e.longitude&&a.getLngLat().lat===e.latitude||a.setLngLat([e.longitude,e.latitude]),e.offset&&!Hb(t.offset,e.offset)&&a.setOffset(e.offset),t.anchor===e.anchor&&t.maxWidth===e.maxWidth||(a.options.anchor=e.anchor,a.setMaxWidth(e.maxWidth));const n=hx(t.className,e.className);if(n)for(const e of n)a.toggleClassName(e);s.current.props=e}return(0,Il.createPortal)(e.children,o)})));const fx=(0,r.memo)((function(e){const t=px((({mapLib:t})=>new t.AttributionControl(e)),{position:e.position});return(0,r.useEffect)((()=>{ux(t._container,e.style)}),[e.style]),null}));(0,r.memo)((function(e){const t=px((({mapLib:t})=>new t.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)})),{position:e.position});return(0,r.useEffect)((()=>{ux(t._controlContainer,e.style)}),[e.style]),null})),(0,r.memo)((0,r.forwardRef)((function(e,t){const n=(0,r.useRef)({props:e}),i=px((({mapLib:t})=>{const i=new t.GeolocateControl(e),r=i._setupUI;return i._setupUI=()=>{i._container.hasChildNodes()||r()},i.on("geolocate",(e=>{n.current.props.onGeolocate?.(e)})),i.on("error",(e=>{n.current.props.onError?.(e)})),i.on("outofmaxbounds",(e=>{n.current.props.onOutOfMaxBounds?.(e)})),i.on("trackuserlocationstart",(e=>{n.current.props.onTrackUserLocationStart?.(e)})),i.on("trackuserlocationend",(e=>{n.current.props.onTrackUserLocationEnd?.(e)})),i}),{position:e.position});return n.current.props=e,(0,r.useImperativeHandle)(t,(()=>i),[]),(0,r.useEffect)((()=>{ux(i._container,e.style)}),[e.style]),null}))),(0,r.memo)((function(e){const t=px((({mapLib:t})=>new t.NavigationControl(e)),{position:e.position});return(0,r.useEffect)((()=>{ux(t._container,e.style)}),[e.style]),null})),(0,r.memo)((function(e){const t=px((({mapLib:t})=>new t.ScaleControl(e)),{position:e.position}),n=(0,r.useRef)(e),i=n.current;n.current=e;const{style:o}=e;return void 0!==e.maxWidth&&e.maxWidth!==i.maxWidth&&(t.options.maxWidth=e.maxWidth),void 0!==e.unit&&e.unit!==i.unit&&t.setUnit(e.unit),(0,r.useEffect)((()=>{ux(t._container,o)}),[o]),null})),(0,r.memo)((function(e){const t=px((({mapLib:t})=>new t.TerrainControl(e)),{position:e.position});return(0,r.useEffect)((()=>{ux(t._container,e.style)}),[e.style]),null})),(0,r.memo)((function(e){const t=px((({mapLib:t})=>new t.LogoControl(e)),{position:e.position});return(0,r.useEffect)((()=>{ux(t._container,e.style)}),[e.style]),null}));class gx extends Db{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:f,fetch:g,operation:m,_subLayerProps:_}=this.props,y={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:f,fetch:g,operation:m},v=_&&e.id&&_[e.id],b=v&&v.updateTriggers,x=e.id||"sublayer";if(v){const t=this.props[Fc],n=e.type?e.type._propTypes:{};for(const e in v){const i=n[e]||t[e];i&&"accessor"===i.type&&(v[e]=this.getSubLayerAccessor(v[e]))}}Object.assign(y,e,v),y.id=`${this.props.id}-${x}`,y.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...b};for(const e of f){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(y,t,{updateTriggers:Object.assign(y.updateTriggers,t.updateTriggers)})}return y}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();i&&(n=Gc(this.renderLayers(),Boolean),this.internalState.subLayers=n),$c("compositeLayer.renderLayers",this,i,n);for(const e of n)e.parent=this}}gx.layerName="CompositeLayer";const mx=gx;function _x({data:e,getIndex:t,dataRange:n,replace:i}){const{startRow:r=0,endRow:o=1/0}=n,s=e.length;let a=s,l=s;for(let n=0;n<s;n++){const i=t(e[n]);if(a>n&&i>=r&&(a=n),i>=o){l=n;break}}let c=a;const u=l-a!==i.length?e.slice(l):void 0;for(let t=0;t<i.length;t++)e[c++]=i[t];if(u){for(let t=0;t<u.length;t++)e[c++]=u[t];e.length=c}return{startRow:a,endRow:a+i.length}}const yx={name:"project32",dependencies:[bd],source:"// Define a structure to hold both the clip-space position and the common position.\nstruct ProjectResult {\n  clipPosition: vec4<f32>,\n  commonPosition: vec4<f32>,\n};\n\n// This function mimics the GLSL version with the 'out' parameter by returning both values.\nfn project_position_to_clipspace_and_commonspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> ProjectResult {\n  // Compute the projected position.\n  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);\n\n  // Start with the provided offset.\n  var finalOffset: vec3<f32> = offset;\n\n  // Get whether a rotation is needed and the rotation matrix.\n  let rotationResult = project_needs_rotation(projectedPosition);\n\n  // If rotation is needed, update the offset.\n  if (rotationResult.needsRotation) {\n    finalOffset = rotationResult.transform * offset;\n  }\n\n  // Compute the common position.\n  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);\n\n  // Convert to clip-space.\n  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);\n\n  return ProjectResult(clipPosition, commonPosition);\n}\n\n// A convenience overload that returns only the clip-space position.\nfn project_position_to_clipspace(\n    position: vec3<f32>,\n    position64Low: vec3<f32>,\n    offset: vec3<f32>\n) -> vec4<f32> {\n  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;\n}\n",vs:"vec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},vx={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!bool(picking.isAttribute)) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n",getUniforms:function(e={},t){const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,(e=>e/255));Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}return void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute)),void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors)),n}},bx={...vx,defaultUniforms:{...vx.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}};class xx{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||vv("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[e,n]of Object.entries(t)){const t=ArrayBuffer.isView(n)?{value:n}:n;if(!ArrayBuffer.isView(t.value))throw new Error(`${this._print(e)}: must be typed array or object with value as typed array`);if("POSITION"!==e&&"positions"!==e||t.size||(t.size=3),"indices"===e){if(this.indices)throw new Error("Multiple indices detected");this.indices=t}else this.attributes[e]=t}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const t of Object.values(e)){const{value:e,size:i,constant:r}=t;!r&&e&&void 0!==i&&i>=1&&(n=Math.min(n,e.length/i))}return n}}const wx="uniform iconUniforms {\n  float sizeScale;\n  vec2 iconsTextureDim;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  bool billboard;\n  highp int sizeUnits;\n  float alphaCutoff;\n} icon;\n",Ex={name:"icon",vs:wx,fs:wx,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},Sx=()=>{},Tx={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Cx={x:0,y:0,width:0,height:0};function Ax(e,t,n,i){const r=Math.min(n/t.width,i/t.height),o=Math.floor(t.width*r),s=Math.floor(t.height*r);return 1===r?{image:t,width:o,height:s}:(e.canvas.height=s,e.canvas.width=o,e.clearRect(0,0,o,s),e.drawImage(t,0,0,t.width,t.height,0,0,o,s),{image:e.canvas,width:o,height:s})}function Px(e){return e&&(e.id||e.url)}function Ix(e,t,n){for(let i=0;i<t.length;i++){const{icon:r,xOffset:o}=t[i];e[Px(r)]={...r,x:o,y:n}}}class Mx{constructor(e,{onUpdate:t=Sx,onError:n=Sx}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Px(e):e;return this._mapping[t]||Cx}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:r}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),i&&(this._mapping=i),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),r&&(this._samplerParameters=r)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||"undefined"==typeof document)return;const n=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};const i={},{iterable:r,objectInfo:o}=Bm(e);for(const e of r){o.index++;const r=t(e,o),s=Px(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");i[s]||n[s]&&r.url===n[s].url||(i[s]={...r,source:e,sourceIndex:o.index})}return i}(e,t,this._mapping)||{});if(n.length>0){const{mapping:e,xOffset:t,yOffset:i,rowHeight:r,canvasHeight:o}=function({icons:e,buffer:t,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:o=0,canvasWidth:s}){let a=[];for(let l=0;l<e.length;l++){const c=e[l];if(!n[Px(c)]){const{height:e,width:l}=c;i+l+t>s&&(Ix(n,a,r),i=0,r=o+r+t,o=0,a=[]),a.push({icon:c,xOffset:i}),i=i+l+t,o=Math.max(o,e)}}return a.length>0&&Ix(n,a,r),{mapping:n,rowHeight:o,xOffset:i,yOffset:r,canvasWidth:s,canvasHeight:(l=o+r+t,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=r,this._mapping=e,this._xOffset=t,this._yOffset=i,this._canvasHeight=o,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||Tx,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,n,i){const{width:r,height:o,device:s}=e,a=s.createTexture({format:"rgba8unorm",width:t,height:n,sampler:i,mipmaps:!0}),l=s.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:e,destinationTexture:a,width:r,height:o}),l.finish(),e.destroy(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||Tx)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,gh(n.url,this._loadOptions).then((e=>{const i=Px(n),r=this._mapping[i],{x:o,y:s,width:a,height:l}=r,{image:c,width:u,height:h}=Ax(t,e,a,l);this._texture?.copyExternalImage({image:c,x:o+(a-u)/2,y:s+(l-h)/2,width:u,height:h}),r.width=u,r.height=h,this._texture.generateMipmap(),this.onUpdate()})).catch((e=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:e})})).finally((()=>{this._pendingCount--}))}}const Rx=[0,0,0,255],kx={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:Rx},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class Ox extends Db{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME icon-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceSizes;\nin float instanceAngles;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec4 instanceIconFrames;\nin float instanceColorModes;\nin vec2 instanceOffsets;\nin vec2 instancePixelOffset;\nout float vColorMode;\nout vec4 vColor;\nout vec2 vTextureCoords;\nout vec2 uv;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = angle * PI / 180.0;\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvec2 iconSize = instanceIconFrames.zw;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),\nicon.sizeMinPixels, icon.sizeMaxPixels\n);\nfloat instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\nvec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\npixelOffset += instancePixelOffset;\npixelOffset.y *= -1.0;\nif (icon.billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvTextureCoords = mix(\ninstanceIconFrames.xy,\ninstanceIconFrames.xy + iconSize,\n(positions.xy + 1.0) / 2.0\n) / icon.iconsTextureDim;\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\nvColorMode = instanceColorModes;\n}\n",fs:"#version 300 es\n#define SHADER_NAME icon-layer-fragment-shader\nprecision highp float;\nuniform sampler2D iconsTexture;\nin float vColorMode;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec4 texColor = texture(iconsTexture, vTextureCoords);\nvec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\nfloat a = texColor.a * layer.opacity * vColor.a;\nif (a < icon.alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color, a);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[yx,bx,Ex]})}initializeState(){this.state={iconManager:new Mx(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:Rx},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,r=this.getAttributeManager(),{iconAtlas:o,iconMapping:s,data:a,getIcon:l,textureParameters:c}=t,{iconManager:u}=this.state;if("string"==typeof o)return;const h=o||this.internalState.isAsyncPropLoading("iconAtlas");u.setProps({loadOptions:t.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?s:null,textureParameters:c}),h?n.iconMapping!==t.iconMapping&&r.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&u.packIcons(a,l),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:r,billboard:o,alphaCutoff:s}=this.props,{iconManager:a}=this.state,l=a.getTexture();if(l){const e=this.state.model,a={iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:Va[r],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:o,alphaCutoff:s};e.shaderInputs.setProps({icon:a}),e.draw(this.context.renderPass)}}_getModel(){return new kv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new xx({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):vo.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:r}=this.state.iconManager.getIconMapping(e);return[t,n,i,r]}}Ox.defaultProps=kx,Ox.layerName="IconLayer";const Lx=Ox,Dx="uniform scatterplotUniforms {\n  float radiusScale;\n  float radiusMinPixels;\n  float radiusMaxPixels;\n  float lineWidthScale;\n  float lineWidthMinPixels;\n  float lineWidthMaxPixels;\n  float stroked;\n  float filled;\n  bool antialiasing;\n  bool billboard;\n  highp int radiusUnits;\n  highp int lineWidthUnits;\n} scatterplot;\n",Fx={name:"scatterplot",vs:Dx,fs:Dx,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Nx=[0,0,0,255],Bx={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Nx},getLineColor:{type:"accessor",value:Nx},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class zx extends Db{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),\nscatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),\nscatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n);\nouterRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\nfloat edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;\nif (scatterplot.billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = scatterplot.antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (scatterplot.stroked > 0.5) {\nfloat isLine = scatterplot.antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (scatterplot.filled > 0.5) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (scatterplot.filled < 0.5) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",source:'// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)\n\nstruct LayerUniforms {\n  opacity: f32,\n};\n\nvar<private> layer: LayerUniforms = LayerUniforms(1.0);\n// @group(0) @binding(1) var<uniform> layer: LayerUniforms;\n\n// Main shaders\n\nstruct ScatterplotUniforms {\n  radiusScale: f32,\n  radiusMinPixels: f32,\n  radiusMaxPixels: f32,\n  lineWidthScale: f32,\n  lineWidthMinPixels: f32,\n  lineWidthMaxPixels: f32,\n  stroked: f32,\n  filled: i32,\n  antialiasing: i32,\n  billboard: i32,\n  radiusUnits: i32,\n  lineWidthUnits: i32,\n};\n\nstruct ConstantAttributeUniforms {\n instancePositions: vec3<f32>,\n instancePositions64Low: vec3<f32>,\n instanceRadius: f32,\n instanceLineWidths: f32,\n instanceFillColors: vec4<f32>,\n instanceLineColors: vec4<f32>,\n instancePickingColors: vec3<f32>,\n\n instancePositionsConstant: i32,\n instancePositions64LowConstant: i32,\n instanceRadiusConstant: i32,\n instanceLineWidthsConstant: i32,\n instanceFillColorsConstant: i32,\n instanceLineColorsConstant: i32,\n instancePickingColorsConstant: i32\n};\n\n@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;\n\nstruct ConstantAttributes {\n  instancePositions: vec3<f32>,\n  instancePositions64Low: vec3<f32>,\n  instanceRadius: f32,\n  instanceLineWidths: f32,\n  instanceFillColors: vec4<f32>,\n  instanceLineColors: vec4<f32>,\n  instancePickingColors: vec3<f32>\n};\n\nconst constants = ConstantAttributes(\n  vec3<f32>(0.0),\n  vec3<f32>(0.0),\n  0.0,\n  0.0,\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec4<f32>(0.0, 0.0, 0.0, 1.0),\n  vec3<f32>(0.0)\n);\n\nstruct Attributes {\n  @builtin(instance_index) instanceIndex : u32,\n  @builtin(vertex_index) vertexIndex : u32,\n  @location(0) positions: vec3<f32>,\n  @location(1) instancePositions: vec3<f32>,\n  @location(2) instancePositions64Low: vec3<f32>,\n  @location(3) instanceRadius: f32,\n  @location(4) instanceLineWidths: f32,\n  @location(5) instanceFillColors: vec4<f32>,\n  @location(6) instanceLineColors: vec4<f32>,\n  @location(7) instancePickingColors: vec3<f32>\n};\n\nstruct Varyings {\n  @builtin(position) position: vec4<f32>,\n  @location(0) vFillColor: vec4<f32>,\n  @location(1) vLineColor: vec4<f32>,\n  @location(2) unitPosition: vec2<f32>,\n  @location(3) innerUnitRadius: f32,\n  @location(4) outerRadiusPixels: f32,\n};\n\n@vertex\nfn vertexMain(attributes: Attributes) -> Varyings {\n  var varyings: Varyings;\n\n  // Draw an inline geometry constant array clip space triangle to verify that rendering works.\n  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));\n  // if (attributes.instanceIndex == 0) {\n  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);\n  //   return varyings;\n  // }\n\n  // var geometry: Geometry;\n  // geometry.worldPosition = instancePositions;\n\n  // Multiply out radius and clamp to limits\n  varyings.outerRadiusPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),\n    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels\n  );\n\n  // Multiply out line width and clamp to limits\n  let lineWidthPixels = clamp(\n    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),\n    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels\n  );\n\n  // outer radius needs to offset by half stroke width\n  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;\n  // Expand geometry to accommodate edge smoothing\n  let edgePadding = select(\n    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,\n    1.0,\n    scatterplot.antialiasing != 0\n  );\n\n  // position on the containing square in [-1, 1] space\n  varyings.unitPosition = edgePadding * attributes.positions.xy;\n  geometry.uv = varyings.unitPosition;\n  geometry.pickingColor = attributes.instancePickingColors;\n\n  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;\n\n  if (scatterplot.billboard != 0) {\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    let clipPixels = project_pixel_size_to_clipspace(offset.xy);\n    varyings.position.x = clipPixels.x;\n    varyings.position.y = clipPixels.y;\n  } else {\n    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);\n    // DECKGL_FILTER_SIZE(offset, geometry);\n    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);\n    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);\n  }\n\n  // Apply opacity to instance color, or return instance picking color\n  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);\n  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);\n  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);\n\n  return varyings;\n}\n\n@fragment\nfn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {\n  // var geometry: Geometry;\n  // geometry.uv = unitPosition;\n\n  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;\n  let inCircle = select(\n    smoothedge(distToCenter, varyings.outerRadiusPixels),\n    step(distToCenter, varyings.outerRadiusPixels),\n    scatterplot.antialiasing != 0\n  );\n\n  if (inCircle == 0.0) {\n    // discard;\n  }\n\n  var fragColor: vec4<f32>;\n\n  if (scatterplot.stroked != 0) {\n    let isLine = select(\n      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),\n      scatterplot.antialiasing != 0\n    );\n\n    if (scatterplot.filled != 0) {\n      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        // discard;\n      }\n      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);\n    }\n  } else if (scatterplot.filled == 0) {\n    // discard;\n  } else {\n    fragColor = varyings.vFillColor;\n  }\n\n  fragColor.a *= inCircle;\n  // DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  return fragColor;\n  // return vec4<f32>(0, 0, 1, 1);\n}\n',modules:[yx,bx,Fx]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,stroked:o,filled:s,billboard:a,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,p={stroked:o,filled:s,billboard:a,antialiasing:l,radiusUnits:Va[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:Va[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d},f=this.state.model;f.shaderInputs.setProps({scatterplot:p}),f.draw(this.context.renderPass)}_getModel(){return new kv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new xx({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0})}}zx.defaultProps=Bx,zx.layerName="ScatterplotLayer";const jx=zx,Ux="uniform sdfUniforms {\n  float gamma;\n  bool enabled;\n  float buffer;\n  float outlineBuffer;\n  vec4 outlineColor;\n} sdf;\n",Vx={name:"sdf",vs:Ux,fs:Ux,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},$x=.75,Gx=[];class Wx extends Lx{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,Vx],fs:"#version 300 es\n#define SHADER_NAME multi-icon-layer-fragment-shader\nprecision highp float;\nuniform sampler2D iconsTexture;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nif (!bool(picking.isActive)) {\nfloat alpha = texture(iconsTexture, vTextureCoords).a;\nvec4 color = vColor;\nif (sdf.enabled) {\nfloat distance = alpha;\nalpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);\nif (sdf.outlineBuffer > 0.0) {\nfloat inFill = alpha;\nfloat inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);\ncolor = mix(sdf.outlineColor, vColor, inFill);\nalpha = inBorder;\n}\n}\nfloat a = alpha * color.a;\nif (a < icon.alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color.rgb, a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:t,target:n})=>this.encodePickingColor(t,n)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map((e=>e/255)),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&vo.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state,o=i?Math.max(n,$x*(1-i)):-1,s=this.state.model,a={buffer:$x,outlineBuffer:o,gamma:n,enabled:Boolean(t),outlineColor:r};if(s.shaderInputs.setProps({sdf:a}),super.draw(e),t&&i){const{iconManager:e}=this.state;e.getTexture()&&(s.shaderInputs.setProps({sdf:{...a,outlineBuffer:$x}}),s.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap((e=>super.getInstanceOffset(e))):Gx}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap((e=>super.getInstanceIconFrame(e))):Gx}}Wx.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Wx.layerName="MultiIconLayer";const Hx=Wx,Zx=1e20;class qx{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal",lang:a=null}={}){this.buffer=t,this.cutoff=i,this.radius=n,this.lang=a;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${o} ${e}px ${r}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:g,gridInner:m,gridOuter:_}=this;this.lang&&(f.lang=this.lang),f.clearRect(g,g,a,l),f.fillText(e,g,g+s);const y=f.getImageData(g,g,a,l);_.fill(Zx,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=y.data[4*(e*a+t)+3]/255;if(0===n)continue;const i=(e+g)*c+t+g;if(1===n)_[i]=0,m[i]=Zx;else{const e=.5-n;_[i]=e>0?e*e:0,m[i]=e<0?e*e:0}}Xx(_,0,0,c,u,c,this.f,this.v,this.z),Xx(m,g,g,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}}function Xx(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)Yx(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)Yx(e,c*o+t,1,i,s,a,l)}function Yx(e,t,n,i,r,o,s){o[0]=0,s[0]=-Zx,s[1]=Zx,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Zx}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}const Kx=[];function Jx(e,t,n,i){let r=0;for(let o=t;o<n;o++){const t=e[o];r+=i[t]?.layoutWidth||0}return r}function Qx(e,t,n,i,r,o){let s=t,a=0;for(let l=t;l<n;l++){const t=Jx(e,l,l+1,r);a+t>i&&(s<l&&o.push(l),s=l,a=0),a+=t}return a}function ew(e,t,n,i,r=0,o){void 0===o&&(o=e.length);const s=[];return"break-all"===t?Qx(e,r,o,n,i,s):function(e,t,n,i,r,o){let s=t,a=t,l=t,c=0;for(let u=t;u<n;u++)if(" "===e[u]?l=u+1:" "!==e[u+1]&&u+1!==n||(l=u+1),l>a){let t=Jx(e,a,l,r);c+t>i&&(s<a&&(o.push(a),s=a,c=0),t>i&&(t=Qx(e,a,l,i,r,o),s=o[o.length-1])),a=l,c+=t}}(e,r,o,n,i,s),s}function tw(e,t,n,i,r,o){let s=0,a=0;for(let o=t;o<n;o++){const t=e[o],n=i[t];n?(a||(a=n.layoutHeight),r[o]=s+n.layoutWidth/2,s+=n.layoutWidth):(vo.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),r[o]=s,s+=32)}o[0]=s,o[1]=a}class nw{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const iw={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};let rw=new nw(3);function ow(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function sw(e,t,n,i){e.font=`${i} ${n}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class aw{constructor(){this.props={...iw}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=function(e,t){let n;n="string"==typeof t?new Set(Array.from(t)):new Set(t);const i=rw.get(e);if(!i)return n;for(const e in i.mapping)n.has(e)&&n.delete(e);return n}(this._key,this.props.characterSet),n=rw.get(this._key);if(n&&0===t.size)return void(this._atlas!==n&&(this._atlas=n));const i=this._generateFontAtlas(t,n);this._atlas=i,rw.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:i,fontSize:r,buffer:o,sdf:s,radius:a,cutoff:l}=this.props;let c=t&&t.data;c||(c=document.createElement("canvas"),c.width=1024);const u=c.getContext("2d",{willReadFrequently:!0});sw(u,n,r,i);const{mapping:h,canvasHeight:d,xOffset:p,yOffset:f}=function({characterSet:e,getFontWidth:t,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:o={},xOffset:s=0,yOffset:a=0}){let l=0,c=s;const u=n+2*i;for(const s of e)if(!o[s]){const e=t(s);c+e+2*i>r&&(c=0,l++),o[s]={x:c+i,y:a+l*u+i,width:e,height:u,layoutWidth:e,layoutHeight:n},c+=e+2*i}return{mapping:o,xOffset:c,yOffset:a+l*u,canvasHeight:(h=a+(l+1)*u,Math.pow(2,Math.ceil(Math.log2(h))))};var h}({getFontWidth:e=>u.measureText(e).width,fontHeight:1.2*r,buffer:o,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(c.height!==d){const e=u.getImageData(0,0,c.width,c.height);c.height=d,u.putImageData(e,0,0)}if(sw(u,n,r,i),s){const t=new qx({fontSize:r,buffer:o,radius:a,cutoff:l,fontFamily:n,fontWeight:`${i}`});for(const n of e){const{data:e,width:i,height:o,glyphTop:s}=t.draw(n);h[n].width=i,h[n].layoutOffsetY=.9*r-s;const a=u.createImageData(i,o);ow(e,a),u.putImageData(a,h[n].x,h[n].y)}}else for(const t of e)u.fillText(t,h[t].x,h[t].y+o+.9*r);return{xOffset:p,yOffset:f,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:r,radius:o,cutoff:s}=this.props;return r?`${e} ${t} ${n} ${i} ${o} ${s}`:`${e} ${t} ${n} ${i}`}}const lw="uniform textBackgroundUniforms {\n  bool billboard;\n  float sizeScale;\n  float sizeMinPixels;\n  float sizeMaxPixels;\n  vec4 borderRadius;\n  vec4 padding;\n  highp int sizeUnits;\n  bool stroked;\n} textBackground;\n",cw={name:"textBackground",vs:lw,fs:lw,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},uw={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class hw extends Db{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME text-background-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceRects;\nin float instanceSizes;\nin float instanceAngles;\nin vec2 instancePixelOffsets;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout float vLineWidth;\nout vec2 uv;\nout vec2 dimensions;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = radians(angle);\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvLineWidth = instanceLineWidths;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),\ntextBackground.sizeMinPixels, textBackground.sizeMaxPixels\n);\ndimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;\nvec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\npixelOffset += instancePixelOffsets;\npixelOffset.y *= -1.0;\nif (textBackground.billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME text-background-layer-fragment-shader\nprecision highp float;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin float vLineWidth;\nin vec2 uv;\nin vec2 dimensions;\nout vec4 fragColor;\nfloat round_rect(vec2 p, vec2 size, vec4 radii) {\nvec2 pixelPositionCB = (p - 0.5) * size;\nvec2 sizeCB = size * 0.5;\nfloat maxBorderRadius = min(size.x, size.y) * 0.5;\nvec4 borderRadius = vec4(min(radii, maxBorderRadius));\nborderRadius.xy =\n(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;\nborderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;\nvec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;\nreturn -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);\n}\nfloat rect(vec2 p, vec2 size) {\nvec2 pixelPosition = p * size;\nreturn min(min(pixelPosition.x, size.x - pixelPosition.x),\nmin(pixelPosition.y, size.y - pixelPosition.y));\n}\nvec4 get_stroked_fragColor(float dist) {\nfloat isBorder = smoothedge(dist, vLineWidth);\nreturn mix(vFillColor, vLineColor, isBorder);\n}\nvoid main(void) {\ngeometry.uv = uv;\nif (textBackground.borderRadius != vec4(0.0)) {\nfloat distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);\nif (textBackground.stroked) {\nfragColor = get_stroked_fragColor(distToEdge);\n} else {\nfragColor = vFillColor;\n}\nfloat shapeAlpha = smoothedge(-distToEdge, 0.0);\nfragColor.a *= shapeAlpha;\n} else {\nif (textBackground.stroked) {\nfloat distToEdge = rect(uv, dimensions);\nfragColor = get_stroked_fragColor(distToEdge);\n} else {\nfragColor = vFillColor;\n}\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[yx,bx,cw]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:r,sizeMaxPixels:o,getLineWidth:s}=this.props;let{padding:a,borderRadius:l}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]),Array.isArray(l)||(l=[l,l,l,l]);const c=this.state.model,u={billboard:t,stroked:Boolean(s),borderRadius:l,padding:a,sizeUnits:Va[i],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o};c.shaderInputs.setProps({textBackground:u}),c.draw(this.context.renderPass)}_getModel(){return new kv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new xx({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,0,1,1,1])}}}),isInstanced:!0})}}hw.defaultProps=uw,hw.layerName="TextBackgroundLayer";const dw=hw,pw={start:1,middle:0,end:-1},fw={top:1,center:0,bottom:-1},gw=[0,0,0,255],mw={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:gw},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:iw.characterSet},fontFamily:iw.fontFamily,fontWeight:iw.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:gw},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:gw},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class _w extends mx{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,i]}=this.transformParagraph(e,t);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,i/=r;const{getTextAnchor:o,getAlignmentBaseline:s}=this.props;return[(pw["function"==typeof o?o(e,t):o]-1)*n/2,(fw["function"==typeof s?s(e,t):s]-1)*i/2,n,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:r,y:o,rowWidth:s,size:[a,l]}=this.transformParagraph(e,t),c=pw["function"==typeof n?n(e,t):n],u=fw["function"==typeof i?i(e,t):i],h=r.length,d=new Array(2*h);let p=0;for(let e=0;e<h;e++){const t=(1-c)*(a-s[e])/2;d[p++]=(c-1)*a/2+t+r[e],d[p++]=(u-1)*l/2+o[e]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new aw},this.props.maxWidth>0&&vo.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:r}=this.state,o={...e,characterSet:r,fontFamily:t,fontWeight:n};if(!i.mapping)return i.setProps(o),!0;for(const e in o)if(o[e]!==i.props[e])return i.setProps(o),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,n=e.attributes?.getText;let i,{getText:r}=this.props,o=e.startIndices;const s="auto"===t&&new Set;if(n&&o){const{texts:t,characterCount:a}=function({value:e,length:t,stride:n,offset:i,startIndices:r,characterSet:o}){const s=e.BYTES_PER_ELEMENT,a=n?n/s:1,l=i?i/s:0,c=r[t]||Math.ceil((e.length-l)/a),u=o&&new Set,h=new Array(t);let d=e;if(a>1||l>0){d=new(0,e.constructor)(c);for(let t=0;t<c;t++)d[t]=e[t*a+l]}for(let e=0;e<t;e++){const t=r[e],n=r[e+1]||c,i=d.subarray(t,n);h[e]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(const e of u)o.add(String.fromCodePoint(e));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:s});i=a,r=(e,{index:n})=>t[n]}else{const{iterable:t,objectInfo:n}=Bm(e);o=[0],i=0;for(const e of t){n.index++;const t=Array.from(r(e,n)||"");s&&t.forEach(s.add,s),i+=t.length,o.push(i)}}this.setState({getText:r,startIndices:o,numInstances:i,characterSet:s||t})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,i=n.mapping,r=this.state.getText,{wordBreak:o,lineHeight:s,maxWidth:a}=this.props;return function(e,t,n,i,r){const o=Array.from(e),s=o.length,a=new Array(s),l=new Array(s),c=new Array(s),u=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,h=[0,0],d=[0,0];let p=0,f=0,g=0;for(let e=0;e<=s;e++){const m=o[e];if("\n"!==m&&e!==s||(g=e),g>f){const e=u?ew(o,n,i,r,f,g):Kx;for(let n=0;n<=e.length;n++){const i=0===n?f:e[n-1],s=n<e.length?e[n]:g;tw(o,i,s,r,a,d);for(let e=i;e<s;e++){a[e];const t=o[e],n=r[t]?.layoutOffsetY||0;l[e]=p+d[1]/2+n,c[e]=d[0]}p+=d[1]*t,h[0]=Math.max(h[0],d[0])}f=g}"\n"===m&&(a[f]=0,l[f]=0,c[f]=0,f++)}return h[1]=p,{x:a,y:l,rowWidth:c,size:h}}(r(e,t)||"",s,o,a*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,atlas:r,mapping:o},styleVersion:s}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:f,getBorderColor:g,getBorderWidth:m,backgroundBorderRadius:_,backgroundPadding:y,background:v,billboard:b,fontSettings:x,outlineWidth:w,outlineColor:E,sizeScale:S,sizeUnits:T,sizeMinPixels:C,sizeMaxPixels:A,transitions:P,updateTriggers:I}=this.props,M=this.getSubLayerClass("characters",Hx),R=this.getSubLayerClass("background",dw);return[v&&new R({getFillColor:f,getLineColor:g,getLineWidth:m,borderRadius:_,padding:y,getPosition:c,getSize:h,getAngle:d,getPixelOffset:p,billboard:b,sizeScale:S,sizeUnits:T,sizeMinPixels:C,sizeMaxPixels:A,transitions:P&&{getPosition:P.getPosition,getAngle:P.getAngle,getSize:P.getSize,getFillColor:P.getBackgroundColor,getLineColor:P.getBorderColor,getLineWidth:P.getBorderWidth,getPixelOffset:P.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:I.getPosition,getAngle:I.getAngle,getSize:I.getSize,getFillColor:I.getBackgroundColor,getLineColor:I.getBorderColor,getLineWidth:I.getBorderWidth,getPixelOffset:I.getPixelOffset,getBoundingRect:{getText:I.getText,getTextAnchor:I.getTextAnchor,getAlignmentBaseline:I.getAlignmentBaseline,styleVersion:s}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new M({sdf:x.sdf,smoothing:Number.isFinite(x.smoothing)?x.smoothing:iw.smoothing,outlineWidth:w/(x.radius||iw.radius),outlineColor:E,iconAtlas:r,iconMapping:o,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:p,billboard:b,sizeScale:S*i,sizeUnits:T,sizeMinPixels:C*i,sizeMaxPixels:A*i,transitions:P&&{getPosition:P.getPosition,getAngle:P.getAngle,getColor:P.getColor,getSize:P.getSize,getPixelOffset:P.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:I.getText,getPosition:I.getPosition,getAngle:I.getAngle,getColor:I.getColor,getSize:I.getSize,getPixelOffset:I.getPixelOffset,getIconOffsets:{getTextAnchor:I.getTextAnchor,getAlignmentBaseline:I.getAlignmentBaseline,styleVersion:s}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){!function(e){vo.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),rw=new nw(e)}(e)}}_w.defaultProps=mw,_w.layerName="TextLayer";const yw=_w;class vw{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=bo,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:o,dataChanged:s,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===o?2:3),this.buffers=n,this.normalize=a,r&&(sl(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(s))for(const e of s)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?jm(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:o}=this;for(const s in r)if(s in i)o.release(n[s]),n[s]=null;else{const i=r[s];i.copy=t,n[s]=o.allocate(n[s],e,i)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:r}=this,{iterable:o,objectInfo:s}=Bm(i,t,n);for(const t of o)s.index++,e(r?r(t,s):null,s.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:o}=this,{startRow:s=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!o)this._forEachGeometry(((e,t)=>{const i=e&&this.normalizeGeometry(e);l[t]=i,n[t+1]=n[t]+(i?this.getGeometrySize(i):0)}),s,a),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof Ep){const e=4*this.positionSize;i=i||o.byteLength/e}else if(o.buffer){const e=o.stride||4*this.positionSize;i=i||o.buffer.byteLength/e}else if(o.value){const e=o.value,t=o.stride/e.BYTES_PER_ELEMENT||this.positionSize;i=i||e.length/t}this._allocate(i,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry(((e,r)=>{const o=l[r]||e;c.vertexStart=n[r],c.indexStart=t[r];const s=r<n.length-1?n[r+1]:i;c.geometrySize=s-n[r],c.geometryIndex=r,this.updateGeometryAttributes(o,c)}),s,a),this.vertexCount=t[t.length-1]}}function bw(e,t,n={}){const i=function(e,t={}){return Math.sign(function(e,t={}){const{start:n=0,end:i=e.length,plane:r="xy"}=t,o=t.size||2;let s=0;const a=xw[r[0]],l=xw[r[1]];for(let t=n,r=i-o;t<i;t+=o)s+=(e[t+a]-e[r+a])*(e[t+l]+e[r+l]),r=t;return s/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,o=(i-n)/r,s=Math.floor(o/2);for(let t=0;t<s;++t){const i=n+t*r,s=n+(o-1-t)*r;for(let t=0;t<r;++t){const n=e[i+t];e[i+t]=e[s+t],e[s+t]=n}}}(e,n),!0)}const xw={x:0,y:1,z:2};function ww(e,t,n,i,r=[]){let o,s;if(8&n)o=(i[3]-e[1])/(t[1]-e[1]),s=3;else if(4&n)o=(i[1]-e[1])/(t[1]-e[1]),s=1;else if(2&n)o=(i[2]-e[0])/(t[0]-e[0]),s=2;else{if(!(1&n))return null;o=(i[0]-e[0])/(t[0]-e[0]),s=0}for(let n=0;n<e.length;n++)r[n]=(1&s)===n?i[s]:o*(t[n]-e[n])+e[n];return r}function Ew(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function Sw(e,t){const n=t.length,i=e.length;if(i>0){let r=!0;for(let o=0;o<n;o++)if(e[i-n+o]!==t[o]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[i+r]=t[r];return!0}function Tw(e,t){const n=t.length;for(let i=0;i<n;i++)e[i]=t[i]}function Cw(e,t,n,i,r=[]){const o=i+t*n;for(let t=0;t<n;t++)r[t]=e[o+t];return r}function Aw(e,t){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:a=e.length}=t||{},l=(a-s)/n;let c=[];const u=[c],h=Cw(e,0,n,s);let d,p;const f=Mw(h,r,o,[]),g=[];Sw(c,h);for(let t=1;t<l;t++){for(d=Cw(e,t,n,s,d),p=Ew(d,f);p;){ww(h,d,p,f,g);const e=Ew(g,f);e&&(ww(h,g,e,f,g),p=e),Sw(c,g),Tw(h,g),Rw(f,r,p),i&&c.length>n&&(c=[],u.push(c),Sw(c,h)),p=Ew(d,f)}Sw(c,d),Tw(h,d)}return i?u:u[0]}function Pw(e,t=null,n){if(!e.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:o=[0,0],edgeTypes:s=!1}=n||{},a=[],l=[{pos:e,types:s?new Array(e.length/i).fill(1):null,holes:t||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:e,types:t,holes:n}=l.shift();kw(e,i,n[0]||e.length,c),u=Mw(c[0],r,o,u);const h=Ew(c[1],u);if(h){let r=Iw(e,t,i,0,n[0]||e.length,u,h);const o={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};l.push(o,a);for(let l=0;l<n.length;l++)r=Iw(e,t,i,n[l],n[l+1]||e.length,u,h),r[0]&&(o.holes.push(o.pos.length),o.pos=Ow(o.pos,r[0].pos),s&&(o.types=Ow(o.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=Ow(a.pos,r[1].pos),s&&(a.types=Ow(a.types,r[1].types)))}else{const i={positions:e};s&&(i.edgeTypes=t),n.length&&(i.holeIndices=n),a.push(i)}}return a}function Iw(e,t,n,i,r,o,s){const a=(r-i)/n,l=[],c=[],u=[],h=[],d=[];let p,f,g;const m=Cw(e,a-1,n,i);let _=Math.sign(8&s?m[1]-o[3]:m[0]-o[2]),y=t&&t[a-1],v=0,b=0;for(let r=0;r<a;r++)p=Cw(e,r,n,i,p),f=Math.sign(8&s?p[1]-o[3]:p[0]-o[2]),g=t&&t[i/n+r],f&&_&&_!==f&&(ww(m,p,s,o,d),Sw(l,d)&&u.push(y),Sw(c,d)&&h.push(y)),f<=0?(Sw(l,p)&&u.push(g),v-=f):u.length&&(u[u.length-1]=0),f>=0?(Sw(c,p)&&h.push(g),b+=f):h.length&&(h[h.length-1]=0),Tw(m,p),_=f,y=g;return[v?{pos:l,types:t&&u}:null,b?{pos:c,types:t&&h}:null]}function Mw(e,t,n,i){const r=Math.floor((e[0]-n[0])/t)*t+n[0],o=Math.floor((e[1]-n[1])/t)*t+n[1];return i[0]=r,i[1]=o,i[2]=r+t,i[3]=o+t,i}function Rw(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function kw(e,t,n,i){let r=1/0,o=-1/0,s=1/0,a=-1/0;for(let i=0;i<n;i+=t){const t=e[i],n=e[i+1];r=t<r?t:r,o=t>o?t:o,s=n<s?n:s,a=n>a?n:a}return i[0][0]=r,i[0][1]=s,i[1][0]=o,i[1][1]=a,i}function Ow(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function Lw(e,t,n,i){let r=-1,o=-1;for(let s=n+1;s<i;s+=t){const t=Math.abs(e[s]);t>r&&(r=t,o=s-1)}return o}function Dw(e,t,n,i,r=85.051129){const o=e[n],s=e[i-t];if(Math.abs(o-s)>180){const i=Cw(e,0,t,n);i[0]+=360*Math.round((s-o)/360),Sw(e,i),i[1]=Math.sign(i[1])*r,Sw(e,i),i[0]=o,Sw(e,i)}}function Fw(e,t,n,i){let r,o=e[0];for(let s=n;s<i;s+=t){r=e[s];const t=r-o;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[s]=o=r}}function Nw(e,t){let n;const i=e.length/t;for(let r=0;r<i&&(n=e[r*t],(n+180)%360==0);r++);const r=360*-Math.round(n/360);if(0!==r)for(let n=0;n<i;n++)e[n*t]+=r}class Bw extends vw{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?function(e,t,n,i){let r;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let n=0;n<e.length;n++)for(let i=0;i<t;i++)r[n*t+i]=e[n][i]||0}else r=e;return n?Aw(r,{size:t,gridResolution:n}):i?function(e,t){const{size:n=2,startIndex:i=0,endIndex:r=e.length,normalize:o=!0}=t||{},s=e.slice(i,r);Fw(s,n,0,r-i);const a=Aw(s,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const e of a)Nw(e,n);return a}(r,{size:t}):r}(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(zw(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&zw(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,i=!!e&&this.isClosed(e),{vertexStart:r,geometrySize:o}=t;n.fill(0,r,r+o),i?(n[r]=4,n[r+o-2]=4):(n[r]+=1,n[r+o-2]+=2),n[r+o-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:r}=t,o=new Array(3);for(let t=i,s=0;s<r;t++,s++)this.getPointOnPath(e,s,o),n[3*t]=o[0],n[3*t+1]=o[1],n[3*t+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return n[0]=e[r],n[1]=e[r+1],n[2]=3===i&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}function zw(e){return Array.isArray(e[0])}const jw="uniform pathUniforms {\n  float widthScale;\n  float widthMinPixels;\n  float widthMaxPixels;\n  float jointType;\n  float capType;\n  float miterLimit;\n  bool billboard;\n  highp int widthUnits;\n} path;\n",Uw={name:"path",vs:jw,fs:jw,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Vw=[0,0,0,255],$w={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:Vw},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Gw={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Ww extends Db{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = path.capType;\n} else {\nvJointType = path.jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),\npath.widthMinPixels, path.widthMaxPixels) / 2.0);\nvec3 width;\nif (path.billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[yx,bx,Uw]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const e=!0;this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Gw,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Gw,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Gw,defaultValue:Vw},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new Bw({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,r=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:r.getPath,buffers:r,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:r,widthUnits:o,widthScale:s,widthMinPixels:a,widthMaxPixels:l}=this.props,c=this.state.model,u={jointType:Number(t),capType:Number(n),billboard:i,widthUnits:Va[o],widthScale:s,miterLimit:r,widthMinPixels:a,widthMaxPixels:l};c.shaderInputs.setProps({path:u}),c.draw(this.context.renderPass)}_getModel(){return new kv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new xx({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Ww.defaultProps=$w,Ww.layerName="PathLayer";const Hw=Ww,Zw="precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int lightType;\n\n  int directionalLightCount;\n  int pointLightCount;\n\n  vec3 ambientColor;\n\n  vec3 lightColor0;\n  vec3 lightPosition0;\n  vec3 lightDirection0;\n  vec3 lightAttenuation0;\n\n  vec3 lightColor1;\n  vec3 lightPosition1;\n  vec3 lightDirection1;\n  vec3 lightAttenuation1;\n\n  vec3 lightColor2;\n  vec3 lightPosition2;\n  vec3 lightDirection2;\n  vec3 lightAttenuation2;\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  switch (index) {\n    case 0:\n      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);\n    case 1:\n      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);\n    case 2:\n    default:  \n      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);\n  }\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  switch (index) {\n    case 0:\n      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);\n    case 1:\n      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);\n    case 2:\n    default:   \n      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);\n  }\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n";var qw;!function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"}(qw||(qw={}));const Xw={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:3},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:qw.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:"// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  color: vec3<f32>,\n};\n\nstruct PointLight {\n  color: vec3<f32>,\n  position: vec3<f32>,\n  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  color: vec3<f32>,\n  direction: vec3<f32>,\n};\n\nstruct lightingUniforms {\n  enabled: i32,\n  pointLightCount: i32,\n  directionalLightCount: i32,\n\n  ambientColor: vec3<f32>,\n\n  // TODO - support multiple lights by uncommenting arrays below\n  lightType: i32,\n  lightColor: vec3<f32>,\n  lightDirection: vec3<f32>,\n  lightPosition: vec3<f32>,\n  lightAttenuation: vec3<f32>,\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n};\n\n// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)\n@binding(1) @group(0) var<uniform> lighting : lightingUniforms;\n\nfn lighting_getPointLight(index: i32) -> PointLight {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nfn lighting_getDirectionalLight(index: i32) -> DirectionalLight {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n",vs:Zw,fs:Zw,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...Xw.defaultUniforms};e.lights&&(e={...e,...Kw(e.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=e||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...Xw.defaultUniforms,enabled:0};const o={...Xw.defaultUniforms,...t,...Yw({ambientLight:n,pointLights:i,directionalLights:r})};return void 0!==e.enabled&&(o.enabled=e.enabled?1:0),o}};function Yw({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const i={};i.ambientLightColor=Jw(e);let r=0;for(const e of t){i.lightType=qw.POINT;const t=r;i[`lightColor${t}`]=Jw(e),i[`lightPosition${t}`]=e.position,i[`lightAttenuation${t}`]=e.attenuation||[1,0,0],r++}for(const e of n){i.lightType=qw.DIRECTIONAL;const t=r;i[`lightColor${t}`]=Jw(e),i[`lightDirection${t}`]=e.direction,r++}return r>3&&vp.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=n.length,i.pointLightCount=t.length,i}function Kw(e){const t={pointLights:[],directionalLights:[]};for(const n of e||[])switch(n.type){case"ambient":t.ambientLight=n;break;case"directional":t.directionalLights?.push(n);break;case"point":t.pointLights?.push(n)}return t}function Jw(e={}){const{color:t=[0,0,0],intensity:n=1}=e;return t.map((e=>e*n/255))}const Qw={props:{},name:"gouraudMaterial",vs:"uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  for (int i = 0; i < lighting.pointLightCount; i++) {\n    PointLight pointLight = lighting_getPointLight(i);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);\n  }\n\n  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);\n  for (int i = lighting.pointLightCount; i < totalLights; i++) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(i);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n}\n".replace("phongMaterial","gouraudMaterial"),fs:"uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n".replace("phongMaterial","gouraudMaterial"),source:"struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, phongMaterial.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n".replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Xw],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map((e=>e/255))),{...Qw.defaultUniforms,...t}}};var eE=d(5230);const tE={isClosed:!0};function nE(e){return"positions"in e?e.positions:e}function iE(e){return"holeIndices"in e?e.holeIndices:null}function rE(e,t,n,i,r){let o=t;const s=n.length;for(let t=0;t<s;t++)for(let r=0;r<i;r++)e[o++]=n[t][r]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let t=0;t<i;t++)e[o++]=n[0][t]||0;return tE.start=t,tE.end=o,tE.size=i,bw(e,r,tE),o}function oE(e,t,n,i,r=0,o,s){const a=(o=o||n.length)-r;if(a<=0)return t;let l=t;for(let t=0;t<a;t++)e[l++]=n[r+t];if(!function(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}(n,i,r,o))for(let t=0;t<i;t++)e[l++]=n[r+t];return tE.start=t,tE.end=l,tE.size=i,bw(e,s,tE),l}function sE(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],i=[];if("positions"in e){const{positions:r,holeIndices:o}=e;if(o){let e=0;for(let s=0;s<=o.length;s++)e=oE(n,e,r,t,o[s-1],o[s],0===s?1:-1),i.push(e);return i.pop(),{positions:n,holeIndices:i}}e=r}if(!function(e){return Array.isArray(e[0])}(e))return oE(n,0,e,t,0,n.length,1),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let r=0;for(const[o,s]of e.entries())r=rE(n,r,s,t,0===o?1:-1),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return rE(n,0,e,t,1),n}function aE(e,t,n){const i=e.length/3;let r=0;for(let o=0;o<i;o++){const s=(o+1)%i;r+=e[3*o+t]*e[3*s+n],r-=e[3*s+t]*e[3*o+n]}return Math.abs(r/2)}function lE(e,t,n,i){const r=e.length/3;for(let o=0;o<r;o++){const r=3*o,s=e[r+0],a=e[r+1],l=e[r+2];e[r+t]=s,e[r+n]=a,e[r+i]=l}}class cE extends vw{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=sE(e,this.positionSize);return this.opts.resolution?Pw(nE(t),iE(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,n){const{size:i=2,normalize:r=!0,edgeTypes:o=!1}=n||{};t=t||[];const s=[],a=[];let l=0,c=0;for(let r=0;r<=t.length;r++){const o=t[r]||e.length,u=c,h=Lw(e,i,l,o);for(let t=h;t<o;t++)s[c++]=e[t];for(let t=l;t<h;t++)s[c++]=e[t];Fw(s,i,u,c),Dw(s,i,u,c,n?.maxLatitude),l=o,a[r]=c}a.pop();const u=Pw(s,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(r)for(const e of u)Nw(e.positions,i);return u}(nE(t),iE(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(uE(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return nE(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&uE(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:o,typedArrayManager:s}=this;let a=r.indices;if(!a||!e)return;let l=i;const c=function(e,t,n,i){let r=iE(e);r&&(r=r.map((e=>e/t)));let o=nE(e);const s=i&&3===t;if(n){const e=o.length;o=o.slice();const i=[];for(let r=0;r<e;r+=t){i[0]=o[r],i[1]=o[r+1],s&&(i[2]=o[r+2]);const e=n(i);o[r]=e[0],o[r+1]=e[1],s&&(o[r+2]=e[2])}}if(s){const e=aE(o,0,1),t=aE(o,0,2),i=aE(o,1,2);if(!e&&!t&&!i)return[];e>t&&e>i||(t>i?(n||(o=o.slice()),lE(o,0,2,1)):(n||(o=o.slice()),lE(o,2,0,1)))}return eE(o,r,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);a=s.allocate(a,i+c.length,{copy:!0});for(let e=0;e<c.length;e++)a[l++]=c[e]+n;o[t+1]=i+c.length,r.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i||!e)return;const o=nE(e);for(let e=t,s=0;s<n;e++,s++){const t=o[s*r],n=o[s*r+1],a=r>2?o[s*r+2]:0;i[3*e]=t,i[3*e+1]=n,i[3*e+2]=a}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:i}=this,r=this.attributes.vertexValid,o=e&&iE(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,t):r.fill(1,t,t+n),o)for(let e=0;e<o.length;e++)r[t+o[e]/i-1]=0;r[t+n-1]=0}}function uE(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const hE="uniform solidPolygonUniforms {\n  bool extruded;\n  bool isWireframe;\n  float elevationScale;\n} solidPolygon;\n",dE={name:"solidPolygon",vs:hE,fs:hE,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},pE="in vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project.commonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (solidPolygon.extruded) {\npos.z += props.elevations * solidPolygon.elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (solidPolygon.extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * layer.opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * layer.opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fE=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n${pE}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,gE=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n${pE}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n`,mE=[0,0,0,255],_E={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:mE},getLineColor:{type:"accessor",value:mE},material:!0},yE={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class vE extends Db{getShaders(e){return super.getShaders({vs:"top"===e?fE:gE,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[yx,Qw,bx,dE]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;let i;e.isGeospatial&&t===ja.DEFAULT&&(t=ja.LNGLAT),t===ja.LNGLAT&&(i=n?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new cE({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),o=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:yE,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:yE,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:yE,accessor:"getFillColor",defaultValue:mE},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:yE,accessor:"getLineColor",defaultValue:mE},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:o,sideModel:s,wireframeModel:a,polygonTesselator:l}=this.state,c={extruded:Boolean(t),elevationScale:r,isWireframe:!1};a&&i&&(a.setInstanceCount(l.instanceCount-1),a.shaderInputs.setProps({solidPolygon:{...c,isWireframe:!0}}),a.draw(this.context.renderPass)),s&&n&&(s.setInstanceCount(l.instanceCount-1),s.shaderInputs.setProps({solidPolygon:c}),s.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(l.vertexCount),o.shaderInputs.setProps({solidPolygon:c}),o.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:i}=e,r=this.getAttributeManager();(i.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&(this.state.models?.forEach((e=>e.destroy())),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let i,r,o;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const n=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new kv(this.context.device,{...t,id:`${e}-top`,topology:"triangle-list",bufferLayout:n,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new kv(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:t,geometry:new xx({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new kv(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:t,geometry:new xx({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,o,i].filter(Boolean),topModel:i,sideModel:r,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}vE.defaultProps=_E,vE.layerName="SolidPolygonLayer";const bE=vE,xE={circle:{type:jx,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Lx,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:yw,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},wE={type:Hw,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},EE={type:bE,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function SE({type:e,props:t}){const n={};for(const i in t)n[i]=e.defaultProps[t[i]];return n}function TE(e,t){const{transitions:n,updateTriggers:i}=e.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const o in t){const s=t[o];let a=e.props[o];o.startsWith("get")&&(a=e.getSubLayerAccessor(a),r.updateTriggers[s]=i[o],n&&(r.transitions[s]=n[o])),r[s]=a}return r}function CE(e,t,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:o=e.length}=n;for(let n=r;n<o;n++){const r=e[n],{geometry:o}=r;if(o)if("GeometryCollection"===o.type){vo.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");const{geometries:e}=o;for(let o=0;o<e.length;o++)AE(e[o],i,t,r,n)}else AE(o,i,t,r,n)}return i}function AE(e,t,n,i,r){const{type:o,coordinates:s}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(function(e,t){let n=PE[e];for(vo.assert(n,`Unknown GeoJSON type ${e}`);t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(o,s))switch(o){case"Point":a.push(n({geometry:e},i,r));break;case"MultiPoint":s.forEach((e=>{a.push(n({geometry:{type:"Point",coordinates:e}},i,r))}));break;case"LineString":l.push(n({geometry:e},i,r));break;case"MultiLineString":s.forEach((e=>{l.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"Polygon":c.push(n({geometry:e},i,r)),s.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"MultiPolygon":s.forEach((e=>{c.push(n({geometry:{type:"Polygon",coordinates:e}},i,r)),e.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}))}))}else vo.warn(`${o} coordinates are malformed`)()}const PE={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function IE(e){return e.geometry.coordinates}const ME=["points","linestrings","polygons"],RE={...SE(xE.circle),...SE(xE.icon),...SE(xE.text),...SE(wE),...SE(EE),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class kE extends mx{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:r,polygons:o}=e,s=function(e,t){const n={points:null,lines:null,polygons:null};for(const i in n){const r=e[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(4*r.length);const o=[];for(let e=0;e<r.length;e++)t(r[e],o),n[i][4*e+0]=o[0],n[i][4*e+1]=o[1],n[i][4*e+2]=o[2],n[i][4*e+3]=255}return n}(e,t);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:s.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:s.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygons._normalize=!1,o.triangles&&(n.polygons.data.attributes.indices=o.triangles.value),n.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygonsOutline._pathType="open",n}(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=function(e){if(Array.isArray(e))return e;switch(vo.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return vo.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(t.dataChanged)){const e=this.state.features;for(const t in e)r[t]=e[t].slice(),o[t]=[];for(const s of t.dataChanged){const t=CE(n,i,s);for(const n in e)o[n].push(_x({data:r[n],getIndex:e=>e.__source.index,dataRange:s,replace:t[n]}))}}else r=CE(n,i);const s=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:o,polygonOutlineFeatures:s}=e;return n.points.data=i,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=IE,n.lines.data=r,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=IE,n.polygons.data=o,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=IE,n.polygonsOutline.data=s,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=IE,n}(r,o);this.setState({features:r,featuresDiff:o,layerProps:s})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=ME.find((e=>i.id.startsWith(`${this.id}-${e}-`))),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n="points"===e.featureType;for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",r=this.shouldRenderSubLayer(i,n.polygons?.data)&&this.getSubLayerClass(i,EE.type);if(r){const o=TE(this,EE.props),s=e&&t;return s||delete o.getLineColor,o.updateTriggers.lineColors=s,new r(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",r="linestrings",o=!e&&t&&this.shouldRenderSubLayer(i,n.polygonsOutline?.data)&&this.getSubLayerClass(i,wE.type),s=this.shouldRenderSubLayer(r,n.lines?.data)&&this.getSubLayerClass(r,wE.type);if(o||s){const e=TE(this,wE.props);return[o&&new o(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),n.polygonsOutline),s&&new s(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex((e=>e.__source.index===i)));const r=new Set(e.split("+")),o=[];for(const e of r){const r=`points-${e}`,s=xE[e],a=s&&this.shouldRenderSubLayer(r,t.points?.data)&&this.getSubLayerClass(r,s.type);if(a){const l=TE(this,s.props);let c=t.points;if("text"===e&&n){const{instancePickingColors:e,...t}=c.data.attributes;c={...c,data:{...c.data,attributes:t}}}o.push(new a(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers,highlightedObjectIndex:i}),c))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"==typeof e?(t,n)=>{const{data:i,index:r}=n,o=function(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[n];return-1!==n?function(e,t,n){const i={properties:{...e.properties[t]}};for(const t in e.numericProps)i.properties[t]=e.numericProps[t].value[n];return i}(e,i,n):null}(i,r);return e(o,n)}:super.getSubLayerAccessor(e)}}kE.layerName="GeoJsonLayer",kE.defaultProps=RE;const OE=kE;class LE{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e||this.constructor===e.constructor&&Xr(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,n={updateTriggers:{}};for(const e in t)if(e in this.props){const i=t[e],r=this.props[e];n[e]=r,i&&"accessor"===i.type&&(n.updateTriggers[e]=this.props.updateTriggers[e],"function"==typeof r&&(n[e]=this.getSubLayerAccessor(r)))}return n}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}LE.defaultProps={},LE.extensionName="LayerExtension";const DE=LE,FE={inject:{"vs:#decl":"\nin vec2 instanceDashArrays;\nin float instanceDashOffsets;\nout vec2 vDashArray;\nout float vDashOffset;\n","vs:#main-end":"\nvDashArray = instanceDashArrays;\nvDashOffset = instanceDashOffsets / width.x;\n","fs:#decl":"\nuniform pathStyleUniforms {\nfloat dashAlignMode;\nbool dashGapPickable;\n} pathStyle;\nin vec2 vDashArray;\nin float vDashOffset;\n","fs:#main-start":"\nfloat solidLength = vDashArray.x;\nfloat gapLength = vDashArray.y;\nfloat unitLength = solidLength + gapLength;\nfloat offset;\nif (unitLength > 0.0) {\nif (pathStyle.dashAlignMode == 0.0) {\noffset = vDashOffset;\n} else {\nunitLength = vPathLength / round(vPathLength / unitLength);\noffset = solidLength / 2.0;\n}\nfloat unitOffset = mod(vPathPosition.y + offset, unitLength);\nif (gapLength > 0.0 && unitOffset > solidLength) {\nif (path.capType <= 0.5) {\nif (!(pathStyle.dashGapPickable && bool(picking.isActive))) {\ndiscard;\n}\n} else {\nfloat distToEnd = length(vec2(\nmin(unitOffset - solidLength, unitLength - unitOffset),\nvPathPosition.x\n));\nif (distToEnd > 1.0) {\nif (!(pathStyle.dashGapPickable && bool(picking.isActive))) {\ndiscard;\n}\n}\n}\n}\n}\n"}},NE={inject:{"vs:#decl":"\nin float instanceOffsets;\n","vs:DECKGL_FILTER_SIZE":"\nfloat offsetWidth = abs(instanceOffsets * 2.0) + 1.0;\nsize *= offsetWidth;\n","vs:#main-end":"\nfloat offsetWidth = abs(instanceOffsets * 2.0) + 1.0;\nfloat offsetDir = sign(instanceOffsets);\nvPathPosition.x = (vPathPosition.x + offsetDir) * offsetWidth - offsetDir;\nvPathPosition.y *= offsetWidth;\nvPathLength *= offsetWidth;\n","fs:#main-start":"\nfloat isInside;\nisInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);\nif (isInside == 0.0) {\ndiscard;\n}\n"}};class BE extends DE{constructor({dash:e=!1,offset:t=!1,highPrecisionDash:n=!1}={}){super({dash:e||n,offset:t,highPrecisionDash:n})}isEnabled(e){return"pathTesselator"in e.state}getShaders(e){if(!e.isEnabled(this))return null;let t={};e.opts.dash&&(t=lb(t,FE)),e.opts.offset&&(t=lb(t,NE));const{inject:n}=t;return{modules:[{name:"pathStyle",inject:n,uniformTypes:{dashAlignMode:"f32",dashGapPickable:"i32"}}]}}initializeState(e,t){const n=this.getAttributeManager();n&&t.isEnabled(this)&&(t.opts.dash&&n.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"},instanceDashOffsets:t.opts.highPrecisionDash?{size:1,accessor:"getPath",transform:t.getDashOffsets.bind(this)}:{size:1,update:e=>{e.constant=!0,e.value=[0]}}}),t.opts.offset&&n.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}updateState(e,t){if(t.isEnabled(this)&&t.opts.dash){const e={dashAlignMode:this.props.dashJustified?1:0,dashGapPickable:Boolean(this.props.dashGapPickable)};this.setShaderModuleProps({pathStyle:e})}}getDashOffsets(e){const t=[0],n="XY"===this.props.positionFormat?2:3,i=Array.isArray(e[0]),r=i?e.length:e.length/n;let o,s;for(let a=0;a<r-1;a++)o=i?e[a]:e.slice(a*n,a*n+n),o=this.projectPosition(o),a>0&&(t[a]=t[a-1]+Fo(s,o)),s=o;return t[r-1]=0,t}}BE.defaultProps={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1},BE.extensionName="PathStyleExtension";const zE=BE;function jE(e){const{onHover:t,highlightColor:n,getSelFeature:i,data:r,type:o,theme2:s,time:a}=e;return new Hw({id:S.Path+"-"+o,data:r,autoHighlight:!0,highlightColor:n,pickable:!["par-path-extension","par-path-line"].includes(o),widthMinPixels:1,capRounded:!0,jointRounded:!0,getPath:e=>{switch(o){case"par-path-extension":case"par-path-line":return e[0];default:return e.geometry.coordinates}},getDashArray:"par-path-extension"===o?[5,8]:null,dashJustified:!0,dashGapPickable:!0,extensions:[new zE({dash:!0})],getColor:e=>{let t;switch(o){case"par-path-extension":case"par-path-line":t=s.isDark?function(e){if(!e)return`rgba(${[100,100,0,1].join(", ")})`;const t=e.match(/\d+(\.\d+)?/g);return 3===t.length&&t.push("1"),`rgba(${t.map(((e,t)=>3===t?Math.min(Number(e),1):Math.min(Number(e)+45,255))).join(", ")})`}(e[1]):function(e){if(!e)return`rgba(${[100,100,0,1].join(", ")})`;const t=e.match(/\d+(\.\d+)?/g);return 3===t.length&&t.push("1"),`rgba(${t.map(((e,t)=>3===t?Math.min(Number(e),1):Math.max(Number(e)-45,0))).join(", ")})`}(e[1]);break;default:var n,i;const{threshold:r}=e.properties;t=r.color;const o=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.opacity,a=k(t);return o&&(a[3]=Math.round(255*o)),a}return k(t)},widthScale:1.1,getWidth:e=>{switch(o){case"par-path-extension":case"par-path-line":return 3*e[2];default:var t,n,i;return null!==(i=null==e||null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth)&&void 0!==i?i:1}},onHover:t})}const UE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class VE{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const r=UE[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new VE(s,o,r,e)}constructor(e,t=64,n=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=UE.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return $E(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)ZE(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];ZE(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function $E(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;GE(e,t,s,i,r,o),$E(e,t,n,i,s-1,1-o),$E(e,t,n,s+1,r,1-o)}function GE(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);GE(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(WE(e,t,i,n),t[2*r+o]>s&&WE(e,t,i,r);a<l;){for(WE(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?WE(e,t,i,l):(l++,WE(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function WE(e,t,n,i){HE(e,n,i),HE(t,2*n,2*i),HE(t,2*n+1,2*i+1)}function HE(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function ZE(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}const qE={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},XE=Math.fround||(YE=new Float32Array(1),e=>(YE[0]=+e,YE[0]));var YE;class KE{constructor(e){this.options=Object.assign(Object.create(qE),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r=`prepare ${e.length} points`;t&&console.time(r),this.points=e;const o=[];for(let t=0;t<e.length;t++){const n=e[t];if(!n.geometry)continue;const[i,r]=n.geometry.coordinates,s=XE(eS(i)),a=XE(tS(r));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let e=i;e>=n;e--){const n=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-n)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(eS(n),tS(o),eS(r),tS(i)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+5]>1?JE(l,t,this.clusterProps):this.points[l[t+3]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=o[t*this.stride],l=o[t*this.stride+1],c=r.within(a,l,s),u=[];for(const t of c){const n=t*this.stride;o[n+4]===e&&u.push(o[n+5]>1?JE(o,n,this.clusterProps):this.points[o[n+3]])}if(0===u.length)throw new Error(i);return u}getLeaves(e,t,n){t=t||10,n=n||0;const i=[];return this._appendLeaves(i,e,t,n,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=i?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,n,i,r):r<i?r++:e.push(t),e.length===n)break}return r}_createTree(e){const t=new VE(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let n=0;n<e.length;n+=this.stride)t.add(e[n],e[n+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+5]>1;let l,c,u;if(a)l=QE(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+3]];l=n.properties;const[i,r]=n.geometry.coordinates;c=eS(i),u=tS(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+3]:this.points[t[e+3]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let n=0;n<a.length;n+=c){if(a[n+2]<=t)continue;a[n+2]=t;const i=a[n],u=a[n+1],h=e.within(a[n],a[n+1],s),d=a[n+5];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+5])}if(p>d&&p>=o){let e,o=i*d,s=u*d,f=-1;const g=(n/c<<5)+(t+1)+this.points.length;for(const i of h){const l=i*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+5];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=g,r&&(e||(e=this._map(a,n,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,l)))}a[n+4]=g,l.push(o/p,s/p,1/0,g,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[n+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+5]>1){const i=this.clusterProps[e[t+6]];return n?Object.assign({},i):i}const i=this.points[e[t+3]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function JE(e,t,n){return{type:"Feature",id:e[t+3],properties:QE(e,t,n),geometry:{type:"Point",coordinates:[nS(e[t]),iS(e[t+1])]}}}function QE(e,t,n){const i=e[t+5],r=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+6],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+3],point_count:i,point_count_abbreviated:r})}function eS(e){return e/360+.5}function tS(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function nS(e){return 360*(e-.5)}function iS(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function rS(e){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function oS({colorCounts:e,annotStateCounts:t,allTotal:n,allStTotal:i}){const r="rgb(230,230,230, 0.95)",o=[],s=[];let a=0,l=0;const c=i,u=Object.values(e),h=Object.keys(e);u.length&&u.forEach(((e,t)=>{s.push(a),a+=e.count})),c&&(t[r]={count:n,label:"Unknown"});const d=[],p=[];[r,b.Alerting,b.Pending,b.Normal].forEach((e=>{const n=t[e];void 0!==n&&(d.push(n),p.push(e))})),c&&d.forEach(((e,t)=>{o.push(l),l+=e.count}));const f=a>=1e3?70:a>=100?42:a>=10?34:30,g=a>=1e3?100:a>=100?64:a>=10?48:36,m=Math.round(.73*g);let _=2*g;_=1===a?3*_:_;let y=`\n  <svg width="${_}" height="${_}" stroke-width="1" viewBox="0 0 ${_} ${_}" \n  xmlns="http://www.w3.org/2000/svg"\n  text-anchor="middle" style="font: ${f}px arial; font-weight: lighter; display: block">`;y+=`<defs>\n            <mask id="donutMask">\n              <circle cx="${g}" cy="${g}" r="${m}" fill="white"/>\n            </mask>\n          </defs>`;let v=0;for(let e=0;e<u.length;e++){const t=v+u[e].count/a*360;y+=sS(v/360,t/360,g,m,h[e]),v=t}y+=`<circle cx="${1===a?3*g:g}" cy="${1===a?3*g:g}" r="${1===a?1.35*m:m}" fill="${r}"  />`;let x=g-m,w=x;for(let e=0;e<o.length;e++){const t=d[e].count/l*(_-2*x);y+=`<rect x="0" y="${w}" width="${_}" height="${t}" fill="${p[e]}" mask="url(#donutMask)"/>`,w+=t}return y+=`<text dominant-baseline="central" transform="translate(${g}, ${g})" >\n    ${n+i===1?"":n+i}\n    </text>`,y+="</svg>",y}function sS(e,t,n,i,r){t-e===1&&(t-=1e-5);const o=2*Math.PI*(e-.25),s=2*Math.PI*(t-.25),a=Math.cos(o),l=Math.sin(o),c=Math.cos(s),u=Math.sin(s),h=t-e>.5?1:0;return`<path d="M ${n+i*a} ${n+i*l} L ${n+n*a} ${n+n*l} A ${n} ${n} 0 ${h} 1 ${n+n*c} ${n+n*u} L ${n+i*c} ${n+i*u} A ${i} ${i} 0 ${h} 0 ${n+i*a} ${n+i*l}" fill="${r}" />`}const aS="uniform dataFilterUniforms {\n  bool useSoftMargin;\n  bool enabled;\n  bool transformSize;\n  bool transformColor;\n#ifdef DATAFILTER_TYPE\n  DATAFILTER_TYPE min;\n  DATAFILTER_TYPE softMin;\n  DATAFILTER_TYPE softMax;\n  DATAFILTER_TYPE max;\n#ifdef DATAFILTER_DOUBLE\n  DATAFILTER_TYPE min64High;\n  DATAFILTER_TYPE max64High;\n#endif\n#endif\n#ifdef DATACATEGORY_TYPE\n  highp uvec4 categoryBitMask;\n#endif\n} dataFilter;\n",lS=`\n${aS}\n\n#ifdef DATAFILTER_TYPE\n  in DATAFILTER_TYPE filterValues;\n#ifdef DATAFILTER_DOUBLE\n  in DATAFILTER_TYPE filterValues64Low;\n#endif\n#endif\n\n#ifdef DATACATEGORY_TYPE\n  in DATACATEGORY_TYPE filterCategoryValues;\n#endif\n\nout float dataFilter_value;\n\nfloat dataFilter_reduceValue(float value) {\n  return value;\n}\nfloat dataFilter_reduceValue(vec2 value) {\n  return min(value.x, value.y);\n}\nfloat dataFilter_reduceValue(vec3 value) {\n  return min(min(value.x, value.y), value.z);\n}\nfloat dataFilter_reduceValue(vec4 value) {\n  return min(min(value.x, value.y), min(value.z, value.w));\n}\n\n#ifdef DATAFILTER_TYPE\n  void dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {\n    if (dataFilter.useSoftMargin) {\n      // smoothstep results are undefined if edge0  edge1\n      // Fallback to ignore filterSoftRange if it is truncated by filterRange\n      DATAFILTER_TYPE leftInRange = mix(\n        smoothstep(dataFilter.min, dataFilter.softMin, valueFromMin),\n        step(dataFilter.min, valueFromMin),\n        step(dataFilter.softMin, dataFilter.min)\n      );\n      DATAFILTER_TYPE rightInRange = mix(\n        1.0 - smoothstep(dataFilter.softMax, dataFilter.max, valueFromMax),\n        step(valueFromMax, dataFilter.max),\n        step(dataFilter.max, dataFilter.softMax)\n      );\n      dataFilter_value = dataFilter_reduceValue(leftInRange * rightInRange);\n    } else {\n      dataFilter_value = dataFilter_reduceValue(\n        step(dataFilter.min, valueFromMin) * step(valueFromMax, dataFilter.max)\n      );\n    }\n  }\n#endif\n\n#ifdef DATACATEGORY_TYPE\n  void dataFilter_setCategoryValue(DATACATEGORY_TYPE category) {\n    #if DATACATEGORY_CHANNELS == 1 // One 128-bit mask\n    uint dataFilter_masks = dataFilter.categoryBitMask[category / 32u];\n    #elif DATACATEGORY_CHANNELS == 2 // Two 64-bit masks\n    uvec2 dataFilter_masks = uvec2(\n      dataFilter.categoryBitMask[category.x / 32u],\n      dataFilter.categoryBitMask[category.y / 32u + 2u]\n    );\n    #elif DATACATEGORY_CHANNELS == 3 // Three 32-bit masks\n    uvec3 dataFilter_masks = dataFilter.categoryBitMask.xyz;\n    #else // Four 32-bit masks\n    uvec4 dataFilter_masks = dataFilter.categoryBitMask;\n    #endif\n\n    // Shift mask and extract relevant bits\n    DATACATEGORY_TYPE dataFilter_bits = DATACATEGORY_TYPE(dataFilter_masks) >> (category & 31u);\n    dataFilter_bits &= 1u;\n\n    #if DATACATEGORY_CHANNELS == 1\n    if(dataFilter_bits == 0u) dataFilter_value = 0.0;\n    #else\n    if(any(equal(dataFilter_bits, DATACATEGORY_TYPE(0u)))) dataFilter_value = 0.0;\n    #endif\n  }\n#endif\n\n`,cS=`\n${aS}\n\nin float dataFilter_value;\n\n`;function uS(e){if(!e||!("extensions"in e))return{};const{filterRange:t=[-1,1],filterEnabled:n=!0,filterTransformSize:i=!0,filterTransformColor:r=!0,categoryBitMask:o}=e,s=e.filterSoftRange||t;return{...Number.isFinite(t[0])?{min:t[0],softMin:s[0],softMax:s[1],max:t[1]}:{min:t.map((e=>e[0])),softMin:s.map((e=>e[0])),softMax:s.map((e=>e[1])),max:t.map((e=>e[1]))},enabled:n,useSoftMargin:Boolean(e.filterSoftRange),transformSize:n&&i,transformColor:n&&r,...o&&{categoryBitMask:o}}}const hS={"vs:#main-start":"\n    dataFilter_value = 1.0;\n    if (dataFilter.enabled) {\n      #ifdef DATAFILTER_TYPE\n        #ifdef DATAFILTER_DOUBLE\n          dataFilter_setValue(\n            filterValues - dataFilter.min64High + filterValues64Low,\n            filterValues - dataFilter.max64High + filterValues64Low\n          );\n        #else\n          dataFilter_setValue(filterValues, filterValues);\n        #endif\n      #endif\n\n      #ifdef DATACATEGORY_TYPE\n        dataFilter_setCategoryValue(filterCategoryValues);\n      #endif\n    }\n  ","vs:#main-end":"\n    if (dataFilter_value == 0.0) {\n      gl_Position = vec4(0.);\n    }\n  ","vs:DECKGL_FILTER_SIZE":"\n    if (dataFilter.transformSize) {\n      size = size * dataFilter_value;\n    }\n  ","fs:DECKGL_FILTER_COLOR":"\n    if (dataFilter_value == 0.0) discard;\n    if (dataFilter.transformColor) {\n      color.a *= dataFilter_value;\n    }\n  "};function dS(e){const{categorySize:t,filterSize:n,fp64:i}=e,r={useSoftMargin:"i32",enabled:"i32",transformSize:"i32",transformColor:"i32"};if(n){const e=1===n?"f32":`vec${n}<f32>`;r.min=e,r.softMin=e,r.softMax=e,r.max=e,i&&(r.min64High=e,r.max64High=e)}return t&&(r.categoryBitMask="vec4<i32>"),r}const pS={name:"dataFilter",vs:lS,fs:cS,inject:hS,getUniforms:uS,uniformTypesFromOptions:dS},fS={name:"dataFilter",vs:lS,fs:cS,inject:hS,getUniforms:function(e){if(!e||!("extensions"in e))return{};const t=uS(e);if(Number.isFinite(t.min)){const e=Math.fround(t.min);t.min-=e,t.softMin-=e,t.min64High=e;const n=Math.fround(t.max);t.max-=n,t.softMax-=n,t.max64High=n}else{const e=t.min.map(Math.fround);t.min=t.min.map(((t,n)=>t-e[n])),t.softMin=t.softMin.map(((t,n)=>t-e[n])),t.min64High=e;const n=t.max.map(Math.fround);t.max=t.max.map(((e,t)=>e-n[t])),t.softMax=t.softMax.map(((e,t)=>e-n[t])),t.max64High=n}return t},uniformTypesFromOptions:dS},gS=["float32-renderable-webgl","texture-blend-float-webgl"],mS={blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:"add",blendAlphaOperation:"add",depthCompare:"never"},_S={categorySize:0,filterSize:1,fp64:!1,countItems:!1},yS={1:"uint",2:"uvec2",3:"uvec3",4:"uvec4"},vS={1:"float",2:"vec2",3:"vec3",4:"vec4"};class bS extends DE{constructor(e={}){super({..._S,...e})}getShaders(e){const{categorySize:t,filterSize:n,fp64:i}=e.opts,r={};t&&(r.DATACATEGORY_TYPE=yS[t],r.DATACATEGORY_CHANNELS=t),n&&(r.DATAFILTER_TYPE=vS[n],r.DATAFILTER_DOUBLE=Boolean(i));const o=i?fS:pS;return o.uniformTypes=o.uniformTypesFromOptions(e.opts),{modules:[o],defines:r}}initializeState(e,t){const n=this.getAttributeManager(),{categorySize:i,filterSize:r,fp64:o}=t.opts;n&&(r&&n.add({filterValues:{size:r,type:o?"float64":"float32",stepMode:"dynamic",accessor:"getFilterValue"}}),i&&n.add({filterCategoryValues:{size:i,stepMode:"dynamic",accessor:"getFilterCategory",type:"uint32",transform:1===i?e=>t._getCategoryKey.call(this,e,0):e=>e.map(((e,n)=>t._getCategoryKey.call(this,e,n)))}}));const{device:s}=this.context;if(n&&t.opts.countItems){const e=function(e){return gS.every((t=>e.features.has(t)))}(s);n.add({filterVertexIndices:{size:e?1:2,vertexOffset:1,type:"unorm8",accessor:(t,{index:n})=>{const i=t&&t.__source?t.__source.index:n;return e?(i+1)%255:[(i+1)%255,Math.floor(i/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});const i=function(e,t){return t?e.createFramebuffer({width:1,height:1,colorAttachments:[e.createTexture({format:"rgba32float",mipmaps:!1})]}):e.createFramebuffer({width:256,height:64,colorAttachments:[e.createTexture({format:"rgba8unorm",mipmaps:!1})]})}(s,e),r=function(e,t,n,i){return n.defines.NON_INSTANCED_MODEL=1,i&&(n.defines.FLOAT_TARGET=1),new kv(e,{id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,topology:"point-list",disableWarnings:!0,vs:"#version 300 es\n#define SHADER_NAME data-filter-vertex-shader\n\n#ifdef FLOAT_TARGET\n  in float filterIndices;\n  in float filterPrevIndices;\n#else\n  in vec2 filterIndices;\n  in vec2 filterPrevIndices;\n#endif\n\nout vec4 vColor;\nconst float component = 1.0 / 255.0;\n\nvoid main() {\n  #ifdef FLOAT_TARGET\n    dataFilter_value *= float(filterIndices != filterPrevIndices);\n    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n    vColor = vec4(0.0, 0.0, 0.0, 1.0);\n  #else\n    // Float texture is not supported: pack result into 4 channels x 256 px x 64px\n    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);\n    float col = filterIndices.x;\n    float row = filterIndices.y * 4.0;\n    float channel = floor(row);\n    row = fract(row);\n    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));\n    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);\n  #endif\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME data-filter-fragment-shader\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main() {\n  if (dataFilter_value < 0.5) {\n    discard;\n  }\n  fragColor = vColor;\n}\n",bufferLayout:t,...n})}(s,n.getBufferLayouts({isInstanced:!1}),t.getShaders.call(this,t),e);this.setState({filterFBO:i,filterModel:r})}}updateState({props:e,oldProps:t,changeFlags:n},i){const r=this.getAttributeManager(),{categorySize:o}=i.opts;if(this.state.filterModel){const n=r.attributes.filterValues?.needsUpdate()||r.attributes.filterCategoryValues?.needsUpdate()||e.filterEnabled!==t.filterEnabled||e.filterRange!==t.filterRange||e.filterSoftRange!==t.filterSoftRange||e.filterCategories!==t.filterCategories;n&&this.setState({filterNeedsUpdate:n})}r?.attributes.filterCategoryValues&&((r.attributes.filterCategoryValues.needsUpdate()||!Xr(e.filterCategories,t.filterCategories,2))&&this.setState({categoryBitMask:null}),n.dataChanged&&(this.setState({categoryMap:Array(o).fill(0).map((()=>({})))}),r.attributes.filterCategoryValues.setNeedsUpdate("categoryMap")))}draw(e,t){const n=this.state.filterFBO,i=this.state.filterModel,r=this.state.filterNeedsUpdate;this.state.categoryBitMask||t._updateCategoryBitMask.call(this,e,t);const{onFilteredItemsChange:o,extensions:s,filterEnabled:a,filterRange:l,filterSoftRange:c,filterTransformSize:u,filterTransformColor:h,filterCategories:d}=this.props,p={extensions:s,filterEnabled:a,filterRange:l,filterSoftRange:c,filterTransformSize:u,filterTransformColor:h,filterCategories:d};if(this.state.categoryBitMask&&(p.categoryBitMask=this.state.categoryBitMask),this.setShaderModuleProps({dataFilter:p}),r&&o&&i){const e=this.getAttributeManager(),{attributes:{filterValues:t,filterCategoryValues:r,filterVertexIndices:s}}=e;i.setVertexCount(this.getNumInstances());const a={...t?.getValue(),...r?.getValue(),...s?.getValue()};i.setAttributes(a),i.shaderInputs.setProps({dataFilter:p});const l=[0,0,n.width,n.height],c=i.device.beginRenderPass({id:"data-filter-aggregation",framebuffer:n,parameters:{viewport:l},clearColor:[0,0,0,0]});i.setParameters(mS),i.draw(c),c.end();const u=i.device.readPixelsToArrayWebGL(n);let h=0;for(let e=0;e<u.length;e++)h+=u[e];o({id:this.id,count:h}),this.state.filterNeedsUpdate=!1}}finalizeState(){const e=this.state.filterFBO,t=this.state.filterModel;e?.destroy(),t?.destroy()}_updateCategoryBitMask(e,t){const{categorySize:n}=t.opts;if(!n)return;const{filterCategories:i}=this.props,r=new Uint32Array([0,0,0,0]),o=1===n?[i]:i,s=1===n?128:2===n?64:32;for(let e=0;e<o.length;e++){const n=o[e];for(const i of n){const n=t._getCategoryKey.call(this,i,e);n<s?r[e*(s/32)+Math.floor(n/32)]+=Math.pow(2,n%32):vo.warn(`Exceeded maximum number of categories (${s})`)()}}this.state.categoryBitMask=r}_getCategoryKey(e,t){const n=this.state.categoryMap[t];return e in n||(n[e]=Object.keys(n).length),n[e]}}bS.defaultProps={getFilterValue:{type:"accessor",value:0},getFilterCategory:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterCategories:[0],filterTransformSize:!0,filterTransformColor:!0},bS.extensionName="DataFilterExtension";const xS=bS;function wS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ES extends mx{shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){const i=n.dataChanged||e.sizeScale!==t.sizeScale||e.maxZoom!==t.maxZoom;if(i){const t=new KE({maxZoom:e.maxZoom,radius:e.sizeScale*Math.sqrt(2)});t.load(e.data),this.setState({index:t})}const r=Math.floor(this.context.viewport.zoom+1);(i||r!==this.state.z)&&this.setState({data:this.state.index.getClusters([-180,-85,180,85],r),z:r})}getPickingInfo({info:e,mode:t}){const n=e.object;if(n){var i;const e=null===(i=n.properties)||void 0===i?void 0:i.cluster_id;e&&(n.properties.expZoom=this.state.index.getClusterExpansionZoom(e))}return e}renderLayers(){var e,t;const n=[];null===(e=this.legendItems)||void 0===e||e.forEach((e=>{e.disabled||n.push(e.label)}));const{data:i}=this.state;var r;return new Lx(this.getSubLayerProps({id:S.Points,data:i,updateTriggers:{getIcon:this.time},getFilterValue:e=>e.properties.cluster?1:0,filterRange:[1,1],selectedFeatureIndexes:null!==(r=null===(t=this.getSelectedFeIndexes)||void 0===t?void 0:t.get(S.Points))&&void 0!==r?r:[],getPosition:e=>e.geometry.coordinates,getIcon:e=>{const t={},i={};let r=e.properties.cluster?this.state.index.getLeaves(e.properties.cluster_id,"infinity"):"";if(Array.isArray(r)){e.properties.objects=r;let o=0,s=0;if(r.forEach((e=>{var r,a;const{color:l,label:c}=null===(r=e.properties)||void 0===r?void 0:r.threshold;if(n.length&&!n.includes(c))return;const{all_annots:u}=e.properties;if(u&&!(null===(a=this.legendItems.at(-1))||void 0===a?void 0:a.disabled)){var h;const e=R(u,this.time),t=null==e||null===(h=e[0])||void 0===h?void 0:h.newState,n=Object.keys(b).find((e=>null==t?void 0:t.startsWith(e)));if(n){const e=b[n];i[e]=i[e]?{count:i[e].count+1,label:n}:{count:1,label:n},s+=1}else o+=1}else o+=1;t[l]=t[l]?{count:t[l].count+1,label:t[l].label}:{count:1,label:c}})),e.properties.colorCounts=t,e.properties.annotStateCounts=i,o>1)return{url:rS(oS({colorCounts:t,annotStateCounts:i,allTotal:o,allStTotal:s})),width:128,height:128}}return{url:rS('<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1">  \n</svg>'),width:1,height:1,id:"blank"}},iconSizeScale:1,getSize:e=>{var t;const n=this.selectedIp===(null===(t=e.properties)||void 0===t?void 0:t.locName),{cluster:i,threshold:r}=e.properties;if(i)return 45;{const{iconSize:e}=r;return e?n?1.5*e:e:30}},iconSizeUnits:"pixels",parameters:{depthTest:!1},extensions:[new xS({filterSize:1})],pickable:this.pickable,autoHighlight:!1}))}constructor(e){var t,n;super(e),wS(this,"selectedIp",void 0),wS(this,"pickable",void 0),wS(this,"getisShowPoints",void 0),wS(this,"getSelectedFeIndexes",void 0),wS(this,"time",void 0),wS(this,"cluster_id",void 0),wS(this,"id",void 0),wS(this,"legendItems",void 0),this.onHover=t=>{var n,i;return t.object?(t.object.properties.cluster_id!==(null===(i=e.hoverCluster)||void 0===i||null===(n=i.object)||void 0===n?void 0:n.cluster_id)&&e.setHoverCluster(t),e.setClosedHint(!1),e.setHoverInfo(t),!0):(e.setHoverInfo({}),!1)},this.cluster_id=null===(n=e.hoverCluster)||void 0===n||null===(t=n.object)||void 0===t?void 0:t.cluster_id,this.id=e.id,this.selectedIp=e.getSelectedIp,this.pickable=e.pickable,this.legendItems=e.legendItems,this.time=e.time}}function SS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const TS=e=>{var{children:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["children"]);return o().createElement("label",{style:{marginRight:"1em",marginTop:"0.5em"}},o().createElement(Pl.Checkbox,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){SS(e,t,n[t])}))}return e}({style:{padding:0}},n)),t)};var CS=d(6089);const AS=e=>({checkBoxes:CS.css`
      color: ${e.colors.text}; 
      display: inline-block;      
      //font-Size: 12;
      //font-Style: italic;
      //padding-left: 5px;
       pointer-events: all;
      //margin: 1em 0em;
      //marginLeft: 1em;    
    `}),PS=Vl((()=>{const e=(0,Pl.useStyles2)(AS),{pointStore:t,lineStore:n,replaceVariables:i}=Pk(),{toggleShowSVG:s,toggleShowPoints:a,getisShowSVG:l,setMode:c,getisShowPoints:u,getisOffset:h,toggleOffset:d,setSelectedIp:p,setTooltipObject:f}=t,{getDirection:g,setDirection:m}=n,{isShowLines:_,toggleShowLines:y}=Pk().lineStore,[v,b]=(0,r.useState)(!1),[x,w]=(0,r.useState)(!1);return["target","source"].includes(i("$locRole")),o().createElement(o().Fragment,null,o().createElement("div",{className:e.checkBoxes},o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,null,o().createElement(TS,{disabled:v,checked:u,title:"nodes",onChange:()=>{a(!u)}},"nodes")),o().createElement(Pl.InlineField,null,o().createElement(TS,{checked:_,title:"edges",onChange:()=>{y(!_)}},"edges")),o().createElement(Pl.InlineField,null,o().createElement(TS,{checked:l,title:"svg",onChange:()=>{s(!l)}},"svg")),o().createElement(Pl.InlineField,null,o().createElement(TS,{checked:!h,title:"stat2 no offset",onChange:()=>{c("view"),d(!h)}},"stat2")))))}));var IS=d(8531);function MS(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const RS={},kS="public/gazetteer/countries.json";function OS(e){return(t=function*(){e||(e=kS);let t=RS[e];if(!t){try{const n=yield(0,IS.getBackendSrv)().get(e);t=function(e,t){if(Array.isArray(t)){const n=t[0];if(n.latitude&&n.longitude&&(n.key||n.keys))return function(e,t){let n=0;const i=new Map;for(const e of t){const t={coords:[e.longitude,e.latitude]};if(e.name&&(i.set(e.name,t),i.set(e.name.toUpperCase(),t),t.props={name:e.name}),e.key&&(i.set(e.key,t),i.set(e.key.toUpperCase(),t)),e.keys)for(const n of e.keys)i.set(n,t),i.set(n.toUpperCase(),t);n++}return{path:e,find:e=>{let t=i.get(e);return t||(t=i.get(e.toUpperCase())),t},count:n,examples:e=>{const t=[];if(i.size<1)t.push("no values found");else for(const n of i.keys())if(t.push(n),t.length>=e)break;return t}}}(e,t)}return{path:e,error:"Unable to parse locations",find:e=>{},examples:e=>[]}}(e,n)}catch(n){console.warn("Error loading placename lookup",e,n),t={path:e,error:"Error loading URL",find:e=>{},examples:e=>[]}}RS[e]=t}return t},function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){MS(o,i,r,s,a,"next",e)}function a(e){MS(o,i,r,s,a,"throw",e)}s(void 0)}))})();var t}function LS(e){if(!(null==e?void 0:e.length))return;const t=[16,8,4,2,1];let n=!0;const i=[],r=[];let o;i[0]=-90,i[1]=90,r[0]=-180,r[1]=180,e.split("").forEach((e=>{o="0123456789bcdefghjkmnpqrstuvwxyz".indexOf(e),t.forEach((e=>{(function(e,t,n){t&n?e[0]=(e[0]+e[1])/2:e[1]=(e[0]+e[1])/2})(n?r:i,o,e),n=!n}))}));const s=(i[0]+i[1])/2;return[(r[0]+r[1])/2,s]}function DS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const FS=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){DS(e,t,n[t])}))}return e}({},function(e){return e.Geojson="geojson",e.Auto="auto",e.Geohash="geohash",e.Coords="coords",e.Lookup="lookup",e}({}));function NS(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function BS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zS(e){return t=>{for(const n of t.fields)if(e(n,t,[]))return n}}function jS(t){return n=>{for(const i of n.fields){if(t.has(i.name.toLowerCase()))return i;const r=(0,e.getFieldDisplayName)(i,n);if(t.has(r))return i}}}const US={mode:FS.Auto,geojson:jS(new Set(["location","geojson"])),geohash:jS(new Set(["geohash"])),latitude:jS(new Set(["latitude","lat"])),longitude:jS(new Set(["longitude","lon","lng"])),h3:jS(new Set(["h3"])),wkt:jS(new Set(["wkt"])),lookup:jS(new Set(["lookup"]))};function VS(t){return(n=function*(){var n;const i=(r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){BS(e,t,n[t])}))}return e}({},US),o=null!=(o={mode:null!==(n=null==t?void 0:t.mode)&&void 0!==n?n:FS.Auto})?o:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(o)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})),r);var r,o;switch(i.mode){case FS.Geohash:(null==t?void 0:t.geohash)&&(i.geohash=zS((0,e.getFieldMatcher)({id:e.FieldMatcherID.byName,options:t.geohash})));break;case FS.Lookup:(null==t?void 0:t.lookup)&&(i.lookup=zS((0,e.getFieldMatcher)({id:e.FieldMatcherID.byName,options:t.lookup}))),i.gazetteer=yield OS(null==t?void 0:t.gazetteer);break;case FS.Coords:(null==t?void 0:t.latitude)&&(i.latitude=zS((0,e.getFieldMatcher)({id:e.FieldMatcherID.byName,options:t.latitude}))),(null==t?void 0:t.longitude)&&(i.longitude=zS((0,e.getFieldMatcher)({id:e.FieldMatcherID.byName,options:t.longitude})));break;case FS.Geojson:(null==t?void 0:t.geojson)&&(i.geojson=zS((0,e.getFieldMatcher)({id:e.FieldMatcherID.byName,options:t.geojson})))}return i},function(){var e=this,t=arguments;return new Promise((function(i,r){var o=n.apply(e,t);function s(e){NS(o,i,r,s,a,"next",e)}function a(e){NS(o,i,r,s,a,"throw",e)}s(void 0)}))})();var n}function $S(e,t){const n={points:[]};if(!(null==e?void 0:e.length))return n;const i=function(e,t){var n;const i={mode:null!==(n=t.mode)&&void 0!==n?n:FS.Auto};if(i.mode===FS.Auto){if(i.geojson=t.geojson(e),i.geojson)return i.mode=FS.Geojson,i;if(i.latitude=t.latitude(e),i.longitude=t.longitude(e),i.latitude&&i.longitude)return i.mode=FS.Coords,i;if(i.geohash=t.geohash(e),i.geohash)return i.mode=FS.Geohash,i;if(i.lookup=t.geohash(e),i.lookup)return i.mode=FS.Lookup,i}switch(i.mode){case FS.Geojson:i.geojson=t.geojson(e);break;case FS.Coords:i.latitude=t.latitude(e),i.longitude=t.longitude(e);break;case FS.Geohash:i.geohash=t.geohash(e);break;case FS.Lookup:i.lookup=t.lookup(e)}return i}(e,t);switch(i.mode){case FS.Geojson:i.geojson?n.points=function(e){const t=e.values.length,n=new Array(t);for(let t=0;t<e.values.length;t++)if(e.values[t]){const i=JSON.parse(e.values[t]);i&&(n[t]={type:i.type,coordinates:i.coordinates})}return n}(i.geojson):n.warning="Missing GeoJson fields";break;case FS.Coords:i.latitude&&i.longitude?n.points=function(e,t){const n=t.values.length,i=new Array(n);for(let r=0;r<n;r++)i[r]={type:"Point",coordinates:[e.values[r],t.values[r]]};return i}(i.longitude,i.latitude):n.warning="Missing latitude/longitude fields";break;case FS.Geohash:i.geohash?n.points=function(e){const t=e.values.length,n=new Array(t);for(let i=0;i<t;i++){const t=LS(e.values[i]);t&&(n[i]={type:"Point",coordinates:t})}return n}(i.geohash):n.warning="Missing geohash field";break;case FS.Lookup:i.lookup?t.gazetteer?n.points=function(e,t){const n=t.values.length,i=new Array(n);for(let r=0;r<n;r++){const n=e.find(t.values[r]);(null==n?void 0:n.coords)&&(i[r]={type:"Point",coordinates:null==n?void 0:n.coords})}return i}(t.gazetteer,i.lookup):n.warning="Gazetteer not found":n.warning="Missing lookup field";break;case FS.Auto:n.warning="Unable to find location fields"}return n}var GS=d(3241),WS=d.n(GS);function HS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ZS extends r.PureComponent{componentDidMount(){this.setState({text:isNaN(this.props.value)?"":`${this.props.value}`})}componentDidUpdate(e){if(this.props.value!==e.value){const e=isNaN(this.props.value)?"":`${this.props.value}`;e!==this.state.text&&this.setState({text:e})}}renderInput(){return o().createElement(Pl.Input,{type:"number",ref:this.inputRef,min:this.props.min,max:this.props.max,step:this.props.step,autoFocus:this.props.autoFocus,value:this.state.text,onChange:this.onChange,onBlur:this.updateValue,onKeyPress:this.onKeyPress,placeholder:this.props.placeholder,disabled:this.props.fieldDisabled,width:this.props.width,suffix:this.props.suffix})}render(){const{inputCorrected:e}=this.state;if(e){let t="",{min:n,max:i}=this.props;return null==i?null!=n&&(t=`< ${n}`):t=null!=n?`${n} < > ${i}`:`> ${i}`,o().createElement(Pl.Field,{invalid:e,error:`Out of range ${t}`,validationMessageHorizontalOverflow:!0,style:{direction:"rtl"}},this.renderInput())}return this.renderInput()}constructor(...e){super(...e),HS(this,"state",{text:"",inputCorrected:!1}),HS(this,"inputRef",o().createRef()),HS(this,"updateValue",(()=>{var e;const t=null===(e=this.inputRef.current)||void 0===e?void 0:e.value;let n=!1,i="";const r=this.props.min,o=this.props.max;let s=""!==t?Number(t):void 0;s&&!Number.isNaN(s)&&(null!=r&&s<r?(i=r.toString(),n=!0):null!=o&&s>o?(i=o.toString(),n=!0):i=null!=t?t:"",this.setState({text:i,inputCorrected:n})),n&&this.updateValueDebounced(),Number.isNaN(s)||s===this.props.value||this.props.onChange(s)})),HS(this,"updateValueDebounced",(0,GS.debounce)(this.updateValue,500)),HS(this,"onChange",(e=>{this.setState({text:e.currentTarget.value}),this.updateValueDebounced()})),HS(this,"onKeyPress",(e=>{"Enter"===e.key&&this.updateValue()}))}}const qS=({value:e,onChange:t,item:n})=>{const{settings:i}=n,s=(0,r.useCallback)((e=>{t((null==i?void 0:i.integer)&&void 0!==e?Math.floor(e):e)}),[t,null==i?void 0:i.integer]);return o().createElement(ZS,{value:e,min:null==i?void 0:i.min,max:null==i?void 0:i.max,step:null==i?void 0:i.step,placeholder:null==i?void 0:i.placeholder,onChange:s})};var XS=d(9089);function YS(e){return YS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},YS(e)}function KS(e,t,n){return(t=function(e){var t=function(e){if("object"!=YS(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=YS(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==YS(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function QS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JS(Object(n),!0).forEach((function(t){KS(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function eT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function tT(e,t){if(e){if("string"==typeof e)return eT(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?eT(e,t):void 0}}function nT(e){return function(e){if(Array.isArray(e))return eT(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||tT(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iT(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||tT(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var rT=d(4452),oT=d.n(rT);function sT(e){var t=r.useRef();t.current=e;var n=r.useCallback((function(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(i))}),[]);return n}var aT="undefined"!=typeof window&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,lT=function(e,t){var n=r.useRef(!0);aT((function(){return e(n.current)}),t),aT((function(){return n.current=!1,function(){n.current=!0}}),[])},cT=function(e,t){lT((function(t){if(!t)return e()}),t)};const uT=lT;function hT(e){var t=r.useRef(!1),n=iT(r.useState(e),2),i=n[0],o=n[1];return r.useEffect((function(){return t.current=!1,function(){t.current=!0}}),[]),[i,function(e,n){n&&t.current||o(e)}]}function dT(e){return void 0!==e}var pT={},fT=[];function gT(e,t){}function mT(e,t){}function _T(e,t,n){t||pT[n]||(e(!1,n),pT[n]=!0)}function yT(e,t){_T(gT,e,t)}yT.preMessage=function(e){fT.push(e)},yT.resetWarned=function(){pT={}},yT.noteOnce=function(e,t){_T(mT,e,t)};const vT=yT;function bT(){return bT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},bT.apply(null,arguments)}function xT(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}function wT(e,t){if(null==e)return{};var n,i,r=xT(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ET(e,t,n){return(e-t)/(n-t)}function ST(e,t,n,i){var r=ET(t,n,i),o={};switch(e){case"rtl":o.right="".concat(100*r,"%"),o.transform="translateX(50%)";break;case"btt":o.bottom="".concat(100*r,"%"),o.transform="translateY(50%)";break;case"ttb":o.top="".concat(100*r,"%"),o.transform="translateY(-50%)";break;default:o.left="".concat(100*r,"%"),o.transform="translateX(-50%)"}return o}function TT(e,t){return Array.isArray(e)?e[t]:e}var CT={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var t=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=CT.F1&&t<=CT.F12)return!1;switch(t){case CT.ALT:case CT.CAPS_LOCK:case CT.CONTEXT_MENU:case CT.CTRL:case CT.DOWN:case CT.END:case CT.ESC:case CT.HOME:case CT.INSERT:case CT.LEFT:case CT.MAC_FF_META:case CT.META:case CT.NUMLOCK:case CT.NUM_CENTER:case CT.PAGE_DOWN:case CT.PAGE_UP:case CT.PAUSE:case CT.PRINT_SCREEN:case CT.RIGHT:case CT.SHIFT:case CT.UP:case CT.WIN_KEY:case CT.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=CT.ZERO&&e<=CT.NINE)return!0;if(e>=CT.NUM_ZERO&&e<=CT.NUM_MULTIPLY)return!0;if(e>=CT.A&&e<=CT.Z)return!0;if(-1!==window.navigator.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case CT.SPACE:case CT.QUESTION_MARK:case CT.NUM_PLUS:case CT.NUM_MINUS:case CT.NUM_PERIOD:case CT.NUM_DIVISION:case CT.SEMICOLON:case CT.DASH:case CT.EQUALS:case CT.COMMA:case CT.PERIOD:case CT.SLASH:case CT.APOSTROPHE:case CT.SINGLE_QUOTE:case CT.OPEN_SQUARE_BRACKET:case CT.BACKSLASH:case CT.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}};const AT=CT,PT=r.createContext({min:0,max:0,direction:"ltr",step:1,includedStart:0,includedEnd:0,tabIndex:0,keyboard:!0,styles:{},classNames:{}});var IT=r.createContext({}),MT=["prefixCls","value","valueIndex","onStartMove","onDelete","style","render","dragging","draggingDelete","onOffsetChange","onChangeComplete","onFocus","onMouseEnter"],RT=r.forwardRef((function(e,t){var n,i=e.prefixCls,o=e.value,s=e.valueIndex,a=e.onStartMove,l=e.onDelete,c=e.style,u=e.render,h=e.dragging,d=e.draggingDelete,p=e.onOffsetChange,f=e.onChangeComplete,g=e.onFocus,m=e.onMouseEnter,_=wT(e,MT),y=r.useContext(PT),v=y.min,b=y.max,x=y.direction,w=y.disabled,E=y.keyboard,S=y.range,T=y.tabIndex,C=y.ariaLabelForHandle,A=y.ariaLabelledByForHandle,P=y.ariaRequired,I=y.ariaValueTextFormatterForHandle,M=y.styles,R=y.classNames,k="".concat(i,"-handle"),O=function(e){w||a(e,s)},L=ST(x,o,v,b),D={};null!==s&&(D={tabIndex:w?null:TT(T,s),role:"slider","aria-valuemin":v,"aria-valuemax":b,"aria-valuenow":o,"aria-disabled":w,"aria-label":TT(C,s),"aria-labelledby":TT(A,s),"aria-required":TT(P,s),"aria-valuetext":null===(n=TT(I,s))||void 0===n?void 0:n(o),"aria-orientation":"ltr"===x||"rtl"===x?"horizontal":"vertical",onMouseDown:O,onTouchStart:O,onFocus:function(e){null==g||g(e,s)},onMouseEnter:function(e){m(e,s)},onKeyDown:function(e){if(!w&&E){var t=null;switch(e.which||e.keyCode){case AT.LEFT:t="ltr"===x||"btt"===x?-1:1;break;case AT.RIGHT:t="ltr"===x||"btt"===x?1:-1;break;case AT.UP:t="ttb"!==x?1:-1;break;case AT.DOWN:t="ttb"!==x?-1:1;break;case AT.HOME:t="min";break;case AT.END:t="max";break;case AT.PAGE_UP:t=2;break;case AT.PAGE_DOWN:t=-2;break;case AT.BACKSPACE:case AT.DELETE:l(s)}null!==t&&(e.preventDefault(),p(t,s))}},onKeyUp:function(e){switch(e.which||e.keyCode){case AT.LEFT:case AT.RIGHT:case AT.UP:case AT.DOWN:case AT.HOME:case AT.END:case AT.PAGE_UP:case AT.PAGE_DOWN:null==f||f()}}});var F=r.createElement("div",bT({ref:t,className:oT()(k,KS(KS(KS({},"".concat(k,"-").concat(s+1),null!==s&&S),"".concat(k,"-dragging"),h),"".concat(k,"-dragging-delete"),d),R.handle),style:QS(QS(QS({},L),c),M.handle)},D,_));return u&&(F=u(F,{index:s,prefixCls:i,value:o,dragging:h,draggingDelete:d})),F}));const kT=RT;var OT=["prefixCls","style","onStartMove","onOffsetChange","values","handleRender","activeHandleRender","draggingIndex","draggingDelete","onFocus"],LT=r.forwardRef((function(e,t){var n=e.prefixCls,i=e.style,o=e.onStartMove,s=e.onOffsetChange,a=e.values,l=e.handleRender,c=e.activeHandleRender,u=e.draggingIndex,h=e.draggingDelete,d=e.onFocus,p=wT(e,OT),f=r.useRef({}),g=iT(r.useState(!1),2),m=g[0],_=g[1],y=iT(r.useState(-1),2),v=y[0],b=y[1],x=function(e){b(e),_(!0)};r.useImperativeHandle(t,(function(){return{focus:function(e){var t;null===(t=f.current[e])||void 0===t||t.focus()},hideHelp:function(){(0,Il.flushSync)((function(){_(!1)}))}}}));var w=QS({prefixCls:n,onStartMove:o,onOffsetChange:s,render:l,onFocus:function(e,t){x(t),null==d||d(e)},onMouseEnter:function(e,t){x(t)}},p);return r.createElement(r.Fragment,null,a.map((function(e,t){var n=u===t;return r.createElement(kT,bT({ref:function(e){e?f.current[t]=e:delete f.current[t]},dragging:n,draggingDelete:n&&h,style:TT(i,t),key:t,value:e,valueIndex:t},w))})),c&&m&&r.createElement(kT,bT({key:"a11y"},w,{value:a[v],valueIndex:null,dragging:-1!==u,draggingDelete:h,render:c,style:{pointerEvents:"none"},tabIndex:null,"aria-hidden":!0})))}));const DT=LT,FT=function(e){var t=e.prefixCls,n=e.style,i=e.children,o=e.value,s=e.onClick,a=r.useContext(PT),l=a.min,c=a.max,u=a.direction,h=a.includedStart,d=a.includedEnd,p=a.included,f="".concat(t,"-text"),g=ST(u,o,l,c);return r.createElement("span",{className:oT()(f,KS({},"".concat(f,"-active"),p&&h<=o&&o<=d)),style:QS(QS({},g),n),onMouseDown:function(e){e.stopPropagation()},onClick:function(){s(o)}},i)},NT=function(e){var t=e.prefixCls,n=e.marks,i=e.onClick,o="".concat(t,"-mark");return n.length?r.createElement("div",{className:o},n.map((function(e){var t=e.value,n=e.style,s=e.label;return r.createElement(FT,{key:t,prefixCls:o,style:n,value:t,onClick:i},s)}))):null},BT=function(e){var t=e.prefixCls,n=e.value,i=e.style,o=e.activeStyle,s=r.useContext(PT),a=s.min,l=s.max,c=s.direction,u=s.included,h=s.includedStart,d=s.includedEnd,p="".concat(t,"-dot"),f=u&&h<=n&&n<=d,g=QS(QS({},ST(c,n,a,l)),"function"==typeof i?i(n):i);return f&&(g=QS(QS({},g),"function"==typeof o?o(n):o)),r.createElement("span",{className:oT()(p,KS({},"".concat(p,"-active"),f)),style:g})},zT=function(e){var t=e.prefixCls,n=e.marks,i=e.dots,o=e.style,s=e.activeStyle,a=r.useContext(PT),l=a.min,c=a.max,u=a.step,h=r.useMemo((function(){var e=new Set;if(n.forEach((function(t){e.add(t.value)})),i&&null!==u)for(var t=l;t<=c;)e.add(t),t+=u;return Array.from(e)}),[l,c,u,i,n]);return r.createElement("div",{className:"".concat(t,"-step")},h.map((function(e){return r.createElement(BT,{prefixCls:t,key:e,value:e,style:o,activeStyle:s})})))},jT=function(e){var t=e.prefixCls,n=e.style,i=e.start,o=e.end,s=e.index,a=e.onStartMove,l=e.replaceCls,c=r.useContext(PT),u=c.direction,h=c.min,d=c.max,p=c.disabled,f=c.range,g=c.classNames,m="".concat(t,"-track"),_=ET(i,h,d),y=ET(o,h,d),v=function(e){!p&&a&&a(e,-1)},b={};switch(u){case"rtl":b.right="".concat(100*_,"%"),b.width="".concat(100*y-100*_,"%");break;case"btt":b.bottom="".concat(100*_,"%"),b.height="".concat(100*y-100*_,"%");break;case"ttb":b.top="".concat(100*_,"%"),b.height="".concat(100*y-100*_,"%");break;default:b.left="".concat(100*_,"%"),b.width="".concat(100*y-100*_,"%")}var x=l||oT()(m,KS(KS({},"".concat(m,"-").concat(s+1),null!==s&&f),"".concat(t,"-track-draggable"),a),g.track);return r.createElement("div",{className:x,style:QS(QS({},b),n),onMouseDown:v,onTouchStart:v})},UT=function(e){var t=e.prefixCls,n=e.style,i=e.values,o=e.startPoint,s=e.onStartMove,a=r.useContext(PT),l=a.included,c=a.range,u=a.min,h=a.styles,d=a.classNames,p=r.useMemo((function(){if(!c){if(0===i.length)return[];var e=null!=o?o:u,t=i[0];return[{start:Math.min(e,t),end:Math.max(e,t)}]}for(var n=[],r=0;r<i.length-1;r+=1)n.push({start:i[r],end:i[r+1]});return n}),[i,c,o,u]);if(!l)return null;var f=null!=p&&p.length&&(d.tracks||h.tracks)?r.createElement(jT,{index:null,prefixCls:t,start:p[0].start,end:p[p.length-1].end,replaceCls:oT()(d.tracks,"".concat(t,"-tracks")),style:h.tracks}):null;return r.createElement(r.Fragment,null,f,p.map((function(e,i){var o=e.start,a=e.end;return r.createElement(jT,{index:i,prefixCls:t,style:QS(QS({},TT(n,i)),h.track),start:o,end:a,key:i,onStartMove:s})})))};function VT(e){var t="targetTouches"in e?e.targetTouches[0]:e;return{pageX:t.pageX,pageY:t.pageY}}var $T=r.forwardRef((function(e,t){var n=e.prefixCls,i=void 0===n?"rc-slider":n,o=e.className,s=e.style,a=e.classNames,l=e.styles,c=e.id,u=e.disabled,h=void 0!==u&&u,d=e.keyboard,p=void 0===d||d,f=e.autoFocus,g=e.onFocus,m=e.onBlur,_=e.min,y=void 0===_?0:_,v=e.max,b=void 0===v?100:v,x=e.step,w=void 0===x?1:x,E=e.value,S=e.defaultValue,T=e.range,C=e.count,A=e.onChange,P=e.onBeforeChange,I=e.onAfterChange,M=e.onChangeComplete,R=e.allowCross,k=void 0===R||R,O=e.pushable,L=void 0!==O&&O,D=e.reverse,F=e.vertical,N=e.included,B=void 0===N||N,z=e.startPoint,j=e.trackStyle,U=e.handleStyle,V=e.railStyle,$=e.dotStyle,G=e.activeDotStyle,W=e.marks,H=e.dots,Z=e.handleRender,q=e.activeHandleRender,X=e.track,Y=e.tabIndex,K=void 0===Y?0:Y,J=e.ariaLabelForHandle,Q=e.ariaLabelledByForHandle,ee=e.ariaRequired,te=e.ariaValueTextFormatterForHandle,ne=r.useRef(null),ie=r.useRef(null),re=r.useMemo((function(){return F?D?"ttb":"btt":D?"rtl":"ltr"}),[D,F]),oe=function(e){return(0,r.useMemo)((function(){if(!0===e||!e)return[!!e,!1,!1,0];var t=e.editable,n=e.draggableTrack;return[!0,t,!t&&n,e.minCount||0,e.maxCount]}),[e])}(T),se=iT(oe,5),ae=se[0],le=se[1],ce=se[2],ue=se[3],he=se[4],de=r.useMemo((function(){return isFinite(y)?y:0}),[y]),pe=r.useMemo((function(){return isFinite(b)?b:100}),[b]),fe=r.useMemo((function(){return null!==w&&w<=0?1:w}),[w]),ge=r.useMemo((function(){return"boolean"==typeof L?!!L&&fe:L>=0&&L}),[L,fe]),me=r.useMemo((function(){return Object.keys(W||{}).map((function(e){var t=W[e],n={value:Number(e)};return t&&"object"===YS(t)&&!r.isValidElement(t)&&("label"in t||"style"in t)?(n.style=t.style,n.label=t.label):n.label=t,n})).filter((function(e){var t=e.label;return t||"number"==typeof t})).sort((function(e,t){return e.value-t.value}))}),[W]),_e=function(e,t,n,i,o,s){var a=r.useCallback((function(n){return Math.max(e,Math.min(t,n))}),[e,t]),l=r.useCallback((function(i){if(null!==n){var r=e+Math.round((a(i)-e)/n)*n,o=function(e){return(String(e).split(".")[1]||"").length},s=Math.max(o(n),o(t),o(e)),l=Number(r.toFixed(s));return e<=l&&l<=t?l:null}return null}),[n,e,t,a]),c=r.useCallback((function(r){var o=a(r),s=i.map((function(e){return e.value}));null!==n&&s.push(l(r)),s.push(e,t);var c=s[0],u=t-e;return s.forEach((function(e){var t=Math.abs(o-e);t<=u&&(c=e,u=t)})),c}),[e,t,i,n,a,l]),u=function r(o,s,a){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit";if("number"==typeof s){var u,h=o[a],d=h+s,p=[];i.forEach((function(e){p.push(e.value)})),p.push(e,t),p.push(l(h));var f=s>0?1:-1;"unit"===c?p.push(l(h+f*n)):p.push(l(d)),p=p.filter((function(e){return null!==e})).filter((function(e){return s<0?e<=h:e>=h})),"unit"===c&&(p=p.filter((function(e){return e!==h})));var g="unit"===c?h:d;u=p[0];var m=Math.abs(u-g);if(p.forEach((function(e){var t=Math.abs(e-g);t<m&&(u=e,m=t)})),void 0===u)return s<0?e:t;if("dist"===c)return u;if(Math.abs(s)>1){var _=nT(o);return _[a]=u,r(_,s-f,a,c)}return u}return"min"===s?e:"max"===s?t:void 0},h=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit",r=e[n],o=u(e,t,n,i);return{value:o,changed:o!==r}},d=function(e){return null===s&&0===e||"number"==typeof s&&e<s};return[c,function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit",r=e.map(c),a=r[n],l=u(r,t,n,i);if(r[n]=l,!1===o){var p=s||0;n>0&&r[n-1]!==a&&(r[n]=Math.max(r[n],r[n-1]+p)),n<r.length-1&&r[n+1]!==a&&(r[n]=Math.min(r[n],r[n+1]-p))}else if("number"==typeof s||null===s){for(var f=n+1;f<r.length;f+=1)for(var g=!0;d(r[f]-r[f-1])&&g;){var m=h(r,1,f);r[f]=m.value,g=m.changed}for(var _=n;_>0;_-=1)for(var y=!0;d(r[_]-r[_-1])&&y;){var v=h(r,-1,_-1);r[_-1]=v.value,y=v.changed}for(var b=r.length-1;b>0;b-=1)for(var x=!0;d(r[b]-r[b-1])&&x;){var w=h(r,-1,b-1);r[b-1]=w.value,x=w.changed}for(var E=0;E<r.length-1;E+=1)for(var S=!0;d(r[E+1]-r[E])&&S;){var T=h(r,1,E+1);r[E+1]=T.value,S=T.changed}}return{value:r[n],values:r}}]}(de,pe,fe,me,k,ge),ye=iT(_e,2),ve=ye[0],be=ye[1],xe=function(e,t){var n=t||{},i=n.defaultValue,r=n.value,o=n.onChange,s=n.postState,a=iT(hT((function(){return dT(r)?r:dT(i)?"function"==typeof i?i():i:"function"==typeof e?e():e})),2),l=a[0],c=a[1],u=void 0!==r?r:l,h=s?s(u):u,d=sT(o),p=iT(hT([u]),2),f=p[0],g=p[1];return cT((function(){var e=f[0];l!==e&&d(l,e)}),[f]),cT((function(){dT(r)||c(r)}),[r]),[h,sT((function(e,t){c(e,t),g([u],t)}))]}(S,{value:E}),we=iT(xe,2),Ee=we[0],Se=we[1],Te=r.useMemo((function(){var e=null==Ee?[]:Array.isArray(Ee)?Ee:[Ee],t=iT(e,1)[0],n=null===Ee?[]:[void 0===t?de:t];if(ae){if(n=nT(e),C||void 0===Ee){var i=C>=0?C+1:2;for(n=n.slice(0,i);n.length<i;){var r;n.push(null!==(r=n[n.length-1])&&void 0!==r?r:de)}}n.sort((function(e,t){return e-t}))}return n.forEach((function(e,t){n[t]=ve(e)})),n}),[Ee,ae,de,C,ve]),Ce=function(e){return ae?e:e[0]},Ae=sT((function(e){var t=nT(e).sort((function(e,t){return e-t}));A&&!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Set;return function e(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=i.has(t);if(vT(!s,"Warning: There may be circular references"),s)return!1;if(t===r)return!0;if(n&&o>1)return!1;i.add(t);var a=o+1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var l=0;l<t.length;l++)if(!e(t[l],r[l],a))return!1;return!0}if(t&&r&&"object"===YS(t)&&"object"===YS(r)){var c=Object.keys(t);return c.length===Object.keys(r).length&&c.every((function(n){return e(t[n],r[n],a)}))}return!1}(e,t)}(t,Te,!0)&&A(Ce(t)),Se(t)})),Pe=sT((function(e){e&&ne.current.hideHelp();var t=Ce(Te);null==I||I(t),vT(!I,"[rc-slider] `onAfterChange` is deprecated. Please use `onChangeComplete` instead."),null==M||M(t)})),Ie=iT(function(e,t,n,i,o,s,a,l,c,u,h){var d=iT(r.useState(null),2),p=d[0],f=d[1],g=iT(r.useState(-1),2),m=g[0],_=g[1],y=iT(r.useState(!1),2),v=y[0],b=y[1],x=iT(r.useState(n),2),w=x[0],E=x[1],S=iT(r.useState(n),2),T=S[0],C=S[1],A=r.useRef(null),P=r.useRef(null),I=r.useRef(null),M=r.useContext(IT),R=M.onDragStart,k=M.onDragChange;uT((function(){-1===m&&E(n)}),[n,m]),r.useEffect((function(){return function(){document.removeEventListener("mousemove",A.current),document.removeEventListener("mouseup",P.current),I.current&&(I.current.removeEventListener("touchmove",A.current),I.current.removeEventListener("touchend",P.current))}}),[]);var O=function(e,t,n){void 0!==t&&f(t),E(e);var i=e;n&&(i=e.filter((function(e,t){return t!==m}))),a(i),k&&k({rawValues:e,deleteIndex:n?m:-1,draggingIndex:m,draggingValue:t})},L=sT((function(e,t,n){if(-1===e){var r=T[0],a=T[T.length-1],l=i-r,u=o-a,h=t*(o-i);h=Math.max(h,l),h=Math.min(h,u);var d=s(r+h);h=d-r;var p=T.map((function(e){return e+h}));O(p)}else{var f=(o-i)*t,g=nT(w);g[e]=T[e];var m=c(g,f,e,"dist");O(m.values,m.value,n)}})),D=r.useMemo((function(){var e=nT(n).sort((function(e,t){return e-t})),t=nT(w).sort((function(e,t){return e-t})),i={};t.forEach((function(e){i[e]=(i[e]||0)+1})),e.forEach((function(e){i[e]=(i[e]||0)-1}));var r=u?1:0;return Object.values(i).reduce((function(e,t){return e+Math.abs(t)}),0)<=r?w:n}),[n,w,u]);return[m,p,v,D,function(i,r,o){i.stopPropagation();var s=o||n,a=s[r];_(r),f(a),C(s),E(s),b(!1);var c=VT(i),d=c.pageX,p=c.pageY,g=!1;R&&R({rawValues:s,draggingIndex:r,draggingValue:a});var m=function(n){n.preventDefault();var i,o,s=VT(n),a=s.pageX,l=s.pageY,c=a-d,f=l-p,m=e.current.getBoundingClientRect(),_=m.width,y=m.height;switch(t){case"btt":i=-f/y,o=c;break;case"ttb":i=f/y,o=c;break;case"rtl":i=-c/_,o=f;break;default:i=c/_,o=f}g=!!u&&Math.abs(o)>130&&h<w.length,b(g),L(r,i,g)},y=function e(t){t.preventDefault(),document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",m),I.current&&(I.current.removeEventListener("touchmove",A.current),I.current.removeEventListener("touchend",P.current)),A.current=null,P.current=null,I.current=null,l(g),_(-1),b(!1)};document.addEventListener("mouseup",y),document.addEventListener("mousemove",m),i.currentTarget.addEventListener("touchend",y),i.currentTarget.addEventListener("touchmove",m),A.current=m,P.current=y,I.current=i.currentTarget}]}(ie,re,Te,de,pe,ve,Ae,Pe,be,le,ue),5),Me=Ie[0],Re=Ie[1],ke=Ie[2],Oe=Ie[3],Le=Ie[4],De=function(e,t){if(!h){var n=nT(Te),i=0,r=0,o=pe-de;Te.forEach((function(t,n){var s=Math.abs(e-t);s<=o&&(o=s,i=n),t<e&&(r=n)}));var s=i;le&&0!==o&&(!he||Te.length<he)?(n.splice(r+1,0,e),s=r+1):n[i]=e,ae&&!Te.length&&void 0===C&&n.push(e);var a,l,c=Ce(n);null==P||P(c),Ae(n),t?(null===(a=document.activeElement)||void 0===a||null===(l=a.blur)||void 0===l||l.call(a),ne.current.focus(s),Le(t,s,n)):(null==I||I(c),vT(!I,"[rc-slider] `onAfterChange` is deprecated. Please use `onChangeComplete` instead."),null==M||M(c))}},Fe=iT(r.useState(null),2),Ne=Fe[0],Be=Fe[1];r.useEffect((function(){if(null!==Ne){var e=Te.indexOf(Ne);e>=0&&ne.current.focus(e)}Be(null)}),[Ne]);var ze=r.useMemo((function(){return(!ce||null!==fe)&&ce}),[ce,fe]),je=sT((function(e,t){Le(e,t),null==P||P(Ce(Te))})),Ue=-1!==Me;r.useEffect((function(){if(!Ue){var e=Te.lastIndexOf(Re);ne.current.focus(e)}}),[Ue]);var Ve=r.useMemo((function(){return nT(Oe).sort((function(e,t){return e-t}))}),[Oe]),$e=iT(r.useMemo((function(){return ae?[Ve[0],Ve[Ve.length-1]]:[de,Ve[0]]}),[Ve,ae,de]),2),Ge=$e[0],We=$e[1];r.useImperativeHandle(t,(function(){return{focus:function(){ne.current.focus(0)},blur:function(){var e,t=document.activeElement;null!==(e=ie.current)&&void 0!==e&&e.contains(t)&&(null==t||t.blur())}}})),r.useEffect((function(){f&&ne.current.focus(0)}),[]);var He=r.useMemo((function(){return{min:de,max:pe,direction:re,disabled:h,keyboard:p,step:fe,included:B,includedStart:Ge,includedEnd:We,range:ae,tabIndex:K,ariaLabelForHandle:J,ariaLabelledByForHandle:Q,ariaRequired:ee,ariaValueTextFormatterForHandle:te,styles:l||{},classNames:a||{}}}),[de,pe,re,h,p,fe,B,Ge,We,ae,K,J,Q,ee,te,l,a]);return r.createElement(PT.Provider,{value:He},r.createElement("div",{ref:ie,className:oT()(i,o,KS(KS(KS(KS({},"".concat(i,"-disabled"),h),"".concat(i,"-vertical"),F),"".concat(i,"-horizontal"),!F),"".concat(i,"-with-marks"),me.length)),style:s,onMouseDown:function(e){e.preventDefault();var t,n=ie.current.getBoundingClientRect(),i=n.width,r=n.height,o=n.left,s=n.top,a=n.bottom,l=n.right,c=e.clientX,u=e.clientY;switch(re){case"btt":t=(a-u)/r;break;case"ttb":t=(u-s)/r;break;case"rtl":t=(l-c)/i;break;default:t=(c-o)/i}De(ve(de+t*(pe-de)),e)},id:c},r.createElement("div",{className:oT()("".concat(i,"-rail"),null==a?void 0:a.rail),style:QS(QS({},V),null==l?void 0:l.rail)}),!1!==X&&r.createElement(UT,{prefixCls:i,style:j,values:Te,startPoint:z,onStartMove:ze?je:void 0}),r.createElement(zT,{prefixCls:i,marks:me,dots:H,style:$,activeStyle:G}),r.createElement(DT,{ref:ne,prefixCls:i,style:U,values:Oe,draggingIndex:Me,draggingDelete:ke,onStartMove:je,onOffsetChange:function(e,t){if(!h){var n=be(Te,e,t);null==P||P(Ce(Te)),Ae(n.values),Be(n.value)}},onFocus:g,onBlur:m,handleRender:Z,activeHandleRender:q,onChangeComplete:Pe,onDelete:le?function(e){if(!(h||!le||Te.length<=ue)){var t=nT(Te);t.splice(e,1),null==P||P(Ce(t)),Ae(t);var n=Math.max(0,e-1);ne.current.hideHelp(),ne.current.focus(n)}}:void 0}),r.createElement(NT,{prefixCls:i,marks:me,onClick:De})))}));const GT=$T,WT=({value:e,onChange:t,item:n})=>{const i=(0,r.useRef)(null),{settings:s}=n,a=(null==s?void 0:s.min)||0,l=(null==s?void 0:s.max)||100,c=null==s?void 0:s.step,u=(null==s?void 0:s.marks)||{[a]:a,[l]:l},h=null==s?void 0:s.included,d=null==s?void 0:s.ariaLabelForHandle,p=(0,Pl.useTheme2)(),[f,g]=(0,r.useState)(null!=e?e:a),[m,_]=(0,r.useState)(75);(0,r.useEffect)((()=>{null!=e&&e!==f&&g(e)}),[e,f]),(0,r.useEffect)((()=>{const e=getComputedStyle(i.current),t=e.getPropertyValue("font-weight")||"normal",n=e.getPropertyValue("font-size")||"16px",r=e.getPropertyValue("font-family")||"Arial",o=Math.max((l+(c||0)).toString().length,(l-(c||0)).toString().length)+4,s=function(e,t){const n=document.createElement("canvas").getContext("2d");return n?(n.font=t,n.measureText(e).width):null}("0".repeat(o),`${t} ${n} ${r}`);s&&_(s+16)}),[l,c]);const y=(0,r.useCallback)((e=>{const n="number"==typeof e?e:e[0];g(n),t&&t(n)}),[g,t]),v=(0,r.useCallback)((e=>{let n=e;!Number.isNaN(n)&&n||(n=0),g(n),t&&t(n)}),[t]),b=((e,t,n=!1)=>{const{spacing:i}=e,r=e.colors.border.strong,o=e.colors.primary.main,s=e.colors.primary.main,a=`box-shadow: 0px 0px 0px 6px ${e.colors.primary.transparent}`;return{container:(0,CS.css)({width:"100%",margin:t?"inherit":i(1,3,1,1),paddingBottom:t&&n?e.spacing(1):"inherit",height:t?"auto":"100%"}),slider:CS.css`
      .rc-slider {
        display: flex;
        flex-grow: 1;
        margin-left: 7px; // half the size of the handle to align handle to the left on 0 value
      }
      .rc-slider-mark {
        top: ${e.spacing(1.75)};
      }
      .rc-slider-mark-text {
        color: ${e.colors.text.disabled};
        font-size: ${e.typography.bodySmall.fontSize};
      }
      .rc-slider-mark-text-active {
        color: ${e.colors.text.primary};
      }
      .rc-slider-handle {
        border: none;
        background-color: ${s};
        box-shadow: ${e.shadows.z1};
        cursor: pointer;
        opacity: 1;
      }

      .rc-slider-handle:hover,
      .rc-slider-handle:active,
      .rc-slider-handle-click-focused:focus {
        ${a};
      }

      // The triple class names is needed because that's the specificity used in the source css :(
      .rc-slider-handle-dragging.rc-slider-handle-dragging.rc-slider-handle-dragging,
      .rc-slider-handle:focus-visible {
        box-shadow: 0 0 0 5px ${e.colors.text.primary};
      }

      .rc-slider-dot,
      .rc-slider-dot-active {
        background-color: ${e.colors.text.primary};
        border-color: ${e.colors.text.primary};
      }

      .rc-slider-track {
        background-color: ${o};
      }
      .rc-slider-rail {
        background-color: ${r};
        cursor: pointer;
      }
    `,tooltip:XS.css`
      body {
        .rc-slider-tooltip {
          cursor: grab;
          user-select: none;
          z-index: ${e.zIndex.tooltip};
        }

        .rc-slider-tooltip-inner {
          color: ${e.colors.text.primary};
          background-color: transparent !important;
          border-radius: 0;
          box-shadow: none;
        }

        .rc-slider-tooltip-placement-top .rc-slider-tooltip-arrow {
          display: none;
        }

        .rc-slider-tooltip-placement-top {
          padding: 0;
        }
      }
    `,sliderInput:(0,CS.css)({display:"flex",flexDirection:"row",alignItems:"center",width:"100%"}),sliderInputVertical:(0,CS.css)({flexDirection:"column",height:"100%",".rc-slider":{margin:0,order:2}}),sliderInputField:(0,CS.css)({marginLeft:e.spacing(3),width:"60px",input:{textAlign:"center"}}),sliderInputFieldVertical:(0,CS.css)({margin:`0 0 ${e.spacing(3)} 0`,order:1})}})(p,!0,Boolean(u)),x=HT(p,m);return o().createElement("div",{className:(0,CS.cx)(b.container,b.slider)},o().createElement(XS.Global,{styles:b.slider}),o().createElement("div",{className:(0,CS.cx)(b.sliderInput)},o().createElement(GT,{min:a,max:l,step:c,defaultValue:e,value:f,onChange:y,vertical:!1,reverse:!1,ariaLabelForHandle:d,marks:u,included:h}),o().createElement("span",{className:x.numberInputWrapper,ref:i},o().createElement(ZS,{value:f,onChange:v,max:l,min:a,step:c}))))},HT=(e,t)=>({numberInputWrapper:(0,CS.css)({marginLeft:e.spacing(3),maxHeight:"32px",maxWidth:t,minWidth:t,overflow:"visible",width:"100%"})});function ZT(e){return(0,Pl.getFieldTypeIconName)(null==e?void 0:e.type)}function qT(t,n){return(0,r.useMemo)((()=>function(t,n){const i={display:new Set,raw:new Set,fields:new Map};for(const r of t)for(const o of r.fields){if(n&&!n(o))continue;const s=(0,e.getFieldDisplayName)(o,r,t);i.display.add(s),i.fields.set(s,o),o.name&&s!==o.name&&(i.raw.add(o.name),i.fields.set(o.name,o))}return i}(t,n)),[t,n])}function XT(e,t,n,i,o){return(0,r.useMemo)((()=>{let r=!1;const s=[];if(n&&s.push(n),"only"===o)for(const n of e.raw)r||n!==t||(r=!0),s.push({value:n,label:`${n} (base field name)`});else{for(const n of e.display){r||n!==t||(r=!0);const o=e.fields.get(n);i&&i!==(null==o?void 0:o.type)||s.push({value:n,label:n,icon:o?ZT(o):void 0})}if("exclude"!==o)for(const n of e.raw)e.display.has(n)||(r||n!==t||(r=!0),s.push({value:n,label:`${n} (base field name)`}))}return t&&!r&&s.push({value:t,label:`${t} (not found)`}),s}),[e,t,n,i,o])}function YT(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){YT(e,t,n[t])}))}return e}function JT(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const QT={label:"Fixed color",value:"_____fixed_____"},eC=e=>{var t,n,i,s;const{value:a,context:l,onChange:c,item:u}=e,h="dark-green",d=(0,Pl.useStyles2)(tC),p=null==a?void 0:a.field,f=a&&Boolean(!p)&&(null==a?void 0:a.fixed),g=XT(qT(l.data),p,QT,null===(t=u.settings)||void 0===t?void 0:t.filteredFieldType,null===(n=u.settings)||void 0===n?void 0:n.baseNameMode),m=(0,r.useCallback)((e=>{if(!e)return void c(void 0);const t=e.value;if(t&&t!==QT.value)c(JT(KT({},a),{field:t}));else{var n;const e=null!==(n=null==a?void 0:a.fixed)&&void 0!==n?n:h;c(JT(KT({},a),{field:void 0,fixed:e}))}}),[c,a]),_=(0,r.useCallback)((e=>{c({field:void 0,fixed:null!=e?e:h})}),[c]),y=f?QT:g.find((e=>e.value===p));return o().createElement(o().Fragment,null,o().createElement("div",{className:d.container},o().createElement(Pl.Select,{value:y,options:g,onChange:m,noOptionsMessage:"No fields found",isClearable:null===(i=u.settings)||void 0===i?void 0:i.isClearable,placeholder:null===(s=u.settings)||void 0===s?void 0:s.placeholder}),f&&o().createElement("div",{className:d.picker},o().createElement(Pl.ColorPicker,{color:null==a?void 0:a.fixed,onChange:_,enableNamedColors:!0}))))},tC=e=>({container:CS.css`
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-end;
    align-items: center;
  `,picker:CS.css`
    padding-left: 8px;
  `});var nC=(e=>(e.Linear="linear",e.Quad="quad",e))(nC||{}),iC=(e=>(e.Clamped="clamped",e.Mod="mod",e))(iC||{}),rC=(e=>(e.Field="field",e.Fixed="fixed",e.Template="template",e))(rC||{}),oC=(e=>(e.Field="field",e.Fixed="fixed",e.Mapping="mapping",e))(oC||{});const sC=Object.freeze({fixed:"",mode:rC.Field,field:""});var aC=function(e){return e.Cisco="img/icons/cisco",e.Networking="img/icons/networking",e.Databases="img/icons/databases",e.Custom="public/img/icons/mapgl",e.BG="public/img/bg",e}({}),lC=function(e){return e.Icon="icon",e.Image="image",e}({}),cC=function(e){return e.Folder="folder",e.URL="url",e.Upload="upload",e}({}),uC=function(e){return e.SMALL="small",e.NORMAL="normal",e}({});function hC(t,n){const i=function(t,n){if(n&&(null==t?void 0:t.length))for(let i=0;i<n.fields.length;i++){const r=n.fields[i];if(t===r.name)return i;if(t===(0,e.getFieldDisplayName)(r,n,undefined))return i}}(n,t);return null==i?void 0:t.fields[i]}function dC(t){var n;const i=null===(n=t.state)||void 0===n?void 0:n.calcs;if(i){const t=i[e.ReducerID.lastNotNull];if(null!=t)return t}const r=t.values;let o=r.length-1;for(;o>=0;){const e=r[o--];if(null!=e)return e}}function pC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fC(t,n,i){return function(t,n,i){var r;if(!t){var o,s;const e=i.visualization.getColorByName(null!==(s=n.fixed)&&void 0!==s?s:"grey");return{isAssumed:Boolean(null===(o=n.field)||void 0===o?void 0:o.length)||!n.fixed,fixed:e,value:()=>e,get:t=>e}}const a=(0,e.getFieldColorModeForField)(t);if(a.isByValue||(null===(r=t.config.mappings)||void 0===r?void 0:r.length)){const n=(0,e.getFieldConfigWithMinMax)(t,!0);n!==t.config&&(l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){pC(e,t,n[t])}))}return e}({},t),c=null!=(c={config:n})?c:{},Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(c)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(c)).forEach((function(e){Object.defineProperty(l,e,Object.getOwnPropertyDescriptor(c,e))})),(t=l).state=void 0);const r=(0,e.getDisplayProcessor)({field:t,theme:i}),o=e=>{var t;return null!==(t=r(e).color)&&void 0!==t?t:"#ccc"};return{field:t,get:e=>o(t.values[e]),value:()=>o(dC(t))}}var l,c;const u=a.getCalculator(t,i)(0,0);return{fixed:u,value:()=>u,get:e=>u,field:t}}(hC(t,n.field),n,i)}function gC(t,n){return function(t,n){if(!t){var i,r;const e=null!==(r=n.fixed)&&void 0!==r?r:0;return{isAssumed:Boolean(null===(i=n.field)||void 0===i?void 0:i.length)||!n.fixed,fixed:e,value:()=>e,get:()=>e}}const o=(0,e.getMinMaxAndDelta)(t),s=n.max-n.min;if(t.values.length<1||s<=0||o.delta<=0)return{fixed:n.min,value:()=>n.min,get:()=>n.min};let a=e=>n.min+e*s;if(void 0===nC.Quad){const e=Math.PI*Math.pow(n.max/2,2),t=Math.PI*Math.pow(n.min/2,2),i=e-t;a=e=>{let n=t+i*e;return 2*Math.sqrt(n/Math.PI)}}const l=e=>{const n=t.values[e];let i=0;return n!==-1/0&&(i=(n-o.min)/o.delta),i>1?i=1:i<0&&(i=0),a(i)};return{get:l,value:()=>l(dC(t)),field:t}}(hC(t,null==n?void 0:n.field),n)}function mC(e){return e||(e={min:0,max:1}),null==e.min&&(e.min=0),null==e.max&&(e.max=1),e}function _C(t,n){const i=n.field?hC(t,n.field):null==t?void 0:t.fields.find((t=>t.type===e.FieldType.string));return function(t,n){let i=n.fixed;var r;const o=null!==(r=n.mode)&&void 0!==r?r:rC.Fixed;if(o===rC.Fixed)return{isAssumed:!Boolean(i),fixed:i,value:()=>i,get:e=>i};if(o===rC.Template){const e=e=>`TEMPLATE[${n.fixed} // ${e}]`;return t?{field:t,get:n=>e(t.values[n]),value:()=>e(dC(t))}:(i=e(""),{isAssumed:!0,fixed:i,value:()=>i,get:e=>i})}if(!t)return{isAssumed:!0,fixed:i,value:()=>i,get:e=>i};let s=n=>(0,e.formattedValueToString)(t.display(n));return{field:t,get:e=>s(t.values[e]),value:()=>s(dC(t))}}(i,n)}function yC(e){return e?e.indexOf(":/")>0?window.__grafana_public_path__:e.startsWith(aC.Custom)?e:"public/plugins/vaduga-mapgl-panel/img/icons/"+e+".svg":""}var vC=["br","col","colgroup","dl","hr","iframe","img","input","link","menuitem","meta","ol","param","select","table","tbody","tfoot","thead","tr","ul","wbr"],bC={"accept-charset":"acceptCharset",acceptcharset:"acceptCharset",accesskey:"accessKey",allowfullscreen:"allowFullScreen",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",cellpadding:"cellPadding",cellspacing:"cellSpacing",charset:"charSet",class:"className",classid:"classID",classname:"className",colspan:"colSpan",contenteditable:"contentEditable",contextmenu:"contextMenu",controlslist:"controlsList",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",datetime:"dateTime",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",enctype:"encType",for:"htmlFor",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",innerhtml:"innerHTML",inputmode:"inputMode",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",marginwidth:"marginWidth",marginheight:"marginHeight",maxlength:"maxLength",mediagroup:"mediaGroup",minlength:"minLength",nomodule:"noModule",novalidate:"noValidate",playsinline:"playsInline",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rowspan:"rowSpan",spellcheck:"spellCheck",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",tabindex:"tabIndex",typemustmatch:"typeMustMatch",usemap:"useMap",accentheight:"accentHeight","accent-height":"accentHeight",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",arabicform:"arabicForm","arabic-form":"arabicForm",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",diffuseconstant:"diffuseConstant",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",edgemode:"edgeMode",enablebackground:"enableBackground","enable-background":"enableBackground",externalresourcesrequired:"externalResourcesRequired",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",imagerendering:"imageRendering","image-rendering":"imageRendering",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",vmathematical:"vMathematical","v-mathematical":"vMathematical",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan",onblur:"onBlur",onchange:"onChange",onclick:"onClick",oncontextmenu:"onContextMenu",ondoubleclick:"onDoubleClick",ondrag:"onDrag",ondragend:"onDragEnd",ondragenter:"onDragEnter",ondragexit:"onDragExit",ondragleave:"onDragLeave",ondragover:"onDragOver",ondragstart:"onDragStart",ondrop:"onDrop",onerror:"onError",onfocus:"onFocus",oninput:"onInput",oninvalid:"onInvalid",onkeydown:"onKeyDown",onkeypress:"onKeyPress",onkeyup:"onKeyUp",onload:"onLoad",onmousedown:"onMouseDown",onmouseenter:"onMouseEnter",onmouseleave:"onMouseLeave",onmousemove:"onMouseMove",onmouseout:"onMouseOut",onmouseover:"onMouseOver",onmouseup:"onMouseUp",onscroll:"onScroll",onsubmit:"onSubmit",ontouchcancel:"onTouchCancel",ontouchend:"onTouchEnd",ontouchmove:"onTouchMove",ontouchstart:"onTouchStart",onwheel:"onWheel"};function xC(e,t,n){const i=[...e].map(((e,i)=>EC(e,{...n,index:i,level:t+1}))).filter(Boolean);return i.length?i:null}function wC(e,t={}){return"string"==typeof e?function(e,t={}){if(!e||"string"!=typeof e)return null;const{includeAllNodes:n=!1,nodeOnly:i=!1,selector:r="body > *",type:o="text/html"}=t;try{const s=(new DOMParser).parseFromString(e,o);if(n){const{childNodes:e}=s.body;return i?e:[...e].map((e=>EC(e,t)))}const a=s.querySelector(r)||s.body.childNodes[0];if(!(a instanceof Node))throw new TypeError("Error parsing input");return i?a:EC(a,t)}catch(e){}return null}(e,t):e instanceof Node?EC(e,t):null}function EC(e,t={}){if(!(e&&e instanceof Node))return null;const{actions:n=[],index:i=0,level:o=0,randomKey:s}=t;let a=e,l=`${o}-${i}`;const c=[];return s&&0===o&&(l=`${function(e=6){let t="";for(let n=e;n>0;--n)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return t}()}-${l}`),Array.isArray(n)&&n.forEach((t=>{t.condition(a,l,o)&&("function"==typeof t.pre&&(a=t.pre(a,l,o),a instanceof Node||(a=e)),"function"==typeof t.post&&c.push(t.post(a,l,o)))})),c.length?c:function(e,t){const{key:n,level:i,...o}=t;switch(e.nodeType){case 1:return r.createElement((s=e.nodeName,/[a-z]+[A-Z]+[a-z]+/.test(s)?s:s.toLowerCase()),function(e,t){const n={key:t};if(e instanceof Element){const t=e.getAttribute("class");t&&(n.className=t),[...e.attributes].forEach((e=>{switch(e.name){case"class":break;case"style":n[e.name]="string"!=typeof(t=e.value)?{}:t.split(/ ?; ?/).reduce(((e,t)=>{const[n,i]=t.split(/ ?: ?/).map(((e,t)=>0===t?e.replace(/\s+/g,""):e.trim()));if(n&&i){const t=n.replace(/(\w)-(\w)/g,((e,t,n)=>`${t}${n.toUpperCase()}`));let r=i.trim();Number.isNaN(Number(i))||(r=Number(i)),e[n.startsWith("-")?n:t]=r}return e}),{});break;case"allowfullscreen":case"allowpaymentrequest":case"async":case"autofocus":case"autoplay":case"checked":case"controls":case"default":case"defer":case"disabled":case"formnovalidate":case"hidden":case"ismap":case"itemscope":case"loop":case"multiple":case"muted":case"nomodule":case"novalidate":case"open":case"readonly":case"required":case"reversed":case"selected":case"typemustmatch":n[bC[e.name]||e.name]=!0;break;default:n[bC[e.name]||e.name]=e.value}var t}))}return n}(e,n),xC(e.childNodes,i,o));case 3:{const t=e.nodeValue?.toString()??"";if(!o.allowWhiteSpaces&&/^\s+$/.test(t)&&!/[\u00A0\u202F]/.test(t))return null;if(!e.parentNode)return t;const n=e.parentNode.nodeName.toLowerCase();return vC.includes(n)?(/\S/.test(t)&&console.warn(`A textNode is not allowed inside '${n}'. Your text "${t}" will be ignored`),null):t}case 8:default:return null;case 11:return xC(e.childNodes,i,t)}var s}(a,{key:l,level:o,...t})}var SC=Object.defineProperty,TC=(e,t,n)=>((e,t,n)=>t in e?SC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),CC="react-inlinesvg",AC={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed",READY:"ready",UNSUPPORTED:"unsupported"};function PC(){return!("undefined"==typeof window||!window.document?.createElement)}async function IC(e,t){const n=await fetch(e,t),i=n.headers.get("content-type"),[r]=(i??"").split(/ ?; ?/);if(n.status>299)throw new Error("Not found");if(!["image/svg+xml","text/plain"].some((e=>r.includes(e))))throw new Error(`Content type isn't valid: ${r}`);return n.text()}function MC(e=1){return new Promise((t=>{setTimeout(t,1e3*e)}))}var RC,kC=class{constructor(){TC(this,"cacheApi"),TC(this,"cacheStore"),TC(this,"subscribers",[]),TC(this,"isReady",!1),this.cacheStore=new Map;let e=CC,t=!1;PC()&&(e=window.REACT_INLINESVG_CACHE_NAME??CC,t=!!window.REACT_INLINESVG_PERSISTENT_CACHE&&"caches"in window),t?caches.open(e).then((e=>{this.cacheApi=e})).catch((e=>{console.error(`Failed to open cache: ${e.message}`),this.cacheApi=void 0})).finally((()=>{this.isReady=!0;const e=[...this.subscribers];this.subscribers.length=0,e.forEach((e=>{try{e()}catch(e){console.error(`Error in CacheStore subscriber callback: ${e.message}`)}}))})):this.isReady=!0}onReady(e){this.isReady?e():this.subscribers.push(e)}async get(e,t){return await(this.cacheApi?this.fetchAndAddToPersistentCache(e,t):this.fetchAndAddToInternalCache(e,t)),this.cacheStore.get(e)?.content??""}set(e,t){this.cacheStore.set(e,t)}isCached(e){return this.cacheStore.get(e)?.status===AC.LOADED}async fetchAndAddToInternalCache(e,t){const n=this.cacheStore.get(e);if(n?.status!==AC.LOADING){if(!n?.content){this.cacheStore.set(e,{content:"",status:AC.LOADING});try{const n=await IC(e,t);this.cacheStore.set(e,{content:n,status:AC.LOADED})}catch(t){throw this.cacheStore.set(e,{content:"",status:AC.FAILED}),t}}}else await this.handleLoading(e,(async()=>{this.cacheStore.set(e,{content:"",status:AC.IDLE}),await this.fetchAndAddToInternalCache(e,t)}))}async fetchAndAddToPersistentCache(e,t){const n=this.cacheStore.get(e);if(n?.status===AC.LOADED)return;if(n?.status===AC.LOADING)return void await this.handleLoading(e,(async()=>{this.cacheStore.set(e,{content:"",status:AC.IDLE}),await this.fetchAndAddToPersistentCache(e,t)}));this.cacheStore.set(e,{content:"",status:AC.LOADING});const i=await(this.cacheApi?.match(e));if(i){const t=await i.text();this.cacheStore.set(e,{content:t,status:AC.LOADED})}else try{await(this.cacheApi?.add(new Request(e,t)));const n=await(this.cacheApi?.match(e)),i=await(n?.text())??"";this.cacheStore.set(e,{content:i,status:AC.LOADED})}catch(t){throw this.cacheStore.set(e,{content:"",status:AC.FAILED}),t}}async handleLoading(e,t){for(let t=0;t<10;t++){if(this.cacheStore.get(e)?.status!==AC.LOADING)return;await MC(.1)}await t()}keys(){return[...this.cacheStore.keys()]}data(){return[...this.cacheStore.entries()].map((([e,t])=>({[e]:t})))}async delete(e){this.cacheApi&&await this.cacheApi.delete(e),this.cacheStore.delete(e)}async clear(){if(this.cacheApi){const e=await this.cacheApi.keys();await Promise.allSettled(e.map((e=>this.cacheApi.delete(e))))}this.cacheStore.clear()}};function OC(e){const t=(0,r.useRef)(void 0);return(0,r.useEffect)((()=>{t.current=e})),t.current}function LC(e){const{baseURL:t,content:n,description:i,handleError:r,hash:o,preProcessor:s,title:a,uniquifyIDs:l=!1}=e;try{const e=function(e,t){return t?t(e):e}(n,s),r=wC(e,{nodeOnly:!0});if(!(r&&r instanceof SVGSVGElement))throw new Error("Could not convert the src to a DOM Node");const c=DC(r,{baseURL:t,hash:o,uniquifyIDs:l});if(i){const e=c.querySelector("desc");e?.parentNode&&e.parentNode.removeChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","desc");t.innerHTML=i,c.prepend(t)}if(void 0!==a){const e=c.querySelector("title");if(e?.parentNode&&e.parentNode.removeChild(e),a){const e=document.createElementNS("http://www.w3.org/2000/svg","title");e.innerHTML=a,c.prepend(e)}}return c}catch(e){return r(e)}}function DC(e,t){const{baseURL:n="",hash:i,uniquifyIDs:r}=t,o=["id","href","xlink:href","xlink:role","xlink:arcrole"],s=["href","xlink:href"];return r?([...e.children].forEach((e=>{if(e.attributes?.length){const t=Object.values(e.attributes).map((e=>{const t=e,r=/url\((.*?)\)/.exec(e.value);return r?.[1]&&(t.value=e.value.replace(r[0],`url(${n}${r[1]}__${i})`)),t}));o.forEach((e=>{const n=t.find((t=>t.name===e));n&&!((e,t)=>s.includes(e)&&!!t&&!t.includes("#"))(e,n.value)&&(n.value=`${n.value}__${i}`)}))}return e.children.length?DC(e,t):e})),e):e}function FC(e){const{cacheRequests:t=!0,children:n=null,description:i,fetchOptions:o,innerRef:s,loader:a=null,onError:l,onLoad:c,src:u,title:h,uniqueHash:d}=e,[p,f]=(0,r.useReducer)(((e,t)=>({...e,...t})),{content:"",element:null,isCached:t&&RC.isCached(e.src),status:AC.IDLE}),{content:g,element:m,isCached:_,status:y}=p,v=OC(e),b=OC(p),x=(0,r.useRef)(d??function(){const e="abcdefghijklmnopqrstuvwxyz",t=`${e}${e.toUpperCase()}1234567890`;let n="";for(let e=0;e<8;e++)n+=(i=t)[Math.floor(Math.random()*i.length)];var i;return n}()),w=(0,r.useRef)(!1),E=(0,r.useRef)(!1),S=(0,r.useCallback)((e=>{w.current&&(f({status:"Browser does not support SVG"===e.message?AC.UNSUPPORTED:AC.FAILED}),l?.(e))}),[l]),T=(0,r.useCallback)(((e,t=!1)=>{w.current&&f({content:e,isCached:t,status:AC.LOADED})}),[]),C=(0,r.useCallback)((async()=>{const e=await IC(u,o);T(e)}),[o,T,u]),A=(0,r.useCallback)((()=>{try{const t=wC(LC({...e,handleError:S,hash:x.current,content:g}));if(!t||!(0,r.isValidElement)(t))throw new Error("Could not convert the src to a React element");f({element:t,status:AC.READY})}catch(e){S(e)}}),[g,S,e]),P=(0,r.useCallback)((async()=>{const e=/^data:image\/svg[^,]*?(;base64)?,(.*)/u.exec(u);let n;if(e?n=e[1]?window.atob(e[2]):decodeURIComponent(e[2]):u.includes("<svg")&&(n=u),n)T(n);else try{if(t){const e=await RC.get(u,o);T(e,!0)}else await C()}catch(e){S(e)}}),[t,C,o,S,T,u]),I=(0,r.useCallback)((async()=>{w.current&&f({content:"",element:null,isCached:!1,status:AC.LOADING})}),[]);(0,r.useEffect)((()=>{if(w.current=!0,PC()&&!E.current){try{if(y===AC.IDLE){if(!function(){if(!document)return!1;const e=document.createElement("div");e.innerHTML="<svg />";const t=e.firstChild;return!!t&&"http://www.w3.org/2000/svg"===t.namespaceURI}()||"undefined"==typeof window||null===window)throw new Error("Browser does not support SVG");if(!u)throw new Error("Missing src");I()}}catch(e){S(e)}return E.current=!0,()=>{w.current=!1}}}),[]),(0,r.useEffect)((()=>{if(PC()&&v&&v.src!==u){if(!u)return void S(new Error("Missing src"));I()}}),[S,I,v,u]),(0,r.useEffect)((()=>{y===AC.LOADED&&A()}),[y,A]),(0,r.useEffect)((()=>{PC()&&v&&v.src===u&&(v.title===h&&v.description===i||A())}),[i,A,v,u,h]),(0,r.useEffect)((()=>{if(b)switch(y){case AC.LOADING:b.status!==AC.LOADING&&P();break;case AC.LOADED:b.status!==AC.LOADED&&A();break;case AC.READY:b.status!==AC.READY&&c?.(u,_)}}),[P,A,_,c,b,u,y]);const M=function(e,...t){const n={};for(const i in e)({}).hasOwnProperty.call(e,i)&&(t.includes(i)||(n[i]=e[i]));return n}(e,"baseURL","cacheRequests","children","description","fetchOptions","innerRef","loader","onError","onLoad","preProcessor","src","title","uniqueHash","uniquifyIDs");return PC()?m?(0,r.cloneElement)(m,{ref:s,...M}):[AC.UNSUPPORTED,AC.FAILED].includes(y)?n:a:a}function NC(e){RC||(RC=new kC);const{loader:t}=e,[n,i]=(0,r.useState)(RC.isReady);return(0,r.useEffect)((()=>{n||RC.onReady((()=>{i(!0)}))}),[n]),n?r.createElement(FC,{...e}):t}const BC={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let zC;const jC=new Uint8Array(16),UC=[];for(let e=0;e<256;++e)UC.push((e+256).toString(16).slice(1));const VC=function(e,t,n){if(BC.randomUUID&&!t&&!e)return BC.randomUUID();const i=(e=e||{}).random??e.rng?.()??function(){if(!zC){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");zC=crypto.getRandomValues.bind(crypto)}return zC(jC)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=i[e];return t}return function(e,t=0){return(UC[e[t+0]]+UC[e[t+1]]+UC[e[t+2]]+UC[e[t+3]]+"-"+UC[e[t+4]]+UC[e[t+5]]+"-"+UC[e[t+6]]+UC[e[t+7]]+"-"+UC[e[t+8]]+UC[e[t+9]]+"-"+UC[e[t+10]]+UC[e[t+11]]+UC[e[t+12]]+UC[e[t+13]]+UC[e[t+14]]+UC[e[t+15]]).toLowerCase()}(i)};function $C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const GC=e=>{const{cleanStyle:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["cleanStyle"]);return o().createElement(NC,(i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){$C(e,t,n[t])}))}return e}({},n),r=null!=(r={cacheRequests:!0,preProcessor:HC})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(r)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(r)).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(r,e))})),i));var i,r};let WC=new Map;function HC(t){let n=WC.get(t);if(!n){const{svgText:i}=B(t,!0);n=e.textUtil.sanitizeSVGContent(i),n.indexOf('<style type="text/css">')>-1&&(n=(e=>{let t=(e=>{var t;return null===(t=e.match(new RegExp("<svg.*id\\s*=\\s*(['\"])(.*?)\\1")))||void 0===t?void 0:t[2]})(e);if(!t){t=`x${VC()}`;const n=e.indexOf("<svg")+5;e=e.substring(0,n)+`id="${t}" `+e.substring(n)}let n=(e=>{const t=e.match(new RegExp('<style type="text/css">([\\s\\S]*?)<\\/style>'));return t?t[0]:null})(e);if(n){let i=n.replace(/(#(.*?))?\./g,`#${t} .`);e=e.replace(n,i)}return e})(n)),WC.set(t,n)}return n}const ZC="undefined"!=typeof document?r.useLayoutEffect:()=>{};function qC(e){const t=(0,r.useRef)(null);return ZC((()=>{t.current=e}),[e]),(0,r.useCallback)(((...e)=>{const n=t.current;return null==n?void 0:n(...e)}),[])}const XC={prefix:String(Math.round(1e10*Math.random())),current:0},YC=r.createContext(XC),KC=r.createContext(!1);Boolean("undefined"!=typeof window&&window.document&&window.document.createElement);let JC=new WeakMap;const QC="function"==typeof r.useId?function(e){let t=r.useId(),[n]=(0,r.useState)("function"==typeof r.useSyncExternalStore?r.useSyncExternalStore(nA,eA,tA):(0,r.useContext)(KC));return e||`${n?"react-aria":`react-aria${XC.prefix}`}-${t}`}:function(e){let t=(0,r.useContext)(YC),n=function(e=!1){let t=(0,r.useContext)(YC),n=(0,r.useRef)(null);if(null===n.current&&!e){var i,o;let e=null===(o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)||void 0===o||null===(i=o.ReactCurrentOwner)||void 0===i?void 0:i.current;if(e){let n=JC.get(e);null==n?JC.set(e,{id:t.current,state:e.memoizedState}):e.memoizedState!==n.state&&(t.current=n.id,JC.delete(e))}n.current=++t.current}return n.current}(!!e),i=`react-aria${t.prefix}`;return e||`${i}-${n}`};function eA(){return!1}function tA(){return!0}function nA(e){return()=>{}}let iA,rA=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),oA=new Map;function sA(e=[]){let t=function(){let[e,t]=(0,r.useState)(void 0),n=(0,r.useRef)(null),i=QC(e),o=(0,r.useRef)(null);if(iA&&iA.register(o,i),rA){const e=oA.get(i);e&&!e.includes(n)?e.push(n):oA.set(i,[n])}return ZC((()=>{let e=i;return()=>{iA&&iA.unregister(o),oA.delete(e)}}),[i]),(0,r.useEffect)((()=>{let e=n.current;return e&&t(e),()=>{e&&(n.current=null)}})),i}(),[n,i]=function(e){let[t,n]=(0,r.useState)(e),i=(0,r.useRef)(null),o=qC((()=>{if(!i.current)return;let e=i.current.next();e.done?i.current=null:t===e.value?o():n(e.value)}));ZC((()=>{i.current&&o()}));let s=qC((e=>{i.current=e(t),o()}));return[t,s]}(t),o=(0,r.useCallback)((()=>{i((function*(){yield t,yield document.getElementById(t)?t:void 0}))}),[t,i]);return ZC(o,[t,o,...e]),n}"undefined"!=typeof FinalizationRegistry&&(iA=new FinalizationRegistry((e=>{oA.delete(e)})));const aA=new Set(["id"]),lA=new Set(["aria-label","aria-labelledby","aria-describedby","aria-details"]),cA=new Set(["href","hrefLang","target","rel","download","ping","referrerPolicy"]),uA=/^(data-.*)$/;function hA(e,t={}){let{labelable:n,isLink:i,propNames:r}=t,o={};for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(aA.has(t)||n&&lA.has(t)||i&&cA.has(t)||(null==r?void 0:r.has(t))||uA.test(t))&&(o[t]=e[t]);return o}const dA="undefined"!=typeof document?r.useLayoutEffect:()=>{};var pA;const fA=null!==(pA=r.useInsertionEffect)&&void 0!==pA?pA:dA;function gA(e){const t=(0,r.useRef)(null);return fA((()=>{t.current=e}),[e]),(0,r.useCallback)(((...e)=>{const n=t.current;return null==n?void 0:n(...e)}),[])}function mA(e){let t=e;return t.nativeEvent=e,t.isDefaultPrevented=()=>t.defaultPrevented,t.isPropagationStopped=()=>t.cancelBubble,t.persist=()=>{},t}function _A(e){var t;if("undefined"==typeof window||null==window.navigator)return!1;let n=null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.brands;return Array.isArray(n)&&n.some((t=>e.test(t.brand)))||e.test(window.navigator.userAgent)}function yA(e){var t;return"undefined"!=typeof window&&null!=window.navigator&&e.test((null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.platform)||window.navigator.platform)}function vA(e){let t=null;return()=>(null==t&&(t=e()),t)}const bA=vA((function(){return yA(/^Mac/i)})),xA=vA((function(){return yA(/^iPhone/i)})),wA=vA((function(){return yA(/^iPad/i)||bA()&&navigator.maxTouchPoints>1})),EA=vA((function(){return xA()||wA()})),SA=(vA((function(){return bA()||EA()})),vA((function(){return _A(/AppleWebKit/i)&&!SA()})),vA((function(){return _A(/Chrome/i)}))),TA=vA((function(){return _A(/Android/i)}));vA((function(){return _A(/Firefox/i)}));const CA=e=>{var t;return null!==(t=null==e?void 0:e.ownerDocument)&&void 0!==t?t:document},AA=e=>e&&"window"in e&&e.window===e?e:CA(e).defaultView||window;let PA=null,IA=new Set,MA=new Map,RA=!1,kA=!1;function OA(e,t){for(let n of IA)n(e,t)}function LA(e){RA=!0,function(e){return!(e.metaKey||!bA()&&e.altKey||e.ctrlKey||"Control"===e.key||"Shift"===e.key||"Meta"===e.key)}(e)&&(PA="keyboard",OA("keyboard",e))}function DA(e){PA="pointer","mousedown"!==e.type&&"pointerdown"!==e.type||(RA=!0,OA("pointer",e))}function FA(e){var t;(0===(t=e).mozInputSource&&t.isTrusted||(TA()&&t.pointerType?"click"===t.type&&1===t.buttons:0===t.detail&&!t.pointerType))&&(RA=!0,PA="virtual")}function NA(e){e.target!==window&&e.target!==document&&e.isTrusted&&(RA||kA||(PA="virtual",OA("virtual",e)),RA=!1,kA=!1)}function BA(){RA=!1,kA=!0}function zA(e){if("undefined"==typeof window||"undefined"==typeof document||MA.get(AA(e)))return;const t=AA(e),n=CA(e);let i=t.HTMLElement.prototype.focus;t.HTMLElement.prototype.focus=function(){RA=!0,i.apply(this,arguments)},n.addEventListener("keydown",LA,!0),n.addEventListener("keyup",LA,!0),n.addEventListener("click",FA,!0),t.addEventListener("focus",NA,!0),t.addEventListener("blur",BA,!1),"undefined"!=typeof PointerEvent&&(n.addEventListener("pointerdown",DA,!0),n.addEventListener("pointermove",DA,!0),n.addEventListener("pointerup",DA,!0)),t.addEventListener("beforeunload",(()=>{jA(e)}),{once:!0}),MA.set(t,{focus:i})}const jA=(e,t)=>{const n=AA(e),i=CA(e);t&&i.removeEventListener("DOMContentLoaded",t),MA.has(n)&&(n.HTMLElement.prototype.focus=MA.get(n).focus,i.removeEventListener("keydown",LA,!0),i.removeEventListener("keyup",LA,!0),i.removeEventListener("click",FA,!0),n.removeEventListener("focus",NA,!0),n.removeEventListener("blur",BA,!1),"undefined"!=typeof PointerEvent&&(i.removeEventListener("pointerdown",DA,!0),i.removeEventListener("pointermove",DA,!0),i.removeEventListener("pointerup",DA,!0)),MA.delete(n))};function UA(){return PA}"undefined"!=typeof document&&function(e){const t=CA(e);let n;"loading"!==t.readyState?zA(e):(n=()=>{zA(e)},t.addEventListener("DOMContentLoaded",n))}(),new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);const VA=(e=document)=>e.activeElement;let $A=new Map,GA=new Set;function WA(){if("undefined"==typeof window)return;function e(e){return"propertyName"in e}let t=n=>{if(!e(n)||!n.target)return;let i=$A.get(n.target);if(i&&(i.delete(n.propertyName),0===i.size&&(n.target.removeEventListener("transitioncancel",t),$A.delete(n.target)),0===$A.size)){for(let e of GA)e();GA.clear()}};document.body.addEventListener("transitionrun",(n=>{if(!e(n)||!n.target)return;let i=$A.get(n.target);i||(i=new Set,$A.set(n.target,i),n.target.addEventListener("transitioncancel",t,{once:!0})),i.add(n.propertyName)})),document.body.addEventListener("transitionend",t)}function HA(e){if(function(){if(null==ZA){ZA=!1;try{document.createElement("div").focus({get preventScroll(){return ZA=!0,!0}})}catch{}}return ZA}())e.focus({preventScroll:!0});else{let t=function(e){let t=e.parentNode,n=[],i=document.scrollingElement||document.documentElement;for(;t instanceof HTMLElement&&t!==i;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&n.push({element:t,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),t=t.parentNode;return i instanceof HTMLElement&&n.push({element:i,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}),n}(e);e.focus(),function(e){for(let{element:t,scrollTop:n,scrollLeft:i}of e)t.scrollTop=n,t.scrollLeft=i}(t)}}"undefined"!=typeof document&&("loading"!==document.readyState?WA():document.addEventListener("DOMContentLoaded",WA));let ZA=null;function qA(e){const t=CA(e),n=VA(t);if("virtual"===UA()){let r=n;i=()=>{VA(t)===r&&e.isConnected&&HA(e)},requestAnimationFrame((()=>{!function(){for(const[e]of $A)"isConnected"in e&&!e.isConnected&&$A.delete(e)}(),0===$A.size?i():GA.add(i)}))}else HA(e);var i}const XA=r.createContext(null);function YA(e,t){let{role:n="dialog"}=e,i=sA();i=e["aria-label"]?void 0:i;let o=(0,r.useRef)(!1);return(0,r.useEffect)((()=>{if(t.current&&!t.current.contains(document.activeElement)){qA(t.current);let e=setTimeout((()=>{document.activeElement===t.current&&(o.current=!0,t.current&&(t.current.blur(),qA(t.current)),o.current=!1)}),500);return()=>{clearTimeout(e)}}}),[t]),function(){let e=(0,r.useContext)(XA),t=null==e?void 0:e.setContain;ZC((()=>{null==t||t(!0)}),[t])}(),{dialogProps:{...hA(e,{labelable:!0}),role:n,tabIndex:-1,"aria-labelledby":e["aria-labelledby"]||i,onBlur:e=>{o.current&&e.stopPropagation()}},titleProps:{id:i}}}const KA=e=>{var t;return null!==(t=null==e?void 0:e.ownerDocument)&&void 0!==t?t:document};function JA(e){const t=(n=e)&&"window"in n&&n.window===n?n:KA(n).defaultView||window;var n;if(!(e instanceof t.HTMLElement||e instanceof t.SVGElement))return!1;let{display:i,visibility:r}=e.style,o="none"!==i&&"hidden"!==r&&"collapse"!==r;if(o){const{getComputedStyle:t}=e.ownerDocument.defaultView;let{display:n,visibility:i}=t(e);o="none"!==n&&"hidden"!==i&&"collapse"!==i}return o}function QA(e,t){return"#comment"!==e.nodeName&&JA(e)&&function(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&("DETAILS"!==e.nodeName||!t||"SUMMARY"===t.nodeName||e.hasAttribute("open"))}(e,t)&&(!e.parentElement||QA(e.parentElement,e))}const eP=(e=document)=>e.activeElement;function tP(e){return e.target}function nP(e){var t;return"undefined"!=typeof window&&null!=window.navigator&&((null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.brands.some((t=>e.test(t.brand))))||e.test(window.navigator.userAgent))}function iP(e){var t;return"undefined"!=typeof window&&null!=window.navigator&&e.test((null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.platform)||window.navigator.platform)}function rP(e){let t=null;return()=>(null==t&&(t=e()),t)}const oP=rP((function(){return iP(/^Mac/i)})),sP=rP((function(){return iP(/^iPhone/i)})),aP=rP((function(){return iP(/^iPad/i)||oP()&&navigator.maxTouchPoints>1})),lP=rP((function(){return sP()||aP()})),cP=(rP((function(){return oP()||lP()})),rP((function(){return nP(/AppleWebKit/i)&&!cP()})),rP((function(){return nP(/Chrome/i)}))),uP=rP((function(){return nP(/Android/i)})),hP=(rP((function(){return nP(/Firefox/i)})),["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable^="false"])']),dP=hP.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";hP.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const pP=hP.join(':not([hidden]):not([tabindex="-1"]),');function fP(e){return e.matches(dP)}function gP(e){return e.matches(pP)}const mP=r.createContext(null),_P="react-aria-focus-scope-restore";let yP=null;function vP(e){let{children:t,contain:n,restoreFocus:i,autoFocus:o}=e,s=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useRef)([]),{parentNode:c}=(0,r.useContext)(mP)||{},u=(0,r.useMemo)((()=>new OP({scopeRef:l})),[l]);ZC((()=>{let e=c||LP.root;if(LP.getTreeNode(e.scopeRef)&&yP&&!TP(yP,e.scopeRef)){let t=LP.getTreeNode(yP);t&&(e=t)}e.addChild(u),LP.addNode(u)}),[u,c]),ZC((()=>{let e=LP.getTreeNode(l);e&&(e.contain=!!n)}),[n]),ZC((()=>{var e;let t=null===(e=s.current)||void 0===e?void 0:e.nextSibling,n=[],i=e=>e.stopPropagation();for(;t&&t!==a.current;)n.push(t),t.addEventListener(_P,i),t=t.nextSibling;return l.current=n,()=>{for(let e of n)e.removeEventListener(_P,i)}}),[t]),function(e,t,n){ZC((()=>{if(t||n)return;let i=e.current;const r=KA(i?i[0]:void 0);let o=t=>{let n=tP(t);EP(n,e.current)?yP=e:wP(n)||(yP=null)};return r.addEventListener("focusin",o,!1),null==i||i.forEach((e=>e.addEventListener("focusin",o,!1))),()=>{r.removeEventListener("focusin",o,!1),null==i||i.forEach((e=>e.removeEventListener("focusin",o,!1)))}}),[e,t,n])}(l,i,n),function(e,t){let n=(0,r.useRef)(void 0),i=(0,r.useRef)(void 0);ZC((()=>{let r=e.current;if(!t)return void(i.current&&(cancelAnimationFrame(i.current),i.current=void 0));const o=KA(r?r[0]:void 0);let s=t=>{if("Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!xP(e)||t.isComposing)return;let n=eP(o),i=e.current;if(!i||!EP(n,i))return;let r=RP(bP(i),{tabbable:!0},i);if(!n)return;r.currentNode=n;let s=t.shiftKey?r.previousNode():r.nextNode();s||(r.currentNode=t.shiftKey?i[i.length-1].nextElementSibling:i[0].previousElementSibling,s=t.shiftKey?r.previousNode():r.nextNode()),t.preventDefault(),s&&CP(s,!0)},a=t=>{yP&&!TP(yP,e)||!EP(tP(t),e.current)?xP(e)&&!SP(tP(t),e)?n.current?n.current.focus():yP&&yP.current&&PP(yP.current):xP(e)&&(n.current=tP(t)):(yP=e,n.current=tP(t))},l=t=>{i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame((()=>{let i=UA(),r=("virtual"===i||null===i)&&uP()&&cP(),s=eP(o);if(!r&&s&&xP(e)&&!SP(s,e)){yP=e;let i=tP(t);var a;i&&i.isConnected?(n.current=i,null===(a=n.current)||void 0===a||a.focus()):yP.current&&PP(yP.current)}}))};return o.addEventListener("keydown",s,!1),o.addEventListener("focusin",a,!1),null==r||r.forEach((e=>e.addEventListener("focusin",a,!1))),null==r||r.forEach((e=>e.addEventListener("focusout",l,!1))),()=>{o.removeEventListener("keydown",s,!1),o.removeEventListener("focusin",a,!1),null==r||r.forEach((e=>e.removeEventListener("focusin",a,!1))),null==r||r.forEach((e=>e.removeEventListener("focusout",l,!1)))}}),[e,t]),ZC((()=>()=>{i.current&&cancelAnimationFrame(i.current)}),[i])}(l,n),function(e,t,n){const i=(0,r.useRef)("undefined"!=typeof document?eP(KA(e.current?e.current[0]:void 0)):null);ZC((()=>{let i=e.current;const r=KA(i?i[0]:void 0);if(!t||n)return;let o=()=>{yP&&!TP(yP,e)||!EP(eP(r),e.current)||(yP=e)};return r.addEventListener("focusin",o,!1),null==i||i.forEach((e=>e.addEventListener("focusin",o,!1))),()=>{r.removeEventListener("focusin",o,!1),null==i||i.forEach((e=>e.removeEventListener("focusin",o,!1)))}}),[e,n]),ZC((()=>{const i=KA(e.current?e.current[0]:void 0);if(!t)return;let r=t=>{if("Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!xP(e)||t.isComposing)return;let n=i.activeElement;if(!SP(n,e)||!IP(e))return;let r=LP.getTreeNode(e);if(!r)return;let o=r.nodeToRestore,s=RP(i.body,{tabbable:!0});s.currentNode=n;let a=t.shiftKey?s.previousNode():s.nextNode();if(o&&o.isConnected&&o!==i.body||(o=void 0,r.nodeToRestore=void 0),(!a||!SP(a,e))&&o){s.currentNode=o;do{a=t.shiftKey?s.previousNode():s.nextNode()}while(SP(a,e));t.preventDefault(),t.stopPropagation(),a?CP(a,!0):wP(o)?CP(o,!0):n.blur()}};return n||i.addEventListener("keydown",r,!0),()=>{n||i.removeEventListener("keydown",r,!0)}}),[e,t,n]),ZC((()=>{const n=KA(e.current?e.current[0]:void 0);if(!t)return;let r=LP.getTreeNode(e);var o;return r?(r.nodeToRestore=null!==(o=i.current)&&void 0!==o?o:void 0,()=>{let i=LP.getTreeNode(e);if(!i)return;let r=i.nodeToRestore,o=eP(n);if(t&&r&&(o&&SP(o,e)||o===n.body&&IP(e))){let t=LP.clone();requestAnimationFrame((()=>{if(n.activeElement===n.body){let n=t.getTreeNode(e);for(;n;){if(n.nodeToRestore&&n.nodeToRestore.isConnected)return void MP(n.nodeToRestore);n=n.parent}for(n=t.getTreeNode(e);n;){if(n.scopeRef&&n.scopeRef.current&&LP.getTreeNode(n.scopeRef))return void MP(AP(n.scopeRef.current,!0));n=n.parent}}}))}}):void 0}),[e,t])}(l,i,n),function(e,t){const n=r.useRef(t);(0,r.useEffect)((()=>{if(n.current){yP=e;const t=KA(e.current?e.current[0]:void 0);!EP(eP(t),yP.current)&&e.current&&PP(e.current)}n.current=!1}),[e])}(l,o),(0,r.useEffect)((()=>{const e=eP(KA(l.current?l.current[0]:void 0));let t=null;if(EP(e,l.current)){for(let n of LP.traverse())n.scopeRef&&EP(e,n.scopeRef.current)&&(t=n);t===LP.getTreeNode(l)&&(yP=t.scopeRef)}}),[l]),ZC((()=>()=>{var e,t,n;let i=null!==(n=null===(t=LP.getTreeNode(l))||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.scopeRef)&&void 0!==n?n:null;l!==yP&&!TP(l,yP)||i&&!LP.getTreeNode(i)||(yP=i),LP.removeTreeNode(l)}),[l]);let h=(0,r.useMemo)((()=>function(e){return{focusNext(t={}){let n=e.current,{from:i,tabbable:r,wrap:o,accept:s}=t;var a;let l=i||eP(KA(null!==(a=n[0])&&void 0!==a?a:void 0)),c=n[0].previousElementSibling,u=RP(bP(n),{tabbable:r,accept:s},n);u.currentNode=EP(l,n)?l:c;let h=u.nextNode();return!h&&o&&(u.currentNode=c,h=u.nextNode()),h&&CP(h,!0),h},focusPrevious(t={}){let n=e.current,{from:i,tabbable:r,wrap:o,accept:s}=t;var a;let l=i||eP(KA(null!==(a=n[0])&&void 0!==a?a:void 0)),c=n[n.length-1].nextElementSibling,u=RP(bP(n),{tabbable:r,accept:s},n);u.currentNode=EP(l,n)?l:c;let h=u.previousNode();return!h&&o&&(u.currentNode=c,h=u.previousNode()),h&&CP(h,!0),h},focusFirst(t={}){let n=e.current,{tabbable:i,accept:r}=t,o=RP(bP(n),{tabbable:i,accept:r},n);o.currentNode=n[0].previousElementSibling;let s=o.nextNode();return s&&CP(s,!0),s},focusLast(t={}){let n=e.current,{tabbable:i,accept:r}=t,o=RP(bP(n),{tabbable:i,accept:r},n);o.currentNode=n[n.length-1].nextElementSibling;let s=o.previousNode();return s&&CP(s,!0),s}}}(l)),[]),d=(0,r.useMemo)((()=>({focusManager:h,parentNode:u})),[u,h]);return r.createElement(mP.Provider,{value:d},r.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:s}),t,r.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:a}))}function bP(e){return e[0].parentElement}function xP(e){let t=LP.getTreeNode(yP);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function wP(e){return SP(e)}function EP(e,t){return!!e&&!!t&&t.some((t=>t.contains(e)))}function SP(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of LP.traverse(LP.getTreeNode(t)))if(n&&EP(e,n.current))return!0;return!1}function TP(e,t){var n;let i=null===(n=LP.getTreeNode(t))||void 0===n?void 0:n.parent;for(;i;){if(i.scopeRef===e)return!0;i=i.parent}return!1}function CP(e,t=!1){if(null==e||t){if(null!=e)try{e.focus()}catch{}}else try{qA(e)}catch{}}function AP(e,t=!0){let n=e[0].previousElementSibling,i=bP(e),r=RP(i,{tabbable:t},e);r.currentNode=n;let o=r.nextNode();return t&&!o&&(i=bP(e),r=RP(i,{tabbable:!1},e),r.currentNode=n,o=r.nextNode()),o}function PP(e,t=!0){CP(AP(e,t))}function IP(e){let t=LP.getTreeNode(yP);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(null==t?void 0:t.scopeRef)===e}function MP(e){e.dispatchEvent(new CustomEvent(_P,{bubbles:!0,cancelable:!0}))&&CP(e)}function RP(e,t,n){let i=(null==t?void 0:t.tabbable)?gP:fP,r=(null==e?void 0:e.nodeType)===Node.ELEMENT_NODE?e:null,o=KA(r),s=function(e,t,n,i){return e.createTreeWalker(t,n,i)}(o,e||o,NodeFilter.SHOW_ELEMENT,{acceptNode(e){var r;return(null==t||null===(r=t.from)||void 0===r?void 0:r.contains(e))?NodeFilter.FILTER_REJECT:!i(e)||!QA(e)||n&&!EP(e,n)||(null==t?void 0:t.accept)&&!t.accept(e)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}});return(null==t?void 0:t.from)&&(s.currentNode=t.from),s}class kP{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,t,n){let i=this.fastMap.get(null!=t?t:null);if(!i)return;let r=new OP({scopeRef:e});i.addChild(r),r.parent=i,this.fastMap.set(e,r),n&&(r.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(null===e)return;let t=this.fastMap.get(e);if(!t)return;let n=t.parent;for(let e of this.traverse())e!==t&&t.nodeToRestore&&e.nodeToRestore&&t.scopeRef&&t.scopeRef.current&&EP(e.nodeToRestore,t.scopeRef.current)&&(e.nodeToRestore=t.nodeToRestore);let i=t.children;n&&(n.removeChild(t),i.size>0&&i.forEach((e=>n&&n.addChild(e)))),this.fastMap.delete(t.scopeRef)}*traverse(e=this.root){if(null!=e.scopeRef&&(yield e),e.children.size>0)for(let t of e.children)yield*this.traverse(t)}clone(){var e;let t=new kP;var n;for(let i of this.traverse())t.addTreeNode(i.scopeRef,null!==(n=null===(e=i.parent)||void 0===e?void 0:e.scopeRef)&&void 0!==n?n:null,i.nodeToRestore);return t}constructor(){this.fastMap=new Map,this.root=new OP({scopeRef:null}),this.fastMap.set(null,this.root)}}class OP{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let LP=new kP;function DP(e,t){if(e.button>0)return!1;if(e.target){const t=e.target.ownerDocument;if(!t||!t.documentElement.contains(e.target))return!1;if(e.target.closest("[data-react-aria-top-layer]"))return!1}return!!t.current&&!e.composedPath().includes(t.current)}function FP(e){let{isDisabled:t,onBlurWithin:n,onFocusWithin:i,onFocusWithinChange:o}=e,s=(0,r.useRef)({isFocusWithin:!1}),{addGlobalListener:a,removeAllGlobalListeners:l}=function(){let e=(0,r.useRef)(new Map),t=(0,r.useCallback)(((t,n,i,r)=>{let o=(null==r?void 0:r.once)?(...t)=>{e.current.delete(i),i(...t)}:i;e.current.set(i,{type:n,eventTarget:t,fn:o,options:r}),t.addEventListener(n,o,r)}),[]),n=(0,r.useCallback)(((t,n,i,r)=>{var o;let s=(null===(o=e.current.get(i))||void 0===o?void 0:o.fn)||i;t.removeEventListener(n,s,r),e.current.delete(i)}),[]),i=(0,r.useCallback)((()=>{e.current.forEach(((e,t)=>{n(e.eventTarget,e.type,t,e.options)}))}),[n]);return(0,r.useEffect)((()=>i),[i]),{addGlobalListener:t,removeGlobalListener:n,removeAllGlobalListeners:i}}(),c=(0,r.useCallback)((e=>{e.currentTarget.contains(e.target)&&s.current.isFocusWithin&&!e.currentTarget.contains(e.relatedTarget)&&(s.current.isFocusWithin=!1,l(),n&&n(e),o&&o(!1))}),[n,o,s,l]),u=function(e){let t=(0,r.useRef)({isFocused:!1,observer:null});dA((()=>{const e=t.current;return()=>{e.observer&&(e.observer.disconnect(),e.observer=null)}}),[]);let n=gA((t=>{null==e||e(t)}));return(0,r.useCallback)((e=>{if(e.target instanceof HTMLButtonElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement){t.current.isFocused=!0;let i=e.target,r=e=>{if(t.current.isFocused=!1,i.disabled){let t=mA(e);n(t)}t.current.observer&&(t.current.observer.disconnect(),t.current.observer=null)};i.addEventListener("focusout",r,{once:!0}),t.current.observer=new MutationObserver((()=>{if(t.current.isFocused&&i.disabled){var e;null===(e=t.current.observer)||void 0===e||e.disconnect();let n=i===document.activeElement?null:document.activeElement;i.dispatchEvent(new FocusEvent("blur",{relatedTarget:n})),i.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:n}))}})),t.current.observer.observe(i,{attributes:!0,attributeFilter:["disabled"]})}}),[n])}(c),h=(0,r.useCallback)((e=>{if(!e.currentTarget.contains(e.target))return;const t=CA(e.target),n=VA(t);if(!s.current.isFocusWithin&&n===e.nativeEvent.target){i&&i(e),o&&o(!0),s.current.isFocusWithin=!0,u(e);let n=e.currentTarget;a(t,"focus",(e=>{if(s.current.isFocusWithin&&(i=n,!((r=e.target)&&i&&i.contains(r)))){let i=new t.defaultView.FocusEvent("blur",{relatedTarget:e.target});!function(e,t){Object.defineProperty(e,"target",{value:t}),Object.defineProperty(e,"currentTarget",{value:t})}(i,n);let r=mA(i);c(r)}var i,r}),{capture:!0})}}),[i,o,u,a,c]);return t?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:h,onBlur:c}}}const NP=[];function BP(e,t){let{onClose:n,shouldCloseOnBlur:i,isOpen:o,isDismissable:s=!1,isKeyboardDismissDisabled:a=!1,shouldCloseOnInteractOutside:l}=e;(0,r.useEffect)((()=>{if(o&&!NP.includes(t))return NP.push(t),()=>{let e=NP.indexOf(t);e>=0&&NP.splice(e,1)}}),[o,t]);let c=()=>{NP[NP.length-1]===t&&n&&n()};!function(e){let{ref:t,onInteractOutside:n,isDisabled:i,onInteractOutsideStart:o}=e,s=(0,r.useRef)({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),a=gA((e=>{n&&DP(e,t)&&(o&&o(e),s.current.isPointerDown=!0)})),l=gA((e=>{n&&n(e)}));(0,r.useEffect)((()=>{let e=s.current;if(i)return;const n=t.current,r=CA(n);if("undefined"!=typeof PointerEvent){let n=n=>{e.isPointerDown&&DP(n,t)&&l(n),e.isPointerDown=!1};return r.addEventListener("pointerdown",a,!0),r.addEventListener("click",n,!0),()=>{r.removeEventListener("pointerdown",a,!0),r.removeEventListener("click",n,!0)}}}),[t,i,a,l])}({ref:t,onInteractOutside:s&&o?e=>{l&&!l(e.target)||(NP[NP.length-1]===t&&(e.stopPropagation(),e.preventDefault()),c())}:void 0,onInteractOutsideStart:e=>{l&&!l(e.target)||NP[NP.length-1]===t&&(e.stopPropagation(),e.preventDefault())}});let{focusWithinProps:u}=FP({isDisabled:!i,onBlurWithin:e=>{e.relatedTarget&&!SP(e.relatedTarget,yP)&&(l&&!l(e.relatedTarget)||null==n||n())}});return{overlayProps:{onKeyDown:e=>{"Escape"!==e.key||a||e.nativeEvent.isComposing||(e.stopPropagation(),e.preventDefault(),c())},...u},underlayProps:{onPointerDown:e=>{e.target===e.currentTarget&&e.preventDefault()}}}}var zP,jP;Boolean((null===(jP=IS.config.panels)||void 0===jP||null===(zP=jP.debug)||void 0===zP?void 0:zP.state)===e.PluginState.alpha);const UP=e=>{const{newValue:t,setNewValue:n,mediaType:i}=e,r=(0,Pl.useStyles2)(VP),s=yC(t);let a=null==t?void 0:t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));return a.length>20&&(a=a.substring(0,20)+"..."),o().createElement(o().Fragment,null,o().createElement(Pl.Field,null,o().createElement(Pl.Input,{onChange:e=>n(e.currentTarget.value),value:t})),o().createElement("div",{className:r.iconContainer},o().createElement(Pl.Field,{label:"Preview"},o().createElement("div",{className:r.iconPreview},i===lC.Icon&&o().createElement(GC,{src:s,className:r.img}),i===lC.Image&&t&&o().createElement("img",{src:s,alt:"Preview of the selected URL",className:r.img}))),o().createElement(Pl.Label,null,a)))},VP=e=>({iconContainer:CS.css`
    display: flex;
    flex-direction: column;
    width: 80%;
    align-items: center;
    align-self: center;
  `,iconPreview:CS.css`
    width: 238px;
    height: 198px;
    border: 1px solid ${e.colors.border.medium};
    display: flex;
    align-items: center;
    justify-content: center;
  `,img:CS.css`
    width: 147px;
    height: 147px;
    fill: ${e.colors.text.primary};
  `});function $P({secondaryText:e="Drag and drop here or browse"}){const t=(0,Pl.useStyles2)(WP);return o().createElement("div",{className:t.iconWrapper},o().createElement("small",{className:t.small},e),o().createElement(Pl.Button,{type:"button",icon:"upload"},"Upload"))}const GP=({mediaType:e,setFormData:t,setUpload:n,error:i})=>{const s=(0,Pl.useStyles2)(WP),[a,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),h=()=>o().createElement(Pl.Field,{label:"Preview"},o().createElement("div",{className:s.iconPreview},e===lC.Icon&&o().createElement(GC,{src:c,className:s.img}),e===lC.Image&&o().createElement("img",{src:c,alt:"Preview of the uploaded file",className:s.img}))),d="icon"===e?{"image/*":[".svg",".xml"]}:{"image/*":[".jpeg",".png",".gif",".webp"]};return o().createElement(Pl.FileDropzone,{readAs:"readAsBinaryString",onFileRemove:e=>{fetch(`/api/storage/delete/upload/${e.file.name}`,{method:"DELETE"}).catch((e=>console.error("cannot delete file",e)))},options:{accept:d,multiple:!1,onDrop:e=>{let i=new FormData;i.append("file",e[0]),u(URL.createObjectURL(e[0])),l(!0),t(i),n(!0)}}},""!==i.message&&a?o().createElement("p",null,i.message):a?o().createElement(h,null):o().createElement($P,null))};function WP(e,t){return{container:CS.css`
      display: flex;
      flex-direction: column;
      width: 100%;
    `,dropzone:CS.css`
      display: flex;
      flex: 1;
      flex-direction: column;
      align-items: center;
      padding: ${e.spacing(6)};
      border-radius: 2px;
      border: 2px dashed ${e.colors.border.medium};
      background-color: ${t?e.colors.background.secondary:e.colors.background.primary};
      cursor: pointer;
    `,iconWrapper:CS.css`
      display: flex;
      flex-direction: column;
      align-items: center;
    `,acceptMargin:CS.css`
      margin: ${e.spacing(2,0,1)};
    `,small:CS.css`
      color: ${e.colors.text.secondary};
      margin-bottom: ${e.spacing(2)};
    `,iconContainer:CS.css`
      display: flex;
      flex-direction: column;
      width: 80%;
      align-items: center;
      align-self: center;
    `,iconPreview:CS.css`
      width: 238px;
      height: 198px;
      border: 1px solid ${e.colors.border.medium};
      display: flex;
      align-items: center;
      justify-content: center;
    `,img:CS.css`
      width: 147px;
      height: 147px;
      fill: ${e.colors.text.primary};
    `}}let HP;HP="undefined"!=typeof window?window:"undefined"!=typeof self?self:d.g;let ZP=null,qP=null;const XP=HP.clearTimeout,YP=HP.setTimeout,KP=HP.cancelAnimationFrame||HP.mozCancelAnimationFrame||HP.webkitCancelAnimationFrame,JP=HP.requestAnimationFrame||HP.mozRequestAnimationFrame||HP.webkitRequestAnimationFrame;null==KP||null==JP?(ZP=XP,qP=function(e){return YP(e,20)}):(ZP=function([e,t]){KP(e),XP(t)},qP=function(e){const t=JP((function(){XP(n),e()})),n=YP((function(){KP(t),e()}),20);return[t,n]});class QP extends r.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._didLogDeprecationWarning=!1,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:e,disableWidth:t,onResize:n}=this.props;if(this._parentNode){const i=window.getComputedStyle(this._parentNode)||{},r=parseFloat(i.paddingLeft||"0"),o=parseFloat(i.paddingRight||"0"),s=parseFloat(i.paddingTop||"0"),a=parseFloat(i.paddingBottom||"0"),l=this._parentNode.getBoundingClientRect(),c=l.height-s-a,u=l.width-r-o;if(!e&&this.state.height!==c||!t&&this.state.width!==u){this.setState({height:c,width:u});const e=()=>{this._didLogDeprecationWarning||(this._didLogDeprecationWarning=!0,console.warn("scaledWidth and scaledHeight parameters have been deprecated; use width and height instead"))};"function"==typeof n&&n({height:c,width:u,get scaledHeight(){return e(),c},get scaledWidth(){return e(),u}})}}},this._setRef=e=>{this._autoSizer=e}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(null!=t&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const n=t.ownerDocument.defaultView.ResizeObserver;null!=n?(this._resizeObserver=new n((()=>{this._timeoutId=setTimeout(this._onResize,0)})),this._resizeObserver.observe(t)):(this._detectElementResize=function(e){let t,n,i,r,o,s,a;const l="undefined"!=typeof document&&document.attachEvent;if(!l){s=function(e){const t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},o=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},a=function(e){if(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)return;const t=this;s(this),this.__resizeRAF__&&ZP(this.__resizeRAF__),this.__resizeRAF__=qP((function(){o(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))};let e=!1,l="";i="animationstart";const c="Webkit Moz O ms".split(" ");let u="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),h="";{const t=document.createElement("fakeelement");if(void 0!==t.style.animationName&&(e=!0),!1===e)for(let n=0;n<c.length;n++)if(void 0!==t.style[c[n]+"AnimationName"]){h=c[n],l="-"+h.toLowerCase()+"-",i=u[n],e=!0;break}}n="resizeanim",t="@"+l+"keyframes "+n+" { from { opacity: 0; } to { opacity: 0; } } ",r=l+"animation: 1ms "+n+"; "}return{addResizeListener:function(o,c){if(l)o.attachEvent("onresize",c);else{if(!o.__resizeTriggers__){const l=o.ownerDocument,c=HP.getComputedStyle(o);c&&"static"===c.position&&(o.style.position="relative"),function(n){if(!n.getElementById("detectElementResize")){const i=(t||"")+".resize-triggers { "+(r||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',o=n.head||n.getElementsByTagName("head")[0],s=n.createElement("style");s.id="detectElementResize",s.type="text/css",null!=e&&s.setAttribute("nonce",e),s.styleSheet?s.styleSheet.cssText=i:s.appendChild(n.createTextNode(i)),o.appendChild(s)}}(l),o.__resizeLast__={},o.__resizeListeners__=[],(o.__resizeTriggers__=l.createElement("div")).className="resize-triggers";const u=l.createElement("div");u.className="expand-trigger",u.appendChild(l.createElement("div"));const h=l.createElement("div");h.className="contract-trigger",o.__resizeTriggers__.appendChild(u),o.__resizeTriggers__.appendChild(h),o.appendChild(o.__resizeTriggers__),s(o),o.addEventListener("scroll",a,!0),i&&(o.__resizeTriggers__.__animationListener__=function(e){e.animationName===n&&s(o)},o.__resizeTriggers__.addEventListener(i,o.__resizeTriggers__.__animationListener__))}o.__resizeListeners__.push(c)}},removeResizeListener:function(e,t){if(l)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",a,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(i,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),null!==this._timeoutId&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:i=!1,disableWidth:o=!1,doNotBailOutOnEmptyChildren:s=!1,nonce:a,onResize:l,style:c={},tagName:u="div",...h}=this.props,{height:d,width:p}=this.state,f={overflow:"visible"},g={};let m=!1;return i||(0===d&&(m=!0),f.height=0,g.height=d,g.scaledHeight=d),o||(0===p&&(m=!0),f.width=0,g.width=p,g.scaledWidth=p),s&&(m=!1),(0,r.createElement)(u,{ref:this._setRef,style:{...f,...c},...h},!m&&e(g))}}function eI(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tI(e,t){return tI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tI(e,t)}var nI=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function iI(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!((i=e[n])===(r=t[n])||nI(i)&&nI(r)))return!1;var i,r;return!0}const rI=function(e,t){var n;void 0===t&&(t=iI);var i,r=[],o=!1;return function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return o&&n===this&&t(s,r)||(i=e.apply(this,s),o=!0,n=this,r=s),i}};var oI="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function sI(e){cancelAnimationFrame(e.id)}var aI=-1;var lI=null;function cI(e){if(void 0===e&&(e=!1),null===lI||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var i=document.createElement("div"),r=i.style;return r.width="100px",r.height="100px",t.appendChild(i),document.body.appendChild(t),t.scrollLeft>0?lI="positive-descending":(t.scrollLeft=1,lI=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),lI}return lI}var uI=function(e){var t=e.columnIndex;return e.data,e.rowIndex+":"+t};function hI(e){var t,n=e.getColumnOffset,i=e.getColumnStartIndexForOffset,o=e.getColumnStopIndexForStartIndex,s=e.getColumnWidth,a=e.getEstimatedTotalHeight,l=e.getEstimatedTotalWidth,c=e.getOffsetForColumnAndAlignment,u=e.getOffsetForRowAndAlignment,h=e.getRowHeight,d=e.getRowOffset,p=e.getRowStartIndexForOffset,f=e.getRowStopIndexForStartIndex,g=e.initInstanceProps,m=e.shouldResetStyleCacheOnItemSizeChange,_=e.validateProps;return(t=function(e){function t(t){var i;return(i=e.call(this,t)||this)._instanceProps=g(i.props,eI(i)),i._resetIsScrollingTimeoutId=null,i._outerRef=void 0,i.state={instance:eI(i),isScrolling:!1,horizontalScrollDirection:"forward",scrollLeft:"number"==typeof i.props.initialScrollLeft?i.props.initialScrollLeft:0,scrollTop:"number"==typeof i.props.initialScrollTop?i.props.initialScrollTop:0,scrollUpdateWasRequested:!1,verticalScrollDirection:"forward"},i._callOnItemsRendered=void 0,i._callOnItemsRendered=rI((function(e,t,n,r,o,s,a,l){return i.props.onItemsRendered({overscanColumnStartIndex:e,overscanColumnStopIndex:t,overscanRowStartIndex:n,overscanRowStopIndex:r,visibleColumnStartIndex:o,visibleColumnStopIndex:s,visibleRowStartIndex:a,visibleRowStopIndex:l})})),i._callOnScroll=void 0,i._callOnScroll=rI((function(e,t,n,r,o){return i.props.onScroll({horizontalScrollDirection:n,scrollLeft:e,scrollTop:t,verticalScrollDirection:r,scrollUpdateWasRequested:o})})),i._getItemStyle=void 0,i._getItemStyle=function(e,t){var r,o=i.props,a=o.columnWidth,l=o.direction,c=o.rowHeight,u=i._getItemStyleCache(m&&a,m&&l,m&&c),p=e+":"+t;if(u.hasOwnProperty(p))r=u[p];else{var f=n(i.props,t,i._instanceProps),g="rtl"===l;u[p]=r={position:"absolute",left:g?void 0:f,right:g?f:void 0,top:d(i.props,e,i._instanceProps),height:h(i.props,e,i._instanceProps),width:s(i.props,t,i._instanceProps)}}return r},i._getItemStyleCache=void 0,i._getItemStyleCache=rI((function(e,t,n){return{}})),i._onScroll=function(e){var t=e.currentTarget,n=t.clientHeight,r=t.clientWidth,o=t.scrollLeft,s=t.scrollTop,a=t.scrollHeight,l=t.scrollWidth;i.setState((function(e){if(e.scrollLeft===o&&e.scrollTop===s)return null;var t=i.props.direction,c=o;if("rtl"===t)switch(cI()){case"negative":c=-o;break;case"positive-descending":c=l-r-o}c=Math.max(0,Math.min(c,l-r));var u=Math.max(0,Math.min(s,a-n));return{isScrolling:!0,horizontalScrollDirection:e.scrollLeft<o?"forward":"backward",scrollLeft:c,scrollTop:u,verticalScrollDirection:e.scrollTop<s?"forward":"backward",scrollUpdateWasRequested:!1}}),i._resetIsScrollingDebounced)},i._outerRefSetter=function(e){var t=i.props.outerRef;i._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},i._resetIsScrollingDebounced=function(){var e,t,n,r;null!==i._resetIsScrollingTimeoutId&&sI(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=(e=i._resetIsScrolling,t=150,n=oI(),r={id:requestAnimationFrame((function i(){oI()-n>=t?e.call(null):r.id=requestAnimationFrame(i)}))})},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},(function(){i._getItemStyleCache(-1)}))},i}(function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,tI(e,t)})(t,e),t.getDerivedStateFromProps=function(e,t){return dI(e,t),_(e),null};var y=t.prototype;return y.scrollTo=function(e){var t=e.scrollLeft,n=e.scrollTop;void 0!==t&&(t=Math.max(0,t)),void 0!==n&&(n=Math.max(0,n)),this.setState((function(e){return void 0===t&&(t=e.scrollLeft),void 0===n&&(n=e.scrollTop),e.scrollLeft===t&&e.scrollTop===n?null:{horizontalScrollDirection:e.scrollLeft<t?"forward":"backward",scrollLeft:t,scrollTop:n,scrollUpdateWasRequested:!0,verticalScrollDirection:e.scrollTop<n?"forward":"backward"}}),this._resetIsScrollingDebounced)},y.scrollToItem=function(e){var t=e.align,n=void 0===t?"auto":t,i=e.columnIndex,r=e.rowIndex,o=this.props,s=o.columnCount,h=o.height,d=o.rowCount,p=o.width,f=this.state,g=f.scrollLeft,m=f.scrollTop,_=function(e){if(void 0===e&&(e=!1),-1===aI||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),aI=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return aI}();void 0!==i&&(i=Math.max(0,Math.min(i,s-1))),void 0!==r&&(r=Math.max(0,Math.min(r,d-1)));var y=a(this.props,this._instanceProps),v=l(this.props,this._instanceProps)>p?_:0,b=y>h?_:0;this.scrollTo({scrollLeft:void 0!==i?c(this.props,i,n,g,this._instanceProps,b):g,scrollTop:void 0!==r?u(this.props,r,n,m,this._instanceProps,v):m})},y.componentDidMount=function(){var e=this.props,t=e.initialScrollLeft,n=e.initialScrollTop;if(null!=this._outerRef){var i=this._outerRef;"number"==typeof t&&(i.scrollLeft=t),"number"==typeof n&&(i.scrollTop=n)}this._callPropsCallbacks()},y.componentDidUpdate=function(){var e=this.props.direction,t=this.state,n=t.scrollLeft,i=t.scrollTop;if(t.scrollUpdateWasRequested&&null!=this._outerRef){var r=this._outerRef;if("rtl"===e)switch(cI()){case"negative":r.scrollLeft=-n;break;case"positive-ascending":r.scrollLeft=n;break;default:var o=r.clientWidth,s=r.scrollWidth;r.scrollLeft=s-o-n}else r.scrollLeft=Math.max(0,n);r.scrollTop=Math.max(0,i)}this._callPropsCallbacks()},y.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&sI(this._resetIsScrollingTimeoutId)},y.render=function(){var e=this.props,t=e.children,n=e.className,i=e.columnCount,o=e.direction,s=e.height,c=e.innerRef,u=e.innerElementType,h=e.innerTagName,d=e.itemData,p=e.itemKey,f=void 0===p?uI:p,g=e.outerElementType,m=e.outerTagName,_=e.rowCount,y=e.style,v=e.useIsScrolling,b=e.width,x=this.state.isScrolling,w=this._getHorizontalRangeToRender(),E=w[0],S=w[1],T=this._getVerticalRangeToRender(),C=T[0],A=T[1],P=[];if(i>0&&_)for(var I=C;I<=A;I++)for(var M=E;M<=S;M++)P.push((0,r.createElement)(t,{columnIndex:M,data:d,isScrolling:v?x:void 0,key:f({columnIndex:M,data:d,rowIndex:I}),rowIndex:I,style:this._getItemStyle(I,M)}));var R=a(this.props,this._instanceProps),k=l(this.props,this._instanceProps);return(0,r.createElement)(g||m||"div",{className:n,onScroll:this._onScroll,ref:this._outerRefSetter,style:bT({position:"relative",height:s,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:o},y)},(0,r.createElement)(u||h||"div",{children:P,ref:c,style:{height:R,pointerEvents:x?"none":void 0,width:k}}))},y._callPropsCallbacks=function(){var e=this.props,t=e.columnCount,n=e.onItemsRendered,i=e.onScroll,r=e.rowCount;if("function"==typeof n&&t>0&&r>0){var o=this._getHorizontalRangeToRender(),s=o[0],a=o[1],l=o[2],c=o[3],u=this._getVerticalRangeToRender(),h=u[0],d=u[1],p=u[2],f=u[3];this._callOnItemsRendered(s,a,h,d,l,c,p,f)}if("function"==typeof i){var g=this.state,m=g.horizontalScrollDirection,_=g.scrollLeft,y=g.scrollTop,v=g.scrollUpdateWasRequested,b=g.verticalScrollDirection;this._callOnScroll(_,y,m,b,v)}},y._getHorizontalRangeToRender=function(){var e=this.props,t=e.columnCount,n=e.overscanColumnCount,r=e.overscanColumnsCount,s=e.overscanCount,a=e.rowCount,l=this.state,c=l.horizontalScrollDirection,u=l.isScrolling,h=l.scrollLeft,d=n||r||s||1;if(0===t||0===a)return[0,0,0,0];var p=i(this.props,h,this._instanceProps),f=o(this.props,p,h,this._instanceProps),g=u&&"backward"!==c?1:Math.max(1,d),m=u&&"forward"!==c?1:Math.max(1,d);return[Math.max(0,p-g),Math.max(0,Math.min(t-1,f+m)),p,f]},y._getVerticalRangeToRender=function(){var e=this.props,t=e.columnCount,n=e.overscanCount,i=e.overscanRowCount,r=e.overscanRowsCount,o=e.rowCount,s=this.state,a=s.isScrolling,l=s.verticalScrollDirection,c=s.scrollTop,u=i||r||n||1;if(0===t||0===o)return[0,0,0,0];var h=p(this.props,c,this._instanceProps),d=f(this.props,h,c,this._instanceProps),g=a&&"backward"!==l?1:Math.max(1,u),m=a&&"forward"!==l?1:Math.max(1,u);return[Math.max(0,h-g),Math.max(0,Math.min(o-1,d+m)),h,d]},t}(r.PureComponent)).defaultProps={direction:"ltr",itemData:void 0,useIsScrolling:!1},t}var dI=function(e,t){e.children,e.direction,e.height,e.innerTagName,e.outerTagName,e.overscanColumnsCount,e.overscanCount,e.overscanRowsCount,e.width,t.instance},pI=hI({getColumnOffset:function(e,t){return t*e.columnWidth},getColumnWidth:function(e,t){return e.columnWidth},getRowOffset:function(e,t){return t*e.rowHeight},getRowHeight:function(e,t){return e.rowHeight},getEstimatedTotalHeight:function(e){var t=e.rowCount;return e.rowHeight*t},getEstimatedTotalWidth:function(e){var t=e.columnCount;return e.columnWidth*t},getOffsetForColumnAndAlignment:function(e,t,n,i,r,o){var s=e.columnCount,a=e.columnWidth,l=e.width,c=Math.max(0,s*a-l),u=Math.min(c,t*a),h=Math.max(0,t*a-l+o+a);switch("smart"===n&&(n=i>=h-l&&i<=u+l?"auto":"center"),n){case"start":return u;case"end":return h;case"center":var d=Math.round(h+(u-h)/2);return d<Math.ceil(l/2)?0:d>c+Math.floor(l/2)?c:d;default:return i>=h&&i<=u?i:h>u||i<h?h:u}},getOffsetForRowAndAlignment:function(e,t,n,i,r,o){var s=e.rowHeight,a=e.height,l=e.rowCount,c=Math.max(0,l*s-a),u=Math.min(c,t*s),h=Math.max(0,t*s-a+o+s);switch("smart"===n&&(n=i>=h-a&&i<=u+a?"auto":"center"),n){case"start":return u;case"end":return h;case"center":var d=Math.round(h+(u-h)/2);return d<Math.ceil(a/2)?0:d>c+Math.floor(a/2)?c:d;default:return i>=h&&i<=u?i:h>u||i<h?h:u}},getColumnStartIndexForOffset:function(e,t){var n=e.columnWidth,i=e.columnCount;return Math.max(0,Math.min(i-1,Math.floor(t/n)))},getColumnStopIndexForStartIndex:function(e,t,n){var i=e.columnWidth,r=e.columnCount,o=e.width,s=t*i,a=Math.ceil((o+n-s)/i);return Math.max(0,Math.min(r-1,t+a-1))},getRowStartIndexForOffset:function(e,t){var n=e.rowHeight,i=e.rowCount;return Math.max(0,Math.min(i-1,Math.floor(t/n)))},getRowStopIndexForStartIndex:function(e,t,n){var i=e.rowHeight,r=e.rowCount,o=e.height,s=t*i,a=Math.ceil((o+n-s)/i);return Math.max(0,Math.min(r-1,t+a-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.columnWidth,e.rowHeight}});function fI(e,t){for(var n in e)if(!(n in t))return!0;for(var i in t)if(e[i]!==t[i])return!0;return!1}var gI=["style"],mI=["style"];function _I(e,t){var n=e.style,i=xT(e,gI),r=t.style,o=xT(t,mI);return!fI(n,r)&&!fI(i,o)}const yI=(0,r.memo)((function(e){const{columnIndex:t,rowIndex:n,style:i,data:r}=e,{cards:s,columnCount:a,onChange:l,selected:c}=r,u=s[t+n*a],h=(0,Pl.useStyles2)(bI);return o().createElement("div",{style:i},u&&o().createElement("div",{key:u.value,className:c===u.value?(0,CS.cx)(h.card,h.selected):h.card,onClick:()=>l(u.value),onKeyDown:e=>{"Enter"===e.key&&l(u.value)},role:"button",tabIndex:0},u.imgUrl.endsWith(".svg")?o().createElement(GC,{src:u.imgUrl,className:h.img}):o().createElement("img",{src:u.imgUrl,alt:"",className:h.img}),o().createElement("h6",{className:h.text},u.label)))}),_I),vI=e=>{const{onChange:t,cards:n,value:i}=e,r=(0,Pl.useStyles2)(bI);return o().createElement(QP,{defaultWidth:680},(({width:e,height:s})=>{const a=Math.floor(e/90),l=Math.ceil(n.length/a);return o().createElement(pI,{width:e,height:s,columnCount:a,columnWidth:90,rowCount:l,rowHeight:90,itemData:{cards:n,columnCount:a,onChange:t,selected:i},className:r.grid},yI)}))},bI=e=>({card:CS.css`
    display: inline-block;
    width: 90px;
    height: 90px;
    margin: 0.75rem;
    margin-left: 15px;
    text-align: center;
    cursor: pointer;
    position: relative;
    background-color: transparent;
    border: 1px solid transparent;
    border-radius: 8px;
    padding-top: 6px;
    :hover {
      border-color: ${e.colors.action.hover};
      box-shadow: ${e.shadows.z2};
    }
  `,selected:CS.css`
    border: 2px solid ${e.colors.primary.main};
    :hover {
      border-color: ${e.colors.primary.main};
    }
  `,img:CS.css`
    width: 40px;
    height: 40px;
    object-fit: cover;
    vertical-align: middle;
    fill: ${e.colors.text.primary};
  `,text:CS.css`
    color: ${e.colors.text.primary};
    white-space: nowrap;
    font-size: 12px;
    text-overflow: ellipsis;
    display: block;
    overflow: hidden;
  `,grid:CS.css`
    border: 1px solid ${e.colors.border.medium};
  `}),xI=["100baset-hub","10700","10ge-fcoe","15200","3x74-floor-cluster-control","6700-series","7500ars7513","accesspoint","ace","acs","adm","androgenous-person","antenna","asa-5500","asic-processor","asr-1000-series","ata","atm-3800","atm-fast-gigabit","atm-router","atm-switch","atm-tag-switch-router","avs","axp","bbsm","branch-office","breakout-box","bridge","broadcast-router","bts-10200","cable-modem","callmanager","car","carrier-routing-system","cddi-fddi","cdm","cell-phone","centri-firewall","cisco-1000","cisco-ca","cisco-file-engine","cisco-hub","cisco-security","cisco-unified-presence-server","cisco-unity-express","cisco-works","class-4-5-switch","cloud","communications-server","congtent-switch-module","contact-center","content-acquirer","content-engine-cache-director","content-service-router","content-service-switch-1100","content-switch","content-transformation-engine-","cs-mars","csm-s","csu-dsu","cube","detector","director-class-fibre-channel-di","directory-server","diskette","distributed-director","dot-dot","dpt","dslam","dual-mode","dwdm-filter","end-office","fax","fc-storage","fddi-ring","fibre-channel-disk-subsystem","fibre-channel-fabric-switch","file-cabinet","file-server","fileserver","firewall-service-module-fwsm","firewall","front-end-processor","gatekeeper","general-appliance","generic-building","generic-gateway","generic-processor","generic-softswitch","gigabit-switch-atm-tag-router","government-building","ground-terminal","guard","h323","handheld","hootphone","host","hp-mini","hub","iad-router","ibm-mainframe","ibm-mini-as400","ibm-tower","icm","ics","intelliswitch-stack","internet-streamer","ios-firewall","ios-slb","ip-communicator","ip-dsl","ip-phone","ip-telephony-router","ip","iptc","iptv-content-manager","iptv-server","iscsi-router","isdn-switch","itp","jbod","key","keys","lan-to-lan","laptop","layer-2-remote-switch","layer-3-switch","lightweight-ap","localdirector","lock","longreach-cpe","mac-woman","macintosh","man-woman","mas-gateway","mau","mcu","mdu","me1100","mediator","meetingplace","mesh-ap","metro-1500","mgx-8000-multiservice-switch","microphone","microwebserver","mini-vax","mobile-access-ip-phone","mobile-access-router","mobile-streamer","modem","moh-server","mse","multi-fabric-server-switch","multilayer-remote-switch","multiswitch-device","mux","mxe","nac-appliance","nce-router","nce","netflow-router","netranger","netsonar","network-management","network-security","nexus-1000","nexus-2000-fabric-extender","nexus-5000","nexus-7000","octel","ons15500","optical-amplifier","optical-services-router","optical-transport","pad-x28","pad","page-icon","pbx-switch","pbx","pc-adapter-card","pc-man","pc-routercard","pc-sosftware","pc-video","pc","pda","phone-fax","phone","pix-firewall","pmc","printer","programmable-switch","protocol-translator","pxf","radio-tower","ratemux","relational-database","repeater","rf-modem","route-switch-processor","router-firewall","router-in-building","router-with-silicon-switch","router","rpsrps","running-man","safeharbor-icon","sattelite-dish","sattelite","scanner","server-switch","server-with-router","service-control","service-module","service-router","services","set-top-box","simultlayer-switch","sip-proxy-server","sitting-woman","small-business","small-hub","softphone","softswitch-pgw-mgc","software-based-server","space-router","speaker","ssc","ssl-terminator","standard-host","standing-man","standing-woman","stb","storage-router","storge-server","stp","streamer","sun-workstation","supercomputer","svx","system-controller","tablet","tape-array","tdm-router","telecommuter-house-pc","telecommuter-house","telecommuter-icon","token","tp-mcu","transpath","truck","turret","tv","ubr910","umg-series","unity-server","universal-gateway","university","upc","ups","vault","video-camera","vip","virtual-layer-switch","virtual-switch-controller-vsc3","voice-atm-switch","voice-commserver","voice-router","voice-switch","vpn-concentrator","vpn-gateway","vss","wae","wavelength-router","web-browser","web-cluster","wi-fi-tag","wireless-location-appliance","wireless-router","wireless-transport","wireless","wirelss-bridge","wism","wlan-controller","workgroup-director","workgroup-switch","workstation","www-server"],wI=["a-b-switch","atm-switch-2","atm-switch","biometric-reader","bridge","data-pipe","building","camera","card-reader","cellphone","cloud","comm-link","copier","diagnostic-device","ethernet","external-hard-drive","external-media-drive","fax-machine","fiber-optic-2","fiber-optic","file-2","file-server","file","firewall","hub","keyboard","lock","mainframe","micro-webserver","modem","monitor","mouse","mpls-2","mpls","multi-function-machine","patch-panel","pbx","pc","phone","plotter","printer","project-screen-2","project-screen","projector-2","projector-3","projector","radio-tower","relational-database","repeater","ring-network","router","satellite-dish","satellite","scanner","server-2","server","smart-phone-2","smart-phone","standing-man","standing-woman","super-computer","switch","telephone","ups","user","video-camera","video-phone","virtual-server","voip-phone","web-service","wireless-access-point","wireless-router","working-person"],EI=["aerospike","airtable","apache-cassandra","apache-couchdb","apache-hadoop","apache-hbase","aws-dynamodb","aws-mobile-hub","aws-rds-relational-database-service","cloudera","couchbase","crateio","dat","database-labs","doctrine","flocker","google-firebase","ibm-cloudant","ibm-compose","influxdb","kinto","knexjs","leveldb","mariadb","memsql","mongodb-realm","mongodb","mysql","neo4j","nuodb","oracle","parse","percona","postgresql","pouchdb","prisma","pumpkindb","pusher","redis","redsmin","rethinkdb","riak","rocksdb","rxdb","scaledrone","sequelize","sqldep","sqlite"],SI="public/plugins/vaduga-mapgl-panel/img/icons/",TI=xI.map((e=>({label:e,value:`cisco/${e}`,search:e.toLowerCase(),imgUrl:SI+"cisco/"+e+".svg"}))),CI=wI.map((e=>({label:e,value:`networking/${e}`,search:e.toLowerCase(),imgUrl:SI+"networking/"+e+".svg"}))),AI=EI.map((e=>({label:e,value:`databases/${e}`,search:e.toLowerCase(),imgUrl:SI+"databases/"+e+".svg"}))),PI={[aC.Cisco]:TI,[aC.Networking]:CI,[aC.Databases]:AI},II=e=>{const{value:t,mediaType:n,folderName:i,newValue:s,setNewValue:a,maxFiles:l}=e,c=(0,Pl.useStyles2)(MI),u=(e=>e===lC.Icon?[aC.Networking,aC.Databases,aC.Cisco,aC.Custom]:[aC.BG])(n).map((e=>({label:e,value:e}))),[h,d]=(0,r.useState)(),[p,f]=(0,r.useState)(((e,t)=>{var n;return null!==(n=e.find((e=>{var n;const i=t.split("/").slice(0,-1).toString();return null==e||null===(n=e.value)||void 0===n?void 0:n.includes(i)})))&&void 0!==n?n:e[0]})(u,(null==t?void 0:t.length)?t:i)),[g,m]=(0,r.useState)([]),[_,y]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const e=null==p?void 0:p.value;if(e!==aC.Custom){if(e){const t=PI[e];m(t),y(t)}}else{const t=n===lC.Icon?e=>e.name.endsWith(".svg"):e=>e.name.endsWith(".png")||e.name.endsWith(".gif");(0,IS.getDataSourceSrv)().get("-- Grafana --").then((n=>{n.listFiles(e.replace(/^public\//,""),l).subscribe({next:n=>{const i=[];n.forEach((n=>{t(n);{const t=n.name.lastIndexOf(".");i.push({value:`${e}/${n.name}`,label:n.name,search:(t?n.name.substring(0,t):n.name).toLowerCase(),imgUrl:`${e}/${n.name}`})}})),m(i),y(i)}})}))}}),[n,p,l]),o().createElement(o().Fragment,null,o().createElement(Pl.Field,null,o().createElement(Pl.Select,{options:u,onChange:f,value:p,menuShouldPortal:!1})),o().createElement(Pl.Field,null,o().createElement(Pl.FilterInput,{value:null!=h?h:"",placeholder:"Search",onChange:e=>{var t;(t=e)?(t=t.toLowerCase(),y(g.filter((e=>e.search.includes(t))))):y(g),d(e)}})),_&&o().createElement("div",{className:c.cardsWrapper},o().createElement(vI,{cards:_,onChange:e=>a(e),value:s})))},MI=e=>({cardsWrapper:CS.css`
    height: 30vh;
    min-height: 50px;
    margin-top: 5px;
    max-width: 680px;
  `});function RI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const kI=e=>{const{value:t,onChange:n,mediaType:i,folderName:s,maxFiles:a}=e,l=(0,Pl.useStyles2)(OI),c=()=>{n(t)},u=(0,r.createRef)(),{dialogProps:h}=YA({},u),{overlayProps:d}=BP({onClose:c,isDismissable:!0,isOpen:!0},u),p=t&&t.includes("://"),[f,g]=(0,r.useState)(null!=t?t:""),[m,_]=(0,r.useState)(p?cC.URL:cC.Folder),[y,v]=(0,r.useState)(new FormData),[b,x]=(0,r.useState)(!1),[w,E]=(0,r.useState)({message:""}),S=e=>`${l.resourcePickerPopoverTab} ${m===e&&l.resourcePickerPopoverActiveTab}`,T=()=>o().createElement(o().Fragment,null,o().createElement(II,{value:t,mediaType:i,folderName:s,newValue:f,setNewValue:g,maxFiles:a}));return o().createElement(vP,{contain:!0,autoFocus:!0,restoreFocus:!0},o().createElement("section",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){RI(e,t,n[t])}))}return e}({ref:u},d,h),o().createElement("div",{className:l.resourcePickerPopover},o().createElement("div",{className:l.resourcePickerPopoverTabs},o().createElement("button",{className:S(cC.Folder),onClick:()=>_(cC.Folder)},"Folder"),o().createElement("button",{className:S(cC.URL),onClick:()=>_(cC.URL)},"URL")),o().createElement("div",{className:l.resourcePickerPopoverContent},(()=>{switch(m){case cC.Folder:return T();case cC.URL:return o().createElement(UP,{newValue:f,setNewValue:g,mediaType:i});case cC.Upload:return o().createElement(GP,{mediaType:i,setFormData:v,setUpload:x,newValue:f,error:w});default:return T()}})(),o().createElement("div",{className:l.buttonRow},o().createElement(Pl.Button,{variant:"secondary",onClick:()=>c(),fill:"outline"},"Cancel"),o().createElement(Pl.Button,{variant:f&&f!==t?"primary":"secondary",onClick:()=>{b?fetch("/api/storage/upload",{method:"POST",body:y}).then((e=>e.status>=400?void e.json().then((e=>E(e))):e.json())).then((e=>{(0,IS.getBackendSrv)().get(`api/storage/read/${e.path}`).then((()=>g(`${IS.config.appUrl}api/storage/read/${e.path}`))).then((()=>n(`${IS.config.appUrl}api/storage/read/${e.path}`)))})).catch((e=>console.error(e))):n(f)}},"Select"))))))},OI=e=>({resourcePickerPopover:CS.css`
    border-radius: ${e.shape.radius.default};
    box-shadow: ${e.shadows.z3};
    background: ${e.colors.background.primary};
    border: 1px solid ${e.colors.border.weak};
  `,resourcePickerPopoverTab:CS.css`
    width: 50%;
    text-align: center;
    padding: ${e.spacing(1,0)};
    background: ${e.colors.background.secondary};
    color: ${e.colors.text.secondary};
    font-size: ${e.typography.bodySmall.fontSize};
    cursor: pointer;
    border: none;

    &:focus:not(:focus-visible) {
      outline: none;
      box-shadow: none;
    }

    :focus-visible {
      position: relative;
    }
  `,resourcePickerPopoverActiveTab:CS.css`
    color: ${e.colors.text.primary};
    font-weight: ${e.typography.fontWeightMedium};
    background: ${e.colors.background.primary};
  `,resourcePickerPopoverContent:CS.css`
    width: 315px;
    font-size: ${e.typography.bodySmall.fontSize};
    min-height: 184px;
    padding: ${e.spacing(1)};
    display: flex;
    flex-direction: column;
  `,resourcePickerPopoverTabs:CS.css`
    display: flex;
    width: 100%;
    border-radius: ${e.shape.radius.default} ${e.shape.radius.default} 0 0;
  `,buttonRow:(0,CS.css)({display:"flex",justifyContent:"center",gap:e.spacing(2),padding:e.spacing(1)})});function LI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function DI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){LI(e,t,n[t])}))}return e}const FI=e=>{const{value:t,src:n,name:i,placeholder:s,onChange:a,onClear:l,mediaType:c,folderName:u,size:h,color:d,maxFiles:p}=e,f=(0,Pl.useStyles2)(BI),g=(0,Pl.useTheme2)(),m=(0,r.createRef)(),_=o().createElement(kI,{onChange:a,value:t,mediaType:c,folderName:u,maxFiles:p});let y=n;!y&&t&&(y=yC(t));const v=d&&{fill:g.visualization.getColorByName(d)};return o().createElement(Pl.PopoverController,{content:_},((e,r,a)=>{return o().createElement(o().Fragment,null,m.current&&o().createElement(Pl.Popover,(c=DI({},a),u={referenceElement:m.current,onMouseEnter:e,onKeyDown:e=>{((e,t)=>{"Tab"===e.key||e.altKey||e.ctrlKey||e.metaKey||(e.stopPropagation(),"Escape"===e.key&&t())})(e,r)}},u=null!=u?u:{},Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(u)).forEach((function(e){Object.defineProperty(c,e,Object.getOwnPropertyDescriptor(u,e))})),c)),o().createElement("div",{ref:m,className:f.pointer,onClick:e,onKeyDown:t=>{"Enter"===t.key&&e()},role:"button",tabIndex:0},h===uC.SMALL&&(t&&y?o().createElement(GC,{src:y,className:f.icon,style:DI({},v)}):o().createElement(Pl.LinkButton,{variant:"primary",fill:"text",size:"sm"},"Set icon")),h===uC.NORMAL&&o().createElement(Pl.Input,{value:NI(n,i),placeholder:s,readOnly:!0,prefix:y&&o().createElement(GC,{cleanStyle:!0,src:y,className:f.icon,style:DI({},v)}),suffix:o().createElement(Pl.Button,{icon:"times",variant:"secondary",fill:"text",size:"sm",onClick:l})})));var c,u}))};function NI(e,t){if(e){var n;const e=null!==(n=null==t?void 0:t.lastIndexOf(".svg"))&&void 0!==n?n:0;if(e>0)return t.substring(0,e)}return t}const BI=e=>({pointer:CS.css`
    cursor: pointer;
    input[readonly] {
      cursor: pointer;
    }
  `,icon:CS.css`
    vertical-align: middle;
    display: inline-block;
    fill: currentColor;
    width: 25px;
  `}),zI=({value:e,onChange:t,context:n,item:i})=>{var s;const a=null!==(s=i.settings)&&void 0!==s?s:{},l=qT(n.data,null==a?void 0:a.filter),c=XT(l,e,void 0,void 0,a.baseNameMode),u=(0,r.useCallback)((e=>{if(!e||function(e,t){return!!e&&(t.display.has(e)||t.raw.has(e))}(e.value,l))return t(null==e?void 0:e.value)}),[l,t]),h=c.find((t=>t.value===e));var d;return o().createElement(o().Fragment,null,o().createElement(Pl.Select,{value:h,placeholder:null!==(d=a.placeholderText)&&void 0!==d?d:"Select field",options:c,onChange:u,noOptionsMessage:a.noFieldsMessage,width:a.width,isClearable:!1!==a.isClearable}))};function jI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function UI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){jI(e,t,n[t])}))}return e}function VI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}oC.Fixed,oC.Field;const $I={settings:{}},GI=e=>{var t,n,i,s,a;const{value:l,context:c,onChange:u,item:h}=e,d=((0,r.useCallback)((e=>{u(VI(UI({},l),{mode:e}))}),[u,l]),(0,r.useCallback)(((e="")=>{u(VI(UI({},l),{field:e}))}),[u,l])),p=(0,r.useCallback)((e=>{u(VI(UI({},l),{fixed:null!=e?e:""}))}),[u,l]);var f;const g=null!==(f=null==l?void 0:l.mode)&&void 0!==f?f:oC.Fixed;var m;null===(t=h.settings)||void 0===t||t.showSourceRadio;const _=null!==(m=null===(n=h.settings)||void 0===n?void 0:n.resourceType)&&void 0!==m?m:lC.Icon;var y;const v=null!==(y=null===(i=h.settings)||void 0===i?void 0:i.folderName)&&void 0!==y?y:aC.Networking,b=null===(s=h.settings)||void 0===s?void 0:s.maxFiles;let x="";var w,E,S;return _===lC.Icon&&((null==l?void 0:l.fixed)?x=yC(l.fixed):(null===(w=h.settings)||void 0===w?void 0:w.placeholderValue)&&(x=yC(h.settings.placeholderValue))),o().createElement(o().Fragment,null,g!==oC.Fixed&&o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Field",labelWidth:9,grow:!0},o().createElement(o().Fragment,null,o().createElement(zI,{context:c,value:null!==(E=l.field)&&void 0!==E?E:"",onChange:d,item:$I})))),g===oC.Fixed&&o().createElement(FI,{onChange:p,onClear:e=>{e.stopPropagation(),u({mode:oC.Fixed,fixed:"",field:""})},value:null==l?void 0:l.fixed,src:x,placeholder:null===(a=h.settings)||void 0===a?void 0:a.placeholderText,name:null!==(S=WI(null==l?void 0:l.fixed))&&void 0!==S?S:"",mediaType:_,folderName:v,size:uC.NORMAL,maxFiles:b}),g===oC.Mapping&&o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Mappings",labelWidth:9,grow:!0},o().createElement("div",null,"TODO mappings editor!"))))};function WI(e){if(!e)return;const t=e.lastIndexOf("/");return t>0?e.substring(t+1):e}function HI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ZI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){HI(e,t,n[t])}))}return e}function qI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const XI={label:"Fixed value",value:"_____fixed_____"},YI=e=>{const{value:t,context:n,onChange:i,item:s}=e,{settings:a}=s,l=(0,Pl.useStyles2)(KI),c=null==t?void 0:t.field,u=Boolean(!c),h=XT(qT(n.data),c,XI,null==a?void 0:a.filteredFieldType),d=(0,r.useMemo)((()=>mC(a)),[a]),p=(0,r.useCallback)((e=>{i(function(e,t){let{min:n,max:i}=mC(t);if(e||(e={}),null==e.max&&(e.max=i),null==e.min&&(e.min=n),e.min>e.max){const t=e.max;e.max=e.min,e.min=t}return e.min<n&&(e.min=n),e.max>i&&(e.max=i),null==e.fixed&&(e.fixed=e.min+(e.max-e.min)/2),e.field||(e.fixed>i?e.fixed=i:e.fixed<n&&(e.fixed=n)),e}(e,d))}),[i,d]),f=(0,r.useCallback)((e=>{const n=e.value;p(qI(ZI({},t),n&&n!==XI.value?{field:n}:{field:void 0}))}),[p,t]),g=(0,r.useCallback)((e=>{void 0!==e&&p(qI(ZI({},t),{min:e}))}),[p,t]),m=(0,r.useCallback)((e=>{void 0!==e&&p(qI(ZI({},t),{max:e}))}),[p,t]),_=(0,r.useCallback)((e=>{void 0!==e&&p(qI(ZI({},t),{fixed:e}))}),[p,t]),y=null!=t?t:{},v=u?XI:h.find((e=>e.value===c));return o().createElement(o().Fragment,null,o().createElement("div",null,o().createElement(Pl.Select,{value:v,options:h,onChange:f,noOptionsMessage:"No fields found"})),o().createElement("div",{className:l.range},u&&o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Value",labelWidth:8,grow:!0},o().createElement(ZS,qI(ZI({value:y.fixed},d),{onChange:_})))),!u&&!d.hideRange&&o().createElement(o().Fragment,null,o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Min",labelWidth:8,grow:!0},o().createElement(ZS,qI(ZI({value:y.min},d),{onChange:g})))),o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Max",labelWidth:8,grow:!0},o().createElement(ZS,qI(ZI({value:y.max},d),{onChange:m})))))))},KI=e=>({range:CS.css`
    padding-top: 8px;
  `});iC.Mod,iC.Clamped;const JI=({value:e,onChange:t,item:n,suffix:i})=>{var s,a,l,c;const u=(null===(s=n.settings)||void 0===s?void 0:s.useTextarea)?Pl.TextArea:Pl.Input,h=(0,r.useCallback)((i=>{let r=null!=e?e:"";var o;"key"in i&&("Enter"!==i.key||(null===(o=n.settings)||void 0===o?void 0:o.useTextarea))||(r=i.currentTarget.value.trim()),r!==e&&t(""===r?void 0:r)}),[e,null===(a=n.settings)||void 0===a?void 0:a.useTextarea,t]);return o().createElement(u,{placeholder:null===(l=n.settings)||void 0===l?void 0:l.placeholder,defaultValue:e||"",rows:(null===(c=n.settings)||void 0===c?void 0:c.useTextarea)&&n.settings.rows||5,onBlur:h,onKeyDown:h,suffix:i})};function QI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){QI(e,t,n[t])}))}return e}function tM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const nM=[{label:"Fixed",value:rC.Fixed,description:"Fixed value"},{label:"Field",value:rC.Field,description:"Display field value"}],iM={settings:{}},rM={settings:{}},oM=({value:e,context:t,onChange:n})=>{const i=(0,r.useCallback)((t=>{n(tM(eM({},e),{mode:t}))}),[n,e]),s=(0,r.useCallback)((t=>{n(tM(eM({},e),{field:t}))}),[n,e]),a=(0,r.useCallback)(((t="")=>{n(tM(eM({},e),{fixed:t}))}),[n,e]);var l;const c=null!==(l=null==e?void 0:e.mode)&&void 0!==l?l:rC.Fixed;var u;return o().createElement(o().Fragment,null,o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Source",labelWidth:9,grow:!0},o().createElement(Pl.RadioButtonGroup,{value:c,options:nM,onChange:i,fullWidth:!0}))),c!==rC.Fixed&&o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Field",labelWidth:9,grow:!0},o().createElement(zI,{context:t,value:null!==(u=e.field)&&void 0!==u?u:"",onChange:s,item:iM}))),c===rC.Fixed&&o().createElement(Pl.InlineFieldRow,{key:null==e?void 0:e.fixed},o().createElement(Pl.InlineField,{label:"Value",labelWidth:9,grow:!0},o().createElement(JI,{context:t,value:null==e?void 0:e.fixed,onChange:a,item:rM,suffix:(null==e?void 0:e.fixed)&&o().createElement(Pl.Button,{icon:"times",variant:"secondary",fill:"text",size:"sm",onClick:()=>{a("")}})}))),c===rC.Template&&o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Template",labelWidth:9,grow:!0},o().createElement(JI,{context:t,value:null==e?void 0:e.fixed,onChange:a,item:rM}))))},sM=Object.freeze({size:{fixed:10,min:10,max:30},color:{fixed:"dark-green"},opacity:.4,textConfig:{fontSize:14}});function aM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function lM(e){var t,n;const i=null==e?void 0:e.text;return!!(i&&(i.mode===rC.Fixed&&(null===(t=i.fixed)||void 0===t?void 0:t.length)||i.mode===rC.Field&&(null===(n=i.field)||void 0===n?void 0:n.length)))}function cM(e){return(t=function*(){var t,n,i,r,o,s;e||(e=sM);const a=lM(e),l={};var c,u,h,d;const p={config:e,hasText:a,fields:l,base:{color:IS.config.theme2.visualization.getColorByName(null!==(c=null===(t=e.color)||void 0===t?void 0:t.fixed)&&void 0!==c?c:sM.color.fixed),opacity:null!==(u=e.opacity)&&void 0!==u?u:sM.opacity,lineWidth:null!==(h=e.lineWidth)&&void 0!==h?h:1,size:null!==(d=null===(n=e.size)||void 0===n?void 0:n.fixed)&&void 0!==d?d:sM.size.fixed}};var f,g,m,_;return(null===(r=e.color)||void 0===r||null===(i=r.field)||void 0===i?void 0:i.length)&&(l.color=e.color.field),(null===(s=e.size)||void 0===s||null===(o=s.field)||void 0===o?void 0:o.length)&&(l.size=e.size.field),a&&(p.base.text=null===(f=e.text)||void 0===f?void 0:f.fixed,p.base.textConfig=null!==(_=e.textConfig)&&void 0!==_?_:sM.textConfig,(null===(m=e.text)||void 0===m||null===(g=m.field)||void 0===g?void 0:g.length)&&(l.text=e.text.field)),Object.keys(l).length||(p.fields=void 0),p},function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){aM(o,i,r,s,a,"next",e)}function a(e){aM(o,i,r,s,a,"throw",e)}s(void 0)}))})();var t}function uM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){uM(e,t,n[t])}))}return e}function dM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const pM=e=>{var t;const{value:n,onChange:i,item:s}=e,{isAuxLayer:a}=s.settings,l=(0,r.useMemo)((()=>{var t;return null===(t=s.settings)||void 0===t||t.frameMatcher,e.context}),[e.context,s.settings]),c=s.settings,u=e=>{i(dM(hM({},n),{color:e}))},h=e=>{i(dM(hM({},n),{opacity:e}))},d=lM(n);var p,f,g,m,_,y,v,b;return(null==c?void 0:c.simpleFixedValues)?o().createElement(o().Fragment,null,o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Color",labelWidth:10},o().createElement(Pl.InlineLabel,{width:4},o().createElement(Pl.ColorPicker,{color:null!==(f=null==n||null===(p=n.color)||void 0===p?void 0:p.fixed)&&void 0!==f?f:sM.color.fixed,onChange:e=>{u({fixed:e})}})))),o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Opacity",labelWidth:10,grow:!0},o().createElement(WT,{value:null!==(g=null==n?void 0:n.opacity)&&void 0!==g?g:sM.opacity,context:l,onChange:h,item:{settings:{min:0,max:1,step:.1}}})))):o().createElement(o().Fragment,null,!a&&o().createElement(Pl.Field,{label:"Circle size"},o().createElement(YI,{value:null!==(m=null==n?void 0:n.size)&&void 0!==m?m:sM.size,context:l,onChange:e=>{i(dM(hM({},n),{size:e}))},item:{settings:{min:1,max:500,filteredFieldType:"number"}}})),o().createElement(Pl.Field,{label:a?"Fill color":"Circle color"},o().createElement(eC,{value:null!==(_=null==n?void 0:n.color)&&void 0!==_?_:sM.color,context:l,onChange:u,item:{settings:{filteredFieldType:"number"}}})),o().createElement(Pl.Field,{label:"Fill opacity"},o().createElement(WT,{value:null!==(y=null==n?void 0:n.opacity)&&void 0!==y?y:sM.opacity,context:l,onChange:h,item:{settings:{min:0,max:1,step:.1}}})),!a&&o().createElement(Pl.Field,{label:"Text label"},o().createElement(oM,{value:null!==(v=null==n?void 0:n.text)&&void 0!==v?v:sC,context:l,onChange:e=>{i(dM(hM({},n),{text:e}))},item:{}})),d&&o().createElement(o().Fragment,null,o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.Field,{label:"Font size"},o().createElement(qS,{value:null!==(b=null==n||null===(t=n.textConfig)||void 0===t?void 0:t.fontSize)&&void 0!==b?b:sM.textConfig.fontSize,context:l,onChange:e=>{i(dM(hM({},n),{textConfig:dM(hM({},n.textConfig),{fontSize:e})}))},item:{}})))))};function fM(e,t,n,i){const r={};var o,s;if(i&&Object.keys(i).length)r.color=fC(e,null!==(o=i.color)&&void 0!==o?o:sM.color,n),r.size=gC(e,null!==(s=i.size)&&void 0!==s?s:sM.size),i.text&&(i.text.field||i.text.fixed)&&(r.text=_C(e,i.text));else if(t.fields){var a,l;t.fields.color&&(r.color=fC(e,null!==(a=t.config.color)&&void 0!==a?a:sM.color,n)),t.fields.size&&(r.size=gC(e,null!==(l=t.config.size)&&void 0!==l?l:sM.size)),t.fields.text&&(r.text=_C(e,t.config.text))}return r}function gM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mM(t,n){if(n.every((e=>{const n=e.name;return t.hasOwnProperty(n)}))){if(n.every((n=>{const i=n.name;let r=[];r=n.type===e.FieldType.number?n.value.split(",").map((e=>parseInt(e,10))):n.value.split(",").map((e=>e.trim()));const o=t[i];return r.includes(o)})))return n.length}return-1}const _M=(e,t)=>t.map((t=>{return n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){gM(e,t,n[t])}))}return e}({},t),i=null!=(i={overrides:mM(e,t.overrides)})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})),n;var n,i})).filter((e=>-1!==e.overrides));function yM(e,t=[],n="cisco/atm-switch",i=20,r=-5){var o;const s=_M(e,t).sort(((e,t)=>t.overrides-e.overrides));let a=n,l=i,c=r;if(!t.length||!s.length)return{iconName:n,iconSize:i,iconVOffset:r};if(s[0]&&!(null==s||null===(o=s[0])||void 0===o?void 0:o.overrides)){const e=t.find((e=>0===e.overrides.length));return e?{iconName:e.iconName,iconSize:e.iconSize,iconVOffset:e.iconVOffset}:{iconName:n,iconSize:i,iconVOffset:r}}const u=s[0];return a=u.iconName,l=u.iconSize,c=u.iconVOffset,{iconName:a,iconSize:l,iconVOffset:c}}function vM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function bM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){bM(e,t,n[t])}))}return e}function wM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const EM={startId:0,direction:"target",vertices:{},searchProperties:[],show:!0,style:sM,jitterPoints:!1},SM=S.Points,TM={isShowBW:!1,throughputField:void 0,bandField:void 0,type:SM,name:"new data",config:EM,location:{mode:FS.Auto}};let CM;const AM={id:SM,name:"Markers and clusters",description:"nodes and edges from query",isBaseMap:!1,showLocation:!0,pointsUp:(t,n,i)=>{return(r=function*(){var r;const o=xM({},EM,n.config),s=yield VS(null==n?void 0:n.location);if(!t.series.length)return[];const a=n.locField,l=n.parField,c=n.edgeLabelField,u=n.isShowBW,h=n.bandField,d=n.throughputField,p=n.isShowTooltip,f=n.aggrTypeField,g=n.displayProperties;CM=n.searchProperties;const m=o.jitterPoints,_=o.startId,y=o.direction,v=o.vertices,b=o.locLabelName,x=o.svgIconRules,w=o.thresholds,E=SM,S=yield cM(o.style),T={};b&&(null===(r=t.annotations)||void 0===r?void 0:r.length)&&t.annotations[0].fields.length&&t.annotations.forEach((t=>{new e.DataFrameView(t).toArray().forEach((e=>{var t,n;(null==e?void 0:e.text)&&(e.labels=function(e){const t=e.match(/(\w+)\s*=\s*(\w+)/g);if(!t)return null;const n={};return t.forEach((e=>{const[t,i,r]=e.match(/(\w+)\s*=\s*(\w+)/);n[i]=r})),n}(null==e?void 0:e.text));const i=null===(t=e.labels)||void 0===t?void 0:t.alertname,r=null===(n=e.labels)||void 0===n?void 0:n[b];if(i){const t=T[i];if(t){const n=t.get(r);n?n.push(e):t.set(r,[e])}else{const t=new Map;t.set(e.labels[b],[e]),T[i]=t}}}))}));const C=new Map;for(const r of t.series){var A,P;if(S.dims=fM(r,S,i),!r.refId||n.query&&n.query.options===r.refId||(null===(A=r.meta)||void 0===A?void 0:A.transformations)&&(null===(P=r.meta.transformations)||void 0===P?void 0:P.length)>0){const t=$S(r,s);t.warning;const o=t.points;if(!o)return console.log("no coords"),[];const b=new e.DataFrameView(r).toArray(),A=[];let P=0;return o.forEach(((e,t)=>{var r,o,s,I;const{type:M,coordinates:R}=e,k=b[t],D=a&&k[a];if(!D)return;const F=c,N=n.bandNumber,B=h&&k[h],z=d&&k[d],j={type:"Point",coordinates:R.slice()},U=L(l&&k[l]);let V;const $=p&&g&&(null==g?void 0:g.length)?[...g,"ack","msg","all_annots"]:["ack","msg"],G=xM({},S.base),W=S.dims,H=null===(o=S.config)||void 0===o||null===(r=o.color)||void 0===r?void 0:r.field,Z=H?k[H]:void 0;W&&(W.color&&(G.color=W.color.get(t)),W.size&&(G.size=W.size.get(t)),W.text&&(G.text=W.text.get(t)));const q=null===(I=S.config)||void 0===I||null===(s=I.color)||void 0===s?void 0:s.fixed;G.fixedColor=q;const X=q&&i.visualization.getColorByName(q),Y=X?O(X):void 0;if(!D||v.hasOwnProperty(D)&&"source"!==y){const e=[a,l,"locName","sources","geojson","longitude","latitude","$streamId","$time","colType"];V=Object.fromEntries(Object.entries(xM(wM(xM({},k),{metric:Z}),z&&{bandNumber:N,bandWidth:B,throughput:z})).filter((([t])=>!e.includes(t))))}else{var K;const e=_+P;if(!(null===(K=v[D])||void 0===K?void 0:K.ptId)){if(v[D]=wM(xM({},v[D]),{ptId:e,tarCoords:R.slice()}),m&&2===(null==R?void 0:R.length)){const[e,t]=R,n=`${e},${t}`;C.has(n)||C.set(n,[]),C.get(n).push({idx:_+P,longitude:e,latitude:t})}let t,n=[];Object.keys(T).forEach((e=>{const t=T[e].get(D);(null==t?void 0:t.length)&&n.push(t)})),n.length&&(t=n);const i=xM(wM(xM(wM(xM({},k),{locName:D,edgeField:F,style:G}),u&&z&&{bandNumber:N,bandWidth:B,throughput:z}),{aggrType:f&&k[f],all_annots:t,colType:E}),p&&{isShowTooltip:p},$&&{displayProps:$}),r=rr(i,Z,w,Y),o=yM(i,x),s={id:_+P,type:"Feature",geometry:j,properties:wM(xM({},i),{threshold:xM({},r,o)})};A.push(s),P++}}if(Array.isArray(U)&&Array.isArray(U[0]))for(let e=0;e<U.length;e++){const t=PM(U,0,e,D);t.length&&IM(v,t,y,V)}else if(U){const e=PM(U,0,null,D);if(e.filter((e=>e&&("string"==typeof e||Array.isArray(e)))).length<2)return;IM(v,e,y,V)}})),m&&C.forEach((e=>{const t=e.length;if(t>1){let n=0,i=1;e.forEach((({idx:e,longitude:r,latitude:o},s)=>{var a;if(e&&"Point"===(null===(a=A[e])||void 0===a?void 0:a.geometry.type)){const s=A[e].geometry;s.coordinates[0]=r+5e-5*Math.cos(n),s.coordinates[1]=o+5e-5*Math.sin(n),n=2*Math.PI*i/(t+1),i+=1}}))}})),A}}return[]},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function s(e){vM(o,n,i,s,a,"next",e)}function a(e){vM(o,n,i,s,a,"throw",e)}s(void 0)}))})();var r},registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:pM,settings:{displayRotation:!0},defaultValue:EM.style}).addBooleanSwitch({path:"config.jitterPoints",name:"Jitter points",description:"Jitter points with same coordinates around each other",defaultValue:EM.jitterPoints})},defaultOptions:EM};function PM(e,t,n,i){if(!Array.isArray(e))return"string"==typeof e?[i,e]:[];const r=Array.isArray(e[n])?e[n]:e;return Array.isArray(r)&&"string"==typeof r[0]||!Array.isArray(r[0])&&"string"==typeof r?Array.isArray(r)&&1===r.length?[i,r[0]]:r[0]!==i?[i,...r]:r:[]}function IM(e,t,n,i){var r;const o=t[0],s=t.at(-1),a="source"===n,l=a?s:o,c=a?o:s,u=a?t.slice().reverse():t,h=null===(r=e[l])||void 0===r?void 0:r.sources;var d,p;h?h[c]?(null==h||null===(d=h[c])||void 0===d?void 0:d.lineExtraProps)&&(h[c]=wM(xM({},h[c]),{lineExtraProps:xM({},null===(p=h[c])||void 0===p?void 0:p.lineExtraProps,Object.fromEntries(Object.entries(i||{}).filter((([e,t])=>null!=t&&""!==t))))})):h[c]=xM({parPath:u},i?{lineExtraProps:i}:{}):e[l]=wM(xM({},e[l]),{sources:{[c]:{parPath:u}}})}const MM=Vl((e=>{var{selectHandler:t,total:n,wait:i=300,value:s="",placeholder:a="Search",aggrTypesOnly:l=!1,noAggrTypes:c=!1,isMainLocSearch:u=!1}=e;!function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}}(e,["selectHandler","total","wait","value","placeholder","aggrTypesOnly","noAggrTypes","isMainLocSearch"]),(0,Pl.useStyles2)(RM);const{pointStore:h,viewStore:d}=Pk(),{switchMap:p,getSelectedIp:f}=h,{setViewState:g}=d,m=(0,r.useMemo)((()=>p?Array.from(p,(([e,t])=>{const n=[CM].filter((e=>null==e?void 0:e.length)).reduce(((e,t)=>e.concat(t)),[]),i=(n&&n.length?n:[]).map((e=>t.properties[e])).join(" "),r=F(null==t?void 0:t.geometry);return{label:`${e} ${i}`,value:e,color:t.properties.iconColor,coord:r,aggrType:t.properties.aggrType}})):[]),[n]),_=l?m.filter((e=>E.includes(null==e?void 0:e.aggrType))):c?m.filter((e=>!E.includes(null==e?void 0:e.aggrType))):m,y=`Search: ${n}`,v=u?f:s;return o().createElement(Pl.Select,{virtualized:!0,options:_,isSearchable:!0,value:""!==v?v:null,placeholder:y,onChange:e=>{t(e.value,null,!0,!0)}})})),RM=e=>({});function kM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function OM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const LM=e=>({inlineRow:CS.css`
      display: flex;
      align-items: center;
      pointer-events: all;
    `,myMenu:CS.css`
    color: grey;    
    font-size: 0.9em;
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    z-index: 9;
    top: ${e.spacing(1)};
    left: ${e.spacing(1)};
    width: auto;    
    // min-width: 15%;
    background: none;
    pointer-events: none;

     > div,button, ul, input, p  {    
     }
`,field:CS.css`
      margin-top: ${e.spacing(.1)};
      margin-right: ${e.spacing(1.5)};
    `}),DM=Vl((({setShowCenter:e,total:t})=>{const{pointStore:n,lineStore:i,viewStore:r,replaceVariables:s}=Pk(),{getViewState:a,setViewState:l,getClusterMaxZoom:c,setClusterMaxZoom:u}=r,{switchMap:h,setSelectedIp:d,setTooltipObject:p,getSelectedIp:f}=n,{getDirection:g,setDirection:m}=i,_=["target","source"].includes(s("$locRole")),y=(0,Pl.useStyles2)(LM),v=[];for(let e=18;e>=2;e--)v.push({label:e.toString(),value:e});return o().createElement("div",{className:y.myMenu},o().createElement(Pl.InlineFieldRow,{className:y.inlineRow},o().createElement(Pl.InlineField,{className:y.field},o().createElement(MM,{aggrTypesOnly:!1,total:t,value:f,isMainLocSearch:!0,selectHandler:(t,n,i=!0,r=!0,o)=>{return(s=function*(){t&&i?d(t,null):t&&!r||null==o||d(null,[o]);const s=null==h?void 0:h.get(t);if(r&&(s||n)){const t=F(null==s?void 0:s.geometry);(n||t)&&(0,Il.flushSync)((()=>{var r,o,s,c;e(i),l((s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){OM(e,t,n[t])}))}return e}({},a),c=null!=(c={longitude:n?n[0]:t[0],latitude:n?n[1]:t[1],transitionDuration:250,maxPitch:42.75,zoom:null!==(o=null==dk||null===(r=dk.transform)||void 0===r?void 0:r.zoom)&&void 0!==o?o:18})?c:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(c)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(c)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(c,e))})),s))}))}},function(){var e=this,t=arguments;return new Promise((function(n,i){var r=s.apply(e,t);function o(e){kM(r,n,i,o,a,"next",e)}function a(e){kM(r,n,i,o,a,"throw",e)}o(void 0)}))})();var s}})),o().createElement(Pl.InlineField,{className:y.field},o().createElement(Pl.Tooltip,{content:"cluster max zoom"},o().createElement("div",null,o().createElement(Pl.Select,{onChange:e=>{e.value&&u(e.value)},value:c,options:v})))),o().createElement(Pl.InlineField,{className:y.field},o().createElement(Pl.Tooltip,{content:"swap tar-src"},o().createElement("div",null,o().createElement(Pl.Switch,{value:"source"===g,title:"path reverse",onChange:()=>{d(""),p({}),m("target"===g?"source":"target"),_&&IS.locationService.partial({"var-locRole":"target"===g?"source":"target"},!0)}}))))),o().createElement(PS,null))}));function FM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NM(e,t){return"object"==typeof e&&null!==e?o().createElement("ul",null,Object.entries(e).map((([n,i],r)=>o().createElement(o().Fragment,null,t&&"labels"===n?i&&Object.entries(i).map((([e,t],r)=>o().createElement("span",{key:`${n}-${r}`},`${e}: ${t}`,r!==Object.keys(i).length-1?", ":""))):Array.isArray(i)?i.map(((e,t)=>o().createElement("span",{key:t},`${t}: ${e}`,t!==i.length-1?", ":""))):o().createElement("span",null,`${n}: ${i}`),r!==Object.keys(e).length-1?", ":""))),o().createElement("br",null)," "):e}const BM=({parent:e,props:t,getSelectedIp:n,getDirection:i})=>o().createElement(Pl.IconButton,{key:"setVars",variant:"primary",name:"graph-bar",size:"sm",tooltip:"set vars",tooltipPlacement:"left",onClick:()=>{!function({parent:e,props:t,getSelectedIp:n,getDirection:i}){const[r,o]="target"===i?[n,e]:[e,n];IS.locationService.partial({"var-target":null!=r?r:"","var-source":null!=o?o:""},!0)}({parent:e,props:t,getSelectedIp:n,getDirection:i})}});function zM({object:t,time:n,timeZone:i,pinned:r=!1,getSelectedIp:s="",setSelectedIp:a,getDirection:l,setTooltipObject:c,setClosedHint:u}){var h,d,p;const f=null!==(p=null!==(d=null==t?void 0:t.properties)&&void 0!==d?d:t)&&void 0!==p?p:{};let g=null==f?void 0:f.displayProps;const m=Array.isArray(g)?g.reduce(((e,t)=>(f.hasOwnProperty(t)&&(Array.isArray(f[t])?e[t]=f[t].map((e=>e)):e[t]=f[t]),e)),{}):f;let _;if(m.hasOwnProperty("all_annots")){const t=R(m.all_annots,n),i=[];(null==t?void 0:t.length)&&(null==t||t.forEach((t=>{if(!t)return;const{labels:n,newState:r,timeEnd:o}=t,{grafana_folder:s}=n,a=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(n,["grafana_folder"]),l=t.timeEnd,c={};l&&(c.timeF=(0,e.dateTime)(l).format("YYYY-MM-DD HH:mm:ss"));const u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){FM(e,t,n[t])}))}return e}({labels:a,newState:r,timeEnd:o},c);i.push(u)})),_=i),delete m.all_annots}const y=f.ptId&&Array.isArray(f.parPath)&&f.parPath.length?[null===(h=f.parPath)||void 0===h?void 0:h.at(-1)]:f.sources&&Object.keys(f.sources),v=null==y?void 0:y.map(((e,t)=>o().createElement("li",{key:""+t},r&&o().createElement(BM,{parent:e,props:f,getSelectedIp:s,getDirection:l}),"target"===l?"src: ":"tar: ",o().createElement("a",{onClick:()=>{var t;return a(s,[null===(t=f.sources[e])||void 0===t?void 0:t.lineId])}},e))));return o().createElement(o().Fragment,null,o().createElement("ul",null,f.locName&&o().createElement("li",{key:"locName"},r&&o().createElement(o().Fragment,null,o().createElement(Pl.IconButton,{key:"closeHint",variant:"destructive",name:"x",size:"sm",tooltip:"close",tooltipPlacement:"left",onClick:()=>{c({}),u(!0)}}),!(null==v?void 0:v.length)&&o().createElement(BM,{props:f,getSelectedIp:s,getDirection:l})),"target"===l?"tar: ":"src: ",o().createElement("a",{onClick:()=>a(s,null)},f.locName)),v,Object.entries(m).map((([e,t])=>o().createElement("li",{key:e},`${e}: ${NM(t,!1)}`))),(null==_?void 0:_.length)&&o().createElement(o().Fragment,null,o().createElement("li",{key:"ans"},_.map(((e,t)=>o().createElement("li",{key:t},NM(e,!0))))))))}const jM=({info:e,time:t,timeZone:n,isClosed:i=!1,setTooltipObject:r,setClosedHint:s,position:a=0})=>{var l,c,u;const h=(0,Pl.useStyles2)((e=>({tooltip:CS.css`
      position: absolute;
      left: ${a-80}px;
      top: 150px;
      pointer-events: none;      
      text-align: left;
      user-select: text;
      cursor: text;      
      font-size: 1em;
      border-radius: 5px;
      border: ${e.isDark?"none":"solid #c7c3c3"};
      background: ${e.isDark?e.colors.background.primary:"#EAEAEA"}; 
      color: ${e.colors.getContrastText(e.colors.background.canvas)}; 
      min-width: 25px;
      max-width: 400px;
      //overflow-y: hidden;
      margin: 5px;
      padding: 8px;
      z-index: 3;
      opacity: 0.95;
      ul {
      list-style-type: none }
    `,turnOnEvents:CS.css`
 position: absolute;
      left: ${a-80}px;
      top: 150px;
      text-align: left;
      user-select: text;
      cursor: text;      
      font-size: 1em;
      border-radius: 5px;
      border: ${e.isDark?"none":"solid #c7c3c3"};
      background: ${e.isDark?e.colors.background.primary:"#EAEAEA"}; 
      color: ${e.colors.getContrastText(e.colors.background.canvas)}; 
      min-width: 25px;
      max-width: 400px;
      //overflow-y: hidden;
      margin: 5px;
      padding: 8px;
      z-index: 10;
      opacity: 0.95;
      ul {
      list-style-type: none }
        pointer-events: all`}))),{pointStore:d,lineStore:p}=Pk(),{getMode:f,getTooltipObject:g,getSelectedIp:m,setSelectedIp:_,getSelIds:y}=d,{getDirection:v}=p;if(!Object.entries(e).length)return null;const{x=-3e3,y:w=-3e3,object:E}=e;if(!E){if(i||"modify"===f)return null;const{x:e=-3e3,y:a=-3e3,object:l}=g;return o().createElement("div",{className:h.turnOnEvents,style:{left:e,top:a}},zM({object:l,time:t,timeZone:n,pinned:!0,getSelectedIp:m,setSelectedIp:_,getDirection:v,setTooltipObject:r,setClosedHint:s}))}if(!(null==E?void 0:E.isShowTooltip)&&!(null==E||null===(l=E.properties)||void 0===l?void 0:l.isShowTooltip)&&!(null==E||null===(c=E.properties)||void 0===c?void 0:c.cluster))return null;if(null==E||null===(u=E.properties)||void 0===u?void 0:u.cluster){if(i)return null;const{colorCounts:e,annotStateCounts:t}=E.properties;if(e){const n=Object.entries(e).map((([e,t],n)=>o().createElement(o().Fragment,{key:e},n>0&&o().createElement("br",null),o().createElement("span",{style:{color:e,fontWeight:"bold"}},`${t.label?t.label:e}: ${t.count}`)))),i=[];[b.Alerting,b.Pending,b.Normal].forEach((e=>{if((null==t?void 0:t[e])&&Object.keys(null==t?void 0:t[e]).length){const n=t[e];i.push([e,n])}}));const r=i.map((([e,t],n)=>o().createElement(o().Fragment,{key:e},n>0&&o().createElement("br",null),o().createElement("span",{style:{color:e,fontWeight:"bold"}},`${t.label?t.label:e}: ${t.count}`))));return n.length?o().createElement("div",{className:h.tooltip,style:{left:x,top:w}},o().createElement("div",null,n),0!==(null==r?void 0:r.length)&&o().createElement("div",null,o().createElement("br",null),o().createElement("span",null,"States: "),o().createElement("br",null),r)):null}}var S;return"modify"===f&&(null===(S=E.properties)||void 0===S?void 0:S.guideType)?null:o().createElement("div",{className:h.tooltip,style:{left:x,top:w}},zM({object:E,time:t,timeZone:n,pinned:!1,setTooltipObject:r,setClosedHint:s,getDirection:v,getSelectedIp:m,setSelectedIp:_}))};function UM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const VM={theme:"auto",showLabels:!0},$M={id:"carto",name:"CARTO reference map",isBaseMap:!0,defaultOptions:VM,create:(e,t)=>({init:()=>{const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){UM(e,t,n[t])}))}return e}({},VM,e.config);let i=n.theme;return i&&"auto"!==i||(i=t.isDark?"dark":"light"),n.showLabels?i+="_all":i+="_nolabels",{version:8,sources:{carto:{type:"raster",tiles:[`https://basemaps.cartocdn.com/${i}/{z}/{x}/{y}.png`],tileSize:256,attribution:" CARTO"}},layers:[{id:"carto",type:"raster",source:"carto",minzoom:0,maxzoom:20}]}}}),registerOptionsUI:e=>{e.addRadio({path:"config.theme",name:"Theme",settings:{options:[{value:"auto",label:"Auto",description:"Match grafana theme"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},defaultValue:VM.theme}).addBooleanSwitch({path:"config.showLabels",name:"Show labels",description:"",defaultValue:VM.showLabels})}},GM=[$M];var WM,HM;const ZM=Boolean((null===(HM=IS.config.panels)||void 0===HM||null===(WM=HM.debug)||void 0===WM?void 0:WM.state)===e.PluginState.alpha);function qM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const XM="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",YM={url:XM+"/tile/{z}/{y}/{x}",attribution:`Tiles  <a href="${XM}">ArcGIS</a>`},KM={id:"xyz",name:"XYZ Tile layer",isBaseMap:!0,create:(e,t)=>({init:()=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){qM(e,t,n[t])}))}return e}({},e.config);var n,i,r,o;return t.url||(t.url=YM.url,t.attribution=null!==(i=null!==(n=t.attribution)&&void 0!==n?n:YM.attribution)&&void 0!==i?i:""),t.attribution||(t.attribution=null!==(o=null!==(r=t.attribution)&&void 0!==r?r:YM.attribution)&&void 0!==o?o:""),{version:8,sources:{xyz:{type:"raster",tiles:[t.url],tileSize:256,attribution:t.attribution}},layers:[{id:"xyz",type:"raster",source:"xyz",minzoom:0,maxzoom:20}]}}}),registerOptionsUI:e=>{e.addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",settings:{placeholder:YM.url}}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:YM.attribution}})}},JM=[KM];function QM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){QM(e,t,n[t])}))}return e}const tR="custom",nR="streets",iR=new e.Registry((()=>[{id:nR,name:"World Street Map",slug:"World_Street_Map"},{id:"world-imagery",name:"World Imagery",slug:"World_Imagery"},{id:"world-physical",name:"World Physical",slug:"World_Physical_Map"},{id:"topo",name:"Topographic",slug:"World_Topo_Map"},{id:"usa-topo",name:"USA Topographic",slug:"USA_Topo_Maps"},{id:"ocean",name:"World Ocean",slug:"Ocean/World_Ocean_Base"},{id:tR,name:"Custom MapServer",description:"Use a custom MapServer with pre-cached values",slug:""}])),rR={id:"esri-xyz",name:"ArcGIS MapServer",isBaseMap:!0,create:(e,t)=>{const n=eR({},e.config);var i;const r=iR.getIfExists(null!==(i=n.server)&&void 0!==i?i:nR);if(r.id!==tR){const e="https://services.arcgisonline.com/ArcGIS/rest/services/";n.url=`${e}${r.slug}/MapServer/tile/{z}/{y}/{x}`,n.attribution=`Tiles  <a href="${e}${r.slug}/MapServer">ArcGIS</a>`}const o=(s=eR({},e),a=null!=(a={config:n})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(a)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(a,e))})),s);var s,a;return KM.create&&KM.create(o,t)},registerOptionsUI:e=>{e.addSelect({path:"config.server",name:"Server instance",settings:{options:iR.selectOptions().options}}).addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",defaultValue:YM.url,settings:{placeholder:YM.url},showIf:e=>{var t;return(null===(t=e.config)||void 0===t?void 0:t.server)===tR}}).addTextInput({path:"config.attribution",name:"Attribution",defaultValue:YM.attribution,settings:{placeholder:YM.attribution},showIf:e=>{var t;return(null===(t=e.config)||void 0===t?void 0:t.server)===tR}})},defaultOptions:{server:nR}};function oR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const sR="https://wms.wheregroup.com/tileserver/style/osm-liberty.json",aR={url:sR,attribution:`Tiles  <a href="${sR}">wheregroup.com</a>`},lR={id:"fromjson",name:"From .json",isBaseMap:!0,create:(e,t)=>({init:()=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){oR(e,t,n[t])}))}return e}({},e.config);var n;return t.url||(t.url=aR.url,t.attribution=null!==(n=t.attribution)&&void 0!==n?n:aR.attribution),t.url}}),registerOptionsUI:e=>{e.addTextInput({path:"config.url",name:"URL template",description:"Json file url",settings:{placeholder:aR.url}}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:aR.attribution}})}},cR=[{id:"osm-standard",name:"Open Street Map",isBaseMap:!0,create:(e,t)=>({init:()=>({version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap Contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:20}]})})},...GM,rR,...JM,lR];function uR(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function hR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){hR(e,t,n[t])}))}return e}function pR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const fR={colIdx:0,startId:0,globalThresholdsConfig:[],style:sM},gR=S.Polygons,mR=(FS.Auto,{id:gR,name:"Polygons layer",description:"GeoJson Polygons from query",isBaseMap:!1,showLocation:!0,pointsUp:(t,n,i)=>{return(r=function*(){var r;const o=dR({},fR,n.config),s=yield VS(n.location);if(!t.series.length)return[];const a=n.locField,l=n.isShowTooltip,c=n.displayProperties,u=(o.colIdx,gR),h=yield cM(o.style),d=null==n||null===(r=n.config)||void 0===r?void 0:r.globalThresholdsConfig;for(const r of t.series)if(h.dims=fM(r,h,i),n.query&&n.query.options===r.refId){const t=$S(r,s);if(t.warning&&console.log("Could not find locations",t.warning),!t.points)return console.log("no coords"),[];const n=new e.DataFrameView(r).toArray(),p=t.points.map(((e,t)=>{var r,s;const p=n[t],f=l&&c&&(null==c?void 0:c.length)?[...c,"ack","msg","all_annots","liveStat"]:["ack","msg","all_annots","liveStat"],g=dR({},h.base),m=h.dims,_=null===(s=h.config)||void 0===s||null===(r=s.color)||void 0===r?void 0:r.field,y=_?p[_]:void 0;var v,b;m&&(m.color&&(g.color=m.color.get(t)),m.size&&(g.size=m.size.get(t)),m.text&&(g.text=m.text.get(t)),g.fixedColor=null===(b=h.config)||void 0===b||null===(v=b.color)||void 0===v?void 0:v.fixed);const x=g.fixedColor,w=x&&i.visualization.getColorByName(x),E=w?O(w):void 0,S=Object.entries(p);var T;const C=S.length>0&&a?null!==(T=p[a])&&void 0!==T?T:S[0][1]:void 0,A=dR(pR(dR({},p),{locName:C,style:g,colType:u}),l&&{isShowTooltip:l},f&&{displayProps:f}),P=rr(A,y,d,E);return{id:o.startId+t,type:"Polygon",geometry:e,properties:pR(dR({},A),{threshold:P})}}));return p}return[]},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function s(e){uR(o,n,i,s,a,"next",e)}function a(e){uR(o,n,i,s,a,"throw",e)}s(void 0)}))})();var r},registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:pM,settings:{isAuxLayer:!0,displayRotation:!0},defaultValue:fR.style})},defaultOptions:fR});function _R(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function yR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){yR(e,t,n[t])}))}return e}function bR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const xR={startId:0,colIdx:0,style:sM},wR=S.GeoJson,ER=(FS.Auto,{id:wR,name:"GeoJson layer",description:"GeoJson features from file (url)",isBaseMap:!1,showLocation:!0,pointsUp:(e,t,n)=>{return(i=function*(){var i;const r=vR({},xR,t.config);if(!e.series.length)return[];const o=t.geojsonLocName,s=(t.geojsonMetricName,t.isShowTooltip),a=t.geojsonDisplayProperties,l=(r.colIdx,wR),c=((null==t?void 0:t.geojsonColor)&&O(n.visualization.getColorByName(null==t?void 0:t.geojsonColor)),yield cM(r.style)),u=null==t||null===(i=t.config)||void 0===i?void 0:i.globalThresholdsConfig,h=null==t?void 0:t.geojsonurl;if(h){var d,p;let e=yield fetch(h,{method:"GET",headers:{"Content-Type":"application/json"}}).catch((e=>{console.log(e)}));if(!e)return[];let t=yield e.json();if(!(null==t||null===(d=t.features)||void 0===d?void 0:d.length))return console.log("no geodata"),[];c.dims=fM(void 0,c,n);const i=null==t||null===(p=t.features)||void 0===p?void 0:p.map(((e,t)=>{var i,h;const{geometry:d,properties:p}=e,f=s&&a&&(null==a?void 0:a.length)?[...a,"ack","msg","all_annots","liveStat"]:["ack","msg","all_annots","liveStat"],g=vR({},c.base),m=c.dims,_=null===(h=c.config)||void 0===h||null===(i=h.color)||void 0===i?void 0:i.field,y=_?e[_]:void 0;var v,b;m&&(m.color&&(g.color=m.color.get(t)),m.size&&(g.size=m.size.get(t)),m.text&&(g.text=m.text.get(t)),g.fixedColor=null===(b=c.config)||void 0===b||null===(v=b.color)||void 0===v?void 0:v.fixed);const x=g.fixedColor,w=x&&n.visualization.getColorByName(x),E=w?O(w):void 0,S=(Object.entries(e),vR(bR(vR({},e),{locName:o?p[o]:void 0,style:g,colType:l}),s&&{isShowTooltip:s},f&&{displayProps:f})),T=rr(S,y,u,E);return{id:r.startId+t,type:"Feature",geometry:d,properties:bR(vR({},S),{threshold:T})}}));return i}return[]},function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function s(e){_R(o,n,r,s,a,"next",e)}function a(e){_R(o,n,r,s,a,"throw",e)}s(void 0)}))})();var i},registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:pM,settings:{isAuxLayer:!0,displayRotation:!0},defaultValue:xR.style})},defaultOptions:xR});function SR(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function TR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){TR(e,t,n[t])}))}return e}function AR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const PR={colIdx:0,startId:0,globalThresholdsConfig:[],style:sM},IR=S.Path,MR=(FS.Auto,{id:IR,name:"Path layer",description:"GeoJson LineStrings from query",isBaseMap:!1,showLocation:!0,pointsUp:(t,n,i)=>{return(r=function*(){var r;const o=CR({},PR,n.config),s=yield VS(n.location);if(!t.series.length)return[];const a=n.locField,l=n.isShowTooltip,c=n.displayProperties,u=(o.colIdx,IR),h=yield cM(o.style),d=null==n||null===(r=n.config)||void 0===r?void 0:r.globalThresholdsConfig;for(const r of t.series)if(h.dims=fM(r,h,i),n.query&&n.query.options===r.refId){const t=$S(r,s);if(t.warning&&console.log("Could not find locations",t.warning),!t.points)return console.log("no coords"),[];const n=new e.DataFrameView(r).toArray(),p=t.points.map(((e,t)=>{var r,s;const p=n[t],f=l&&c&&(null==c?void 0:c.length)?[...c,"ack","msg","all_annots","liveStat"]:["ack","msg","all_annots","liveStat"],g=CR({},h.base),m=h.dims,_=null===(s=h.config)||void 0===s||null===(r=s.color)||void 0===r?void 0:r.field,y=_?p[_]:void 0;var v,b;m&&(m.color&&(g.color=m.color.get(t)),m.size&&(g.size=m.size.get(t)),m.text&&(g.text=m.text.get(t)),g.fixedColor=null===(b=h.config)||void 0===b||null===(v=b.color)||void 0===v?void 0:v.fixed);const x=g.fixedColor,w=x&&i.visualization.getColorByName(x),E=w?O(w):void 0,S=Object.entries(p);var T;const C=S.length>0&&a?null!==(T=p[a])&&void 0!==T?T:S[0][1]:void 0,A=CR(AR(CR({},p),{locName:C,style:g,colType:u}),l&&{isShowTooltip:l},f&&{displayProps:f}),P=rr(A,y,d,E);return{id:o.startId+t,type:"LineString",geometry:e,properties:AR(CR({},A),{threshold:P})}}));return p}return[]},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function s(e){SR(o,n,i,s,a,"next",e)}function a(e){SR(o,n,i,s,a,"throw",e)}s(void 0)}))})();var r},registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:pM,settings:{isAuxLayer:!0,displayRotation:!0},defaultValue:PR.style})},defaultOptions:PR}),RR=[AM,mR,MR,ER],kR={type:"default",config:{}},OR={id:kR.type,name:"Default base layer",isBaseMap:!0,create:(e,t)=>{var n;const i=null===IS.config||void 0===IS.config||null===(n=IS.config.geomapDefaultBaseLayerConfig)||void 0===n?void 0:n.type;if(i){const e=LR.getIfExists(i);if(console.log("create/?"),!e)throw new Error("Invalid basemap configuraiton on server");return e&&e.create?e.create(IS.config.geomapDefaultBaseLayerConfig,t):{}}return $M&&$M.create?$M.create(e,t):{}}},LR=new e.Registry((()=>[OR,...cR,...RR])),DR=({data:e,type:t="nums",dir:n="to"})=>{const i=["list1","list2"].includes(t);let r;switch(t){case"unames":case"nums":r="meters";break;default:r="pixels"}return new yw({data:e,id:S.Text+"-"+t,getText:e=>e.text,getPosition:e=>{switch(t){case"unames":return[e.coordinates[0],e.coordinates[1]+5e-5];case"nums":return[e.coordinates[0],e.coordinates[1]-5e-5];default:const[t,n]=e.coordinates;return[(t[0]+n[0])/2,(t[1]+n[1])/2]}},getAngle:e=>{var t;return null!==(t=e.angle)&&void 0!==t?t:0},getAlignmentBaseline:i?"to"===n?"top":"bottom":"center",getTextAnchor:i?"start":"middle",sizeUnits:r,getSize:e=>{switch(t){case"unames":return 5;case"nums":return 3;default:const t=e.fontSize;return null!=t?t:13}},getColor:e=>k(e.color)})},FR=[0,0,0,255],NR={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:FR},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class BR extends mx{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&vo.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),n=e.dataChanged.map((e=>_x({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:n})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:r}=this.props,o=[],s="XY"===i?2:3,{startRow:a,endRow:l}=e,{iterable:c,objectInfo:u}=Bm(t,a,l);for(const e of c){u.index++;let t=n(e,u);r&&(t=sE(t,s));const{holeIndices:i}=t,a=t.positions||t;if(i)for(let t=0;t<=i.length;t++){const n=a.slice(i[t-1]||0,i[t]||a.length);o.push(this.getSubLayerRow({path:n},e,u.index))}else o.push(this.getSubLayerRow({path:a},e,u.index))}return o}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:r,wireframe:o,_normalize:s,_windingOrder:a,elevationScale:l,transitions:c,positionFormat:u}=this.props,{lineWidthUnits:h,lineWidthScale:d,lineWidthMinPixels:p,lineWidthMaxPixels:f,lineJointRounded:g,lineMiterLimit:m,lineDashJustified:_}=this.props,{getFillColor:y,getLineColor:v,getLineWidth:b,getLineDashArray:x,getElevation:w,getPolygon:E,updateTriggers:S,material:T}=this.props,{paths:C,pathsDiff:A}=this.state,P=this.getSubLayerClass("fill",bE),I=this.getSubLayerClass("stroke",Hw),M=this.shouldRenderSubLayer("fill",C)&&new P({_dataDiff:t,extruded:r,elevationScale:l,filled:i,wireframe:o,_normalize:s,_windingOrder:a,getElevation:w,getFillColor:y,getLineColor:r&&o?v:FR,material:T,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:S&&{getPolygon:S.getPolygon,getElevation:S.getElevation,getFillColor:S.getFillColor,lineColors:r&&o,getLineColor:S.getLineColor}}),{data:e,positionFormat:u,getPolygon:E}),R=!r&&n&&this.shouldRenderSubLayer("stroke",C)&&new I({_dataDiff:A&&(()=>A),widthUnits:h,widthScale:d,widthMinPixels:p,widthMaxPixels:f,jointRounded:g,miterLimit:m,dashJustified:_,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(v),getWidth:this.getSubLayerAccessor(b),getDashArray:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"stroke",updateTriggers:S&&{getWidth:S.getLineWidth,getColor:S.getLineColor,getDashArray:S.getLineDashArray}}),{data:C,positionFormat:u,getPath:e=>e.path});return[!r&&M,R,r&&M]}}BR.layerName="PolygonLayer",BR.defaultProps=NR;const zR=BR;function jR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function UR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){jR(e,t,n[t])}))}return e}function VR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const $R={marker:{x:0,y:0,width:128,height:128,mask:!0}},GR=e=>{const{data:t,getSelectedFeIndexes:n,highlightColor:i,onHover:r,iconMapping:o=$R,colType:s=S.Polygons,getTooltipObject:a,setHoverInfo:l,setClosedHint:c,closedHint:u,hoverCluster:h,hoverInfo:d,setHoverCluster:p,setTooltipObject:f,theme2:g,isStatic:m}=e;var _;return new zR({highlightColor:i,pickable:!0,autoHighlight:s!==S.Hull,id:m?s+"-"+m:s,iconMapping:o,data:t,onHover:e=>{var t,n;if(s!==S.Hull)return r(e);if((null==a?void 0:a.object)&&Object.keys(null==a?void 0:a.object).length)return;if(!e.object)return void l({});const i=null!==(n=null==h?void 0:h.objects)&&void 0!==n?n:d.prevHullData,o=null==h||null===(t=h.object)||void 0===t?void 0:t.properties;if(o){const{cluster:t,colorCounts:n,annotStateCounts:i}=o;e.object.properties=VR(UR({},e.object.properties),{cluster:t,colorCounts:n,annotStateCounts:i,isHull:!0})}(0,Il.flushSync)((()=>{l(VR(UR({},e),{prevHullData:i})),u&&c(!1)}))},onClick:()=>{l({}),p(null),f({})},selectedFeatureIndexes:null!==(_=null==n?void 0:n[S.Polygons])&&void 0!==_?_:[],getPolygon:e=>e.geometry.coordinates,getIcon:()=>"marker",filled:!0,stroked:s!==S.Hull,getFillColor:e=>{var t,n;if(s===S.Hull)return k(g.isDark?"rgb(255, 215, 0, 0.2)":"rgb(66, 164, 245, 0.2)");const{threshold:i}=e.properties,{color:r}=i,o=null===(n=e.properties)||void 0===n||null===(t=n.style)||void 0===t?void 0:t.opacity,a=k(r);return o&&(a[3]=Math.round(255*o)),a},extruded:!1,getLineColor:e=>{const{threshold:t}=e.properties,{color:n}=t;return k(n)},getLineWidth:e=>{var t,n;return null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth}})},WR={marker:{x:0,y:0,width:128,height:128,mask:!0}};var HR=d(5731);const ZR=()=>{var e,t;const n=(0,Pl.useStyles2)(qR),{pointStore:i,viewStore:r}=Pk(),{getSelCoord:s}=i;function a(e){const t=document.getElementById(e);if(t){const e=document.createRange();e.selectNode(t);const n=window.getSelection();null==n||n.removeAllRanges(),null==n||n.addRange(e)}}const l=s.coordinates.length?s:{coordinates:[" "," "],type:"Point"};return o().createElement("div",{className:n.posTracker},o().createElement("div",null,o().createElement("span",{onDoubleClick:()=>a("coordinates")},o().createElement(HR.CopyToClipboard,{text:JSON.stringify(s)},o().createElement(Pl.Icon,{name:"copy",size:"xs",title:"Copy GeoJSON"})),"",o().createElement("span",{id:"coordinates"},"[",o().createElement("span",{onClick:()=>a("lon")},o().createElement("span",{id:"lon"},null===(e=l.coordinates)||void 0===e?void 0:e[0])),",",o().createElement("span",{onClick:()=>a("lat")},o().createElement("span",{id:"lat"},null==l||null===(t=l.coordinates)||void 0===t?void 0:t[1])),"]"),"lon,lat")))},qR=e=>({posTracker:CS.css`
        //margin-bottom: 5px;        
        margin-right: ${e.spacing(1)};
          //position: absolute;
          z-index: 1;
          //bottom: ${e.spacing(.3)};
      font-size: x-small;
      // color: ${e.colors.getContrastText(e.colors.background.primary)};
      
        `}),XR={name:"collision",dependencies:[bd],vs:"\nin float collisionPriorities;\n\nuniform sampler2D collision_texture;\n\nuniform collisionUniforms {\n  bool sort;\n  bool enabled;\n} collision;\n\nvec2 collision_getCoords(vec4 position) {\n  vec4 collision_clipspace = project_common_position_to_clipspace(position);\n  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;\n}\n\nfloat collision_match(vec2 tex, vec3 pickingColor) {\n  vec4 collision_pickingColor = texture(collision_texture, tex);\n  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));\n  float e = 0.001;\n  return step(delta, e);\n}\n\nfloat collision_isVisible(vec2 texCoords, vec3 pickingColor) {\n  if (!collision.enabled) {\n    return 1.0;\n  }\n\n  // Visibility test, sample area of 5x5 pixels in order to fade in/out.\n  // Due to the locality, the lookups will be cached\n  // This reduces the flicker present when objects are shown/hidden\n  const int N = 2;\n  float accumulator = 0.0;\n  vec2 step = vec2(1.0 / project.viewportSize);\n\n  const float floatN = float(N);\n  vec2 delta = -floatN * step;\n  for(int i = -N; i <= N; i++) {\n    delta.x = -step.x * floatN;\n    for(int j = -N; j <= N; j++) {\n      accumulator += collision_match(texCoords + delta, pickingColor);\n      delta.x += step.x;\n    }\n    delta.y += step.y;\n  }\n\n  float W = 2.0 * floatN + 1.0;\n  return pow(accumulator / (W * W), 2.2);\n}\n",inject:{"vs:#decl":"\n  float collision_fade = 1.0;\n","vs:DECKGL_FILTER_GL_POSITION":"\n  if (collision.sort) {\n    float collisionPriority = collisionPriorities;\n    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000\n  }\n\n  if (collision.enabled) {\n    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));\n    vec2 collision_texCoords = collision_getCoords(collision_common_position);\n    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);\n    if (collision_fade < 0.0001) {\n      // Position outside clip space bounds to discard\n      position = vec4(0.0, 0.0, 2.0, 1.0);\n    }\n  }\n  ","vs:DECKGL_FILTER_COLOR":"\n  color.a *= collision_fade;\n  "},getUniforms:e=>{if(!e||!("dummyCollisionMap"in e))return{};const{enabled:t,collisionFBO:n,drawToCollisionMap:i,dummyCollisionMap:r}=e;return{enabled:t&&!i,sort:Boolean(i),collision_texture:!i&&n?n.colorAttachments[0]:r}},uniformTypes:{sort:"i32",enabled:"i32"}};class YR extends nd{renderCollisionMap(e,t){const n=[1,1,e.width-2,e.height-2];this.render({...t,clearColor:[0,0,0,0],scissorRect:n,target:e,pass:"collision"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}class KR{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:t}=e;this.dummyCollisionMap=t.createTexture({width:1,height:1}),this.collisionFilterPass=new YR(t,{id:"default-collision-filter"})}preRender({effects:e,layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:o,isPicking:s,preRenderStats:a={}}){const{device:l}=this.context;if(s)return;const c=t.filter((({props:{visible:e,collisionEnabled:t}})=>e&&t));if(0===c.length)return void(this.channels={});const u=e?.filter((e=>e.useInPicking&&a[e.id])),h=a["mask-effect"]?.didRender,d=this._groupByCollisionGroup(l,c),p=i[0],f=!this.lastViewport||!this.lastViewport.equals(p)||h;for(const e in d){const t=this.collisionFBOs[e],i=d[e],[s,a]=l.canvasContext.getPixelSize();t.resize({width:s/2,height:a/2}),this._render(i,{effects:u,layerFilter:n,onViewportActive:r,views:o,viewport:p,viewportChanged:f})}}_render(e,{effects:t,layerFilter:n,onViewportActive:i,views:r,viewport:o,viewportChanged:s}){const{collisionGroup:a}=e,l=this.channels[a];if(!l)return;const c=s||e===l||!Xr(l.layers,e.layers,1)||e.layerBounds.some(((e,t)=>!Co(e,l.layerBounds[t])))||e.allLayersLoaded!==l.allLayersLoaded||e.layers.some((e=>e.props.transitions));if(this.channels[a]=e,c){this.lastViewport=o;const s=this.collisionFBOs[a];this.collisionFilterPass.renderCollisionMap(s,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:t,layerFilter:n,viewports:o?[o]:[],onViewportActive:i,views:r,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:s.device.canvasContext.getDevicePixelRatio()/2}}})}}_groupByCollisionGroup(e,t){const n={};for(const e of t){const t=e.props.collisionGroup;let i=n[t];i||(i={collisionGroup:t,layers:[],layerBounds:[],allLayersLoaded:!0},n[t]=i),i.layers.push(e),i.layerBounds.push(e.getBounds()),e.isLoaded||(i.allLayersLoaded=!1)}for(const t of Object.keys(n))this.collisionFBOs[t]||this.createFBO(e,t),this.channels[t]||(this.channels[t]=n[t]);for(const e of Object.keys(this.collisionFBOs))n[e]||this.destroyFBO(e);return n}getShaderModuleProps(e){const{collisionGroup:t,collisionEnabled:n}=e.props,{collisionFBOs:i,dummyCollisionMap:r}=this,o=i[t];return{collision:{enabled:n&&Boolean(o),collisionFBO:o,dummyCollisionMap:r}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,t){const{width:n,height:i}=e.gl.canvas,r=e.createTexture({format:"rgba8unorm",width:n,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=e.createTexture({format:"depth16unorm",width:n,height:i,mipmaps:!1});this.collisionFBOs[t]=e.createFramebuffer({id:`collision-${t}`,width:n,height:i,colorAttachments:[r],depthStencilAttachment:o})}destroyFBO(e){const t=this.collisionFBOs[e];t.colorAttachments[0]?.destroy(),t.depthStencilAttachment?.destroy(),t.destroy(),delete this.collisionFBOs[e]}}class JR extends DE{getShaders(){return{modules:[XR]}}draw({shaderModuleProps:e}){e.collision?.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,t){null!==this.getAttributeManager()&&(this.context.deck?._addDefaultEffect(new KR),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}}JR.defaultProps={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},JR.extensionName="CollisionFilterExtension";const QR=JR,ek=({time:t})=>{const n=(0,Pl.useStyles2)(tk),i=(0,e.dateTime)(t).format("YYYY-MM-DD HH:mm:ss");return o().createElement("div",{className:n.stateTime},"annots time: ",i)},tk=e=>({stateTime:CS.css`
        margin-bottom: 0px;
        margin-right: ${e.spacing(1)};
        z-index: 1;               
      font-size: x-small;
      //bottom: 5px;
      //right: 1%;
      //transform: translateX(100%);
    `});var nk=function(e,t={}){const n=y(e);return function(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!h(e[0])||!h(e[1]))throw new Error("coordinates must contain numbers");return l({type:"Point",coordinates:e},t,n)}([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)};function ik(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function rk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ok(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){rk(e,t,n[t])}))}return e}function sk(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class ak extends e.BusEventWithPayload{}rk(ak,"type","mapType");class lk extends e.BusEventWithPayload{}rk(lk,"type","mapView");class ck extends e.BusEventWithPayload{}rk(ck,"type","panel-edit-started");class uk extends e.BusEventWithPayload{}rk(uk,"type","panel-edit-finished");class hk extends e.BusEventWithPayload{}let dk,pk;rk(hk,"type","thresholdType");const fk=Vl((({options:e,data:n,width:i,height:s,eventBus:a})=>{var l,c,u;const{pointStore:h,lineStore:d,viewStore:p,replaceVariables:f}=Pk();pk=e.globalThresholdsConfig;const m=e.svgIconsConfig,_=null===(l=e.common)||void 0===l?void 0:l.locLabelName,y=null===(c=e.common)||void 0===c?void 0:c.isShowLegend,w=(0,Pl.useStyles2)(gk),T=(0,Pl.useTheme2)(),{getPoints:C,getisOffset:P,getMode:L,setSelCoord:B,getComments:j,setAllComments:U,getSelectedIp:V,getSelFeature:$,getSelIds:G,switchMap:W,getisShowSVG:H,getSelectedFeIndexes:Z,setSelectedIp:q,setTooltipObject:X,getTooltipObject:Y,getisShowPoints:K,setSvgIcons:J,getSvgIcons:Q,getAllFeatures:ee,setAllFeatures:te}=h,{getViewState:ne,setViewState:ie,getClusterMaxZoom:re}=p,{getisShowLines:oe,getEditableLines:se,getLineSwitchMap:ae,getDirection:le,setDirection:ce,setVertices:ue}=d,he=(0,r.useRef)(null),de=(0,r.useRef)(null),pe=(0,r.useRef)(null),[fe,ge]=(0,r.useState)(Y),[me,_e]=(0,r.useState)(!1),[ye,ve]=(0,r.useState)(),[be,xe]=(0,r.useState)(!0),[we,Ee]=(0,r.useState)(!!V),[Se,Te]=(0,r.useState)(ne),[Ce,Ae]=(0,r.useState)(),[Pe,Ie]=(0,r.useState)([]),[Me,Re]=(0,r.useState)({r:5}),[ke,Oe]=(0,r.useState)(),Le=f("$__timezone"),[De,Fe]=(0,r.useState)(1e3*n.timeRange.to.unix()),[Ne,Be]=(0,r.useState)(0),ze=!!(null===(u=n.annotations)||void 0===u?void 0:u.length),je=(0,r.useMemo)((()=>{const e=[];return null==pk||pk.forEach(((t,n)=>e.push({color:t.color,label:t.label,yAxis:1,disabled:!1}))),e}),[]),[Ue,Ve]=(0,r.useState)(je);(0,r.useEffect)((()=>{if(n.timeRange){var e;Fe(1e3*n.timeRange.to.unix());const t="annotations & alerts query (built-in)";if(ze&&(null==Ue||null===(e=Ue.at(-1))||void 0===e?void 0:e.label)!==t){const e={color:b.Alerting,label:"annotations & alerts query (built-in)",yAxis:1,disabled:!1};Ve((t=>[...t,e]))}}}),[n]),(0,r.useEffect)((()=>{const t=a.subscribe(lk,(e=>{Te(void 0),$e(n)})),i=a.subscribe(ak,(t=>{e.basemap.type!==t.payload.mapType&&(Te(void 0),$e(n))})),r=a.subscribe(hk,(e=>{var t;if(null===(t=e.payload)||void 0===t?void 0:t.thresholds){var n,i;const t=[];null===(n=e.payload.thresholds)||void 0===n||n.forEach(((e,n)=>t.push({color:e.color,label:e.label,yAxis:1,disabled:!1})));const r="annotations & alerts query (built-in)";if(ze&&(null==Ue||null===(i=Ue.at(-1))||void 0===i?void 0:i.label)!==r){const e={color:b.Alerting,label:"annotations & alerts query (built-in)",yAxis:1,disabled:!1};t.push(e)}Ve(t)}})),o=a.subscribe(hk,(e=>{var t;if(null===(t=e.payload)||void 0===t?void 0:t.thresholds){var n,i;const t=[];null===(n=e.payload.thresholds)||void 0===n||n.forEach(((e,n)=>t.push({color:e.color,label:e.label,yAxis:1,disabled:!1})));const r="annotations & alerts query (built-in)";if(ze&&(null==Ue||null===(i=Ue.at(-1))||void 0===i?void 0:i.label)!==r){const e={color:b.Alerting,label:"annotations & alerts query (built-in)",yAxis:1,disabled:!1};t.push(e)}Ve(t)}}));return()=>{t.unsubscribe(),i.unsubscribe(),r.unsubscribe(),o.unsubscribe()}}),[a]);const $e=n=>{return(r=function*(){{var r;const a=["target","source"].includes(f("$locRole"))?f("$locRole"):le,l={};for(const e in S)Object.prototype.hasOwnProperty.call(S,e)&&(l[S[e]]=0);const c=[];let u;if((null==m?void 0:m.length)&&(u=yield function(e){return A((function*(){if(e.length){const t=e.filter((e=>e)).map(z),n=(yield Promise.all(t)).filter((e=>e));return n.length?Object.fromEntries(n):{}}return{}}))()}(m)),u&&Object.keys(u).length&&J(u),(null==e||null===(r=e.dataLayers)||void 0===r?void 0:r.length)>0){const t={};for(let i=0;i<e.dataLayers.length;i++){const r=e.dataLayers[i],s=LR.getIfExists(r.type);var o;const u=sk(ok({},r),{config:sk(ok({},r.config),{globalThresholdsConfig:pk,startId:null!==(o=l[r.type])&&void 0!==o?o:0,vertices:t,direction:a,locLabelName:_,svgIconRules:m,thresholds:pk})}),h=(null==s?void 0:s.pointsUp)?yield s.pointsUp(n,u,T):null,d=Array.isArray(h)?h:[],p={colType:r.type,features:d,vertices:Object.keys(t).length?t:null};l[p.colType]=l[p.colType]+p.features.length,c.push(p)}}if(!Se){const n=Mk(e.view);let r,o,a;if(n.id===t.Auto){if((null==c?void 0:c.length)>0){const e=new Ja({width:i,height:s}),t=c.reduce(((e,t)=>e.concat(t.features)),[]).map((e=>({type:"Feature",geometry:{type:"Point",coordinates:F(e.geometry)}}))).filter((e=>e));if(t.length>1){({longitude:r,latitude:o,zoom:a}=n);const[i,s,l,c]=v({type:"FeatureCollection",features:t}),u=[[i,s],[l,c]];i&&s&&l&&c&&({longitude:r,latitude:o,zoom:a}=e.fitBounds(u))}r||({longitude:r,latitude:o,zoom:a}=n)}}else({longitude:r,latitude:o,zoom:a}=n);void 0!==r&&void 0!==o?ie(ok({},{longitude:r,latitude:o,zoom:a,maxPitch:42.75})):(Ie([]),Te(void 0)),Ik(e.basemap,ve,!1,T)}let h=[],d={},p=[],g=[],y=[];c.forEach((e=>{switch(e.colType){case S.Points:(null==e?void 0:e.features.length)&&(d=function(e,t){const n={};for(const t in e)e.hasOwnProperty(t)&&(n[t]=I({},e[t]));for(const e in t)t.hasOwnProperty(e)&&(n[e]?(n[e].ptId=n[e].ptId||t[e].ptId,n[e].tarCoords=n[e].tarCoords||t[e].tarCoords,n[e].sources=I({},n[e].sources,Object.entries(t[e].sources||{}).reduce(((t,[i,r])=>{var o,s;const a=(null===(s=n[e])||void 0===s||null===(o=s.sources)||void 0===o?void 0:o[i])||{};return t[i]=M(I({},a,r),{lineExtraProps:I({},a.lineExtraProps||{},r.lineExtraProps?Object.entries(r.lineExtraProps).reduce(((e,[t,n])=>(null!=n&&""!==n&&(e[t]=n),e)),{}):{})}),t}),{}))):n[e]=I({},t[e]));return n}(d,null==e?void 0:e.vertices),h=h.concat(null==e?void 0:e.features),h=h.map((e=>{var t,n;const{locName:i}=e.properties,r=(null===(t=d[i])||void 0===t?void 0:t.sources)?ok({},null===(n=d[i])||void 0===n?void 0:n.sources):void 0;return sk(ok({},e),{properties:sk(ok({},e.properties),{sources:r&&Object.keys(r).length>0?r:void 0})})})));break;case S.Polygons:(null==e?void 0:e.features.length)&&(p=p.concat(null==e?void 0:e.features));break;case S.Path:(null==e?void 0:e.features.length)&&(g=g.concat(null==e?void 0:e.features));break;case S.GeoJson:(null==e?void 0:e.features.length)&&(y=y.concat(null==e?void 0:e.features))}})),ue(d);const b=[],x=function(e){const t=[];for(const n in e){const i=e[n].sources;if(i)for(const e in i){const n=i[e].parPath;Array.isArray(n)&&n.forEach(((e,i)=>{if(Array.isArray(e)&&e.length>2){const r=e[3],o=e[4],[s,a,l]=[n[0],n.at(-1),i];void 0!==r&&t.push({text:r,iconColor:o,orderId:i,coords:e.slice(0,2),tar:s,src:a})}}))}}return t}(d);let w=0;null==x||x.forEach((e=>{const{text:t,iconColor:n,orderId:i,coords:r,tar:o,src:s}=e;if(o&&t&&i&&r){const e=n&&T.visualization.getColorByName(n);var a;b.push({type:"Feature",id:w,geometry:{type:"Point",coordinates:r},properties:{note:t,tIdx:i+1,tar:o,iconColor:(null==n?void 0:n.indexOf("rgb"))>-1?n:null!==(a=n&&O(e))&&void 0!==a?a:"rgb(78, 194, 252)",isShowTooltip:!0,displayProps:["note","tar","tIdx"]}}),w++}})),b&&U(b);const E=[h,p,g,y],C={};E.forEach(((e,t)=>{null!=e&&(C[["markers","polygons","path","geojson"][t]]=e)})),E.forEach((e=>{null!=e&&Object.assign(C,e)})),h&&Be(h.length),te(C)}},function(){var e=this,t=arguments;return new Promise((function(n,i){var o=r.apply(e,t);function s(e){ik(o,n,i,s,a,"next",e)}function a(e){ik(o,n,i,s,a,"throw",e)}s(void 0)}))})();var r};(0,r.useEffect)((()=>{var e,t,n;if((null==ke||null===(n=ke.object)||void 0===n||null===(t=n.properties)||void 0===t||null===(e=t.objects)||void 0===e?void 0:e.length)>2||fe.prevHullData){var i,r,o;const e=null!==(o=null==ke||null===(r=ke.object)||void 0===r||null===(i=r.properties)||void 0===i?void 0:i.objects)&&void 0!==o?o:fe.prevHullData,t=Al({type:"FeatureCollection",features:e});if(!t)return;const n=GR(sk(ok({},He),{colType:S.Hull,data:[t]}));(0,Il.flushSync)((()=>{Ie((e=>{var t;let i=[...e];return"convex-hull"===(null==e||null===(t=e[0])||void 0===t?void 0:t.id)?i[0]=n:i=[n,...e],i}))}))}}),[ke]);const Ge=(0,r.useCallback)((()=>{var e;const t=pe;dk=(null===(e=t.current)||void 0===e?void 0:e.getMap)?t.current.getMap():null}),[]),We={setSelCoord:B,setClosedHint:_e,switchMap:W,getMode:L,setShowCenter:Ee,setCPlotCoords:Ae,setIsRenderNums:xe,setTooltipObject:X,setSelectedIp:q,setLocalViewState:Te,setHoverCluster:Oe,setHoverInfo:ge},He={pickable:!0,autoHighlight:!0,highlightColor:k(T.isDark?"rgb(255, 215, 0, 0.2)":"rgb(32, 82, 153, 0.2)"),onHover:ge,setShowCenter:Ee,getEditableLines:se,getSelectedFeIndexes:Z,getPoints:C,getSelFeature:$,switchMap:W,getMode:L,getSelectedIp:V,setClosedHint:_e,setSelectedIp:q,theme2:T,time:De,options:e,setTooltipObject:X,getTooltipObject:Y,setHoverInfo:ge,closedHint:me,hoverCluster:ke,hoverInfo:fe,setHoverCluster:Oe,legendItems:Ue},Ze={getDirection:le,getisOffset:P,getComments:j,setTooltipObject:X,setCPlotCoords:Ae},qe={getSvgIcons:Q,getisShowSVG:H,getisShowPoints:K},Xe=()=>{var e,t,n;let i,r,o,s,a,l,c,u;const h=[];let d=[];const p=[],f=[],m=[];if((null==ke||null===(n=ke.object)||void 0===n||null===(t=n.properties)||void 0===t||null===(e=t.objects)||void 0===e?void 0:e.length)>2||fe.prevHullData){var _,y,v;const e=null!==(v=null==ke||null===(y=ke.object)||void 0===y||null===(_=y.properties)||void 0===_?void 0:_.objects)&&void 0!==v?v:fe.prevHullData,t=Al({type:"FeatureCollection",features:e});if(t){const e=GR(sk(ok({},He),{colType:S.Hull,isStatic:!0,data:[t]}));h.push(e)}}let x,w,E,C;if(ee&&({markers:x,polygons:w,path:E,geojson:C}=ee),(null==w?void 0:w.length)>0&&h.push(GR(sk(ok({},He),{data:w}))),(null==E?void 0:E.length)>0&&h.push(jE(sk(ok({},He),{data:E,type:"path"}))),(null==C?void 0:C.length)>0){const e={type:"FeatureCollection",features:C};h.push((e=>{const{data:t,getSelectedIp:n,onHover:i,highlightColor:r}=e;return new OE({id:S.GeoJson,data:t,pickable:!0,onHover:i,autoHighlight:!0,highlightColor:r,stroked:!1,filled:!0,extruded:!0,pointType:"circle",lineWidthMinPixels:2,getFillColor:e=>{var t,n;const{threshold:i}=e.properties,{color:r}=i,o=null===(n=e.properties)||void 0===n||null===(t=n.style)||void 0===t?void 0:t.opacity,s=k(r);return o&&(s[3]=Math.round(255*o)),s},getLineColor:e=>{const{threshold:t}=e.properties,{color:n}=t;return k(n)},getPointRadius:100,getLineWidth:e=>{var t,n;return null==e||null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth},getElevation:30})})(sk(ok({},He),{data:e})))}if((null==x?void 0:x.length)>0||(null==h?void 0:h.length)>0){const e=ae;if((null==$?void 0:$.properties.colType)===S.Points){const t=G.map((e=>se[e])).filter((e=>e)),n=t.length>0&&D({features:t,switchMap:W,lineSwitchMap:e,getisOffset:P,time:De})[1];o=n&&(null==n?void 0:n.length)>0?jE(sk(ok({},He),{data:n,type:"par-path-line"})):null;const i=n&&function({features:e,switchMap:t,lineSwitchMap:n,getisOffset:i,time:r}){let o,s=[];const a=[];return e.forEach(((e,l)=>{var c;if(e&&(null===(c=e.properties)||void 0===c?void 0:c.locName)){const{locName:l,parPath:c}=e.properties,u=null==c?void 0:c.at(-1);a.push(l);let h=n.get(u);if(!h)return;let d=h;for(;d;){const{locName:e}=d.properties;if(a.includes(e))break;a.push(e),o=D({features:[d],switchMap:t,lineSwitchMap:n,getisOffset:i,time:r})[1]||void 0,(null==o?void 0:o.length)>0&&s.push(o);const{parPath:l}=null==d?void 0:d.properties;d=l&&(null==n?void 0:n.get(l.at(-1)))}}})),s.reduce(((e,t)=>e.concat(t)),[])}({features:t,switchMap:W,lineSwitchMap:e,getisOffset:P,time:De});s=i&&(null==i?void 0:i.length)>0?jE(sk(ok({},He),{data:i,type:"par-path-extension"})):null;const r=be&&P&&function(e){if(!Array.isArray(e)||0===e.length)return[];const t=[];return e.forEach((e=>{if(!(null==e?void 0:e.properties))return;const n=null==e?void 0:e.properties.parPathCoords,i=Array.isArray(n)&&n.length>1?n:[],r=(null==i?void 0:i.length)>0?i.map(((e,t)=>({text:t+1+"",coordinates:e,color:"rgb(237, 71, 59)"}))):[];r&&t.push(r)})),t.reduce(((e,t)=>e.concat(t)),[])}(t);l=(null==r?void 0:r.length)>0?DR({data:r,type:"nums",dir:"to"}):null}const t=se.map((e=>function(e,t){var n,i,r,o;if(!e)return[];const{properties:s}=e,a=e.geometry,l=null==t?void 0:t.get(null===(n=s.parPath)||void 0===n?void 0:n.at(-1)),c=null==l?void 0:l.geometry;var u;const h=a&&a.coordinates&&a.coordinates.length>0&&null!==(u=a.coordinates[0][0])&&void 0!==u?u:null;var d;const p=c&&c.coordinates&&c.coordinates.length>0&&null!==(d=c.coordinates)&&void 0!==d?d:null;if(!h||!p)return[];const f=((e,t)=>{if(!e||!t)return 0;let n;const i=t[0]-t[0],r=t[1]-t[1],o=-e[0],s=i*-e[1]-r*o;return n=90-g(e,t),Math.abs(n)>90&&s>0&&(n+=180),n})(h,p);let m=null==s||null===(i=s.threshold)||void 0===i?void 0:i.color;const{bandNumber:_,bandWidth:y,throughput:v}=s;if((y||_)&&v){let e;y?e=v/y*100:_&&(e=v/_*100),m=N(e)}const{locName:b,edgeField:x}=e.properties;let w=e.properties[x];if("number"==typeof w){const{value:e,unit:t}=function(e){if("number"==typeof e){const t=e/1e3,n=t/1e3;let i;return i=n>=1?{value:n.toFixed(2),unit:" Mbps"}:t>=1?{value:t.toFixed(1),unit:" Kbps"}:{value:e,unit:" bps"},i}return console.error("Invalid input. Please provide a number."),null}(w);w=e+t}const E=null==s||null===(o=s.style)||void 0===o||null===(r=o.textConfig)||void 0===r?void 0:r.fontSize;return e&&w?{to:[{text:w+"\n",coordinates:[h,p],color:m,angle:f,fontSize:E}]}:{to:[]}}(e,W)));a=!P&&(null==t?void 0:t.length)>0?DR({data:t.reduce(((e,t)=>t.to?e.concat(t.to):e),[]),dir:"to",type:"list1"}):null;const n=se;if(oe&&(null==n?void 0:n.length)>0){const e={type:"FeatureCollection",features:n};i=(e=>{const{linesCollection:t,getSelectedFeIndexes:n,getEditableLines:i,getisOffset:r,onHover:o,pickable:s,autoHighlight:a,highlightColor:l,time:c,legendItems:u}=e;var h;const d=null!==(h=null==n?void 0:n.get(S.Lines))&&void 0!==h?h:[],p=d.length>0,f=[...i];return(p?i[d[0]]:null)&&f.splice(d[0],1),new OE({highlightColor:l,onHover:o,id:S.Lines,data:t,selectedFeatureIndexes:d,getLineWidth:e=>{var t,n;return null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth},getLineColor:e=>{var t,n;if(!r&&(null===(t=e.properties)||void 0===t?void 0:t.throughput)){let t;const{bandNumber:n,bandWidth:i,throughput:r}=e.properties;if(i||n){let e;i?e=r/i*100:n&&(e=r/n*100),t=N(e)}else t=N(101);return k(t)}const{threshold:i,all_annots:o}=e.properties,{color:s}=i;if(o&&!(null==u||null===(n=u.at(-1))||void 0===n?void 0:n.disabled)){var a;const e=R(o,c),t=null==e||null===(a=e[0])||void 0===a?void 0:a.newState,n=(null==t?void 0:t.startsWith("Normal"))?b.Normal:"Alerting"===t?b.Alerting:b.Pending;return k(n).slice(0,3)}return k(s)},lineWidthScale:1,lineWidthMinPixels:.1,pickable:s,autoHighlight:a})})(sk(ok({},He,Ze),{linesCollection:e})),f.push(i)}let _,y=x,v=x;if(null==v?void 0:v.length){const e={type:"FeatureCollection",features:v};r=(e=>{const{featureCollection:t,getSelectedFeIndexes:n,getisShowSVG:i,getSvgIcons:r,getisShowPoints:o,getSelectedIp:s,pickable:a,time:l,onHover:c,highlightColor:u,options:h,theme2:d,legendItems:p}=e;var f;return new OE({highlightColor:u,onHover:c,id:S.Points,data:t,selectedFeatureIndexes:null!==(f=null==n?void 0:n.get(S.Points))&&void 0!==f?f:[],parameters:{depthTest:!1},pointType:"circle+icon+text",updateTriggers:{getIcon:r},getText:e=>{var t,n;return null===(n=e.properties)||void 0===n||null===(t=n.style)||void 0===t?void 0:t.text},getTextPixelOffset:e=>[0,15],getTextColor:e=>{var t;const{threshold:n,cluster:i,all_annots:r}=e.properties;if(i)return[0,0,0];const{color:o}=n;if(r&&!(null===(t=p.at(-1))||void 0===t?void 0:t.disabled)){var s;const e=R(r,l),t=null==e||null===(s=e[0])||void 0===s?void 0:s.newState,n=(null==t?void 0:t.startsWith("Normal"))?b.Normal:"Alerting"===t?b.Alerting:b.Pending;return k(n)}return k(o)},getTextSize:e=>{var t,n,i;const r=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n||null===(t=n.textConfig)||void 0===t?void 0:t.fontSize;return null!=r?r:12},getFillColor:e=>{var t,n,i;const{threshold:r,all_annots:o}=e.properties,{color:s}=r;if(o&&!(null===(t=p.at(-1))||void 0===t?void 0:t.disabled)){var a;const e=R(o,l),t=null==e||null===(a=e[0])||void 0===a?void 0:a.newState,n=(null==t?void 0:t.startsWith("Normal"))?b.Normal:"Alerting"===t?b.Alerting:b.Pending;return k(n)}const c=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.opacity,u=k(s);return c&&(u[3]=Math.round(255*c)),u},stroke:!0,getLineWidth:.5,getLineColor:e=>{var t,n,i;const{threshold:r,all_annots:o}=e.properties,{color:s}=r;if(o&&!(null==p||null===(t=p.at(-1))||void 0===t?void 0:t.disabled)){var a;const e=R(o,l),t=null==e||null===(a=e[0])||void 0===a?void 0:a.newState,n=(null==t?void 0:t.startsWith("Normal"))?b.Normal:"Alerting"===t?b.Alerting:b.Pending;return k(n).slice(0,3)}const c=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.opacity,u=k(s);return c&&(u[3]=Math.round(255*c)),u},getPointRadius:e=>{var t,n,i;const r=s===(null===(t=e.properties)||void 0===t?void 0:t.locName),o=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.size;return r?o/2*1.3:o/2},getIcon:e=>{const{threshold:t}=e.properties,{iconName:n}=t,i=r[n];if(i){const{svgText:e,width:t,height:r}=i;return{url:rS(e),width:t,height:r,id:n}}return{url:rS('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">  \n</svg>'),width:1,height:1,id:"blank"}},getIconPixelOffset:e=>{const{threshold:t,cluster:n}=e.properties;if(n)return[0,0];const{iconVOffset:i}=t;return[0,null!=i?i:0]},getIconSize:e=>{var t;const n=s===(null===(t=e.properties)||void 0===t?void 0:t.locName),{cluster:i,threshold:r}=e.properties;if(i)return 40;{const{iconSize:e}=r;return e?n?1.5*e:e:30}},iconSizeUnits:"pixels",getIconColor:e=>{const{threshold:t,cluster:n}=e.properties;if(n)return[0,0,0];const{color:i}=t;return k(i)},_subLayerProps:{"points-text":{extensions:[new QR],collisionGroup:"text",collisionTestProps:{sizeScale:2.5}},"points-icon":{visible:i,extensions:[new QR],collisionGroup:"icons",collisionTestProps:{sizeScale:1.5}},"points-circle":{visible:o}},filled:!0,pickable:a,pickingDepth:0,autoHighlight:!0})})(sk(ok({},He,qe),{featureCollection:e})),p.push(r)}if((null==y?void 0:y.length)&&m.push(y),m.length&&(u=new ES(sk(ok({},He,qe),{getPosition:e=>e.coordinates,data:m.reduce(((e,t)=>e.concat(t)),[]),id:"icon-cluster",sizeScale:40,maxZoom:re,thresholds:[]}))),d=[...h,...f,...p],a&&d.push(a),o&&(d.unshift(o),d.push(s),d.push(l)),j&&(null==j?void 0:j.length)>0&&(c=(e=>{const{data:t,getSelectedFeIndexes:n,getisShowPoints:i,onHover:r,highlightColor:o,iconMapping:s=WR}=e;var a;return new Lx({visible:i,highlightColor:o,onHover:r,id:S.Icons,iconAtlas:"public/plugins/vaduga-mapgl-panel/img/37a766e00c9900c1c40d.png",iconMapping:s,data:t,selectedFeatureIndexes:null!==(a=null==n?void 0:n.get(S.Icons))&&void 0!==a?a:[],getPosition:e=>e.geometry.coordinates,getIcon:()=>"marker",getColor:e=>{const{iconColor:t}=e.properties;return k(t)},getSize:e=>5,sizeUnits:"meters",sizeScale:.4,sizeMinPixels:5,sizeMaxPixels:45,pickable:!0,autoHighlight:!0})})(sk(ok({},He,qe),{data:j,getSelectedFeIndexes:Z,setClosedHint:_e,setSelectedIp:q})),d.push(c)),we&&Ce&&$){const{longitude:e,latitude:t}=Ce;_=new jx({id:"centerplot-layer",data:[{coordinates:[e,t]}],pickable:!1,opacity:.2,stroked:!1,filled:!0,radiusScale:5,radiusMinPixels:1,radiusMaxPixels:18,lineWidthMinPixels:1,getPosition:e=>e.coordinates,getRadius:e=>Math.sqrt(e.exits),getFillColor:e=>k(T.isDark?"rgb(255, 221, 87, 0.9)":"rgb(32, 82, 153, 0.8)")}),d.push(_)}d.push(u)}Ie(d.filter((e=>null!=e)))};(0,r.useEffect)((()=>{ne&&(Te(ne),Ae(ne))}),[ne]),(0,r.useEffect)((()=>{var t,i,r;((null===(t=e.dataLayers)||void 0===t?void 0:t.some((e=>null==e?void 0:e.query)))||(null===(i=n.request)||void 0===i?void 0:i.targets))&&(null==n||null===(r=n.series)||void 0===r?void 0:r.length)&&(ee&&Object.keys(ee).length?Xe():Re((e=>ok({},e))))}),[Ue,Q,Y,re,G,ne,Ce,L,ee,V,P,H,oe,K]),(0,r.useEffect)((()=>{n&&n.series.length&&$e(n)}),[Me,le,n,i,s,e]);const Ye=(0,r.useMemo)((()=>o().createElement(DM,{total:Ne,setShowCenter:Ee})),[Ne]),Ke=(0,r.useCallback)(((e,t)=>{Ve((t=>null==t?void 0:t.map((t=>t!==e?t:sk(ok({},t),{disabled:!t.disabled})))))}),[]);return ye&&Se?o().createElement("div",{className:w.container,ref:de},o().createElement(Gb,{widgets:[new Kr({id:"myfull",container:null!==(Je=de.current)&&void 0!==Je?Je:void 0,placement:"top-right",className:w.fullscreen}),new hl({id:"compass",placement:"top-right",className:w.compass})],ref:he,style:{pointerEvents:"all",inset:"0px",zIndex:"1"},layers:Pe,initialViewState:Se,controller:{dragMode:"pan",doubleClickZoom:!1,scrollZoom:{smooth:!1,speed:.005},inertia:!0},onClick:(e,t)=>((e,t,n)=>{const{setSelCoord:i,setClosedHint:r,switchMap:o,getMode:s,setShowCenter:a,setCPlotCoords:l,setIsRenderNums:c,setTooltipObject:u,setSelectedIp:h,setLocalViewState:d,setHoverCluster:p,setHoverInfo:f}=n,g=e.coordinate;if(g){const[e,t]=g.map((e=>parseFloat(e.toFixed(6))));i({coordinates:[e,t],type:"Point"})}if(e.picked){var m;const{properties:t,id:n}=e.object,{locName:i,parPath:p}=t;if(i){var _,y;const{aggrType:d,colType:p}=t;r(!1);const f=null===(_=e.sourceLayer)||void 0===_?void 0:_.id,g=(null==f?void 0:f.startsWith("edit-lines"))?n:null,m=null==i?void 0:i.split(x)[0],v=null==o||null===(y=o.get(m))||void 0===y?void 0:y.geometry,b=null==dk?void 0:dk.getZoom();if(v&&"modify"!==s){const[e,t]=null==v?void 0:v.coordinates;a(!0),l({longitude:e,latitude:t,zoom:b||18,maxPitch:42.75,bearing:0,pitch:0})}c(!E.includes(d)),u(e),h(i,g?[g]:null)}else if((null==t||null===(m=t.objects)||void 0===m?void 0:m.length)&&!(null==t?void 0:t.isHull)){const e={type:"FeatureCollection",features:t.objects},n=nk(e),[i,r]=n.geometry.coordinates;d({longitude:i,latitude:r,zoom:t.expZoom,transitionDuration:250,maxPitch:42.75,rnd:Math.random()})}}else p(null),f({}),a(!0),h(""),r(!0),u({})})(e,0,We)},o().createElement(lx,{onLoad:Ge,ref:pe,mapStyle:ye,attributionControl:!1},o().createElement(fx,{style:{zIndex:"2",position:"absolute",top:0,right:T.spacing(1)}}))),o().createElement("div",{className:w.timeNcoords},o().createElement(ZR,null),!!ze&&o().createElement(ek,{time:De})),o().createElement(jM,{time:De,timeZone:Le,position:0,info:fe,isClosed:me,setTooltipObject:X,setClosedHint:_e}),y&&o().createElement("div",{className:w.legend},o().createElement(Pl.VizLegend,{displayMode:Pl.LegendDisplayMode.List,placement:"bottom",items:Ue,onLabelClick:Ke})),Ye):null;var Je})),gk=e=>({page:CS.css`
          padding: ${e.spacing(3)};
          background-color: ${e.colors.background.secondary};
          display: flex;
          justify-content: center;
        `,container:CS.css`
            .maplibregl-ctrl-attrib-button {
                display: none;
            }
        `,yamap:CS.css`
          width: 100%;
          height: 100%;
          z-index: -1;
          position: absolute;
          isolation: isolate;
          inset: 0;
          overflow: hidden;
          pointer-events: none;
        `,geocoder:CS.css`
          display: flex;
          flex-direction: row-reverse;
          //width: 10%;
          position:absolute;
          right: ${e.spacing(1.7)};
          top: ${e.spacing(2)};
        `,textBox:CS.css`
          position: absolute;
          bottom: 0;
          left: 0;
          padding: 10px;
        `,fullscreen:CS.css`
          z-index: 2;
          position: absolute;
          top: ${e.spacing(5)};
          right: 0px;
          
          overflow: hidden;
          pointer-events: all;
        `,compass:CS.css`
          z-index: 2;
          position: absolute;
          top: ${e.spacing(10)};
          right: 0px;   
          overflow: hidden;
          pointer-events: all;
        `,legend:CS.css`
          z-index: 2;
            position: absolute;            
            bottom: 0;// ${e.spacing(3)};
            //left: ${e.spacing(10)};
            //width: 20%;
            padding-bottom: 5px;
            pointer-events: all;
            background: ${e.isDark?e.colors.background.secondary:"#EAEAEA"};
        `,timeNcoords:CS.css`            
            position: absolute;
            z-index: 1;
            font-size: small;
            bottom: 5px;
            right: 1%;                        
        `});function mk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){mk(e,t,n[t])}))}return e}function yk(e,t){if("string"==typeof e){var n;const i=null===(n=t.get(e))||void 0===n?void 0:n.properties.aggrType;return E.includes(i)}return!1}const vk=class{get getVertices(){return this.vertices}get getDirection(){return this.direction}get getEditableLines(){const{getPoints:e,switchMap:t,getisOffset:n,editCoords:i}=this.root.pointStore,{theme2:r}=this.root,o=[];let s=0;return this.vertices&&Object.keys(this.vertices).forEach(((a,l)=>{var c;const{ptId:u}=this.vertices[a],h=null==e?void 0:e[u];if(!(null==h?void 0:h.properties))return;const{sources:d}=null==h?void 0:h.properties;d&&(null===(c=Object.values(d))||void 0===c||c.forEach(((e,a)=>{var l,c;const{locName:p}=h.properties,f=null==e?void 0:e.lineExtraProps;let g;const m=null==f?void 0:f.metric;if(m){var _,y;const e=null===(y=h.properties)||void 0===y||null===(_=y.style)||void 0===_?void 0:_.fixedColor,t=e&&r.visualization.getColorByName(e),n=t?O(t):void 0;g=(0,GS.isNumber)(m)&&rr(_k({},h.properties,f),m,pk,n)}const v=null===(l=e.parPath)||void 0===l?void 0:l.at(-1),b=null==e?void 0:e.parPath,w=v?null==t?void 0:t.get(v):null,S=h.geometry;let C;w&&(C=w.geometry);const A=h.properties.aggrType,P=Array.isArray(b)&&b.length>0?function(e,t){if(0===e.length)return[[]];const n=[];let i=[],r=yk(e[0],t);for(let o=0;o<e.length;o++){const s=e[o],a=yk(s,t);a&&r!==a&&i.length>0&&(i.push({item:s,gIdx:o}),n.push(i),i=[],r=!a),i.push({item:s,gIdx:o})}return i.length>0&&n.push(i),n}(b,t):[],I=A&&E.includes(A)?P:P.filter(((e,n)=>{const i=0!==n&&2===e.length&&yk(e[0].item,t)&&yk(e[e.length-1].item,t);return e.some((e=>"string"==typeof e.item)),!i})),M=n||A&&E.includes(A)?I.filter((e=>e.length>1)).map((e=>er(e,t))):C?[[S.coordinates,C.coordinates]]:null;if(!M)return;const R=Array.isArray(b)&&(null==b?void 0:b.map(((e,t)=>({item:e,gIdx:t})))),k=R&&(null==R?void 0:R.length)?er(R,t):[],L=(this.direction,p);var D,F;o.push({id:s,type:"Feature",geometry:{type:"MultiLineString",coordinates:M},properties:(D=_k({},h.properties,f,g&&{threshold:g}),F={locName:d&&1===Object.keys(d).length?L:L+x+a,ptId:u,parPath:Array.isArray(b)?[...b]:null,parPathCoords:k,segrPathVisible:I.length>0?I:Array.isArray(b)?[[{item:p,gIdx:0},{item:b.at(-1),gIdx:1}]]:null},F=null!=F?F:{},Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(F)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(F)).forEach((function(e){Object.defineProperty(D,e,Object.getOwnPropertyDescriptor(F,e))})),D)}),(null===(c=e.parPath)||void 0===c?void 0:c.length)&&i(h,s,T.SetLineId,v),s++})))})),n?(o.forEach(((n,i)=>{var r,s,a;if(!n)return;const{locName:l,ptId:c,aggrType:u,parPath:h,isOffset:d}=n.properties,p=h?h[1]:null,f=h?h[length-2]:null,g=p?null==t||null===(r=t.get(p))||void 0===r?void 0:r.properties.aggrType:"",m=f?null==t||null===(s=t.get(f))||void 0===s?void 0:s.properties.aggrType:"",_=!!g&&E.includes(g);if(m&&E.includes(m),u&&E.includes(u))return;if(!_)return;const y=function({locName:e,lineFeatures:t,direction:n}){return t.length?t.filter((t=>{const{parPath:i}=t.properties;return(null==i?void 0:i.at("target"===n?-1:0))===e})):[]}({locName:c?null==e||null===(a=e[c])||void 0===a?void 0:a.properties.locName:null,lineFeatures:o,direction:this.direction});if((null==y?void 0:y.length)<1)return;let v=0;y.forEach(((e,i)=>{var r;const o=e.geometry.coordinates,s=e.properties.segrPathVisible,a=o.at("target"===this.direction?-1:0),{locName:c,parPath:u,aggrType:h}=e.properties;if(E.includes(h))return;const d="target"===this.direction?u.length-2:1,p=null==t||null===(r=t.get(u[d]))||void 0===r?void 0:r.properties.aggrType;if(!E.includes(p))return;const f=(null==n?void 0:n.geometry).coordinates;if(f&&(null==f?void 0:f.length)>0){const e=a[0],t=f[0].at("target"===this.direction?0:-1);if(e&&t&&c!==l){var g;const n=[e,t],r=y.length;.7*(i-Math.floor(r/2))==0&&v++;const o=.7*(i+v-Math.floor(r/2)),l=Ki(Qi()(n),o,{units:"meters"}),[c,h]=null==l||null===(g=l.geometry)||void 0===g?void 0:g.coordinates,d=(function(e,t){[(e[0]+t[0])/2,(e[1]+t[1])/2].map((e=>parseFloat(e.toFixed(6))))}(e,h),function(e,t){return[[(2*e[0]+t[0])/3,(2*e[1]+t[1])/3],[(e[0]+2*t[0])/3,(e[1]+2*t[1])/3]]}(c,h).map((e=>e.map((e=>parseFloat(e.toFixed(6))))))),p="target"===this.direction?a.length-1:1;a.splice(p,0,d[0],d[1]);const f="target"===this.direction?u.length-1:1;u.splice(f,0,d[0],d[1]);const m=s["target"===this.direction?s.length-1:0],_=m[0].gIdx,b=[d[0],d[1]].map(((e,t)=>({item:e,gIdx:_+1}))),x="target"===this.direction?m.length-1:1;m.splice(x,0,...b)}}}))})),o):o}get getLineSwitchMap(){const e=this.getEditableLines,t=[];return null==e||e.forEach((e=>{(null==e?void 0:e.properties)&&t.push([e.properties.locName,e])})),new Map(t)}get getisShowLines(){return this.isShowLines}constructor(e){mk(this,"root",void 0),mk(this,"isShowLines",!0),mk(this,"vertices",{}),mk(this,"direction","target"),mk(this,"setVertices",(e=>{this.vertices=e})),mk(this,"setDirection",(e=>{this.direction=e})),mk(this,"toggleShowLines",(e=>{this.isShowLines=e})),this.root=e;const t=["target","source"].includes(e.replaceVariables("$locRole"));this.direction=t?e.replaceVariables("$locRole"):"target",qn(this)}};function bk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const xk=class{get getMode(){return this.mode}get getSvgIcons(){return this.svgIcons}get getSelCoord(){return this.selCoord}get getSelIds(){return this.selIds}get getSelFeature(){var e;return null===(e=this.switchMap)||void 0===e?void 0:e.get(this.selectedIp)}get getisOffset(){return this.isOffset}get getTooltipObject(){return this.tooltipObject}get getSelectedFeIndexes(){if(!this.getSelFeature)return null;const{id:e,properties:t}=this.getSelFeature,{colType:n,locName:i}=t,r=this.selIds,o=new Map;return n&&void 0!==e&&(o.set(n,[e]),n===S.Points&&(null==r?void 0:r.length)&&o.set(S.Lines,r)),o}get getisShowSVG(){return this.isShowSVG}get getisShowPoints(){return this.isShowPoints}get getComments(){return this.comments}get getAllFeatures(){return this.allFeatures}get getPoints(){var e,t;return null!==(t=null===(e=this.allFeatures)||void 0===e?void 0:e.markers)&&void 0!==t?t:[]}get getSelectedIp(){return this.selectedIp}get switchMap(){const{allFeatures:e}=this,t=e.markers,n=[];if(null==t||t.forEach((e=>{e&&e.properties&&n.push([e.properties.locName,e])})),0!==n.length)return new Map(n)}constructor(e){bk(this,"root",void 0),bk(this,"type","icons"),bk(this,"allFeatures",{}),bk(this,"comments",void 0),bk(this,"isShowSVG",!0),bk(this,"mode","view"),bk(this,"isShowPoints",!0),bk(this,"isOffset",!0),bk(this,"selectedIp",""),bk(this,"selIds",[]),bk(this,"selCoord",{coordinates:[],type:"Point"}),bk(this,"svgIcons",{}),bk(this,"tooltipObject",w),bk(this,"setSvgIcons",(e=>{this.svgIcons=e})),bk(this,"setSelCoord",(e=>{this.selCoord=e})),bk(this,"setMode",(e=>{this.mode=e})),bk(this,"setSelIds",(e=>{this.selIds=e})),bk(this,"setAllComments",(e=>{this.comments=e})),bk(this,"setTooltipObject",(e=>{var t,n,i;this.tooltipObject=(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){bk(e,t,n[t])}))}return e}({},e),i=null!=(i={cluster:!1,object:null!==(t=e.object)&&void 0!==t?t:{}})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})),n)})),bk(this,"toggleShowSVG",(e=>{this.isShowSVG=e})),bk(this,"toggleShowPoints",(e=>{this.isShowPoints=e})),bk(this,"toggleOffset",(e=>{this.isOffset=e})),bk(this,"setSelectedIp",((e,t=null)=>{var n;if(null!==e){var i;const t=null==e?void 0:e.split(x),n=null==t?void 0:t[0];this.selectedIp=null!=n?n:"";const r=null===(i=this.getSelFeature)||void 0===i?void 0:i.geometry;r&&this.setSelCoord(r)}const r=null===(n=this.getSelFeature)||void 0===n?void 0:n.properties.sources;if(r&&Object.values(r).length){const n=null!==t?t:e?Object.values(r).map((e=>null==e?void 0:e.lineId)).filter((e=>void 0!==e)):[];this.setSelIds(n)}else this.setSelIds([])})),bk(this,"setAllFeatures",(e=>{this.allFeatures=e})),bk(this,"editCoords",yn(((e,t,n,i)=>{var r;let o=null==e||null===(r=e.properties)||void 0===r?void 0:r.sources,s=i&&o&&o[i];n===T.SetLineId&&s&&void 0!==t&&(s.lineId=t)}))),this.root=e;const t=e.replaceVariables("$stat"),n=parseInt(t,10);1!==n&&2!==n||(this.isOffset=1===n),qn(this)}};function wk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ek=class{get getClusterMaxZoom(){return this.clusterMaxZoom}get getViewState(){return this.viewState}constructor(e){wk(this,"root",void 0),wk(this,"viewState",void 0),wk(this,"clusterMaxZoom",16),wk(this,"setViewState",(e=>{this.viewState=e})),wk(this,"setClusterMaxZoom",(e=>{this.clusterMaxZoom=e})),this.root=e;const t=e.replaceVariables("$cluster_max_zoom"),n=parseInt(t,10);n>1&&n<19&&(this.clusterMaxZoom=n),qn(this)}};function Sk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Tk=class{constructor(e){Sk(this,"lineStore",void 0),Sk(this,"pointStore",void 0),Sk(this,"viewStore",void 0),Sk(this,"replaceVariables",void 0),Sk(this,"theme2",void 0),this.replaceVariables=e.replaceVariables,this.theme2=e.theme2,this.lineStore=new vk(this),this.pointStore=new xk(this),this.viewStore=new Ek(this)}},Ck=(0,r.createContext)(void 0),Ak=({children:e,props:t})=>{const n=new Tk(t);return o().createElement(Ck.Provider,{value:n},e)},Pk=()=>{const e=(0,r.useContext)(Ck);if(void 0===e)throw new Error("useRootStore must be used within RootStoreProvider");return e},Ik=(e,t,n,i)=>{var r,o,s;(null==e?void 0:e.type)&&!IS.config.geomapDisableCustomBaseLayer||(e=kR);const a=null!==(s=null!==(o=LR.getIfExists(e.type))&&void 0!==o?o:OR)&&void 0!==s?s:{},l=a&&a.create?null==a?void 0:a.create(e,i):{};var c;t(null!==(c=null==l||null===(r=l.init)||void 0===r?void 0:r.call(l))&&void 0!==c?c:{})},Mk=e=>{let t={id:e.id,longitude:0,latitude:0,zoom:1};const i=n.getIfExists(e.id);if(i){let n,l;var r,o,s,a;void 0===i.lat||4!==e.zoom?(n=[null!==(r=e.lon)&&void 0!==r?r:0,null!==(o=e.lat)&&void 0!==o?o:0],l=e.zoom):(n=[null!==(s=i.lon)&&void 0!==s?s:0,null!==(a=i.lat)&&void 0!==a?a:0],l=i.zoom),n&&(t.longitude=n[0],t.latitude=n[1]),l&&(t.zoom=l)}return t};function Rk(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kk(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){Rk(e,t,n[t])}))}return e}const Ok=({value:e,onChange:t,options:n})=>o().createElement(Pl.Select,{width:"auto",isLoading:!1,value:e,onChange:e=>{t(null==e?void 0:e.value)},options:n}),Lk=e=>{if((0,Pl.useStyles2)(Dk),e.context.data&&e.context.data.length>0){const t=e.context.data.flatMap((e=>e.fields)).map((e=>({label:e.name,value:e.name,type:e.type})));return o().createElement(o().Fragment,null,o().createElement(Ok,{context:e.context,options:t,item:e.context.item,value:e.overrideField.name,onChange:n=>{"string"==typeof n&&e.nameTypeSetter(e.index,n,t.find((e=>e.value===n)).type)}}),o().createElement(Pl.AutoSizeInput,{minWidth:10,disabled:!e.overrideField.name,onCommitChange:t=>{e.valueSetter(e.index,t.currentTarget.value)},defaultValue:e.overrideField.value,placeholder:"val1,val2..."}),o().createElement(Pl.IconButton,{disabled:e.disabled,key:"deleteThresholdField",variant:"destructive",name:"x",tooltip:"remove threshold Field",onClick:()=>e.remover(e.index)}))}return o().createElement(Pl.Select,{onChange:()=>{},disabled:!0})},Dk=e=>({inputPrefix:CS.css`
      display: flex;
      align-items: center;
    `,colorPicker:CS.css`
      padding: 0 ${e.spacing(1)};
    `}),Fk=j(.1,50,1,!0),Nk=t=>{const n=(0,Pl.useStyles2)(Bk),[i,s]=(0,r.useState)((()=>{if(!t.threshold.overrides)return[];const e=[];return Object.values(t.threshold.overrides).forEach(((t,n)=>{e[n]={overrideField:t,order:n,ID:VC()}})),e})),a=e=>{s(e);const n=[];e.forEach((e=>{n.push(e.overrideField)})),t.overrideSetter(t.index,n)},l=(e,t,n)=>{i[e].overrideField.name=t,i[e].overrideField.type=n,a([...i])},c=(e,t)=>{i[e].overrideField.value=t,a([...i])},u=e=>{const t=[...i];let n=0;for(let i=0;i<t.length;i++)if(t[i].order===e){n=i;break}t.splice(n,1);for(let e=0;e<t.length;e++)t[e].order=e;a([...t])},[h,d]=(0,r.useState)((p=t.threshold.lineWidth,Fk.keys(),p));var p;return o().createElement(Pl.Input,{title:"metric threshold value",disabled:t.disabled,type:"number",step:"1.0",key:t.ID,onChange:e=>t.valueSetter(t.index,Number(e.currentTarget.value)),value:t.threshold.value,prefix:o().createElement("div",{className:n.inputPrefix},o().createElement(Pl.Tooltip,{content:"stat1 color"},o().createElement("div",{className:n.colorPicker},o().createElement(Pl.ColorPicker,{color:t.threshold.color,onChange:e=>{t.colorSetter(t.index,e)},enableNamedColors:!0}))),o().createElement("div",null,o().createElement(Pl.Select,{title:"line width",disabled:t.disabled,menuShouldPortal:!0,value:h,onChange:e=>{const n="string"==typeof e.value?parseFloat(e.value):e.value;n&&(d(e),t.lineWidthSetter(t.index,n))},options:"number"==typeof h?Fk.concat([{value:h,label:h.toString()}]):Fk,allowCustomValue:!0,width:"auto"}))),suffix:o().createElement(o().Fragment,null,o().createElement(Pl.AutoSizeInput,{title:"color label",disabled:!1,onCommitChange:e=>{t.labelSetter(t.index,e.currentTarget.value)},defaultValue:t.threshold.label,placeholder:"label"}),i&&i.map(((e,n)=>o().createElement(Lk,{disabled:t.disabled||!1,key:`threshold-field-index-${e.ID}`,ID:e.ID,overrideField:e.overrideField,nameTypeSetter:l,valueSetter:c,remover:u,index:n,context:t.context}))),o().createElement(Pl.IconButton,{disabled:t.disabled,key:"addThresholdField",variant:"primary",name:"plus",tooltip:"add override",onClick:()=>{const t=i.length,n={overrideField:{name:"",value:"",type:e.FieldType.string},order:t,ID:VC()};a([...i,n])}}),o().createElement(Pl.IconButton,{disabled:t.disabled,key:"deleteThreshold",variant:"destructive",name:"trash-alt",tooltip:"delete threshold",onClick:()=>t.remover(t.index)}))})},Bk=e=>({inputPrefix:CS.css`
      display: flex;
      align-items: center;
    `,colorPicker:CS.css`
      padding: 0 ${e.spacing(1)} 0 0;
    `}),zk=e=>{const{context:t}=e,n=t.eventBus,i=(0,Pl.useStyles2)(jk),[s,a]=(0,r.useState)((()=>{if(!e.thresholds)return[];const t=[];return e.thresholds.forEach(((e,n)=>{t[n]={threshold:e,order:n,ID:VC()}})),t})),l=(0,Pl.useTheme2)(),c=((0,Pl.useTheme)(),t=>{a(t);const i=[];t.forEach((e=>{i.push(e.threshold)})),null==n||n.publish({type:"thresholdType",payload:{thresholds:i}}),e.setter(i)}),u=(e,t,n)=>{t&&(s[e].threshold.overrides=t,c([...s]))},h=(e,t)=>{s[e].threshold.value=Number(t);const n=[...s],i=(0,GS.orderBy)(n,["threshold.value"],["asc"]);c([...i])},d=(e,t)=>{let n=t;void 0!==l.visualization&&(n=l.visualization.getColorByName(t)),s[e].threshold.color=O(n),c([...s])},p=(e,t)=>{s[e].threshold.lineWidth=t,c([...s])},f=(e,t)=>{s[e].threshold.label=t,c([...s])},g=e=>{const t=[...s];let n=0;for(let i=0;i<t.length;i++)if(t[i].order===e){n=i;break}t.splice(n,1);for(let e=0;e<t.length;e++)t[e].order=e;c([...t])};return o().createElement(o().Fragment,null,o().createElement(Pl.Button,{className:i.addBtn,disabled:e.disabled,fill:"solid",variant:"primary",icon:"plus",onClick:()=>{const e={threshold:{overrides:[],color:"rgba(154, 205, 50)",lineWidth:1,label:"",value:0},order:s.length,ID:VC()};c([...s,e])}},"Add Threshold"),s&&s.map(((t,n)=>o().createElement(Nk,{disabled:e.disabled||!1,key:`threshold-item-index-${t.ID}`,ID:t.ID,threshold:t.threshold,colorSetter:d,lineWidthSetter:p,valueSetter:h,labelSetter:f,overrideSetter:u,remover:g,index:n,context:e.context}))))},jk=e=>({addBtn:CS.css`
      margin-bottom: ${e.spacing(1)};;      
    `}),Uk=({context:e,onChange:t})=>{const[n,i]=(0,r.useState)(e.options.globalThresholdsConfig);return o().createElement(zk,{context:e,thresholds:n,setter:e=>{i(e),t(e)}})};var Vk=function(){},$k="undefined"!=typeof window;var Gk=d(1559);function Wk(e,t="latest"){return Hk(e,t.replace(/\-.*/,""))}function Hk(e,t){const n={};for(const[i,r]of Object.entries(e))Zk(r)?n[i]=Hk(r,t):(Xk(r,i),n[i]=qk(r,t));return n}function Zk(e){if("object"==typeof e){const[t]=Object.keys(e);return!(0,Gk.valid)(t)}return!1}function qk(e,t){let n,i=Object.keys(e).sort(Gk.compare);if("latest"===t)return e[i[i.length-1]];for(const e of i)(0,Gk.gte)(t,e)&&(n=e);return n||(n=i[i.length-1]),e[n]}function Xk(e,t){if(!Object.keys(e).every((e=>(0,Gk.valid)(e))))throw new Error(`Invalid semver version: '${t}'`)}const Yk="8.5.0",Kk={RadioButton:{container:{"10.2.3":"data-testid radio-button"}},Breadcrumbs:{breadcrumb:{"9.4.0":e=>`data-testid ${e} breadcrumb`}},CanvasGridAddActions:{addPanel:{"12.1.0":"data-testid CanvasGridAddActions add-panel"},groupPanels:{"12.1.0":"data-testid CanvasGridAddActions group-panels"},ungroup:{"12.1.0":"data-testid CanvasGridAddActions ungroup"},addRow:{"12.1.0":"data-testid CanvasGridAddActions add-row"},pasteRow:{"12.1.0":"data-testid CanvasGridAddActions paste-row"},addTab:{"12.1.0":"data-testid CanvasGridAddActions add-tab"},pasteTab:{"12.1.0":"data-testid CanvasGridAddActions paste-tab"}},DashboardEditPaneSplitter:{primaryBody:{"12.1.0":"data-testid DashboardEditPaneSplitter primary body"}},EditPaneHeader:{deleteButton:{"12.1.0":"data-testid EditPaneHeader delete panel"},copyDropdown:{"12.1.0":"data-testid EditPaneHeader copy dropdown"},copy:{"12.1.0":"data-testid EditPaneHeader copy"},duplicate:{"12.1.0":"data-testid EditPaneHeader duplicate"},backButton:{"12.1.0":"data-testid EditPaneHeader back"}},TimePicker:{openButton:{[Yk]:"data-testid TimePicker Open Button"},overlayContent:{"10.2.3":"data-testid TimePicker Overlay Content"},fromField:{"10.2.3":"data-testid Time Range from field",[Yk]:"Time Range from field"},toField:{"10.2.3":"data-testid Time Range to field",[Yk]:"Time Range to field"},applyTimeRange:{[Yk]:"data-testid TimePicker submit button"},copyTimeRange:{"10.4.0":"data-testid TimePicker copy button"},pasteTimeRange:{"10.4.0":"data-testid TimePicker paste button"},calendar:{label:{"10.2.3":"data-testid Time Range calendar",[Yk]:"Time Range calendar"},openButton:{"10.2.3":"data-testid Open time range calendar",[Yk]:"Open time range calendar"},closeButton:{"10.2.3":"data-testid Close time range Calendar",[Yk]:"Close time range Calendar"}},absoluteTimeRangeTitle:{[Yk]:"data-testid-absolute-time-range-narrow"}},DataSourcePermissions:{form:{"9.5.0":()=>'form[name="addPermission"]'},roleType:{"9.5.0":"Role to add new permission to"},rolePicker:{"9.5.0":"Built-in role picker"},permissionLevel:{"12.0.0":"Permission level","9.5.0":"Permission Level"}},DateTimePicker:{input:{"10.2.3":"data-testid date-time-input"}},DataSource:{TestData:{QueryTab:{scenarioSelectContainer:{[Yk]:"Test Data Query scenario select container"},scenarioSelect:{[Yk]:"Test Data Query scenario select"},max:{[Yk]:"TestData max"},min:{[Yk]:"TestData min"},noise:{[Yk]:"TestData noise"},seriesCount:{[Yk]:"TestData series count"},spread:{[Yk]:"TestData spread"},startValue:{[Yk]:"TestData start value"},drop:{[Yk]:"TestData drop values"}}},DataSourceHttpSettings:{urlInput:{"10.4.0":"data-testid Datasource HTTP settings url",[Yk]:"Datasource HTTP settings url"}},Jaeger:{traceIDInput:{[Yk]:"Trace ID"}},Prometheus:{configPage:{connectionSettings:{[Yk]:"Data source connection URL"},manageAlerts:{"10.4.0":"prometheus-alerts-manager"},allowAsRecordingRulesTarget:{"12.1.0":"prometheus-recording-rules-target"},scrapeInterval:{"10.4.0":"data-testid scrape interval"},queryTimeout:{"10.4.0":"data-testid query timeout"},defaultEditor:{"10.4.0":"data-testid default editor"},disableMetricLookup:{"10.4.0":"disable-metric-lookup"},prometheusType:{"10.4.0":"data-testid prometheus type"},prometheusVersion:{"10.4.0":"data-testid prometheus version"},cacheLevel:{"10.4.0":"data-testid cache level"},incrementalQuerying:{"10.4.0":"prometheus-incremental-querying"},queryOverlapWindow:{"10.4.0":"data-testid query overlap window"},disableRecordingRules:{"10.4.0":"disable-recording-rules"},customQueryParameters:{"10.4.0":"data-testid custom query parameters"},httpMethod:{"10.4.0":"data-testid http method"},exemplarsAddButton:{"10.3.0":"data-testid Add exemplar config button",[Yk]:"Add exemplar config button"},internalLinkSwitch:{"10.3.0":"data-testid Internal link switch",[Yk]:"Internal link switch"},codeModeMetricNamesSuggestionLimit:{"11.1.0":"data-testid code mode metric names suggestion limit"},seriesLimit:{"12.0.2":"data-testid maximum series limit"}},queryEditor:{explain:{"10.4.0":"data-testid prometheus explain switch wrapper"},editorToggle:{"10.4.0":"data-testid QueryEditorModeToggle"},options:{"10.4.0":"data-testid prometheus options"},legend:{"10.4.0":"data-testid prometheus legend wrapper"},format:{"10.4.0":"data-testid prometheus format"},step:{"10.4.0":"data-testid prometheus-step"},type:{"10.4.0":"data-testid prometheus type"},exemplars:{"10.4.0":"data-testid prometheus-exemplars"},builder:{metricSelect:{"10.4.0":"data-testid metric select"},hints:{"10.4.0":"data-testid prometheus hints"},metricsExplorer:{"10.4.0":"data-testid metrics explorer"},queryAdvisor:{"10.4.0":"data-testid query advisor"}},code:{queryField:{"10.4.0":"data-testid prometheus query field"},metricsCountInfo:{"11.1.0":"data-testid metrics count disclaimer"},metricsBrowser:{openButton:{"10.4.0":"data-testid open metrics browser"},selectMetric:{"10.4.0":"data-testid select a metric"},seriesLimit:{"10.3.1":"data-testid series limit"},metricList:{"10.4.0":"data-testid metric list"},labelNamesFilter:{"10.4.0":"data-testid label names filter"},labelValuesFilter:{"10.4.0":"data-testid label values filter"},useQuery:{"10.4.0":"data-testid use query"},useAsRateQuery:{"10.4.0":"data-testid use as rate query"},validateSelector:{"10.4.0":"data-testid validate selector"},clear:{"10.4.0":"data-testid clear"}}}},exemplarMarker:{"10.3.0":"data-testid Exemplar marker",[Yk]:"Exemplar marker"},variableQueryEditor:{queryType:{"10.4.0":"data-testid query type"},labelnames:{metricRegex:{"10.4.0":"data-testid label names metric regex"}},labelValues:{labelSelect:{"10.4.0":"data-testid label values label select"}},metricNames:{metricRegex:{"10.4.0":"data-testid metric names metric regex"}},varQueryResult:{"10.4.0":"data-testid variable query result"},seriesQuery:{"10.4.0":"data-testid prometheus series query"},classicQuery:{"10.4.0":"data-testid prometheus classic query"}},annotations:{minStep:{"10.4.0":"data-testid prometheus-annotation-min-step"},title:{"10.4.0":"data-testid prometheus annotation title"},tags:{"10.4.0":"data-testid prometheus annotation tags"},text:{"10.4.0":"data-testid prometheus annotation text"},seriesValueAsTimestamp:{"10.4.0":"data-testid prometheus annotation series value as timestamp"}}}},Menu:{MenuComponent:{[Yk]:e=>`${e} menu`},MenuGroup:{[Yk]:e=>`${e} menu group`},MenuItem:{[Yk]:e=>`${e} menu item`},SubMenu:{container:{"10.3.0":"data-testid SubMenu container",[Yk]:"SubMenu container"},icon:{"10.3.0":"data-testid SubMenu icon",[Yk]:"SubMenu icon"}}},Panels:{Panel:{title:{[Yk]:e=>`data-testid Panel header ${e}`},content:{"11.1.0":"data-testid panel content"},headerContainer:{"9.5.0":"data-testid header-container"},headerItems:{"10.2.0":e=>`data-testid Panel header item ${e}`},menuItems:{"9.5.0":e=>`data-testid Panel menu item ${e}`},menu:{"9.5.0":e=>`data-testid Panel menu ${e}`},containerByTitle:{[Yk]:e=>`${e} panel`},headerCornerInfo:{[Yk]:e=>`Panel header ${e}`},status:{"10.2.0":e=>`data-testid Panel status ${e}`,[Yk]:e=>"Panel status"},loadingBar:{"10.0.0":()=>"Panel loading bar"},HoverWidget:{container:{"10.1.0":"data-testid hover-header-container",[Yk]:"hover-header-container"},dragIcon:{"10.0.0":"data-testid drag-icon"}},PanelDataErrorMessage:{"10.4.0":"data-testid Panel data error message"}},Visualization:{Graph:{container:{"9.5.0":"Graph container"},VisualizationTab:{legendSection:{[Yk]:"Legend section"}},Legend:{legendItemAlias:{[Yk]:e=>`gpl alias ${e}`},showLegendSwitch:{[Yk]:"gpl show legend"}},xAxis:{labels:{[Yk]:()=>"div.flot-x-axis > div.flot-tick-label"}}},BarGauge:{valueV2:{[Yk]:"data-testid Bar gauge value"}},PieChart:{svgSlice:{"10.3.0":"data testid Pie Chart Slice"}},Text:{container:{[Yk]:()=>".markdown-html"}},Table:{header:{[Yk]:"table header"},footer:{[Yk]:"table-footer"},body:{"10.2.0":"data-testid table body"}}}},VizLegend:{seriesName:{"10.3.0":e=>`data-testid VizLegend series ${e}`}},Drawer:{General:{title:{[Yk]:e=>`Drawer title ${e}`},expand:{[Yk]:"Drawer expand"},contract:{[Yk]:"Drawer contract"},close:{"10.3.0":"data-testid Drawer close",[Yk]:"Drawer close"},rcContentWrapper:{"9.4.0":()=>".rc-drawer-content-wrapper"},subtitle:{"10.4.0":"data-testid drawer subtitle"}},DashboardSaveDrawer:{saveButton:{"11.1.0":"data-testid Save dashboard drawer button"},saveAsButton:{"11.1.0":"data-testid Save as dashboard drawer button"},saveAsTitleInput:{"11.1.0":"Save dashboard title field"}}},PanelEditor:{General:{content:{"11.1.0":"data-testid Panel editor content","8.0.0":"Panel editor content"}},OptionsPane:{content:{"11.1.0":"data-testid Panel editor option pane content",[Yk]:"Panel editor option pane content"},select:{[Yk]:"Panel editor option pane select"},fieldLabel:{[Yk]:e=>`${e} field property editor`},fieldInput:{"11.0.0":e=>`data-testid Panel editor option pane field input ${e}`}},DataPane:{content:{"11.1.0":"data-testid Panel editor data pane content",[Yk]:"Panel editor data pane content"}},applyButton:{"9.2.0":"data-testid Apply changes and go back to dashboard","9.1.0":"Apply changes and go back to dashboard","8.0.0":"panel editor apply"},toggleVizPicker:{"10.0.0":"data-testid toggle-viz-picker","8.0.0":"toggle-viz-picker"},toggleVizOptions:{"10.1.0":"data-testid toggle-viz-options",[Yk]:"toggle-viz-options"},toggleTableView:{"11.1.0":"data-testid toggle-table-view",[Yk]:"toggle-table-view"},showZoomField:{"10.2.0":"Map controls Show zoom control field property editor"},showAttributionField:{"10.2.0":"Map controls Show attribution field property editor"},showScaleField:{"10.2.0":"Map controls Show scale field property editor"},showMeasureField:{"10.2.0":"Map controls Show measure tools field property editor"},showDebugField:{"10.2.0":"Map controls Show debug field property editor"},measureButton:{"12.1.0":"data-testid panel-editor-measure-button","9.2.0":"show measure tools"},Outline:{section:{"12.0.0":"data-testid Outline section"},node:{"12.0.0":e=>`data-testid outline node ${e}`},item:{"12.0.0":e=>`data-testid outline item ${e}`}},ElementEditPane:{variableType:{"12.0.0":e=>`data-testid variable type ${e}`},addVariableButton:{"12.0.0":"data-testid add variable button"},variableNameInput:{"12.0.0":"data-testid variable name input"},variableLabelInput:{"12.0.0":"data-testid variable label input"},AutoGridLayout:{minColumnWidth:{"12.1.0":"data-testid min column width selector"},customMinColumnWidth:{"12.1.0":"data-testid custom min column width input"},clearCustomMinColumnWidth:{"12.1.0":"data-testid clear custom min column width input"},maxColumns:{"12.1.0":"data-testid max columns selector"},rowHeight:{"12.1.0":"data-testid row height selector"},customRowHeight:{"12.1.0":"data-testid custom row height input"},clearCustomRowHeight:{"12.1.0":"data-testid clear custom row height input"},fillScreen:{"12.1.0":"data-testid fill screen switch"}}}},PanelInspector:{Data:{content:{[Yk]:"Panel inspector Data content"}},Stats:{content:{[Yk]:"Panel inspector Stats content"}},Json:{content:{"11.1.0":"data-testid Panel inspector Json content",[Yk]:"Panel inspector Json content"}},Query:{content:{[Yk]:"Panel inspector Query content"},refreshButton:{[Yk]:"Panel inspector Query refresh button"},jsonObjectKeys:{[Yk]:()=>".json-formatter-key"}}},Tab:{title:{"11.2.0":e=>`data-testid Tab ${e}`},active:{[Yk]:()=>'[class*="-activeTabStyle"]'}},RefreshPicker:{runButtonV2:{[Yk]:"data-testid RefreshPicker run button"},intervalButtonV2:{[Yk]:"data-testid RefreshPicker interval button"}},QueryTab:{content:{[Yk]:"Query editor tab content"},queryInspectorButton:{[Yk]:"Query inspector button"},queryHistoryButton:{"10.2.0":"data-testid query-history-button",[Yk]:"query-history-button"},addQuery:{"10.2.0":"data-testid query-tab-add-query",[Yk]:"Query editor add query button"},addQueryFromLibrary:{"11.5.0":"data-testid query-tab-add-query-from-library"},queryGroupTopSection:{"11.2.0":"data-testid query group top section"},addExpression:{"11.2.0":"data-testid query-tab-add-expression"}},QueryHistory:{queryText:{"9.0.0":"Query text"}},QueryEditorRows:{rows:{[Yk]:"Query editor row"}},QueryEditorRow:{actionButton:{"10.4.0":e=>`data-testid ${e}`},title:{[Yk]:e=>`Query editor row title ${e}`},container:{[Yk]:e=>`Query editor row ${e}`}},AlertTab:{content:{"10.2.3":"data-testid Alert editor tab content",[Yk]:"Alert editor tab content"}},AlertRules:{groupToggle:{"11.0.0":"data-testid group-collapse-toggle"},toggle:{"11.0.0":"data-testid collapse-toggle"},expandedContent:{"11.0.0":"data-testid expanded-content"},previewButton:{"11.1.0":"data-testid alert-rule preview-button"},ruleNameField:{"11.1.0":"data-testid alert-rule name-field"},newFolderButton:{"11.1.0":"data-testid alert-rule new-folder-button"},newFolderNameField:{"11.1.0":"data-testid alert-rule name-folder-name-field"},newFolderNameCreateButton:{"11.1.0":"data-testid alert-rule name-folder-name-create-button"},newEvaluationGroupButton:{"11.1.0":"data-testid alert-rule new-evaluation-group-button"},newEvaluationGroupName:{"11.1.0":"data-testid alert-rule new-evaluation-group-name"},newEvaluationGroupInterval:{"11.1.0":"data-testid alert-rule new-evaluation-group-interval"},newEvaluationGroupCreate:{"11.1.0":"data-testid alert-rule new-evaluation-group-create-button"},step:{"11.5.0":e=>`data-testid alert-rule step-${e}`},stepAdvancedModeSwitch:{"11.5.0":e=>`data-testid advanced-mode-switch step-${e}`}},Alert:{alertV2:{[Yk]:e=>`data-testid Alert ${e}`}},TransformTab:{content:{"10.1.0":"data-testid Transform editor tab content",[Yk]:"Transform editor tab content"},newTransform:{"10.1.0":e=>`data-testid New transform ${e}`},transformationEditor:{"10.1.0":e=>`data-testid Transformation editor ${e}`},transformationEditorDebugger:{"10.1.0":e=>`data-testid Transformation editor debugger ${e}`}},Transforms:{card:{"10.1.0":e=>`data-testid New transform ${e}`},disableTransformationButton:{"10.4.0":"data-testid Disable transformation button"},Reduce:{modeLabel:{"10.2.3":"data-testid Transform mode label",[Yk]:"Transform mode label"},calculationsLabel:{"10.2.3":"data-testid Transform calculations label",[Yk]:"Transform calculations label"}},SpatialOperations:{actionLabel:{"9.1.2":"root Action field property editor"},locationLabel:{"10.2.0":"root Location Mode field property editor"},location:{autoOption:{"9.1.2":"Auto location option"},coords:{option:{"9.1.2":"Coords location option"},latitudeFieldLabel:{"9.1.2":"root Latitude field field property editor"},longitudeFieldLabel:{"9.1.2":"root Longitude field field property editor"}},geohash:{option:{"9.1.2":"Geohash location option"},geohashFieldLabel:{"9.1.2":"root Geohash field field property editor"}},lookup:{option:{"9.1.2":"Lookup location option"},lookupFieldLabel:{"9.1.2":"root Lookup field field property editor"},gazetteerFieldLabel:{"9.1.2":"root Gazetteer field property editor"}}}},searchInput:{"10.2.3":"data-testid search transformations",[Yk]:"search transformations"},noTransformationsMessage:{"10.2.3":"data-testid no transformations message"},addTransformationButton:{"10.1.0":"data-testid add transformation button",[Yk]:"add transformation button"},removeAllTransformationsButton:{"10.4.0":"data-testid remove all transformations button"}},NavBar:{Configuration:{button:{"9.5.0":"Configuration"}},Toggle:{button:{"10.2.3":"data-testid Toggle menu",[Yk]:"Toggle menu"}},Reporting:{button:{"9.5.0":"Reporting"}}},NavMenu:{Menu:{"10.2.3":"data-testid navigation mega-menu"},item:{"9.5.0":"data-testid Nav menu item"}},NavToolbar:{container:{"9.4.0":"data-testid Nav toolbar"},commandPaletteTrigger:{"11.5.0":"data-testid Command palette trigger"},shareDashboard:{"11.1.0":"data-testid Share dashboard"},markAsFavorite:{"11.1.0":"data-testid Mark as favorite"},editDashboard:{editButton:{"11.1.0":"data-testid Edit dashboard button"},saveButton:{"11.1.0":"data-testid Save dashboard button"},exitButton:{"11.1.0":"data-testid Exit edit mode button"},settingsButton:{"11.1.0":"data-testid Dashboard settings"},addRowButton:{"11.1.0":"data-testid Add row button"},addLibraryPanelButton:{"11.1.0":"data-testid Add a panel from the panel library button"},addVisualizationButton:{"11.1.0":"data-testid Add new visualization menu item"},pastePanelButton:{"11.1.0":"data-testid Paste panel button"},discardChangesButton:{"11.1.0":"data-testid Discard changes button"},discardLibraryPanelButton:{"11.1.0":"data-testid Discard library panel button"},unlinkLibraryPanelButton:{"11.1.0":"data-testid Unlink library panel button"},saveLibraryPanelButton:{"11.1.0":"data-testid Save library panel button"},backToDashboardButton:{"11.1.0":"data-testid Back to dashboard button"}}},PageToolbar:{container:{[Yk]:()=>".page-toolbar"},item:{[Yk]:e=>`${e}`},itemButton:{"9.5.0":e=>`data-testid ${e}`}},QueryEditorToolbarItem:{button:{[Yk]:e=>`QueryEditor toolbar item button ${e}`}},BackButton:{backArrow:{"10.3.0":"data-testid Go Back",[Yk]:"Go Back"}},OptionsGroup:{group:{"11.1.0":e=>e?`data-testid Options group ${e}`:"data-testid Options group",[Yk]:e=>e?`Options group ${e}`:"Options group"},toggle:{"11.1.0":e=>e?`data-testid Options group ${e} toggle`:"data-testid Options group toggle",[Yk]:e=>e?`Options group ${e} toggle`:"Options group toggle"}},PluginVisualization:{item:{[Yk]:e=>`Plugin visualization item ${e}`},current:{[Yk]:()=>'[class*="-currentVisualizationItem"]'}},Select:{menu:{"11.5.0":"data-testid Select menu",[Yk]:"Select options menu"},option:{"11.1.0":"data-testid Select option",[Yk]:"Select option"},toggleAllOptions:{"11.3.0":"data-testid toggle all options"},input:{[Yk]:()=>'input[id*="time-options-input"]'},singleValue:{[Yk]:()=>'div[class*="-singleValue"]'}},FieldConfigEditor:{content:{[Yk]:"Field config editor content"}},OverridesConfigEditor:{content:{[Yk]:"Field overrides editor content"}},FolderPicker:{containerV2:{[Yk]:"data-testid Folder picker select container"},input:{"10.4.0":"data-testid folder-picker-input"}},ReadonlyFolderPicker:{container:{[Yk]:"data-testid Readonly folder picker select container"}},DataSourcePicker:{container:{"10.0.0":"data-testid Data source picker select container","8.0.0":"Data source picker select container"},inputV2:{"10.1.0":"data-testid Select a data source",[Yk]:"Select a data source"},dataSourceList:{"10.4.0":"data-testid Data source list dropdown"},advancedModal:{dataSourceList:{"10.4.0":"data-testid Data source list"},builtInDataSourceList:{"10.4.0":"data-testid Built in data source list"}}},TimeZonePicker:{containerV2:{[Yk]:"data-testid Time zone picker select container"},changeTimeSettingsButton:{"11.0.0":"data-testid Time zone picker Change time settings button"}},WeekStartPicker:{containerV2:{[Yk]:"data-testid Choose starting day of the week"},placeholder:{[Yk]:"Choose starting day of the week"}},TraceViewer:{spanBar:{"9.0.0":"data-testid SpanBar--wrapper"}},QueryField:{container:{"10.3.0":"data-testid Query field",[Yk]:"Query field"}},QueryBuilder:{queryPatterns:{"10.3.0":"data-testid Query patterns",[Yk]:"Query patterns"},labelSelect:{"10.3.0":"data-testid Select label",[Yk]:"Select label"},inputSelect:{"11.1.0":"data-testid Select label-input"},valueSelect:{"10.3.0":"data-testid Select value",[Yk]:"Select value"},matchOperatorSelect:{"10.3.0":"data-testid Select match operator",[Yk]:"Select match operator"}},ValuePicker:{button:{"10.3.0":e=>`data-testid Value picker button ${e}`},select:{"10.3.0":e=>`data-testid Value picker select ${e}`}},Search:{sectionV2:{[Yk]:"data-testid Search section"},itemsV2:{[Yk]:"data-testid Search items"},cards:{[Yk]:"data-testid Search cards"},collapseFolder:{[Yk]:e=>`data-testid Collapse folder ${e}`},expandFolder:{[Yk]:e=>`data-testid Expand folder ${e}`},dashboardItem:{[Yk]:e=>`data-testid Dashboard search item ${e}`},dashboardCard:{[Yk]:e=>`data-testid Search card ${e}`},folderHeader:{"9.3.0":e=>`data-testid Folder header ${e}`},folderContent:{"9.3.0":e=>`data-testid Folder content ${e}`},dashboardItems:{[Yk]:"data-testid Dashboard search item"}},DashboardLinks:{container:{[Yk]:"data-testid Dashboard link container"},dropDown:{[Yk]:"data-testid Dashboard link dropdown"},link:{[Yk]:"data-testid Dashboard link"}},LoadingIndicator:{icon:{"10.4.0":"data-testid Loading indicator",[Yk]:"Loading indicator"}},CallToActionCard:{buttonV2:{[Yk]:e=>`data-testid Call to action button ${e}`}},DataLinksContextMenu:{singleLink:{"10.3.0":"data-testid Data link",[Yk]:"Data link"}},DataLinksActionsTooltip:{tooltipWrapper:{"12.1.0":"data-testid Data links actions tooltip wrapper"}},CodeEditor:{container:{"10.2.3":"data-testid Code editor container",[Yk]:"Code editor container"}},ReactMonacoEditor:{editorLazy:{"11.1.0":"data-testid ReactMonacoEditor editorLazy"}},DashboardImportPage:{textarea:{[Yk]:"data-testid-import-dashboard-textarea"},submit:{[Yk]:"data-testid-load-dashboard"}},ImportDashboardForm:{name:{[Yk]:"data-testid-import-dashboard-title"},submit:{[Yk]:"data-testid-import-dashboard-submit"}},PanelAlertTabContent:{content:{"10.2.3":"data-testid Unified alert editor tab content",[Yk]:"Unified alert editor tab content"}},VisualizationPreview:{card:{[Yk]:e=>`data-testid suggestion-${e}`}},ColorSwatch:{name:{[Yk]:"data-testid-colorswatch"}},DashboardRow:{title:{[Yk]:e=>`data-testid dashboard-row-title-${e}`}},UserProfile:{profileSaveButton:{[Yk]:"data-testid-user-profile-save"},preferencesSaveButton:{[Yk]:"data-testid-shared-prefs-save"},orgsTable:{[Yk]:"data-testid-user-orgs-table"},sessionsTable:{[Yk]:"data-testid-user-sessions-table"},extensionPointTabs:{"10.2.3":"data-testid-extension-point-tabs"},extensionPointTab:{"10.2.3":e=>`data-testid-extension-point-tab-${e}`}},FileUpload:{inputField:{"9.0.0":"data-testid-file-upload-input-field"},fileNameSpan:{"9.0.0":"data-testid-file-upload-file-name"}},DebugOverlay:{wrapper:{"9.2.0":"debug-overlay"}},OrgRolePicker:{input:{"9.5.0":"Role"}},AnalyticsToolbarButton:{button:{"9.5.0":"Dashboard insights"}},Variables:{variableOption:{"9.5.0":"data-testid variable-option"},variableLinkWrapper:{"11.1.1":"data-testid variable-link-wrapper"}},Annotations:{annotationsTypeInput:{"11.1.0":"data-testid annotations-type-input",[Yk]:"annotations-type-input"},annotationsChoosePanelInput:{"11.1.0":"data-testid choose-panels-input",[Yk]:"choose-panels-input"},editor:{testButton:{"11.0.0":"data-testid annotations-test-button"},resultContainer:{"11.0.0":"data-testid annotations-query-result-container"}}},Tooltip:{container:{"10.2.0":"data-testid tooltip"}},ReturnToPrevious:{buttonGroup:{"11.0.0":"data-testid dismissable button group"},backButton:{"11.0.0":"data-testid back"},dismissButton:{"11.0.0":"data-testid dismiss"}},SQLQueryEditor:{selectColumn:{"11.0.0":"data-testid select-column"},selectColumnInput:{"11.0.0":"data-testid select-column-input"},selectFunctionParameter:{"11.0.0":e=>`data-testid select-function-parameter-${e}`},selectAggregation:{"11.0.0":"data-testid select-aggregation"},selectAggregationInput:{"11.0.0":"data-testid select-aggregation-input"},selectAlias:{"11.0.0":"data-testid select-alias"},selectAliasInput:{"11.0.0":"data-testid select-alias-input"},selectInputParameter:{"11.0.0":"data-testid select-input-parameter"},filterConjunction:{"11.0.0":"data-testid filter-conjunction"},filterField:{"11.0.0":"data-testid filter-field"},filterOperator:{"11.0.0":"data-testid filter-operator"},headerTableSelector:{"11.0.0":"data-testid header-table-selector"},headerFilterSwitch:{"11.0.0":"data-testid header-filter-switch"},headerGroupSwitch:{"11.0.0":"data-testid header-group-switch"},headerOrderSwitch:{"11.0.0":"data-testid header-order-switch"},headerPreviewSwitch:{"11.0.0":"data-testid header-preview-switch"}},EntityNotFound:{container:{"11.2.0":"data-testid entity-not-found"}},Portal:{container:{"11.5.0":"data-testid portal-container"}}},Jk={Alerting:{AddAlertRule:{url:{"10.1.0":"/alerting/new/alerting",[Yk]:"/alerting/new"}},EditAlertRule:{url:{[Yk]:e=>`alerting/${e}/edit`}}},Login:{url:{[Yk]:"/login"},username:{"10.2.3":"data-testid Username input field",[Yk]:"Username input field"},password:{"10.2.3":"data-testid Password input field",[Yk]:"Password input field"},submit:{"10.2.3":"data-testid Login button",[Yk]:"Login button"},skip:{"10.2.3":"data-testid Skip change password button"}},PasswordlessLogin:{url:{[Yk]:"/login/passwordless/authenticate"},email:{"10.2.3":"data-testid Email input field",[Yk]:"Email input field"},submit:{"10.2.3":"data-testid PasswordlessLogin button",[Yk]:"PasswordlessLogin button"}},Home:{url:{[Yk]:"/"}},DataSource:{name:{"10.3.0":"data-testid Data source settings page name input field",[Yk]:"Data source settings page name input field"},delete:{[Yk]:"Data source settings page Delete button"},readOnly:{"10.3.0":"data-testid Data source settings page read only message",[Yk]:"Data source settings page read only message"},saveAndTest:{"10.0.0":"data-testid Data source settings page Save and Test button",[Yk]:"Data source settings page Save and Test button"},alert:{"10.3.0":"data-testid Data source settings page Alert",[Yk]:"Data source settings page Alert"}},DataSources:{url:{[Yk]:"/datasources"},dataSources:{[Yk]:e=>`Data source list item ${e}`}},EditDataSource:{url:{"9.5.0":e=>`/datasources/edit/${e}`},settings:{"9.5.0":"Datasource settings page basic settings"}},AddDataSource:{url:{[Yk]:"/datasources/new"},dataSourcePluginsV2:{"9.3.1":e=>`Add new data source ${e}`,[Yk]:e=>`Data source plugin item ${e}`}},ConfirmModal:{delete:{"10.0.0":"data-testid Confirm Modal Danger Button",[Yk]:"Confirm Modal Danger Button"}},AddDashboard:{url:{[Yk]:"/dashboard/new"},itemButton:{"9.5.0":e=>`data-testid ${e}`},addNewPanel:{"11.1.0":"data-testid Add new panel","8.0.0":"Add new panel",[Yk]:"Add new panel"},itemButtonAddViz:{[Yk]:"Add new visualization menu item"},addNewRow:{"11.1.0":"data-testid Add new row",[Yk]:"Add new row"},addNewPanelLibrary:{"11.1.0":"data-testid Add new panel from panel library",[Yk]:"Add new panel from panel library"},Settings:{Annotations:{List:{url:{[Yk]:"/dashboard/new?orgId=1&editview=annotations"}},Edit:{url:{[Yk]:e=>`/dashboard/new?editview=annotations&editIndex=${e}`}}},Variables:{List:{url:{"11.3.0":"/dashboard/new?orgId=1&editview=variables",[Yk]:"/dashboard/new?orgId=1&editview=templating"}},Edit:{url:{"11.3.0":e=>`/dashboard/new?orgId=1&editview=variables&editIndex=${e}`,[Yk]:e=>`/dashboard/new?orgId=1&editview=templating&editIndex=${e}`}}}}},ImportDashboard:{url:{[Yk]:"/dashboard/import"}},Dashboard:{url:{[Yk]:e=>`/d/${e}`},DashNav:{nav:{[Yk]:"Dashboard navigation"},navV2:{[Yk]:"data-testid Dashboard navigation"},publicDashboardTag:{"9.1.0":"data-testid public dashboard tag"},shareButton:{"10.4.0":"data-testid share-button"},scrollContainer:{"11.1.0":"data-testid Dashboard canvas scroll container"},newShareButton:{container:{"11.1.0":"data-testid new share button"},shareLink:{"11.1.0":"data-testid new share link-button"},arrowMenu:{"11.1.0":"data-testid new share button arrow menu"},menu:{container:{"11.1.0":"data-testid new share button menu"},shareInternally:{"11.1.0":"data-testid new share button share internally"},shareExternally:{"11.1.1":"data-testid new share button share externally"},shareSnapshot:{"11.2.0":"data-testid new share button share snapshot"}}},NewExportButton:{container:{"11.2.0":"data-testid new export button"},arrowMenu:{"11.2.0":"data-testid new export button arrow menu"},Menu:{container:{"11.2.0":"data-testid new export button menu"},exportAsJson:{"11.2.0":"data-testid new export button export as json"}}},playlistControls:{prev:{"11.0.0":"data-testid playlist previous dashboard button"},stop:{"11.0.0":"data-testid playlist stop dashboard button"},next:{"11.0.0":"data-testid playlist next dashboard button"}}},Controls:{"11.1.0":"data-testid dashboard controls"},SubMenu:{submenu:{[Yk]:"Dashboard submenu"},submenuItem:{[Yk]:"data-testid template variable"},submenuItemLabels:{[Yk]:e=>`data-testid Dashboard template variables submenu Label ${e}`},submenuItemValueDropDownValueLinkTexts:{[Yk]:e=>`data-testid Dashboard template variables Variable Value DropDown value link text ${e}`},submenuItemValueDropDownDropDown:{[Yk]:"Variable options"},submenuItemValueDropDownOptionTexts:{[Yk]:e=>`data-testid Dashboard template variables Variable Value DropDown option text ${e}`},Annotations:{annotationsWrapper:{"10.0.0":"data-testid annotation-wrapper"},annotationLabel:{"10.0.0":e=>`data-testid Dashboard annotations submenu Label ${e}`},annotationToggle:{"10.0.0":e=>`data-testid Dashboard annotations submenu Toggle ${e}`}}},Settings:{Actions:{close:{"9.5.0":"data-testid dashboard-settings-close"}},General:{deleteDashBoard:{"11.1.0":"data-testid Dashboard settings page delete dashboard button"},sectionItems:{[Yk]:e=>`Dashboard settings section item ${e}`},saveDashBoard:{[Yk]:"Dashboard settings aside actions Save button"},saveAsDashBoard:{[Yk]:"Dashboard settings aside actions Save As button"},title:{"11.2.0":"General"}},Annotations:{Edit:{urlParams:{[Yk]:e=>`editview=annotations&editIndex=${e}`}},List:{url:{[Yk]:e=>`/d/${e}?editview=annotations`},addAnnotationCTAV2:{[Yk]:"data-testid Call to action button Add annotation query"},annotations:{"10.4.0":"data-testid list-annotations"}},Settings:{name:{"11.1.0":"data-testid Annotations settings name input",[Yk]:"Annotations settings name input"}},NewAnnotation:{panelFilterSelect:{"10.0.0":"data-testid annotations-panel-filter"},showInLabel:{"11.1.0":"data-testid show-in-label"},previewInDashboard:{"10.0.0":"data-testid annotations-preview"},delete:{"10.4.0":"data-testid annotations-delete"},apply:{"10.4.0":"data-testid annotations-apply"},enable:{"10.4.0":"data-testid annotation-enable"},hide:{"10.4.0":"data-testid annotation-hide"}}},Variables:{List:{url:{"11.3.0":e=>`/d/${e}?editview=variables`,[Yk]:e=>`/d/${e}?editview=templating`},addVariableCTAV2:{[Yk]:"data-testid Call to action button Add variable"},newButton:{[Yk]:"Variable editor New variable button"},table:{[Yk]:"Variable editor Table"},tableRowNameFields:{[Yk]:e=>`Variable editor Table Name field ${e}`},tableRowDefinitionFields:{"10.1.0":e=>`Variable editor Table Definition field ${e}`},tableRowArrowUpButtons:{[Yk]:e=>`Variable editor Table ArrowUp button ${e}`},tableRowArrowDownButtons:{[Yk]:e=>`Variable editor Table ArrowDown button ${e}`},tableRowDuplicateButtons:{[Yk]:e=>`Variable editor Table Duplicate button ${e}`},tableRowRemoveButtons:{[Yk]:e=>`Variable editor Table Remove button ${e}`}},Edit:{urlParams:{"11.3.0":e=>`editview=variables&editIndex=${e}`,[Yk]:e=>`editview=templating&editIndex=${e}`},General:{headerLink:{[Yk]:"Variable editor Header link"},modeLabelNew:{[Yk]:"Variable editor Header mode New"},modeLabelEdit:{[Yk]:"Variable editor Header mode Edit"},generalNameInput:{[Yk]:"Variable editor Form Name field"},generalNameInputV2:{[Yk]:"data-testid Variable editor Form Name field"},generalTypeSelect:{[Yk]:"Variable editor Form Type select"},generalTypeSelectV2:{[Yk]:"data-testid Variable editor Form Type select"},generalLabelInput:{[Yk]:"Variable editor Form Label field"},generalLabelInputV2:{[Yk]:"data-testid Variable editor Form Label field"},generalHideSelect:{[Yk]:"Variable editor Form Hide select"},generalHideSelectV2:{[Yk]:"data-testid Variable editor Form Hide select"},selectionOptionsAllowCustomValueSwitch:{[Yk]:"data-testid Variable editor Form Allow Custom Value switch"},selectionOptionsMultiSwitch:{"10.4.0":"data-testid Variable editor Form Multi switch",[Yk]:"Variable editor Form Multi switch"},selectionOptionsIncludeAllSwitch:{"10.4.0":"data-testid Variable editor Form IncludeAll switch",[Yk]:"Variable editor Form IncludeAll switch"},selectionOptionsCustomAllInput:{"10.4.0":"data-testid Variable editor Form IncludeAll field",[Yk]:"Variable editor Form IncludeAll field"},previewOfValuesOption:{"10.4.0":"data-testid Variable editor Preview of Values option",[Yk]:"Variable editor Preview of Values option"},submitButton:{"10.4.0":"data-testid Variable editor Run Query button",[Yk]:"Variable editor Submit button"},applyButton:{"9.3.0":"data-testid Variable editor Apply button"}},QueryVariable:{closeButton:{[Yk]:"data-testid Query Variable editor close button"},editor:{[Yk]:"data-testid Query Variable editor"},previewButton:{[Yk]:"data-testid Query Variable editor preview button"},queryOptionsDataSourceSelect:{"10.4.0":"data-testid Select a data source","10.0.0":"data-testid Data source picker select container",[Yk]:"Data source picker select container"},queryOptionsOpenButton:{[Yk]:"data-testid Query Variable editor open button"},queryOptionsRefreshSelect:{[Yk]:"Variable editor Form Query Refresh select"},queryOptionsRefreshSelectV2:{[Yk]:"data-testid Variable editor Form Query Refresh select"},queryOptionsRegExInput:{[Yk]:"Variable editor Form Query RegEx field"},queryOptionsRegExInputV2:{[Yk]:"data-testid Variable editor Form Query RegEx field"},queryOptionsSortSelect:{[Yk]:"Variable editor Form Query Sort select"},queryOptionsSortSelectV2:{[Yk]:"data-testid Variable editor Form Query Sort select"},queryOptionsQueryInput:{"10.4.0":"data-testid Variable editor Form Default Variable Query Editor textarea"},valueGroupsTagsEnabledSwitch:{[Yk]:"Variable editor Form Query UseTags switch"},valueGroupsTagsTagsQueryInput:{[Yk]:"Variable editor Form Query TagsQuery field"},valueGroupsTagsTagsValuesQueryInput:{[Yk]:"Variable editor Form Query TagsValuesQuery field"}},ConstantVariable:{constantOptionsQueryInput:{[Yk]:"Variable editor Form Constant Query field"},constantOptionsQueryInputV2:{[Yk]:"data-testid Variable editor Form Constant Query field"}},DatasourceVariable:{datasourceSelect:{[Yk]:"data-testid datasource variable datasource type"},nameFilter:{[Yk]:"data-testid datasource variable datasource name filter"}},TextBoxVariable:{textBoxOptionsQueryInput:{[Yk]:"Variable editor Form TextBox Query field"},textBoxOptionsQueryInputV2:{[Yk]:"data-testid Variable editor Form TextBox Query field"}},CustomVariable:{customValueInput:{[Yk]:"data-testid custom-variable-input"}},IntervalVariable:{intervalsValueInput:{[Yk]:"data-testid interval variable intervals input"},autoEnabledCheckbox:{"10.4.0":"data-testid interval variable auto value checkbox"},stepCountIntervalSelect:{"10.4.0":"data-testid interval variable step count input"},minIntervalInput:{"10.4.0":"data-testid interval variable mininum interval input"}},GroupByVariable:{dataSourceSelect:{"10.4.0":"data-testid Select a data source"},infoText:{"10.4.0":"data-testid group by variable info text"},modeToggle:{"10.4.0":"data-testid group by variable mode toggle"}},AdHocFiltersVariable:{datasourceSelect:{"10.4.0":"data-testid Select a data source"},infoText:{"10.4.0":"data-testid ad-hoc filters variable info text"},modeToggle:{"11.0.0":"data-testid ad-hoc filters variable mode toggle"}}}}},Annotations:{marker:{"10.0.0":"data-testid annotation-marker"}},Rows:{Repeated:{ConfigSection:{warningMessage:{"10.2.0":"data-testid Repeated rows warning message"}}}}},Dashboards:{url:{[Yk]:"/dashboards"},dashboards:{"10.2.0":e=>`Dashboard search item ${e}`},toggleView:{[Yk]:"data-testid radio-button"}},SaveDashboardAsModal:{newName:{"10.2.0":"Save dashboard title field"},save:{"10.2.0":"Save dashboard button"}},SaveDashboardModal:{save:{"10.2.0":"Dashboard settings Save Dashboard Modal Save button"},saveVariables:{"10.2.0":"Dashboard settings Save Dashboard Modal Save variables checkbox"},saveTimerange:{"10.2.0":"Dashboard settings Save Dashboard Modal Save timerange checkbox"},saveRefresh:{"11.1.0":"Dashboard settings Save Dashboard Modal Save refresh checkbox"}},SharePanelModal:{linkToRenderedImage:{[Yk]:"Link to rendered image"}},ShareDashboardModal:{PublicDashboard:{WillBePublicCheckbox:{"9.1.0":"data-testid public dashboard will be public checkbox"},LimitedDSCheckbox:{"9.1.0":"data-testid public dashboard limited datasources checkbox"},CostIncreaseCheckbox:{"9.1.0":"data-testid public dashboard cost may increase checkbox"},PauseSwitch:{"9.5.0":"data-testid public dashboard pause switch"},EnableAnnotationsSwitch:{"9.3.0":"data-testid public dashboard on off switch for annotations"},CreateButton:{"9.5.0":"data-testid public dashboard create button"},DeleteButton:{"9.3.0":"data-testid public dashboard delete button"},CopyUrlInput:{"9.1.0":"data-testid public dashboard copy url input"},CopyUrlButton:{"9.1.0":"data-testid public dashboard copy url button"},SettingsDropdown:{"10.1.0":"data-testid public dashboard settings dropdown"},TemplateVariablesWarningAlert:{"9.1.0":"data-testid public dashboard disabled template variables alert"},UnsupportedDataSourcesWarningAlert:{"9.5.0":"data-testid public dashboard unsupported data sources alert"},NoUpsertPermissionsWarningAlert:{"9.5.0":"data-testid public dashboard no upsert permissions alert"},EnableTimeRangeSwitch:{"9.4.0":"data-testid public dashboard on off switch for time range"},EmailSharingConfiguration:{Container:{"9.5.0":"data-testid email sharing config container"},ShareType:{"9.5.0":"data-testid public dashboard share type"},EmailSharingInput:{"9.5.0":"data-testid public dashboard email sharing input"},EmailSharingInviteButton:{"9.5.0":"data-testid public dashboard email sharing invite button"},EmailSharingList:{"9.5.0":"data-testid public dashboard email sharing list"},DeleteEmail:{"9.5.0":"data-testid public dashboard delete email button"},ReshareLink:{"9.5.0":"data-testid public dashboard reshare link button"}}},SnapshotScene:{url:{"11.1.0":e=>`/dashboard/snapshot/${e}`},PublishSnapshot:{"11.1.0":"data-testid publish snapshot button"},CopyUrlButton:{"11.1.0":"data-testid snapshot copy url button"},CopyUrlInput:{"11.1.0":"data-testid snapshot copy url input"}}},ShareDashboardDrawer:{ShareInternally:{container:{"11.3.0":"data-testid share internally drawer container"},lockTimeRangeSwitch:{"11.3.0":"data-testid share internally lock time range switch"},shortenUrlSwitch:{"11.3.0":"data-testid share internally shorten url switch"},copyUrlButton:{"11.3.0":"data-testid share internally copy url button"},SharePanel:{preview:{"11.5.0":"data-testid share panel internally image generation preview"},widthInput:{"11.5.0":"data-testid share panel internally width input"},heightInput:{"11.5.0":"data-testid share panel internally height input"},scaleFactorInput:{"11.5.0":"data-testid share panel internally scale factor input"},generateImageButton:{"11.5.0":"data-testid share panel internally generate image button"},downloadImageButton:{"11.5.0":"data-testid share panel internally download image button"}}},ShareExternally:{container:{"11.3.0":"data-testid share externally drawer container"},publicAlert:{"11.3.0":"data-testid public share alert"},emailSharingAlert:{"11.3.0":"data-testid email share alert"},shareTypeSelect:{"11.3.0":"data-testid share externally share type select"},Creation:{PublicShare:{createButton:{"11.3.0":"data-testid public share dashboard create button"},cancelButton:{"11.3.0":"data-testid public share dashboard cancel button"}},EmailShare:{createButton:{"11.3.0":"data-testid email share dashboard create button"},cancelButton:{"11.3.0":"data-testid email share dashboard cancel button"}},willBePublicCheckbox:{"11.3.0":"data-testid share dashboard will be public checkbox"}},Configuration:{enableTimeRangeSwitch:{"11.3.0":"data-testid share externally enable time range switch"},enableAnnotationsSwitch:{"11.3.0":"data-testid share externally enable annotations switch"},copyUrlButton:{"11.3.0":"data-testid share externally copy url button"},revokeAccessButton:{"11.3.0":"data-testid share externally revoke access button"},toggleAccessButton:{"11.3.0":"data-testid share externally pause or resume access button"}}},ShareSnapshot:{url:{"11.3.0":e=>`/dashboard/snapshot/${e}`},container:{"11.3.0":"data-testid share snapshot drawer container"},publishSnapshot:{"11.3.0":"data-testid share snapshot publish button"},copyUrlButton:{"11.3.0":"data-testid share snapshot copy url button"}}},ExportDashboardDrawer:{ExportAsJson:{container:{"11.3.0":"data-testid export as json drawer container"},codeEditor:{"11.3.0":"data-testid export as json code editor"},exportExternallyToggle:{"11.3.0":"data-testid export as json externally switch"},saveToFileButton:{"11.3.0":"data-testid export as json save to file button"},copyToClipboardButton:{"11.3.0":"data-testid export as json copy to clipboard button"},cancelButton:{"11.3.0":"data-testid export as json cancel button"}}},PublicDashboard:{page:{"9.5.0":"public-dashboard-page"},NotAvailable:{container:{"9.5.0":"public-dashboard-not-available"},title:{"9.5.0":"public-dashboard-title"},pausedDescription:{"9.5.0":"public-dashboard-paused-description"}},footer:{"11.0.0":"public-dashboard-footer"}},PublicDashboardScene:{loadingPage:{"11.0.0":"public-dashboard-scene-loading-page"},page:{"11.0.0":"public-dashboard-scene-page"},controls:{"11.0.0":"public-dashboard-controls"}},RequestViewAccess:{form:{"9.5.0":"request-view-access-form"},recipientInput:{"9.5.0":"request-view-access-recipient-input"},submitButton:{"9.5.0":"request-view-access-submit-button"}},PublicDashboardConfirmAccess:{submitButton:{"10.2.0":"data-testid confirm-access-submit-button"}},Explore:{url:{[Yk]:"/explore"},General:{container:{[Yk]:"data-testid Explore"},graph:{[Yk]:"Explore Graph"},table:{[Yk]:"Explore Table"},scrollView:{"9.0.0":"data-testid explorer scroll view"},addFromQueryLibrary:{"11.5.0":"data-testid explore add from query library button"}},QueryHistory:{container:{"11.1.0":"data-testid QueryHistory"}}},SoloPanel:{url:{[Yk]:e=>`/d-solo/${e}`}},PluginsList:{page:{[Yk]:"Plugins list page"},list:{[Yk]:"Plugins list"},listItem:{[Yk]:"Plugins list item"},signatureErrorNotice:{"10.3.0":"data-testid Unsigned plugins notice",[Yk]:"Unsigned plugins notice"}},PluginPage:{page:{[Yk]:"Plugin page"},signatureInfo:{"10.3.0":"data-testid Plugin signature info",[Yk]:"Plugin signature info"},disabledInfo:{"10.3.0":"data-testid Plugin disabled info",[Yk]:"Plugin disabled info"}},PlaylistForm:{name:{[Yk]:"Playlist name"},interval:{[Yk]:"Playlist interval"},itemDelete:{"10.2.0":"data-testid playlist-form-delete-item"}},BrowseDashboards:{table:{body:{"10.2.0":"data-testid browse-dashboards-table"},row:{"10.2.0":e=>`data-testid browse dashboards row ${e}`},checkbox:{"10.0.0":e=>`data-testid ${e} checkbox`}},NewFolderForm:{form:{"10.2.0":"data-testid new folder form"},nameInput:{"10.2.0":"data-testid new-folder-name-input"},createButton:{"10.2.0":"data-testid new-folder-create-button"}}},SearchDashboards:{table:{"10.2.0":"Search results table"}},Search:{url:{"9.3.0":"/?search=openn"},FolderView:{url:{"9.3.0":"/?search=open&layout=folders"}}},PublicDashboards:{ListItem:{linkButton:{"9.3.0":"public-dashboard-link-button"},configButton:{"9.3.0":"public-dashboard-configuration-button"},trashcanButton:{"9.3.0":"public-dashboard-remove-button"},pauseSwitch:{"10.1.0":"data-testid public dashboard pause switch"}}},UserListPage:{tabs:{allUsers:{"10.0.0":"data-testid all-users-tab"},orgUsers:{"10.0.0":"data-testid org-users-tab"},anonUserDevices:{"10.2.3":"data-testid anon-user-devices-tab"},publicDashboardsUsers:{"10.0.0":"data-testid public-dashboards-users-tab"},users:{"10.0.0":"data-testid users-tab"}},org:{url:{"10.2.0":"/admin/users","9.5.0":"/org/users"}},admin:{url:{"9.5.0":"/admin/users"}},publicDashboards:{container:{"11.1.0":"data-testid public-dashboards-users-list"}},UserListAdminPage:{container:{"10.0.0":"data-testid user-list-admin-page"}},UsersListPage:{container:{"10.0.0":"data-testid users-list-page"}},UserAnonListPage:{container:{"10.4.0":"data-testid user-anon-list-page"}},UsersListPublicDashboardsPage:{container:{"10.0.0":"data-testid users-list-public-dashboards-page"},DashboardsListModal:{listItem:{"10.0.0":e=>`data-testid dashboards-list-item-${e}`}}}},ProfilePage:{url:{"10.2.0":"/profile"}},Plugin:{url:{[Yk]:e=>`/plugins/${e}`}},MigrateToCloud:{url:{"11.2.0":"/admin/migrate-to-cloud"}}},Qk={pages:Wk(Jk),components:Wk(Kk)},eO=o().memo((({id:e,title:t,children:n,forceOpen:i,isOpenDefault:s,renderTitle:a,className:l,itemsCount:c,isNested:u=!1})=>{const h=!1!==s,[d,p]=function(e,t,n){if(!$k)return[t,Vk,Vk];if(!e)throw new Error("useLocalStorage key may not be falsy");var i=n?n.raw?function(e){return e}:n.deserializer:JSON.parse,o=(0,r.useRef)((function(e){try{var r=n?n.raw?String:n.serializer:JSON.stringify,o=localStorage.getItem(e);return null!==o?i(o):(t&&localStorage.setItem(e,r(t)),t)}catch(e){return t}})),s=(0,r.useState)((function(){return o.current(e)})),a=s[0],l=s[1];(0,r.useLayoutEffect)((function(){return l(o.current(e))}),[e]);var c=(0,r.useCallback)((function(t){try{var r,o="function"==typeof t?t(a):t;if(void 0===o)return;r=n?n.raw?"string"==typeof o?o:JSON.stringify(o):n.serializer?n.serializer(o):JSON.stringify(o):JSON.stringify(o),localStorage.setItem(e,r),l(i(r))}catch(e){}}),[e,l]),u=(0,r.useCallback)((function(){try{localStorage.removeItem(e),l(void 0)}catch(e){}}),[e,l]);return[a,c,u]}(nO(e),{isExpanded:h});var f;const[g,m]=(0,r.useState)(null!==(f=null==d?void 0:d.isExpanded)&&void 0!==f?f:h),_=(0,Pl.useStyles2)(tO);(0,r.useEffect)((()=>{!g&&i&&i>0&&m(!0)}),[i,g]);const y=(0,r.useCallback)((()=>{p({isExpanded:!g}),m(!g)}),[p,m,g]);a||(a=function(e){return e||void 0===c||0===c?t:o().createElement("span",null,t," ",o().createElement(Pl.Counter,{value:c}))});const v=(0,CS.cx)({[_.box]:!0,[_.boxNestedExpanded]:u&&g},l,"options-group"),b=(0,CS.cx)(_.header,{[_.headerExpanded]:g,[_.headerNested]:u}),x=(0,CS.cx)(_.body,{[_.bodyNested]:u});return o().createElement("div",{className:v,"data-testid":"options-category","aria-label":Qk.components.OptionsGroup.group(e)},o().createElement("div",{className:b,onClick:y,"aria-label":Qk.components.OptionsGroup.toggle(e)},o().createElement("div",{className:(0,CS.cx)(_.toggle,"editor-options-group-toggle")},o().createElement(Pl.Icon,{name:g?"angle-down":"angle-right"})),o().createElement("div",{className:_.title,role:"heading"},a(g))),g&&o().createElement("div",{className:x},n))}));eO.displayName="OptionsPaneCategory";const tO=e=>({box:CS.css`
      border-top: 1px solid ${e.colors.border.weak};
    `,boxNestedExpanded:CS.css`
      margin-bottom: ${e.spacing(2)};
    `,toggle:CS.css`
      color: ${e.colors.text.secondary};
      margin-right: ${e.spacing(1)};
    `,title:CS.css`
      flex-grow: 1;
      overflow: hidden;
    `,header:CS.css`
      display: flex;
      cursor: pointer;
      align-items: baseline;
      padding: ${e.spacing(1)};
      color: ${e.colors.text.primary};
      font-weight: ${e.typography.fontWeightMedium};

      &:hover {
        background: ${e.colors.emphasize(e.colors.background.primary,.03)};
      }
    `,headerExpanded:CS.css`
      color: ${e.colors.text.primary};
    `,headerNested:CS.css`
      padding: ${e.spacing(.5,0,.5,0)};
    `,body:CS.css`
      padding: ${e.spacing(1,2,1,4)};
    `,bodyNested:CS.css`
      position: relative;
      padding-right: 0;
      &:before {
        content: '';
        position: absolute;
        top: 0;
        left: 8px;
        width: 1px;
        height: 100%;
        background: ${e.colors.border.weak};
      }
    `}),nO=e=>`grafana.dashboard.editor.ui.optionGroup[${e}]`;function iO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class rO{addItem(e){return e.parent=this,this.items.push(e),this}addCategory(e){return e.props.isNested=!0,e.parent=this,this.categories.push(e),this}render(e){return this.props.customRender?this.props.customRender():o().createElement(eO,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){iO(e,t,n[t])}))}return e}({key:this.props.title},this.props),this.items.map((e=>e.render())),this.categories.map((e=>e.render())))}constructor(e){iO(this,"props",void 0),iO(this,"items",void 0),iO(this,"categories",void 0),iO(this,"parent",void 0),this.props=e,this.items=[],this.categories=[]}}function oO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){oO(e,t,n[t])}))}return e}function aO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function lO(e,t,n){const i=Array.isArray(t)?t:t.split("."),r=i.shift();if(r.endsWith("]")){const t=r.lastIndexOf("["),o=+r.substring(t+1,r.length-1),s=r.substring(0,t);let a=e[s];const l=Array.isArray(a)?[...a]:[];return i.length&&(a=l[o],null!=a&&"object"==typeof a||(a={}),n=lO(a,i,n)),l[o]=n,aO(sO({},e),{[s]:l})}if(!i.length)return aO(sO({},e),{[r]:n});let o=e[r];return null!=o&&"object"==typeof o||(o={}),aO(sO({},e),{[r]:lO(o,i,n)})}var cO=d(2341),uO=d.n(cO);function hO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class dO{getLabel(e){const{title:t,description:n}=this.props;if(!e)return this.parent.props.title===t?null:t;const i=[];return this.parent.parent&&i.push(this.highlightWord(this.parent.parent.props.title,e)),this.parent.props.title!==t&&i.push(this.highlightWord(this.parent.props.title,e)),o().createElement(Pl.Label,{description:n&&this.highlightWord(n,e),category:i},this.highlightWord(t,e))}highlightWord(e,t){return o().createElement(uO(),{textToHighlight:e,searchWords:[t],highlightClassName:"search-fragment-highlight"})}render(e){const{title:t,description:n,render:i,showIf:r,skipField:s}=this.props,a=`${this.parent.props.id} ${t}`;return r&&!r()?null:s?i():o().createElement(Pl.Field,{label:this.getLabel(e),description:n,key:a,"aria-label":Qk.components.PanelEditor.OptionsPane.fieldLabel(a)},i())}constructor(e){hO(this,"props",void 0),hO(this,"parent",void 0),this.props=e}}function pO(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const fO=[{label:"Countries",description:"Lookup countries by name, two letter code, or three leter code",value:kS},{label:"USA States",description:"Lookup states by name or 2 ",value:"public/gazetteer/usa-states.json"}],gO=({value:e,onChange:t,context:n})=>{const i=(0,Pl.useStyles2)(mO),[s,a]=(0,r.useState)();(0,r.useEffect)((()=>{var t;(t=function*(){const t=yield OS(e);a(t)},function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){pO(o,i,r,s,a,"next",e)}function a(e){pO(o,i,r,s,a,"throw",e)}s(void 0)}))})()}),[e,a]);const{current:l,options:c}=(0,r.useMemo)((()=>{let e=[...fO],t=e.find((e=>e.value===(null==s?void 0:s.path)));return!t&&s&&(t={label:s.path,value:s.path},e.push(t)),{options:e,current:t}}),[s]);return o().createElement(o().Fragment,null,o().createElement(Pl.Select,{menuShouldPortal:!0,value:l,options:c,onChange:e=>t(e.value),allowCustomValue:!0,formatCreateLabel:e=>`Load from URL: ${e}`}),s&&o().createElement(o().Fragment,null,s.error&&o().createElement(Pl.Alert,{title:s.error,severity:"warning"}),s.count&&o().createElement("div",{className:i.keys},o().createElement("b",null,"(",s.count,")"),s.examples(10).map((e=>o().createElement("span",{key:e},e,",")))," ","&ellipsis;")))},mO=e=>({keys:CS.css`
      margin-top: 4px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;

      > span {
        margin-left: 4px;
      }
    `}),_O=({value:t,context:n,onChange:i,item:s})=>{const a=(0,r.useMemo)((()=>n.data.map((t=>({value:t.refId,label:`Query: ${t.refId} (size: ${t.length})`,description:t.fields.map((t=>(0,e.getFieldDisplayName)(t))).join(", ")})))),[n.data]),[l,c]=(0,r.useState)({refIds:[],value:void 0}),u=(0,r.useMemo)((()=>{var e;return null!==(e=a.find((e=>e.value===(null==t?void 0:t.options))))&&void 0!==e?e:((e,t,n)=>{if(n)return e.find((e=>!t.some((t=>e===t))))||void 0})(a,l.refIds,l.value)}),[t,a,l]),h=(0,r.useCallback)((t=>{i((null==t?void 0:t.value)?{id:e.FrameMatcherID.byRefId,options:t.value}:void 0)}),[i]);return a===l.refIds&&(null==u?void 0:u.value)===l.value||c({refIds:a,value:null==u?void 0:u.value}),o().createElement(Pl.Select,{options:a,onChange:h,isClearable:!0,placeholder:"Change filter",value:u})};function yO(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const vO=t=>{return(n=function*(){const n=[];if(t&&t.data&&t.data.length>0&&t.options&&t.options.query&&t.options.query.options){const i=t.data;for(let r=0;r<i.length;r++)if(i[r].refId&&i[r].refId===t.options.query.options){const i=t.data[r];for(const r of i.fields){const o=(0,e.getFieldDisplayName)(r,i,t.data),s=r.name;n.push({value:s,label:o})}}}else if(t&&t.data&&t.data.length>0&&t.data[0]){const i=t.data;for(let r=0;r<i.length;r++){const i=t.data[r];for(const r of i.fields){const o=(0,e.getFieldDisplayName)(r,i,t.data),s=r.name;n.push({value:s,label:o})}}}return n},function(){var e=this,t=arguments;return new Promise((function(i,r){var o=n.apply(e,t);function s(e){yO(o,i,r,s,a,"next",e)}function a(e){yO(o,i,r,s,a,"throw",e)}s(void 0)}))})();var n};function bO(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function xO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){xO(e,t,n[t])}))}return e}function EO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const SO=({options:t,eventBus:n,onChange:i,data:s,filter:a})=>{const l=(0,r.useMemo)((()=>LR.selectOptions((null==t?void 0:t.type)?[t.type]:[kR.type],a)),[null==t?void 0:t.type,a]),c=(0,r.useCallback)((()=>{return(e=function*(){if(!(null==t?void 0:t.geojsonurl))return[];const e=null==t?void 0:t.geojsonurl;if(!e)return;let n=yield fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}}).catch((e=>{console.log(e)}));if(!n)return[];let i=yield n.json();return Object.keys(i.features[0].properties).map((e=>({value:e,label:e})))},function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){bO(o,i,r,s,a,"next",e)}function a(e){bO(o,i,r,s,a,"throw",e)}s(void 0)}))})();var e}),[null==t?void 0:t.geojsonurl]),u=(0,r.useMemo)((()=>{const n=LR.getIfExists(null==t?void 0:t.type);if(!n||!(n.registerOptionsUI||n.showLocation||n.showOpacity))return null;const i=new e.PanelOptionsEditorBuilder;return n.showLocation&&i.addTextInput({path:"name",name:"Layer name",settings:{}}).addTextInput({path:"geojsonurl",name:"GeoJson Url",description:"Url to a file with valid GeoJSON FeatureCollection object",settings:{},showIf:e=>e.type===S.GeoJson}).addCustomEditor({id:"query",path:"query",name:"Data query",editor:_O,showIf:e=>e.type!==S.GeoJson}).addRadio({path:"location.mode",name:"Location",description:"",defaultValue:FS.Auto,settings:{options:[{value:FS.Auto,label:"Auto"},{value:FS.Coords,label:"Coords"},{value:FS.Geojson,label:"Geojson"},{value:FS.Lookup,label:"Lookup"},{value:FS.Geohash,label:"Geohash"}]},showIf:e=>e.type!==S.GeoJson}).addFieldNamePicker({path:"location.geojson",name:"Geojson field",showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===FS.Geojson}}).addFieldNamePicker({path:"location.longitude",name:"Longitude field",settings:{filter:t=>t.type===e.FieldType.number,noFieldsMessage:"No numeric fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===FS.Coords}}).addFieldNamePicker({path:"location.latitude",name:"Latitude field",settings:{filter:t=>t.type===e.FieldType.number,noFieldsMessage:"No numeric fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===FS.Coords}}).addFieldNamePicker({path:"location.geohash",name:"Geohash field",settings:{filter:t=>t.type===e.FieldType.string,noFieldsMessage:"No strings fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===FS.Geohash}}).addFieldNamePicker({path:"location.lookup",name:"Lookup field",settings:{filter:t=>t.type===e.FieldType.string,noFieldsMessage:"No strings fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===FS.Lookup}}).addCustomEditor({id:"gazetteer",path:"location.gazetteer",name:"Gazetteer",editor:gO,showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===FS.Lookup}}).addFieldNamePicker({path:"locField",name:"Target name field",settings:{filter:t=>t.type===e.FieldType.string,noFieldsMessage:"No string fields found"},showIf:e=>e.type!==S.GeoJson}).addSelect({path:"geojsonLocName",name:"Location name GeoJson property",settings:{allowCustomValue:!0,options:[],placeholder:"GeoJson properties",getOptions:c},showIf:e=>e.type===S.GeoJson,defaultValue:""}).addFieldNamePicker({path:"parField",name:"Source name / path to source field",description:"String or Array<String | [lon, lat]>",settings:{filter:t=>t.type===e.FieldType.string,noFieldsMessage:"No string fields found"},showIf:e=>e.type===S.Points}).addFieldNamePicker({path:"edgeLabelField",name:"Edge label field",description:"text is visible in stat2 mode",settings:{noFieldsMessage:"No fields found"},showIf:e=>e.type===S.Points}).addBooleanSwitch({path:"isShowBW",name:"Show secondary metric",description:"experimental: display tput/band ratio with hardcoded color thresholds",defaultValue:!1,showIf:e=>e.type===S.Points}).addNumberInput({path:"bandNumber",name:"Bandwidth #",description:"default bandwidth in bits/sec (SI) (bps).",showIf:e=>e.isShowBW}).addFieldNamePicker({path:"bandField",name:"Bandwidth field",description:"bandwidth in bits/sec (SI) (bps).",settings:{filter:t=>t.type===e.FieldType.number,noFieldsMessage:"No fields found"},showIf:e=>e.isShowBW}).addFieldNamePicker({path:"throughputField",name:"Throughput field",description:"throughput in bits/sec (SI) (bps).",settings:{filter:t=>t.type===e.FieldType.number,noFieldsMessage:"No fields found"},showIf:e=>e.isShowBW}).addSelect({path:"geojsonMetricName",name:"Metric name GeoJson property",description:"select Metric GeoJson property with numeric values",settings:{allowCustomValue:!0,options:[],placeholder:"GeoJson properties",getOptions:c},showIf:e=>e.type===S.GeoJson}).addFieldNamePicker({path:"aggrTypeField",name:"Aggr type field",description:"flag some extra locations as 'node' or 'connector' to aggregate and offset links at endpoints",settings:{filter:t=>t.type===e.FieldType.string,noFieldsMessage:"No string fields found"},showIf:e=>"string"==typeof e.parField&&e.type===S.Points}).addBooleanSwitch({path:"isShowTooltip",name:"Show tooltip",description:"applies to current layer",defaultValue:!0}).addMultiSelect({path:"displayProperties",name:"Tooltip properties",description:"applies to current layer",settings:{allowCustomValue:!1,options:[],placeholder:"All Properties",getOptions:vO},showIf:e=>e.type!==S.GeoJson&&e.isShowTooltip,defaultValue:""}).addMultiSelect({path:"geojsonDisplayProperties",name:"Tooltip properties",description:"properties to be displayed from GeoJson file",settings:{allowCustomValue:!0,options:[],placeholder:"Properties",getOptions:c},showIf:e=>e.type===S.GeoJson,defaultValue:""}).addMultiSelect({path:"searchProperties",name:"Search by",description:"extra fields to search by (save & reload)",settings:{allowCustomValue:!1,options:[],placeholder:"Search by location name",getOptions:vO},showIf:e=>e.type===S.Points,defaultValue:""}),n.registerOptionsUI&&n.registerOptionsUI(i),i}),[null==t?void 0:t.type,c]),h=(0,r.useMemo)((()=>{const e=LR.getIfExists(null==t?void 0:t.type);if(!u||!e)return null;const n=new rO({id:"Layer config",title:"Layer config"}),r={data:s,options:t},a=EO(wO({},t),{type:e.id,config:wO({},e.defaultOptions,null==t?void 0:t.config)});return(!t||e.defaultOptions&&!t.config)&&i(a),function(e,t,n,i){for(const r of e){if(r.showIf&&!r.showIf(i.options,i.data))continue;const e=t(r.category),s=r.editor;e.addItem(new dO({title:r.name,description:r.description,render:function(){return o().createElement(s,{value:(0,GS.get)(i.options,r.path),onChange:e=>{n(r.path,e)},item:r,context:i})}}))}}(u.getRegistry().list(),(e=>n),((e,t)=>{i(lO(a,e,t))}),r),o().createElement(o().Fragment,null,o().createElement("br",null),n.items.map((e=>e.render())))}),[u,i,s,t]);return o().createElement("div",null,o().createElement(Pl.Select,{menuShouldPortal:!0,options:l.options,value:l.current,onChange:e=>{null==n||n.publish({type:"mapType",payload:{type:e}});const r=LR.getIfExists(e.value);r?i(EO(wO({},t),{type:r.id,config:wO({},r.defaultOptions)})):console.warn("layer does not exist",e)}}),h)};function TO(t){return!!t.isBaseMap&&(t.state!==e.PluginState.alpha||ZM)}const CO=({value:e,onChange:t,context:n})=>IS.config.geomapDisableCustomBaseLayer?o().createElement("div",null,"The base layer is configured by the server admin."):o().createElement(SO,{options:e,eventBus:n.eventBus,data:n.data,onChange:t,filter:TO});function AO(t){return!t.isBaseMap&&(t.state!==e.PluginState.alpha||ZM)}const PO=({value:e,onChange:t,context:n})=>{const i=(0,Pl.useStyles2)((e=>({collapsible:CS.css`
      margin-top: 5px;
      padding-left: 5px;    
      border-bottom: solid 0.001px;      
    `})));return o().createElement(o().Fragment,null,o().createElement("div",{className:"data-layer-add"},o().createElement(Pl.ToolbarButton,{icon:"plus",tooltip:"add new layer",variant:"primary",key:"Add",onClick:()=>{let n=e?WS().cloneDeep(e):[];n.push(TM),t(n)}},"Add Layer")),(e||[]).map(((r,s)=>o().createElement(o().Fragment,null,o().createElement(Pl.CollapsableSection,{className:i.collapsible,label:r.name?r.name+" layer":"unnamed layer",isOpen:!1},o().createElement(SO,{options:r||void 0,data:n.data,onChange:n=>{let i=e?WS().cloneDeep(e):[];i[s]=n,t(i)},filter:AO}),o().createElement("div",{className:"data-layer-remove"},o().createElement(Pl.ToolbarButton,{icon:"trash-alt",tooltip:"delete",variant:"destructive",key:"Delete",onClick:n=>{(n=>{let i=e?WS().cloneDeep(e):[];i.splice(n,1),t(i)})(s)}},"Delete")))))))};function IO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class MO extends r.PureComponent{componentDidMount(){this.setState({text:isNaN(this.props.value)?"":`${this.props.value}`})}componentDidUpdate(e){if(this.props.value!==e.value){const e=isNaN(this.props.value)?"":`${this.props.value}`;e!==this.state.text&&this.setState({text:e})}}renderInput(){return o().createElement(Pl.Input,{type:"number",ref:this.inputRef,min:this.props.min,max:this.props.max,step:this.props.step,autoFocus:this.props.autoFocus,value:this.state.text,onChange:this.onChange,onBlur:this.updateValue,onKeyPress:this.onKeyPress,placeholder:this.props.placeholder})}render(){const{inputCorrected:e}=this.state;if(e){let t="",{min:n,max:i}=this.props;return null==i?null!=n&&(t=`< ${n}`):t=null!=n?`${n} < > ${i}`:`> ${i}`,o().createElement(Pl.Field,{invalid:e,error:`Out of range ${t}`,validationMessageHorizontalOverflow:!0,style:{direction:"rtl"}},this.renderInput())}return this.renderInput()}constructor(...e){super(...e),IO(this,"state",{text:"",inputCorrected:!1}),IO(this,"inputRef",o().createRef()),IO(this,"updateValue",(()=>{var e;let t;const n=null===(e=this.inputRef.current)||void 0===e?void 0:e.value;(null==n?void 0:n.length)&&(t=+n,isNaN(t))||(t!==this.props.value&&this.props.onChange(t),this.state.inputCorrected&&this.setState({inputCorrected:!1}))})),IO(this,"updateValueDebounced",(0,GS.debounce)(this.updateValue,500)),IO(this,"onChange",(e=>{let t,n=!1;const i=this.props.min,r=this.props.max,o=e.currentTarget.valueAsNumber;Number.isNaN(o)||(null!=i&&o<i?(t=i.toString(),n=!0):null!=r&&o>r?(t=r.toString(),n=!0):t=e.currentTarget.value),this.setState({text:t||"",inputCorrected:n}),this.updateValueDebounced()})),IO(this,"onKeyPress",(e=>{"Enter"===e.key&&this.updateValue()}))}}function RO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){RO(e,t,n[t])}))}return e}function OO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const LO=({value:e,onChange:i,context:s})=>{const a=(0,r.useCallback)((e=>{var t;null===(t=s.eventBus)||void 0===t||t.publish({type:"mapView",payload:"update"}),i(e)}),[i,s.eventBus]),l=(0,r.useMemo)((()=>{const t=[];return(null==e?void 0:e.id)?t.push(e.id):t.push(n.list()[0].id),n.selectOptions(t)}),[null==e?void 0:e.id]),c=(0,r.useCallback)((()=>{const n=dk;if(n){const i=n.getCenter(),r=n.getZoom();if(i&&r){const{lng:n,lat:o}=i;a(OO(kO({},e),{id:t.Coordinates,lon:+n.toFixed(6),lat:+o.toFixed(6),zoom:+r.toFixed(2)}))}}}),[e,a]),u=(0,r.useCallback)((i=>{const r=n.getIfExists(i.value);var o,s,l;r&&r.id!==t.Auto?a(OO(kO({},e),{id:r.id,lat:null!==(o=r.lat)&&void 0!==o?o:null==e?void 0:e.lat,lon:null!==(s=r.lon)&&void 0!==s?s:null==e?void 0:e.lon,zoom:null!==(l=r.zoom)&&void 0!==l?l:null==e?void 0:e.zoom})):r&&r.id===t.Auto&&a(OO(kO({},e),{id:r.id}))}),[e,a]);var h;return o().createElement(o().Fragment,null,o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"View",labelWidth:10,grow:!0},o().createElement(Pl.Select,{menuShouldPortal:!0,options:l.options,value:l.current,onChange:u}))),(null==e?void 0:e.id)===t.Coordinates&&o().createElement(o().Fragment,null,o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Latitude",labelWidth:10,grow:!0},o().createElement(MO,{value:e.lat,min:-90,max:90,step:.001,onChange:t=>{a(OO(kO({},e),{lat:t}))}}))),o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Longitude",labelWidth:10,grow:!0},o().createElement(MO,{value:e.lon,min:-180,max:180,step:.001,onChange:t=>{a(OO(kO({},e),{lon:t}))}})))),o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.InlineField,{label:"Zoom",labelWidth:10,grow:!0},o().createElement(MO,{value:null!==(h=null==e?void 0:e.zoom)&&void 0!==h?h:1,min:1,max:18,step:.01,onChange:t=>{a(OO(kO({},e),{zoom:t}))}}))),o().createElement(Pl.InlineFieldRow,null,o().createElement(Pl.Button,{variant:"secondary",size:"sm",fullWidth:!0,onClick:c},o().createElement("span",null,"Use current map settings"))))},DO=({value:e,onChange:t,options:n})=>o().createElement(Pl.Select,{width:20,isLoading:!1,value:e,onChange:e=>{t(null==e?void 0:e.value)},options:n}),FO=e=>{const t=(0,Pl.useStyles2)(NO);if(e.context.data&&e.context.data.length>0){const n=e.context.data.flatMap((e=>e.fields)).map((e=>({label:e.name,value:e.name,type:e.type})));return o().createElement(o().Fragment,null,o().createElement(Pl.InlineField,{shrink:!0,label:"override "+(e.index+1)},o().createElement(DO,{context:e.context,options:n,item:e.context.item,value:e.overrideField.name,onChange:t=>{"string"==typeof t&&e.nameTypeSetter(e.index,t,n.find((e=>e.value===t)).type)}})),o().createElement(Pl.InlineField,{label:"values"},o().createElement(Pl.AutoSizeInput,{minWidth:10,onCommitChange:t=>{e.valueSetter(e.index,t.currentTarget.value)},defaultValue:e.overrideField.value,placeholder:"val1,val2..."})),o().createElement(Pl.InlineField,{className:t.rmButton},o().createElement(Pl.IconButton,{disabled:e.disabled,key:"deleteThresholdField",variant:"destructive",name:"x",tooltip:"rm override field",onClick:()=>e.remover(e.index)})))}return o().createElement(Pl.Select,{onChange:()=>{},disabled:!0})},NO=e=>({colorPicker:CS.css`
      padding: 0 ${e.spacing(1)};
    `,rmButton:CS.css`
          align-items: center;
        `}),BO=j(10,150,5,!1),zO=(j(-20,20,5,!1),(t,n)=>{const i=(0,Pl.useStyles2)(jO),[s,a]=(0,r.useState)((()=>{if(!t.rule.overrides)return[];const e=[];return Object.values(t.rule.overrides).forEach(((t,n)=>{e[n]={overrideField:t,order:n,ID:VC()}})),e})),l=(xI.map((e=>({label:e,value:"cisco/"+e}))),wI.map((e=>({label:e,value:"networking/"+e}))),EI.map((e=>({label:e,value:"databases/"+e}))),e=>{a(e);const n=[];e.forEach((e=>{n.push(e.overrideField)})),t.overrideSetter(t.index,n)}),c=(e,t,n)=>{s[e].overrideField.name=t,s[e].overrideField.type=n,l([...s])},u=(e,t)=>{s[e].overrideField.value=t,l([...s])},h=e=>{const t=[...s];let n=0;for(let i=0;i<t.length;i++)if(t[i].order===e){n=i;break}t.splice(n,1);for(let e=0;e<t.length;e++)t[e].order=e;l([...t])},[d,p]=(0,r.useState)(t.rule.iconRuleLabel),[f,g]=(0,r.useState)(t.rule.iconSize),[m,_]=(0,r.useState)(t.rule.iconVOffset),[y,v]=(0,r.useState)(t.rule.iconName);return o().createElement(Pl.InlineFieldRow,{className:i.inlineRow},o().createElement(Pl.InlineField,{shrink:!0,label:"label"},o().createElement(Pl.AutoSizeInput,{key:t.index,defaultValue:d,placeholder:"rule label",onCommitChange:e=>{const{value:n}=e.currentTarget;p(n),t.iconLabelSetter(t.index,n)}})),o().createElement(Pl.InlineField,{label:"size"},o().createElement(Pl.Select,{disabled:t.disabled,menuShouldPortal:!0,value:f,onChange:e=>{const n="string"==typeof e.value?parseFloat(e.value):e.value;n&&(g(e),t.iconSizeSetter(t.index,n))},options:"number"==typeof f?BO.concat([{value:f,label:f.toString()}]):BO,allowCustomValue:!0})),o().createElement(Pl.InlineField,{shrink:!0,label:"offset",className:i.voffset},o().createElement(Pl.Input,{disabled:t.disabled,type:"number",step:"1.0",key:t.index,defaultValue:m,onChange:e=>{const{value:n}=e.currentTarget,i="string"==typeof n?parseFloat(n):n;"number"==typeof i&&(_(i),t.iconVOffsetSetter(t.index,i))}})),s&&s.map(((e,n)=>o().createElement(FO,{disabled:t.disabled||!1,key:`rule-field-index-${e.ID}`,ID:e.ID,overrideField:e.overrideField,nameTypeSetter:c,valueSetter:u,remover:h,index:n,context:t.context}))),o().createElement(Pl.InlineField,{shrink:!0,label:"icon name"},o().createElement(GI,{value:{fixed:t.rule.iconName,mode:oC.Fixed},context:n,onChange:e=>{var n;e&&("custom_icon"===e.fixed?v(e.fixed):"string"==typeof(n=e.fixed)&&(t.iconNameSetter(t.index,n),v(n)))},item:{settings:{resourceType:lC.Icon,folderName:aC.Networking,placeholderText:"Select an icon",showSourceRadio:!1,maxFiles:2e3}}})),o().createElement(Pl.InlineField,{className:i.addButton},o().createElement(Pl.IconButton,{disabled:t.disabled,key:"addRuleField",variant:"primary",name:"plus",tooltip:"add override",onClick:()=>{const t=s.length,n={overrideField:{name:"",value:"",type:e.FieldType.string},order:t,ID:VC()};l([...s,n])}})))}),jO=e=>({ruleContainer:CS.css`
      display: flex;
      align-items: center;
      //flex: 1; // Use flex: 1 to distribute space equally among child elements
      justify-content: space-between;
    `,colorPicker:CS.css`
      padding: 0 ${e.spacing(1)};
    `,nodeSelect:CS.css`
      margin: 5px 0px;
    `,inlineField:CS.css`
      flex: 1 0 auto;
    `,inlineRow:CS.css`
      //display: flex;
      //align-items: center;
     margin-top: 10px;      
    `,voffset:CS.css`
      //display: inline-block; /* Ensures the field takes only the space it needs */
      width: 30%;
      flex-shrink: 1;
    `,addButton:CS.css`
      align-items: center;
    `}),UO=e=>{const[t,n]=(0,r.useState)((()=>{if(!e.rules)return[];const t=[];return e.rules.forEach(((e,n)=>{t[n]={rule:e,order:n,ID:VC()}})),t})),i=(0,Pl.useTheme2)(),s=t=>{n(t);const i=[];t.forEach((e=>{i.push(e.rule)})),e.setter(i)},a=(e,n,i)=>{n&&(t[e].rule.overrides=n,s([...t]))},l=(e,n)=>{let r=n;void 0!==i.visualization&&(r=i.visualization.getColorByName(n)),t[e].rule.svgColor=O(r),s([...t])},c=(e,n)=>{t[e].rule.iconRuleLabel=n,s([...t])},u=(e,n)=>{t[e].rule.iconSize=n,s([...t])},h=e=>{t[e].rule.iconRuleCollapsed=!t[e].rule.iconRuleCollapsed,s([...t])},d=(e,n)=>{t[e].rule.iconVOffset=n,s([...t])},p=(e,n)=>{t[e].rule.iconName=n,s([...t])},f=e=>{const n=[...t];let i=0;for(let t=0;t<n.length;t++)if(n[t].order===e){i=t;break}n.splice(i,1);for(let e=0;e<n.length;e++)n[e].order=e;s([...n])};return o().createElement(o().Fragment,null,o().createElement(Pl.Button,{disabled:e.disabled,fill:"solid",variant:"primary",icon:"plus",onClick:()=>{const e={rule:{overrides:[],iconRuleLabel:"new rule",iconRuleCollapsed:!0,iconSize:20,iconVOffset:-5,iconName:""},order:t.length,ID:VC()};s([...t,e])}},"Add icon rule"),t&&t.map(((t,n)=>{var i;return o().createElement(Pl.CollapsableSection,{key:n,isOpen:t.rule.iconRuleCollapsed,label:o().createElement("span",null,n+1," ",null!==(i=t.rule.iconRuleLabel)&&void 0!==i?i:"rule",o().createElement(o().Fragment,null,""),o().createElement(Pl.IconButton,{disabled:e.disabled,key:"deleteRule",variant:"secondary",name:"trash-alt",tooltip:"delete icon rule",onClick:e=>{f(n),e.stopPropagation()}})),onToggle:()=>h(n)},o().createElement(zO,{disabled:e.disabled||!1,key:`rule-item-index-${t.ID}`,ID:t.ID,rule:t.rule,colorSetter:l,iconLabelSetter:c,iconSizeSetter:u,iconVOffsetSetter:d,iconNameSetter:p,overrideSetter:a,remover:f,index:n,context:e.context}))})))},VO=({context:e,onChange:t})=>{const[n,i]=(0,r.useState)(e.options.svgIconsConfig);return o().createElement(o().Fragment,null,o().createElement(Pl.Field,null,o().createElement(UO,{context:e,rules:n,setter:e=>{i(e),t(e)}})))},$O=new e.PanelPlugin((({options:e,data:t,width:n,height:i,replaceVariables:r,eventBus:s,onOptionsChange:a})=>{(null==e?void 0:e.dataLayer)&&!(null==e?void 0:e.dataLayers)&&(e.dataLayers=[e.dataLayer],e.dataLayer=null);const l=(0,Pl.useTheme2)(),c=(u=kk({},(0,Pl.usePanelContext)()),h={onToggleSeriesVisibility:void 0,onSeriesColorChange:(t,n)=>{var i;const r=kk({},e);null===(i=r.globalThresholdsConfig)||void 0===i||i.forEach((e=>{if(e.label===t){const t=l.visualization.getColorByName(n);t&&(e.color=O(t))}})),null==s||s.publish({type:"thresholdType",payload:{thresholds:r.globalThresholdsConfig}}),a(r)}},h=null!=h?h:{},Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(h)):function(e){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t.push.apply(t,n)}return t}(Object(h)).forEach((function(e){Object.defineProperty(u,e,Object.getOwnPropertyDescriptor(h,e))})),u);var u,h;return o().createElement(Pl.PanelContextProvider,{value:c},o().createElement(Ak,{props:{replaceVariables:r,theme2:l}},o().createElement(fk,{options:e,data:t,width:n,height:i,eventBus:s})))})).setNoPadding().setPanelOptions((e=>{e.addCustomEditor({category:["Map view"],id:"view",path:"view",name:"Initial view",description:"This location will show when the panel first loads",editor:LO,defaultValue:i}),e.addCustomEditor({category:["Base layer"],id:"basemap",path:"basemap",name:"Base layer",editor:CO,defaultValue:kR}),e.addCustomEditor({category:["Data layers"],id:"dataLayers",path:"dataLayers",name:"Data layers",editor:PO}),e.addTextInput({category:["Other settings"],path:"common.locLabelName",name:"Location name label in alert annotation",settings:{}}).addBooleanSwitch({category:["Other settings"],path:"common.isShowLegend",name:"Show legend",defaultValue:!0}).addCustomEditor({category:["Svg icons"],id:"svgIconsConfig",path:"svgIconsConfig",name:"Svg icons",editor:VO}).addCustomEditor({name:"Default thresholds to be applied to all metrics that do not have an override",id:"globalThresholdsConfig",path:"globalThresholdsConfig",description:"for primary metric (stat1)",editor:Uk,defaultValue:[],category:["Thresholds"]})})).setDataSupport({annotations:!0,alertStates:!0})})(),p})()));
//# sourceMappingURL=module.js.map